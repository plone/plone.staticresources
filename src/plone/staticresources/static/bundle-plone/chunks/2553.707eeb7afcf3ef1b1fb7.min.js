(self.webpackChunkplone_staticresources=self.webpackChunkplone_staticresources||[]).push([[2553],{2553:function(){!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const t=(r="string",e=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(r=o=e,(a=String).prototype.isPrototypeOf(r)||o.constructor?.name===a.name)?"string":t;var r,o,a})(e)===r);var r;const o=(a=void 0,e=>a===e);var a,s=tinymce.util.Tools.resolve("tinymce.util.Delay"),n=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),i=tinymce.util.Tools.resolve("tinymce.util.Tools");const u=e=>{const t=/^(\d+)([ms]?)$/.exec(e);return(t&&t[2]?{s:1e3,m:6e4}[t[2]]:1)*parseInt(e,10)},c=e=>t=>t.options.get(e),l=c("autosave_ask_before_unload"),m=c("autosave_restore_when_empty"),d=c("autosave_interval"),f=c("autosave_retention"),p=e=>{const t=document.location;return e.options.get("autosave_prefix").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},v=(e,t)=>{if(o(t))return e.dom.isEmpty(e.getBody());{const r=i.trim(t);if(""===r)return!0;{const t=(new DOMParser).parseFromString(r,"text/html");return e.dom.isEmpty(t)}}},y=e=>{const t=parseInt(n.getItem(p(e)+"time")??"0",10)||0;return!((new Date).getTime()-t>f(e))||(g(e,!1),!1)},g=(e,t)=>{const r=p(e);n.removeItem(r+"draft"),n.removeItem(r+"time"),!1!==t&&(e=>{e.dispatch("RemoveDraft")})(e)},h=e=>{const t=p(e);!v(e)&&e.isDirty()&&(n.setItem(t+"draft",e.getContent({format:"raw",no_events:!0})),n.setItem(t+"time",(new Date).getTime().toString()),(e=>{e.dispatch("StoreDraft")})(e))},D=e=>{const t=p(e);y(e)&&(e.setContent(n.getItem(t+"draft")??"",{format:"raw"}),(e=>{e.dispatch("RestoreDraft")})(e))};var _=tinymce.util.Tools.resolve("tinymce.EditorManager");const b=e=>t=>{const r=()=>y(e)&&!e.mode.isReadOnly();t.setEnabled(r());const o=()=>t.setEnabled(r());return e.on("StoreDraft RestoreDraft RemoveDraft",o),()=>e.off("StoreDraft RestoreDraft RemoveDraft",o)},w=e=>{(e=>{const t=d(e);s.setEditorInterval(e,()=>{h(e)},t)})(e);const t=()=>{(e=>{e.undoManager.transact(()=>{D(e),g(e)}),e.focus()})(e)};e.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:t,onSetup:b(e)}),e.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:t,onSetup:b(e)})};e.add("autosave",e=>((e=>{const r=e.options.register,o=e=>{const r=t(e);return r?{value:u(e),valid:r}:{valid:!1,message:"Must be a string."}};r("autosave_ask_before_unload",{processor:"boolean",default:!0}),r("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),r("autosave_restore_when_empty",{processor:"boolean",default:!1}),r("autosave_interval",{processor:o,default:"30s"}),r("autosave_retention",{processor:o,default:"20m"})})(e),(e=>{e.editorManager.on("BeforeUnload",e=>{let t;i.each(_.get(),e=>{e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&l(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t&&(e.preventDefault(),e.returnValue=t)})})(e),w(e),e.on("init",()=>{m(e)&&e.dom.isEmpty(e.getBody())&&D(e)}),(e=>({hasDraft:()=>y(e),storeDraft:()=>h(e),restoreDraft:()=>D(e),removeDraft:t=>g(e,t),isEmpty:t=>v(e,t)}))(e)))}()}}]);
//# sourceMappingURL=2553.707eeb7afcf3ef1b1fb7.min.js.map