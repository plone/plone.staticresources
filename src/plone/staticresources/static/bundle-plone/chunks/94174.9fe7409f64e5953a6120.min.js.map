{"version":3,"file":"chunks/94174.9fe7409f64e5953a6120.min.js","mappings":"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","sources":["webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/mockup-parser.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/base.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/basepattern.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/dom.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/events.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/logging.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/parser.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/polyfills.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/registry.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/utils.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/uuid.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/store.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/date-picker/date-picker.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/display-time/display-time.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/close-panel/close-panel.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/tooltip/tooltip.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/core/i18n-wrapper.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/core/i18n.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/core/utils.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/autotoc/autotoc.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/backdrop/backdrop.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/contentbrowser/contentbrowser.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/datatables/datatables.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/modal/modal.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/querystring/querystring.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/relateditems/relateditems.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/select2/select2.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/sortable/sortable.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/upload/upload.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/jquery-ext.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/checklist/checklist.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/datetime-picker/datetime-picker.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/validation/validation.js","webpack://plone.staticresources/./node_modules/@patternslib/pat-code-editor/src/code-editor.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/ajax/ajax.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/inject/inject.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/depends/depends.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/contentloader/contentloader.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/cookietrigger/cookietrigger.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/formautofocus/formautofocus.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/formunloadalert/formunloadalert.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/livesearch/livesearch.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/markspeciallinks/markspeciallinks.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/navigationmarker/navigationmarker.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/passwordstrength/passwordstrength.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/preventdoublesubmit/preventdoublesubmit.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/manageportlets/manageportlets.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/recurrence/recurrence.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/search/search.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/structure/structure.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/structure-updater/structure-updater.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/tinymce/tinymce.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/textareamimetypeselector/textareamimetypeselector.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/toggle/toggle.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/toolbar/toolbar.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/tree/tree.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/dexterity-types-listing.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/registry.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/schemaeditor.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/contentrules.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/contentrule-elements.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/discussion.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/discussion-comments.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/discussion-moderation.js","webpack://plone.staticresources/./node_modules/@plone/mockup/src/patterns.js"],"sourcesContent":["import $ from \"jquery\";\n\nvar parser = {\n    getOptions($el, patternName, options) {\n        /* This is the Mockup parser. An alternative parser for Patternslib\n         * patterns.\n         *\n         * NOTE: Use of the Mockup parser is discouraged and is added here for\n         * legacy support for the Plone Mockup project.\n         *\n         * It parses a DOM element for pattern configuration options.\n         */\n        options = options || {};\n        // get options from parent element first, stop if element tag name is 'body'\n        if ($el.length !== 0 && !$.nodeName($el[0], \"body\")) {\n            options = this.getOptions($el.parent(), patternName, options);\n        }\n        // collect all options from element\n        let elOptions = {};\n        if ($el.length !== 0) {\n            elOptions = $el.data(\"pat-\" + patternName);\n            if (elOptions) {\n                // parse options if string\n                if (typeof elOptions === \"string\") {\n                    const tmpOptions = {};\n                    $.each(elOptions.split(\";\"), function (i, item) {\n                        item = item.split(\":\");\n                        item.reverse();\n                        let key = item.pop();\n                        key = key.replace(/^\\s+|\\s+$/g, \"\"); // trim\n                        item.reverse();\n                        let value = item.join(\":\");\n                        value = value.replace(/^\\s+|\\s+$/g, \"\"); // trim\n                        tmpOptions[key] = value;\n                    });\n                    elOptions = tmpOptions;\n                }\n            }\n        }\n        return $.extend(true, {}, options, elOptions);\n    },\n};\n\nexport default parser;\n","/**\n * A Base pattern for creating scoped patterns. It's similar to Backbone's\n * Model class. The advantage of this approach is that each instance of a\n * pattern has its own local scope (closure).\n *\n * A new instance is created for each DOM element on which a pattern applies.\n *\n * You can assign values, such as $el, to `this` for an instance and they\n * will remain unique to that instance.\n *\n * Older Patternslib patterns on the other hand have a single global scope for\n * all DOM elements.\n */\nimport $ from \"jquery\";\nimport Registry from \"./registry\";\nimport logging from \"./logging\";\nimport mockupParser from \"./mockup-parser\";\n\nconst log = logging.getLogger(\"Patternslib Base\");\n\nconst initBasePattern = function ($el, options, trigger) {\n    if (!$el.jquery) {\n        $el = $($el);\n    }\n    const name = this.prototype.name;\n    const plog = logging.getLogger(`pat.${name}`);\n    let pattern = $el.data(`pattern-${name}`);\n    if (pattern === undefined && Registry.patterns[name]) {\n        try {\n            // Immediately set the pattern instance to the temporary value\n            // ``initializing`` before the async Base constructor is setting\n            // the value later.\n            // This prevents re-init the pattern on this element on multiple\n            // initialization calls..\n            $el.data(`pattern-${name}`, \"initializing\");\n            options =\n                this.prototype.parser === \"mockup\"\n                    ? mockupParser.getOptions($el, name, options)\n                    : options;\n            pattern = new Registry.patterns[name]($el, options, trigger);\n        } catch (e) {\n            plog.error(`Failed while initializing ${name} pattern.`, e);\n        }\n    }\n    return pattern;\n};\n\nconst Base = async function ($el, options, trigger) {\n    if (($el?.jquery && $el.length === 0) || !$el) {\n        log.warn(\"No element given to pattern.\");\n        return;\n    }\n    if (!$el.jquery) {\n        $el = $($el);\n    }\n    this.$el = $el;\n    this.el = $el[0];\n    this.options = $.extend(true, {}, this.defaults || {}, options || {});\n\n    this.emit(\"pre-init\");\n\n    await this.init($el, options, trigger);\n\n    // Store pattern instance on element\n    this.$el.data(`pattern-${this.name}`, this);\n    this.el[`pattern-${this.name}`] = this;\n\n    this.emit(\"init\");\n};\n\nBase.prototype = {\n    constructor: Base,\n    on(eventName, eventCallback) {\n        this.$el.on(`${eventName}.${this.name}.patterns`, eventCallback);\n    },\n    one(eventName, eventCallback) {\n        this.$el.one(`${eventName}.${this.name}.patterns`, eventCallback);\n    },\n    emit(eventName, args) {\n        // args should be a list\n        if (args === undefined) {\n            args = [];\n        }\n        this.$el.trigger(`${eventName}.${this.name}.patterns`, args);\n    },\n};\n\nBase.extend = function (patternProps) {\n    /* Helper function to correctly set up the prototype chain for new patterns.\n     */\n    const parent = this;\n    let child;\n\n    // Check that the required configuration properties are given.\n    if (!patternProps) {\n        throw new Error(\n            \"Pattern configuration properties required when calling Base.extend\"\n        );\n    }\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent's constructor.\n    if (Object.hasOwnProperty.call(patternProps, \"constructor\")) {\n        child = patternProps.constructor;\n    } else {\n        child = function () {\n            parent.apply(this, arguments);\n        };\n    }\n\n    // Allow patterns to be extended indefinitely\n    child.extend = Base.extend;\n\n    // Static properties required by the Patternslib registry\n    child.init = initBasePattern;\n    child.jquery_plugin = true;\n    child.trigger = patternProps.trigger;\n    child.parser = patternProps?.parser || null;\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () {\n        this.constructor = child;\n    };\n    Surrogate.prototype = parent.prototype;\n    child.prototype = new Surrogate();\n\n    // Add pattern's configuration properties (instance properties) to the subclass,\n    $.extend(true, child.prototype, patternProps);\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = parent.prototype;\n\n    // Register the pattern in the Patternslib registry.\n    if (!patternProps.name) {\n        log.warn(\"This pattern without a name attribute will not be registered!\");\n    } else if (!patternProps.trigger) {\n        log.warn(\n            `The pattern ${patternProps.name} does not have a trigger attribute, it will not be registered.`\n        );\n    } else if (patternProps.autoregister !== false) {\n        Registry.register(child, patternProps.name);\n    }\n    return child;\n};\n\nexport default Base;\n","/**\n * A Base pattern for creating scoped patterns.\n *\n * Each instance of a pattern has its own local scope.\n * A new instance is created for each DOM element on which a pattern applies.\n *\n * For usage, see basepattern.md\n */\nimport events from \"./events\";\nimport logging from \"./logging\";\nimport create_uuid from \"./uuid\";\n\nconst log = logging.getLogger(\"basepattern\");\n\nclass BasePattern {\n    static name; // name of pattern used in Registry.\n    static trigger; // A CSS selector to match elements that should trigger the pattern instantiation.\n    static parser; // Options parser.\n\n    // Parser options\n    parser_group_options = true;\n    parser_multiple = undefined;\n    parser_inherit = true;\n\n    constructor(el, options = {}) {\n        // Make static variables available on instance.\n        this.name = this.constructor.name;\n        this.trigger = this.constructor.trigger;\n        this.parser = this.constructor.parser;\n\n        if (!el) {\n            log.warn(`No element given to pattern ${this.name}.`);\n            return;\n        }\n        if (el.jquery) {\n            el = el[0];\n        }\n        this.el = el;\n        this.uuid = create_uuid();\n\n        // Notify pre-init\n        this.el.dispatchEvent(\n            new Event(`pre-init.${this.name}.patterns`, {\n                bubbles: true,\n                cancelable: true,\n            })\n        );\n\n        // Initialize asynchronously.\n        //\n        // 1) We need to call the concrete implementation of ``init``, but the\n        //    inheritance chain is not yet set up and ``init`` not available.\n        //\n        // 2) We want to wait for the init() to successfuly finish and fire an\n        //    event then.\n        //    But the constructer cannot not return a Promise, thus not be\n        //    asynchronous but only return itself.\n        //\n        // Both limitations are gone in next tick.\n        //\n        window.setTimeout(async () => {\n            if (typeof this.el[`pattern-${this.name}`] !== \"undefined\") {\n                // Do not reinstantiate\n                log.debug(`Not reinstatiating the pattern ${this.name}.`, this.el);\n\n                // Notify that not instantiated\n                this.el.dispatchEvent(\n                    new Event(`not-init.${this.name}.patterns`, {\n                        bubbles: true,\n                        cancelable: false,\n                    })\n                );\n                return;\n            }\n\n            // Create the options object by parsing the element and using the\n            // optional options as default.\n            this.options =\n                this.parser?.parse(\n                    this.el,\n                    options,\n                    this.parser_multiple,\n                    this.parser_inherit,\n                    this.parser_group_options\n                ) ?? options;\n\n            // Store pattern instance on element\n            this.el[`pattern-${this.name}`] = this;\n\n            // Initialize the pattern\n            await this.init();\n\n            // Notify that now ready\n            this.el.dispatchEvent(\n                new Event(`init.${this.name}.patterns`, {\n                    bubbles: true,\n                    cancelable: true,\n                })\n            );\n        }, 0);\n    }\n\n    async init() {\n        // Extend this method in your pattern.\n    }\n\n    /**\n     * Listen to an event on the element only once.\n     *\n     * @param {string} event_name - Name of the event to listen to.\n     * @param {function} callback - Callback to call when the event is thrown.\n     */\n    one(event_name, event_callback) {\n        events.add_event_listener(\n            this.el,\n            `${event_name}.${this.name}.patterns`,\n            `basepattern-one--${event_name}.${this.name}.patterns`,\n            event_callback,\n            {\n                once: true,\n            }\n        );\n    }\n\n    /**\n     * Destroy/remove/unload the pattern from the element.\n     */\n    destroy() {\n        delete this.el[`pattern-${this.name}`];\n    }\n}\n\nexport default BasePattern;\nexport { BasePattern };\n","/* Utilities for DOM traversal or navigation */\nimport events from \"./events\";\nimport logging from \"./logging\";\nimport create_uuid from \"./uuid\";\n\nconst logger = logging.getLogger(\"core dom\");\n\nconst DATA_PREFIX = \"__patternslib__data_prefix__\";\nconst DATA_STYLE_DISPLAY = \"__patternslib__style__display\";\n\nconst INPUT_SELECTOR = \"input, select, textarea, button\";\n\n/**\n * Wait for the document to be ready.\n *\n * @param {Function} fn - The function to call when the document is ready.\n */\nconst document_ready = (fn) => {\n    const event_id = create_uuid();\n\n    const _ready = () => {\n        if (document.readyState !== \"loading\") {\n            // Remove the event listener for this callback.\n            events.remove_event_listener(document, event_id);\n            // call on next available tick\n            setTimeout(fn, 1);\n        }\n    };\n\n    // Listen for the document to be ready and call _ready() when it is.\n    events.add_event_listener(document, \"readystatechange\", event_id, _ready);\n\n    // Also check the ready state immediately in case we missed the event.\n    _ready();\n};\n\n/**\n * Return an array of DOM nodes.\n *\n * @param {Node|NodeList|jQuery} nodes - The DOM node to start the search from.\n *\n * @returns {Array} - An array of DOM nodes.\n */\nconst toNodeArray = (nodes) => {\n    if (nodes.jquery || nodes instanceof NodeList) {\n        // jQuery or document.querySelectorAll\n        nodes = [...nodes];\n    } else if (nodes instanceof Array === false) {\n        nodes = [nodes];\n    }\n    return nodes;\n};\n\n/**\n * Like querySelectorAll but including the element where it starts from.\n * Returns an Array, not a NodeList\n *\n * @param {Node} el - The DOM node to start the search from.\n *\n * @returns {Array} - The DOM nodes found.\n */\nconst querySelectorAllAndMe = (el, selector) => {\n    if (!el || !el.querySelectorAll) {\n        return [];\n    }\n\n    const all = [...el.querySelectorAll(selector)];\n    if (el.matches(selector)) {\n        all.unshift(el); // start element should be first.\n    }\n    return all;\n};\n\n/**\n * Wrap a element with a wrapper element.\n *\n * The element to be wrapped will be moved into the wrapper element and the\n * wrapper element is placed just before the old element was.\n *\n * @param {Node} el - The DOM node to wrap.\n * @param {Node} wrapper - The wrapper element.\n */\nconst wrap = (el, wrapper) => {\n    // See: https://stackoverflow.com/a/13169465/1337474\n    el.parentNode.insertBefore(wrapper, el);\n    wrapper.appendChild(el);\n};\n\n/**\n * Hides the element with ``display: none`` and stores the current display value.\n *\n * @param {Node} el - The DOM node to hide.\n */\nconst hide = (el) => {\n    if (el.style.display === \"none\") {\n        // Nothing to do.\n        return;\n    }\n    if (el.style.display) {\n        el[DATA_STYLE_DISPLAY] = el.style.display;\n    }\n    el.style.display = \"none\";\n};\n\n/**\n * Shows element by removing ``display: none`` and restoring the display value\n * to whatever it was before.\n *\n * @param {Node} el - The DOM node to show.\n */\nconst show = (el) => {\n    const val = el[DATA_STYLE_DISPLAY] || null;\n    el.style.display = val;\n    delete el[DATA_STYLE_DISPLAY];\n};\n\n/**\n * Test, if a element is visible or not.\n *\n * @param {Node} el - The DOM node to test.\n * @returns {Boolean} - True if the element is visible.\n */\nconst is_visible = (el) => {\n    // Check, if element is visible in DOM.\n    // https://stackoverflow.com/a/19808107/1337474\n    return el.offsetWidth > 0 && el.offsetHeight > 0;\n};\n\n/**\n * Test, if a element is a input-type element.\n *\n * This is taken from Sizzle/jQuery at:\n * https://github.com/jquery/sizzle/blob/f2a2412e5e8a5d9edf168ae3b6633ac8e6bd9f2e/src/sizzle.js#L139\n * https://github.com/jquery/sizzle/blob/f2a2412e5e8a5d9edf168ae3b6633ac8e6bd9f2e/src/sizzle.js#L1773\n *\n * @param {Node} el - The DOM node to test.\n * @returns {Boolean} - True if the element is a input-type element.\n */\nconst is_input = (el) => {\n    const re_input = /^(?:input|select|textarea|button)$/i;\n    return re_input.test(el.nodeName);\n};\n\n/**\n * Test, if a element is a button-like input type.\n *\n * @param {Node} el - The DOM node to test.\n * @returns {Boolean} - True if the element is a input-type element.\n */\nconst is_button = (el) => {\n    return el.matches(`\n        button,\n        input[type=image],\n        input[type=button],\n        input[type=reset],\n        input[type=submit]\n    `);\n};\n\n\n\n/**\n * Return all direct parents of ``el`` matching ``selector``.\n * This matches against all parents but not the element itself.\n * The order of elements is from the search starting point up to higher\n * DOM levels.\n *\n * @param {Node} el - The DOM node to start the search from.\n * @param {String} selector - CSS selector to match against.\n * @returns {Array} - List of matching DOM nodes.\n */\nconst find_parents = (el, selector) => {\n    const ret = [];\n    let parent = el;\n    while (parent) {\n        parent = parent.parentNode?.closest?.(selector);\n        if (parent) ret.push(parent);\n    }\n    return ret;\n};\n\n/**\n * Find an element in the whole DOM tree if the selector is an ID selector,\n * otherwise use the given element as the starting point.\n *\n * @param {Node} el - The DOM node to start the search from.\n * @param {String} selector - The CSS selector to search for.\n *\n * @returns {NodeList} - The DOM nodes found.\n *\n */\nconst find_scoped = (el, selector) => {\n    // If the selector starts with an object id do a global search,\n    // otherwise do a local search.\n    return (selector.indexOf(\"#\") === 0 ? document : el).querySelectorAll(selector);\n};\n\n/**\n * Return all HTMLElement parents of el, starting from the direct parent of el.\n * The document itself is excluded because it's not a real DOM node.\n *\n * @param {Node} el - The DOM node to start the search from.\n *\n * @returns {Array} - The DOM nodes found.\n */\nconst get_parents = (el) => {\n    // Return all HTMLElement parents of el, starting from the direct parent of el.\n    const parents = [];\n    let parent = el?.parentNode;\n    while (parent) {\n        parents.push(parent);\n        parent = parent?.parentNode;\n        parent = parent instanceof HTMLElement ? parent : null;\n    }\n    return parents;\n};\n\n/**\n * Return the value of the first attribute found in the list of parents.\n *\n * @param {Node} el - The DOM element to start the acquisition search for the given attribute.\n * @param {string} attribute - Name of the attribute to search for.\n * @param {Boolean} include_empty - Also return empty values.\n * @param {Boolean} include_all - Return a list of attribute values found in all parents.\n *\n * @returns {*} - Returns the value of the searched attribute or a list of all attributes.\n */\nconst acquire_attribute = (\n    el,\n    attribute,\n    include_empty = false,\n    include_all = false\n) => {\n    let _el = el;\n    const ret = []; // array for ``include_all`` mode.\n    while (_el) {\n        const val = _el.getAttribute(attribute);\n        if (val || (include_empty && val === \"\")) {\n            if (!include_all) {\n                return val;\n            }\n            ret.push(val);\n        }\n        _el = _el.parentElement;\n    }\n    if (include_all) {\n        return ret;\n    }\n};\n\n/**\n * Return a DocumentFragment from a given string.\n *\n * @param {String} string - The HTML structure as a string.\n *\n * @returns {DocumentFragment} - The DOM nodes as a DocumentFragment.\n */\nconst create_from_string = (string) => {\n    // See: https://davidwalsh.name/convert-html-stings-dom-nodes\n    return document.createRange().createContextualFragment(string.trim());\n};\n\n/**\n * Return a CSS property value for a given DOM node.\n * For length-values, relative values are converted to pixels.\n * Optionally parse as pixels, if applicable.\n *\n * Note: The element must be attached to the body to make CSS caluclations work.\n *\n * @param {Node} el - DOM node.\n * @param {String} property - CSS property to query on DOM node.\n * @param {Boolean} [as_pixels=false] - Convert value to pixels, if applicable.\n * @param {Boolean} [as_float=false] - Convert value to float, if applicable.\n *\n * @returns {(String|Number)} - The CSS value to return.\n */\nfunction get_css_value(el, property, as_pixels = false, as_float = false) {\n    let value = window.getComputedStyle(el).getPropertyValue(property);\n    if (as_pixels || as_float) {\n        value = parseFloat(value) || 0.0;\n    }\n    if (as_pixels && !as_float) {\n        value = parseInt(Math.round(value), 10);\n    }\n    return value;\n}\n\n/**\n * Find a scrollable element up in the DOM tree.\n *\n * Note: Setting the ``overflow`` shorthand property also sets the individual overflow-y and overflow-y properties.\n *\n * @param {Node} el - The DOM element to start the search on.\n * @param {String} [direction=] - Not given: Search for any scrollable element up in the DOM tree.\n *                                ``x``: Search for a horizontally scrollable element.\n *                                ``y``: Search for a vertically scrollable element.\n * @param {(Node|null)} [fallback=document.body] - Fallback, if no scroll container can be found.\n *                                                     The default is to use document.body.\n *\n * @returns {Node} - Return the first scrollable element.\n *                   If no other element could be found, document.body would be returned.\n */\nconst find_scroll_container = (el, direction, fallback = document.body) => {\n    while (el && el !== document.body) {\n        if (!direction || direction === \"y\") {\n            let overflow_y = get_css_value(el, \"overflow-y\");\n            if ([\"auto\", \"scroll\"].includes(overflow_y)) {\n                return el;\n            }\n        }\n        if (!direction || direction === \"x\") {\n            let overflow_x = get_css_value(el, \"overflow-x\");\n            if ([\"auto\", \"scroll\"].includes(overflow_x)) {\n                return el;\n            }\n        }\n        el = el.parentElement;\n    }\n    return fallback;\n};\n\n/**\n * Get the horizontal scroll position.\n *\n * @param {Node} scroll_reference - The element to get the scroll position from.\n *\n * @returns {number} The horizontal scroll position.\n */\nconst get_scroll_x = (scroll_reference) => {\n    // scroll_listener == window: window.scrollX\n    // scroll_listener == html: html.scrollLeft == window.scrollX\n    // scroll_listener == DOM node: node.scrollLeft\n    return typeof scroll_reference.scrollLeft !== \"undefined\"\n        ? scroll_reference.scrollLeft\n        : scroll_reference.scrollX;\n};\n\n/**\n * Get the vertical scroll position.\n *\n * @param {Node} scroll_reference - The element to get the scroll position from.\n *\n * @returns {number} The vertical scroll position.\n */\nconst get_scroll_y = (scroll_reference) => {\n    // scroll_listener == window: window.scrollY\n    // scroll_listener == html: html.scrollTop == window.scrollY\n    // scroll_listener == DOM node: node.scrollTop\n    return typeof scroll_reference.scrollTop !== \"undefined\"\n        ? scroll_reference.scrollTop\n        : scroll_reference.scrollY;\n};\n\n/**\n * Get the elements position relative to another element.\n *\n * @param {Node} el - The DOM element to get the position for.\n * @param {Node} [reference_el=document.body] - The DOM element to get the position relative to.\n *\n * @returns {{top: number, left: number}} - The position of the element relative to the other element.\n */\nconst get_relative_position = (el, reference_el = document.body) => {\n    // Get the reference element to which against we calculate\n    // the relative position of the target.\n    // In case of a scroll container of window, we do not have\n    // getBoundingClientRect method, so get the body instead.\n    if (reference_el === window) {\n        reference_el = document.body;\n    }\n\n    // Calculate absolute [] position difference between\n    // scroll_container and scroll_target.\n    // Substract the container's border from the scrolling\n    // value, as this one isn't respected by\n    // getBoundingClientRect [] and would lead to covered\n    // items [].\n    // ) so that it doesn't make a difference, if the element\n    // is below or above the scrolling container. We just need\n    // to know the absolute difference.\n    // ) Calculations are based from the viewport.\n    // ) See:\n    //      https://docs.microsoft.com/en-us/previous-versions//hh781509(v=vs.85)\n    //      https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n    const left = Math.abs(\n        el.getBoundingClientRect().left +\n            reference_el.scrollLeft -\n            reference_el.getBoundingClientRect().left -\n            dom.get_css_value(reference_el, \"border-left-width\", true)\n    );\n    const top = Math.abs(\n        el.getBoundingClientRect().top +\n            reference_el.scrollTop -\n            reference_el.getBoundingClientRect().top -\n            dom.get_css_value(reference_el, \"border-top-width\", true)\n    );\n\n    return { top, left };\n};\n\n/**\n * Scroll to a given element.\n * The element will be scrolled to the top of the scroll container.\n *\n * @param {Node} el - The element which should be scrolled to.\n * @param {Node} scroll_container - The element which is scrollable.\n * @param {number} [offset=0] - Optional offset in pixels to stop scrolling before the target position. Can also be a negative number.\n * @param {string} [direction=\"top\"] - The direction to scroll to. Can be either \"top\", \"left\" or \"both\".\n */\nconst scroll_to_element = (el, scroll_container, offset = 0, direction = \"top\") => {\n    // Get the position of the element relative to the scroll container.\n    const position = get_relative_position(el, scroll_container);\n\n    const options = { behavior: \"auto\" };\n    if (direction === \"top\" || direction === \"both\") {\n        options.top = position.top - offset;\n    }\n    if (direction === \"left\" || direction === \"both\") {\n        options.left = position.left - offset;\n    }\n\n    // Scroll to the target position.\n    scroll_container.scrollTo(options);\n};\n\n/**\n * Scroll to the top of a scrolling container.\n *\n * @param {Node} [scroll_container = document.body] - The element which is scrollable.\n * @param {number} [offset=0] - Optional offset in pixels to stop scrolling before the target position. Can also be a negative number.\n */\nconst scroll_to_top = (scroll_container = document.body, offset = 0) => {\n    // Just scroll up, period.\n    scroll_container.scrollTo({ top: 0 - offset, behavior: \"auto\" });\n};\n\n/**\n * Scroll to the bottom of a scrolling container.\n *\n * @param {Node} [scroll_container = document.body] - The element which is scrollable.\n * @param {number} [offset=0] - Optional offset in pixels to stop scrolling before the target position. Can also be a negative number.\n */\nconst scroll_to_bottom = (scroll_container = document.body, offset = 0) => {\n    // Just scroll up, period.\n    //\n    const top = (scroll_container === window ? document.body : scroll_container)\n        .scrollHeight;\n    scroll_container.scrollTo({ top: top - offset, behavior: \"auto\" });\n};\n\n/**\n * Get data stored directly on the node instance.\n * We are using a prefix to make sure the data doesn't collide with other attributes.\n *\n * @param el {Node} - The DOM node from which we want to retrieve the data.\n * @param name {String} - The name of the variable. Note - this is stored on\n *                        the DOM node prefixed with the DATA_PREFIX.\n * @param default_value {Any} - Optional default value.\n * @returns {Any} - The value which is stored on the DOM node.\n */\nconst get_data = (el, name, default_value) => {\n    return el[`${DATA_PREFIX}${name}`] || default_value;\n};\n\n/**\n * Set and store data directly on the node instance.\n * We are using a prefix to make sure the data doesn't collide with other attributes.\n *\n * @param el {Node} - The DOM node which we want to store the data on.\n * @param name {String} - The name of the variable. Note - this is stored on\n *                        the DOM node prefixed with the DATA_PREFIX.\n * @param value {Any} - The value we want to store on the DOM node.\n */\nconst set_data = (el, name, value) => {\n    el[`${DATA_PREFIX}${name}`] = value;\n};\n\n/**\n * Delete a variable from the node instance.\n * We are using a prefix to make sure the data doesn't collide with other attributes.\n *\n * @param el {Node} - The DOM node which we want to delete the variable from.\n * @param name {String} - The name of the variable. Note - this is stored on\n *                        the DOM node prefixed with the DATA_PREFIX.\n */\nconst delete_data = (el, name) => {\n    delete el[`${DATA_PREFIX}${name}`];\n};\n\n/**\n * Simple template engine, based on JS template literal\n *\n * NOTE: This uses eval and would break if Content-Security-Policy does not\n *       allow 'unsafe-eval'.\n *       Because of this CSR problem the use of this method is not recommended.\n *\n * Please note: You cannot pass a template literal as template_string.\n * JavaScript itself would try to expand it and would fail.\n *\n * See: https://stackoverflow.com/a/37217166/1337474\n *\n * @param {String} template_string - The template string as a JavaScript template literal.\n *                                   For each variable in the template you have to use ``this``.\n *                                   E.g. if you pass ``{message: \"ok\"}`` as template_variables, you can use it like so:\n *                                   `<h1>${this.message}</h1>`\n * @param {Object} template_variables - Object literal with all the variables which should be used in the template.\n *\n * @returns {String} - Returns the a string as template expanded with the template_variables.\n */\nconst template = (template_string, template_variables = {}) => {\n    logger.warn(\n        \"Using dom.template is not recommended due to a problem with Content-Security-Policy.\"\n    );\n    return new Function(\"return `\" + template_string + \"`;\").call(template_variables);\n};\n\n/**\n * Get the visible ratio of an element compared to container.\n * If no container is given, the viewport is used.\n *\n * Note: currently only vertical ratio is supported.\n *\n * @param {Node} el - The element to get the visible ratio from.\n * @param {Node} [container] - The container to compare the element to.\n * @returns {number} - The visible ratio of the element.\n *                    0 means the element is not visible.\n *                    1 means the element is fully visible.\n */\nconst get_visible_ratio = (el, container) => {\n    if (!el) {\n        return 0;\n    }\n\n    const rect = el.getBoundingClientRect();\n    const container_rect =\n        container !== window\n            ? container.getBoundingClientRect()\n            : {\n                  top: 0,\n                  bottom: window.innerHeight,\n              };\n\n    let visible_ratio = 0;\n    if (rect.top < container_rect.bottom && rect.bottom > container_rect.top) {\n        const rect_height = rect.bottom - rect.top;\n        const visible_height =\n            Math.min(rect.bottom, container_rect.bottom) -\n            Math.max(rect.top, container_rect.top);\n        visible_ratio = visible_height / rect_height;\n    }\n\n    return visible_ratio;\n};\n\n/**\n * Get an escaped CSS selector for a given id string.\n *\n * id selectors should - but don't have to - start with a letter.\n * If the id starts with a number or a dash, it should be escaped.\n * This method does that for you.\n *\n * Alse see:\n * - https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id\n * - https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape\n *\n * @param {String} id - The id to escape.\n *\n * @returns {String} - The escaped CSS selector.\n *\n * @example\n * escape_css_id_selector(\"#123\"); // returns \"#\\\\31 23\"\"\n * escape_css_id_selector(\"#-123\"); // returns \"#-\\\\31 23\"\n */\nconst escape_css_id = (id) => {\n    return `#${CSS.escape(id.split(\"#\")[1])}`;\n};\n\n/**\n * Set and get a universally unique id (uuid) for a DOM element.\n *\n * This method returns a uuid for the given element. On the first call it will\n * generate a uuid and store it on the element.\n *\n * @param {Node} el - The DOM node to get the uuid for.\n * @returns {String} - The uuid.\n */\nconst element_uuid = (el) => {\n    if (!get_data(el, \"uuid\", false)) {\n        set_data(el, \"uuid\", create_uuid());\n    }\n    return get_data(el, \"uuid\");\n};\n\n/**\n * Find a related form element.\n *\n * @param {Node} el - The DOM node to start the search from.\n * @returns {Node} - The closest form element.\n *\n * @example\n * find_form(document.querySelector(\"input\"));\n */\nconst find_form = (el) => {\n    // Prefer input.form which allows for input outside form elements and fall\n    // back to search for a parent form.\n    const form =\n        el.closest(\".pat-subform\") || // Special Patternslib subform concept has precedence.\n        el.form ||\n        el.querySelector(INPUT_SELECTOR)?.form ||\n        el.closest(\"form\");\n    return form;\n};\n\n/**\n * Find any input type.\n */\nconst find_inputs = (el) => {\n    return querySelectorAllAndMe(el, INPUT_SELECTOR);\n};\n\nconst dom = {\n    document_ready: document_ready,\n    toNodeArray: toNodeArray,\n    querySelectorAllAndMe: querySelectorAllAndMe,\n    wrap: wrap,\n    hide: hide,\n    show: show,\n    find_inputs: find_inputs,\n    find_parents: find_parents,\n    find_scoped: find_scoped,\n    get_parents: get_parents,\n    acquire_attribute: acquire_attribute,\n    is_visible: is_visible,\n    is_input: is_input,\n    is_button: is_button,\n    create_from_string: create_from_string,\n    get_css_value: get_css_value,\n    find_scroll_container: find_scroll_container,\n    get_scroll_x: get_scroll_x,\n    get_scroll_y: get_scroll_y,\n    get_relative_position: get_relative_position,\n    scroll_to_element: scroll_to_element,\n    scroll_to_top: scroll_to_top,\n    scroll_to_bottom: scroll_to_bottom,\n    get_data: get_data,\n    set_data: set_data,\n    delete_data: delete_data,\n    template: template,\n    get_visible_ratio: get_visible_ratio,\n    escape_css_id: escape_css_id,\n    element_uuid: element_uuid,\n    find_form: find_form,\n};\n\nexport default dom;\n","import utils from \"./utils\";\n\n// Event related methods and event factories\n\n// Event listener registration for easy-to-remove event listeners.\n// once Safari supports the ``signal`` option for addEventListener we can abort\n// event handlers by calling AbortController.abort().\nexport const event_listener_map = new Map();\n\n/**\n * Add an event listener to a DOM element under a unique id.\n * If a event is registered under the same id for the same element, the old handler is removed first.\n *\n * @param {DOM Node} el - The element to register the event for.\n * @param {string} event_type - The event type to listen for.\n * @param {string} id - A unique id under which the event is registered.\n * @param {function} cb - The event handler / callback function.\n * @param {Object} opts - Options for the addEventListener API.\n *\n */\nconst add_event_listener = (el, event_type, id, cb, opts = {}) => {\n    if (!el?.addEventListener) {\n        return; // nothing to do.\n    }\n    remove_event_listener(el, id); // do not register one listener twice.\n\n    // Create event_listener_map entry if not existent.\n    if (!event_listener_map.has(el)) {\n        event_listener_map.set(el, new Map());\n    }\n    let _cb = cb;\n    if (opts?.once === true) {\n        // For `once` events, also remove the entry from the event_listener_map.\n        _cb = (e) => {\n            event_listener_map.get(el)?.delete(id);\n            cb(e);\n        };\n    }\n    // Only `capture` option is necessary for `removeEventListener`.\n    event_listener_map\n        .get(el)\n        .set(id, [event_type, _cb, opts.capture ? opts : undefined]);\n    el.addEventListener(event_type, _cb, opts);\n};\n\n/**\n * Remove an event listener from a DOM element under a unique id.\n *\n * If an element and id are given, the event listeners for the given element matching the id are removed.\n * If an element but no id is given, all event listeners for that element are removed.\n * If an id but no element is given, all event listeners for any element matching the id are removed.\n * If no element and no id are given, all event listeners are removed.\n *\n * The id can be a wildcard string, e.g. `test-*-event`, which would match any\n * event which starts with \"test-\" and ends with \"-event\". The wildcard \"*\" can\n * be anywhere in the string and also be used multiple times. If no wildcard is\n * present the search string is used for an exact match.\n *\n * @param {DOM Node} [el] - The element to register the event for.\n * @param {string} [id] - A unique id under which the event is registered.\n *                        Can be a wildcard string.\n *\n */\nconst remove_event_listener = (el, id) => {\n    const els = el ? [el] : event_listener_map.keys();\n    for (const el of els) {\n        if (!el?.removeEventListener) {\n            return; // nothing to do.\n        }\n        const el_events = event_listener_map.get(el);\n        if (!el_events) {\n            return;\n        }\n        let entries;\n        if (id) {\n            // remove event listener with matching id\n            entries = [...el_events.entries()].filter((entry) =>\n                utils.regexp_from_wildcard(id).test(entry[0])\n            );\n        } else {\n            // remove all event listeners of element\n            entries = el_events.entries();\n        }\n        for (const entry of entries || []) {\n            // Remove event listener\n            el.removeEventListener(entry[1][0], entry[1][1], entry[1][2]);\n            // Delete entry from event_listener_map\n            event_listener_map.get(el).delete(entry[0]);\n            // Delete element from event_listener_map if no more events are registered.\n            if (!event_listener_map.get(el).size) {\n                event_listener_map.delete(el);\n            }\n        }\n    }\n};\n\n/**\n * Await an event to be thrown.\n *\n * Usage:\n *     await events.await_event(button, \"click\");\n *\n * @param {DOM Node} el - The element to listen on.\n * @param {String} event_name - The event name to listen for.\n *\n * @returns {Promise} - Returns a Promise which can be used for ``await`` and which will be resolved when the event is throwm.\n *\n */\nconst await_event = (el, event_name) => {\n    // See: https://stackoverflow.com/a/44746691/1337474\n    return new Promise((resolve) =>\n        el.addEventListener(event_name, resolve, { once: true })\n    );\n};\n\n/**\n * Await pattern init.\n *\n * Usage:\n *     await events.await_pattern_init(PATTERN);\n *\n * @param {Pattern instance} pattern - The pattern instance.\n *\n * @returns {Promise} - Returns a Promise which can be used for ``await`` and which will be resolved when the event is throwm.\n *\n */\nconst await_pattern_init = (pattern) => {\n    // See: https://stackoverflow.com/a/44746691/1337474\n    return new Promise((resolve, reject) => {\n        // Case initialized\n        pattern.one(\"init\", (e) => {\n            if (e.target !== pattern.el) {\n                // Don't handle bubbling init events from child elements. We\n                // want to check on init events coming directly from this\n                // Pattern's element.\n                return;\n            }\n            // Resolve promise and unregister the not-init event handler.\n            remove_event_listener(\n                pattern.el,\n                `basepattern-one--not-init.${pattern.name}.patterns`\n            );\n            resolve();\n        });\n\n        // Case not initialized\n        pattern.one(\"not-init\", (e) => {\n            if (e.target !== pattern.el) {\n                // Don't handle bubbling not-init events from child elements.\n                // We want to check on not-init events coming directly from\n                // this Pattern's element.\n                return;\n            }\n            // Reject promise and unregister the init event handler.\n            remove_event_listener(\n                pattern.el,\n                `basepattern-one--init.${pattern.name}.patterns`\n            );\n            reject();\n        });\n    }).catch(() => {\n        throw new Error(`Pattern \"${pattern.name}\" not initialized.`);\n    });\n};\n\n/**\n * Event factories\n */\n\n/** Generic event factory.\n *\n * A event factory for a bubbling and cancelable generic event.\n *\n * @param {string} name - The event name.\n * @returns {Event} - Returns a blur event.\n */\nconst generic_event = (name) => {\n    return new Event(name, {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst blur_event = () => {\n    return new Event(\"blur\", {\n        bubbles: false,\n        cancelable: false,\n    });\n};\n\nconst click_event = () => {\n    return new Event(\"click\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst change_event = () => {\n    return new Event(\"change\", {\n        bubbles: true,\n        cancelable: false,\n    });\n};\n\nconst focus_event = () => {\n    return new Event(\"focus\", {\n        bubbles: false,\n        cancelable: false,\n    });\n};\n\nconst input_event = () => {\n    return new Event(\"input\", {\n        bubbles: true,\n        cancelable: false,\n    });\n};\n\nconst mousedown_event = () => {\n    return new Event(\"mousedown\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst mouseup_event = () => {\n    return new Event(\"mouseup\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst scroll_event = () => {\n    return new Event(\"scroll\", {\n        bubbles: true,\n        cancelable: false,\n    });\n};\n\nconst submit_event = ({ submitter } = { submitter: undefined }) => {\n    const event = new Event(\"submit\", {\n        bubbles: true,\n        cancelable: true,\n    });\n    event.submitter = submitter; // undefined or the submitting element\n    return event;\n};\n\nconst dragstart_event = () => {\n    return new Event(\"dragstart\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst dragend_event = () => {\n    return new Event(\"dragend\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nexport default {\n    add_event_listener: add_event_listener,\n    remove_event_listener: remove_event_listener,\n    await_event: await_event,\n    await_pattern_init: await_pattern_init,\n    generic_event: generic_event,\n    blur_event: blur_event,\n    click_event: click_event,\n    change_event: change_event,\n    focus_event: focus_event,\n    input_event: input_event,\n    mousedown_event: mousedown_event,\n    mouseup_event: mouseup_event,\n    scroll_event: scroll_event,\n    submit_event: submit_event,\n    dragstart_event: dragstart_event,\n    dragend_event: dragend_event,\n};\n","/**\n * Patterns logging - minimal logging framework\n *\n * Copyright 2012 Simplon B.V.\n */\n\n// source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind\nif (!Function.prototype.bind) {\n    Function.prototype.bind = function (oThis) {\n        if (typeof this !== \"function\") {\n            // closest thing possible to the ECMAScript 5 internal IsCallable function\n            throw new TypeError(\n                \"Function.prototype.bind - what is trying to be bound is not callable\"\n            );\n        }\n\n        var aArgs = Array.prototype.slice.call(arguments, 1),\n            fToBind = this,\n            fNOP = function () {},\n            fBound = function () {\n                return fToBind.apply(\n                    this instanceof fNOP && oThis ? this : oThis,\n                    aArgs.concat(Array.prototype.slice.call(arguments))\n                );\n            };\n        fNOP.prototype = this.prototype;\n        fBound.prototype = new fNOP();\n\n        return fBound;\n    };\n}\n\nvar root, // root logger instance\n    writer; // writer instance, used to output log entries\n\nvar Level = {\n    DEBUG: 10,\n    INFO: 20,\n    WARN: 30,\n    ERROR: 40,\n    FATAL: 50,\n};\n\nfunction ConsoleWriter() {}\n\nConsoleWriter.prototype = {\n    output: function (log_name, level, messages) {\n        if (log_name) messages.unshift(log_name + \":\");\n        if (level <= Level.DEBUG) console.debug.apply(console, messages);\n        else if (level <= Level.INFO) console.info.apply(console, messages);\n        else if (level <= Level.WARN) console.warn.apply(console, messages);\n        else console.error.apply(console, messages);\n    },\n};\n\nfunction Logger(name, parent) {\n    this._loggers = {};\n    this.name = name || \"\";\n    this._parent = parent || null;\n    if (!parent) {\n        this._enabled = true;\n        this._level = Level.WARN;\n    }\n}\n\nLogger.prototype = {\n    getLogger: function (name) {\n        var path = name.split(\".\"),\n            root = this,\n            route = this.name ? [this.name] : [];\n        while (path.length) {\n            var entry = path.shift();\n            route.push(entry);\n            if (!(entry in root._loggers))\n                root._loggers[entry] = new Logger(route.join(\".\"), root);\n            root = root._loggers[entry];\n        }\n        return root;\n    },\n\n    _getFlag: function (flag) {\n        var context = this;\n        flag = \"_\" + flag;\n        while (context !== null) {\n            if (context[flag] !== undefined) return context[flag];\n            context = context._parent;\n        }\n        return null;\n    },\n\n    setEnabled: function (state) {\n        this._enabled = !!state;\n    },\n\n    isEnabled: function () {\n        this._getFlag(\"enabled\");\n    },\n\n    setLevel: function (level) {\n        if (typeof level === \"number\") this._level = level;\n        else if (typeof level === \"string\") {\n            level = level.toUpperCase();\n            if (level in Level) this._level = Level[level];\n        }\n    },\n\n    getLevel: function () {\n        return this._getFlag(\"level\");\n    },\n\n    log: function (level, messages) {\n        if (\n            !messages.length ||\n            !this._getFlag(\"enabled\") ||\n            level < this._getFlag(\"level\")\n        )\n            return;\n        messages = Array.prototype.slice.call(messages);\n        writer.output(this.name, level, messages);\n    },\n\n    debug: function () {\n        this.log(Level.DEBUG, arguments);\n    },\n\n    info: function () {\n        this.log(Level.INFO, arguments);\n    },\n\n    warn: function () {\n        this.log(Level.WARN, arguments);\n    },\n\n    error: function () {\n        this.log(Level.ERROR, arguments);\n    },\n\n    fatal: function () {\n        this.log(Level.FATAL, arguments);\n    },\n};\n\nfunction getWriter() {\n    return writer;\n}\n\nfunction setWriter(w) {\n    writer = w;\n}\n\nsetWriter(new ConsoleWriter());\n\nroot = new Logger();\n\nvar logconfig = /loglevel(|-[^=]+)=([^&]+)/g,\n    match;\n\nwhile ((match = logconfig.exec(window.location.search)) !== null) {\n    var logger = match[1] === \"\" ? root : root.getLogger(match[1].slice(1));\n    logger.setLevel(match[2].toUpperCase());\n}\n\nvar api = {\n    Level: Level,\n    getLogger: root.getLogger.bind(root),\n    setEnabled: root.setEnabled.bind(root),\n    isEnabled: root.isEnabled.bind(root),\n    setLevel: root.setLevel.bind(root),\n    getLevel: root.getLevel.bind(root),\n    debug: root.debug.bind(root),\n    info: root.info.bind(root),\n    warn: root.warn.bind(root),\n    error: root.error.bind(root),\n    fatal: root.fatal.bind(root),\n    getWriter: getWriter,\n    setWriter: setWriter,\n};\n\nexport default api;\n","// Patterns argument parser\nimport $ from \"jquery\";\nimport utils from \"./utils.js\";\nimport logging from \"./logging\";\n\nclass ArgumentParser {\n    constructor(name) {\n        this.order = [];\n        this.parameters = {};\n        this.attribute = \"data-pat-\" + name;\n        this.enum_values = {};\n        this.enum_conflicts = [];\n        this.groups = {};\n        this.possible_groups = {};\n        this.log = logging.getLogger(name + \".parser\");\n\n        this.group_pattern = /([a-z][a-z0-9]*)-([A-Z][a-z0-0\\-]*)/i;\n        this.json_param_pattern = /^\\s*\\[?\\s*{/i;\n        this.named_param_pattern = /^\\s*([a-z][a-z0-9\\-]*)\\s*:(.*)/is;\n        this.token_pattern = /(([\"']).*?(?!\\\\)\\2)|\\s*(\\S+)\\s*/g;\n    }\n\n    _camelCase(str) {\n        return str.replace(/\\-([a-z])/g, (__, p1) => p1.toUpperCase());\n    }\n\n    addAlias(alias, original) {\n        /* Add an alias for a previously added parser argument.\n         *\n         * Useful when you want to support both US and UK english argument\n         * names.\n         */\n        if (this.parameters[original]) {\n            this.parameters[original].alias = alias;\n        } else {\n            throw `Attempted to add an alias \"${alias}\" for a non-existing parser argument \"${original}\".`;\n        }\n    }\n\n    addGroupToSpec(spec) {\n        /* Determine wether an argument being parsed can be grouped and\n         * update its specifications object accordingly.\n         *\n         * Internal method used by addArgument and addJSONArgument\n         */\n        const m = spec.name.match(this.group_pattern);\n        if (m) {\n            const group = m[1];\n            const field = m[2];\n            if (group in this.possible_groups) {\n                const first_spec = this.possible_groups[group];\n                const first_name = first_spec.name.match(this.group_pattern)[2];\n                first_spec.group = group;\n                first_spec.dest = first_name;\n                this.groups[group] = new ArgumentParser();\n                this.groups[group].addArgument(\n                    first_name,\n                    first_spec.value,\n                    first_spec.choices,\n                    first_spec.multiple\n                );\n                delete this.possible_groups[group];\n            }\n            if (group in this.groups) {\n                this.groups[group].addArgument(\n                    field,\n                    spec.value,\n                    spec.choices,\n                    spec.multiple\n                );\n                spec.group = group;\n                spec.dest = field;\n            } else {\n                this.possible_groups[group] = spec;\n                spec.dest = this._camelCase(spec.name);\n            }\n        }\n        return spec;\n    }\n\n    addJSONArgument(name, default_value) {\n        /* Add an argument where the value is provided in JSON format.\n         *\n         * This is a different usecase than specifying all arguments to\n         * the data-pat-... attributes in JSON format, and instead is part\n         * of the normal notation except that a value is in JSON instead of\n         * for example a string.\n         */\n        this.order.push(name);\n        this.parameters[name] = this.addGroupToSpec({\n            name: name,\n            value: default_value,\n            dest: name,\n            group: null,\n            type: \"json\",\n        });\n    }\n\n    addArgument(name, default_value, choices, multiple) {\n        const spec = {\n            name: name,\n            value:\n                multiple && !Array.isArray(default_value)\n                    ? [default_value]\n                    : default_value,\n            multiple: multiple,\n            dest: name,\n            group: null,\n        };\n        if (choices && Array.isArray(choices) && choices.length) {\n            spec.choices = choices;\n            spec.type = this._typeof(choices[0]);\n            for (const choice of choices) {\n                if (this.enum_conflicts.indexOf(choice) !== -1) {\n                    continue;\n                } else if (choice in this.enum_values) {\n                    this.enum_conflicts.push(choice);\n                    delete this.enum_values[choice];\n                } else {\n                    this.enum_values[choice] = name;\n                }\n            }\n        } else if (typeof spec.value === \"string\" && spec.value.slice(0, 1) === \"$\") {\n            spec.type = this.parameters[spec.value.slice(1)].type;\n        } else {\n            // Note that this will get reset by _defaults if default_value is a function.\n            spec.type = this._typeof(multiple ? spec.value[0] : spec.value);\n        }\n        this.order.push(name);\n        this.parameters[name] = this.addGroupToSpec(spec);\n    }\n\n    _typeof(obj) {\n        if (obj === null) {\n            return \"null\";\n        }\n        return typeof obj;\n    }\n\n    _coerce(name, value) {\n        const spec = this.parameters[name];\n        if (typeof value !== spec.type)\n            try {\n                switch (spec.type) {\n                    case \"json\":\n                        value = JSON.parse(value);\n                        break;\n                    case \"boolean\":\n                        if (typeof value === \"string\") {\n                            value = value.toLowerCase();\n                            const num = parseInt(value, 10);\n                            if (!isNaN(num)) value = !!num;\n                            else\n                                value =\n                                    value === \"true\" ||\n                                    value === \"y\" ||\n                                    value === \"yes\" ||\n                                    value === \"y\" ||\n                                    value === \"on\";\n                        } else if (typeof value === \"number\") {\n                            value = !!value;\n                        } else {\n                            throw `Cannot convert value for ${name} to boolean.`;\n                        }\n                        break;\n                    case \"number\":\n                        if (typeof value === \"string\") {\n                            value = parseInt(value, 10);\n                            if (isNaN(value)) {\n                                throw `Cannot convert value for ${name} to number.`;\n                            }\n                        } else if (typeof value === \"boolean\") {\n                            value = value + 0;\n                        } else {\n                            throw `Cannot convert value for ${name} to number.`;\n                        }\n                        break;\n                    case \"string\":\n                        value = value.toString();\n                        break;\n                    case \"null\": // Missing default values\n                    case \"undefined\":\n                        break;\n                    default:\n                        throw `Do not know how to convert value for ${name} of type ${typeof value} to ${\n                            spec.type\n                        }.`;\n                }\n            } catch (e) {\n                this.log.warn(e);\n                return null;\n            }\n\n        if (spec.choices && spec.choices.indexOf(value) === -1) {\n            this.log.warn(`Illegal value for ${name}: ${value}.`);\n            return null;\n        }\n        return value;\n    }\n\n    _set(opts, name, value) {\n        if (!(name in this.parameters)) {\n            this.log.debug(`Ignoring value for unknown argument: ${name}.`);\n            return;\n        }\n        const spec = this.parameters[name];\n        let parts;\n        if (spec.multiple) {\n            if (typeof value === \"string\") {\n                parts = value.split(/,+/);\n            } else {\n                parts = value;\n            }\n            value = [];\n            for (const part of parts) {\n                const v = this._coerce(name, part.trim());\n                if (v !== null) {\n                    value.push(v);\n                }\n            }\n        } else {\n            value = this._coerce(name, value);\n            if (value === null) {\n                return;\n            }\n        }\n        opts[name] = value;\n    }\n\n    _split(text) {\n        const tokens = [];\n        text.replace(this.token_pattern, (match, quoted, __, simple) => {\n            if (quoted) {\n                tokens.push(quoted);\n            } else if (simple) {\n                tokens.push(simple);\n            }\n        });\n        return tokens;\n    }\n\n    _parseExtendedNotation(argstring) {\n        const opts = {};\n        const parts = argstring\n            .replace(/;;/g, \"\\0x1f\")\n            .replace(/&amp;/g, \"&amp\\0x1f\")\n            .split(/;/)\n            .map((el) => el.replace(new RegExp(\"\\0x1f\", \"g\"), \";\"));\n        for (const part of parts) {\n            if (!part) {\n                continue;\n            }\n            const matches = part.match(this.named_param_pattern);\n            if (!matches) {\n                this.log.warn(`Invalid parameter: ${part}: ${argstring}.`);\n                continue;\n            }\n            const name = matches[1];\n            const value = matches[2].trim();\n            const arg = Object.values(this.parameters).filter((it) => it.alias === name);\n\n            const is_alias = arg.length === 1;\n\n            if (is_alias) {\n                this._set(opts, arg[0].name, value);\n            } else if (name in this.parameters) {\n                this._set(opts, name, value);\n            } else if (name in this.groups) {\n                const subopt = this.groups[name]._parseShorthandNotation(value);\n                for (const field in subopt) {\n                    this._set(opts, name + \"-\" + field, subopt[field]);\n                }\n            } else {\n                this.log.warn(`Unknown named parameter: ${matches[1]}.`);\n                continue;\n            }\n        }\n        return opts;\n    }\n\n    _parseShorthandNotation(parameter) {\n        const parts = this._split(parameter);\n        const opts = {};\n        let i = 0;\n\n        while (parts.length) {\n            const part = parts.shift().trim();\n            let sense;\n            let flag;\n            let positional = true;\n            if (part.slice(0, 3) === \"no-\") {\n                sense = false;\n                flag = part.slice(3);\n            } else {\n                sense = true;\n                flag = part;\n            }\n            if (flag in this.parameters && this.parameters[flag].type === \"boolean\") {\n                positional = false;\n                this._set(opts, flag, sense);\n            } else if (flag in this.enum_values) {\n                positional = false;\n                this._set(opts, this.enum_values[flag], flag);\n            } else if (positional) this._set(opts, this.order[i], part);\n            else {\n                parts.unshift(part);\n                break;\n            }\n            i++;\n            if (i >= this.order.length) {\n                break;\n            }\n        }\n        if (parts.length) this.log.warn(`Ignore extra arguments: ${parts.join(\" \")}.`);\n        return opts;\n    }\n\n    _parse(parameter) {\n        if (!parameter) {\n            return {};\n        }\n        if (parameter.match(this.json_param_pattern)) {\n            try {\n                return JSON.parse(parameter);\n            } catch (e) {\n                this.log.warn(`Invalid JSON argument found: ${parameter}.`);\n            }\n        }\n        if (parameter.match(this.named_param_pattern)) {\n            return this._parseExtendedNotation(parameter);\n        }\n        const sep = parameter.indexOf(\";\");\n        if (sep === -1) {\n            return this._parseShorthandNotation(parameter);\n        }\n        const opts = this._parseShorthandNotation(parameter.slice(0, sep));\n        const extended = this._parseExtendedNotation(parameter.slice(sep + 1));\n        for (const name in extended) {\n            opts[name] = extended[name];\n        }\n        return opts;\n    }\n\n    _defaults($el) {\n        const result = {};\n        for (const name in this.parameters) {\n            if (typeof this.parameters[name].value === \"function\") {\n                try {\n                    result[name] = this.parameters[name].value($el, name);\n                    this.parameters[name].type = typeof result[name];\n                } catch (e) {\n                    this.log.error(`Default function for ${name} failed.`);\n                }\n            } else {\n                result[name] = this.parameters[name].value;\n            }\n        }\n        return result;\n    }\n\n    _cleanupOptions(options, group_options = true) {\n        // Resolve references\n        for (const name of Object.keys(options)) {\n            const spec = this.parameters[name];\n            if (spec === undefined) {\n                continue;\n            }\n\n            if (\n                options[name] === spec.value &&\n                typeof spec.value === \"string\" &&\n                spec.value.slice(0, 1) === \"$\"\n            ) {\n                options[name] = options[spec.value.slice(1)];\n            }\n        }\n        if (group_options) {\n            // Move options into groups and do renames\n            for (const name of Object.keys(options)) {\n                const spec = this.parameters[name];\n                let target;\n                if (spec === undefined) {\n                    continue;\n                }\n\n                if (spec.group) {\n                    if (typeof options[spec.group] !== \"object\") {\n                        options[spec.group] = {};\n                    }\n                    target = options[spec.group];\n                } else {\n                    target = options;\n                }\n\n                if (spec.dest !== name) {\n                    target[spec.dest] = options[name];\n                    delete options[name];\n                }\n            }\n        }\n        return options;\n    }\n\n    parse($el, options, multiple, inherit = true, group_options = true) {\n        if (!$el.jquery) {\n            $el = $($el);\n        }\n        if (typeof options === \"boolean\" && multiple === undefined) {\n            // Fix argument order: ``multiple`` passed instead of ``options``.\n            multiple = options;\n            options = {};\n        }\n        const stack = inherit ? [[this._defaults($el)]] : [[{}]];\n        let $possible_config_providers;\n        let final_length = 1;\n        /*\n         * XXX this is a workaround for:\n         * - https://github.com/Patternslib/Patterns/issues/393\n         *\n         * Prevents the parser to pollute the pat-modal configuration\n         * with data-pat-inject elements define in a `.pat-modal` parent element.\n         *\n         *  Probably this function should be completely revisited, see:\n         * - https://github.com/Patternslib/Patterns/issues/627\n         *\n         */\n        if (\n            !inherit ||\n            ($el.hasClass(\"pat-modal\") && this.attribute === \"data-pat-inject\")\n        ) {\n            $possible_config_providers = $el;\n        } else {\n            $possible_config_providers = $el.parents(`[${this.attribute}]`).addBack();\n        }\n\n        for (const provider of $possible_config_providers) {\n            let frame;\n            const data = ($(provider).attr(this.attribute) || \"\").trim();\n            if (!data) {\n                continue;\n            }\n            const _parse = this._parse.bind(this);\n            if (data.match(/&&/)) {\n                frame = data.split(/\\s*&&\\s*/).map(_parse);\n            } else {\n                frame = _parse(data);\n            }\n            if (!Array.isArray(frame)) {\n                frame = [frame];\n            }\n            final_length = Math.max(frame.length, final_length);\n            stack.push(frame);\n        }\n\n        if (typeof options === \"object\") {\n            if (Array.isArray(options)) {\n                stack.push(options);\n                final_length = Math.max(options.length, final_length);\n            } else {\n                stack.push([options]);\n            }\n        }\n        if (!multiple) {\n            final_length = 1;\n        }\n        const results = utils\n            .removeDuplicateObjects(utils.mergeStack(stack, final_length))\n            .map((current_value) => this._cleanupOptions(current_value, group_options));\n        return multiple ? results : results[0];\n    }\n}\n\n// BBB\nArgumentParser.prototype.add_argument = ArgumentParser.prototype.addArgument;\n\nexport default ArgumentParser;\n","// Polyfills for modern browsers\n\n// SubmitEvent.submitter polyfill for Safari < 15.4 and jsDOM\n// Original code: https://stackoverflow.com/a/61110260/1337474\n// Also see: https://caniuse.com/?search=submitter\n//\n!(function () {\n    let last_btn = null;\n    const submitable_buttons = `button, input[type=\"button\"], input[type=\"submit\"], input[type=\"image\"]`;\n    document.addEventListener(\n        \"click\",\n        function (e) {\n            if (!e.target.closest) return;\n            last_btn = e.target.closest(submitable_buttons);\n        },\n        true\n    );\n    document.addEventListener(\n        \"submit\",\n        function (e) {\n            if (\"submitter\" in e) return;\n            const canditates = [document.activeElement, last_btn];\n            last_btn = null;\n            for (const candidate of canditates) {\n                if (!candidate) continue;\n                if (!candidate.form) continue;\n                if (!candidate.matches(submitable_buttons)) continue;\n                e.submitter = candidate;\n                return;\n            }\n            e.submitter = e.target.querySelector(submitable_buttons);\n        },\n        true\n    );\n})();\n","/**\n * Patterns registry - Central registry and scan logic for patterns\n *\n * Copyright 2012-2013 Simplon B.V.\n * Copyright 2012-2013 Florian Friesdorf\n * Copyright 2013 Marko Durkovic\n * Copyright 2013 Rok Garbas\n * Copyright 2014-2015 Syslab.com GmBH, JC Brand\n */\n\n/*\n * changes to previous patterns.register/scan mechanism\n * - if you want initialised class, do it in init\n * - init returns set of elements actually initialised\n * - handle once within init\n * - no turnstile anymore\n * - set pattern.jquery_plugin if you want it\n */\nimport $ from \"jquery\";\nimport dom from \"./dom\";\nimport logging from \"./logging\";\nimport utils from \"./utils\";\n\nconst log = logging.getLogger(\"registry\");\nconst disable_re = /patterns-disable=([^&]+)/g;\nconst dont_catch_re = /patterns-dont-catch/g;\nconst disabled = {};\nlet dont_catch = false;\nlet match;\n\nwhile ((match = disable_re.exec(window.location.search)) !== null) {\n    disabled[match[1]] = true;\n    log.info(\"Pattern disabled via url config:\", match[1]);\n}\n\nwhile ((match = dont_catch_re.exec(window.location.search)) !== null) {\n    dont_catch = true;\n    log.info(\"I will not catch init exceptions\");\n}\n\n/**\n * Global pattern registry.\n *\n * This is a singleton and shared among any instance of the Patternslib\n * registry since Patternslib version 8.\n *\n * You normally don't need this as the registry handles it for you.\n */\nif (typeof window.__patternslib_registry === \"undefined\") {\n    window.__patternslib_registry = {};\n}\nexport const PATTERN_REGISTRY = window.__patternslib_registry;\nif (typeof window.__patternslib_registry_initialized === \"undefined\") {\n    window.__patternslib_registry_initialized = false;\n}\n\nconst registry = {\n    patterns: PATTERN_REGISTRY, // reference to global patterns registry\n    // as long as the registry is not initialized, pattern\n    // registration just registers a pattern. Once init is called,\n    // the DOM is scanned. After that registering a new pattern\n    // results in rescanning the DOM only for this pattern.\n    init() {\n        dom.document_ready(() => {\n            if (window.__patternslib_registry_initialized) {\n                // Do not reinitialize a already initialized registry.\n                return;\n            }\n            window.__patternslib_registry_initialized = true;\n            log.debug(\"Loaded: \" + Object.keys(registry.patterns).sort().join(\", \"));\n            registry.scan(document.body);\n            log.debug(\"Finished initial scan.\");\n        });\n    },\n\n    clear() {\n        // Removes all patterns from the registry. Currently only being\n        // used in tests.\n        for (const name in registry.patterns) {\n            delete registry.patterns[name];\n        }\n    },\n\n    transformPattern(name, content) {\n        /* Call the transform method on the pattern with the given name, if\n         * it exists.\n         */\n        if (disabled[name]) {\n            log.debug(`Skipping disabled pattern: ${name}.`);\n            return;\n        }\n\n        const pattern = registry.patterns[name];\n        const transform = pattern.transform || pattern.prototype?.transform;\n        if (transform) {\n            try {\n                transform($(content));\n            } catch (e) {\n                if (dont_catch) {\n                    throw e;\n                }\n                log.error(`Transform error for pattern ${name}.`, e);\n            }\n        }\n    },\n\n    initPattern(name, el, trigger) {\n        /* Initialize the pattern with the provided name and in the context\n         * of the passed in DOM element.\n         */\n        const $el = $(el);\n        const pattern = registry.patterns[name];\n        const plog = logging.getLogger(`pat.${name}`);\n        if (el.matches(pattern.trigger)) {\n            plog.debug(\"Initialising.\", el);\n            try {\n                if (pattern.init) {\n                    // old style initialisation\n                    pattern.init($el, null, trigger);\n                } else {\n                    // class based pattern initialisation\n                    new pattern($el, null, trigger);\n                }\n\n                plog.debug(\"done.\");\n            } catch (e) {\n                if (dont_catch) {\n                    throw e;\n                }\n                plog.error(\"Caught error:\", e);\n            }\n        }\n    },\n\n    orderPatterns(patterns) {\n        // Always add pat-validation as first pattern, so that it can prevent\n        // other patterns from reacting to submit events if form validation\n        // fails.\n        if (patterns.includes(\"validation\")) {\n            patterns.splice(patterns.indexOf(\"validation\"), 1);\n            patterns.unshift(\"validation\");\n        }\n        // Add clone-code to the very beginning - we want to copy the markup\n        // before any other patterns changed the markup.\n        if (patterns.includes(\"clone-code\")) {\n            patterns.splice(patterns.indexOf(\"clone-code\"), 1);\n            patterns.unshift(\"clone-code\");\n        }\n\n        return patterns;\n    },\n\n    scan(content, patterns, trigger) {\n        if (!content) {\n            return;\n        }\n\n        if (typeof content === \"string\") {\n            content = document.querySelector(content);\n        } else if (content instanceof Text) {\n            // No need to scan a TextNode.\n            return;\n        } else if (content.jquery) {\n            content = content[0];\n        }\n\n        const selectors = [];\n        patterns = this.orderPatterns(patterns || Object.keys(registry.patterns));\n        for (const name of patterns) {\n            this.transformPattern(name, content);\n            const pattern = registry.patterns[name];\n            if (pattern.trigger) {\n                selectors.unshift(pattern.trigger);\n            }\n        }\n\n        // Clean up selectors:\n        // - Remove whitespace,\n        // - Remove trailing commas,\n        // - Join to selecto string.\n        const selector_string = selectors.map(\n            (selector) => selector.trim().replace(/,$/, \"\")\n        ).join(\",\");\n\n        // Exit, if no selector.\n        if (!selector_string) {\n            return;\n        }\n\n        let matches = dom.querySelectorAllAndMe(\n            content,\n            selector_string\n        );\n        matches = matches.filter((el) => {\n            // Filter out patterns:\n            // - with class ``.disable-patterns`` or wrapped within.\n            // - wrapped in ``<pre>`` elements\n            // - wrapped in ``<template>`` elements (not reachable anyways)\n            return (\n                !el?.closest?.(\".disable-patterns\") &&\n                !el?.parentNode?.closest?.(\"pre\") &&\n                // BBB. TODO: Remove with next major version.\n                !el?.closest?.(\".cant-touch-this\")\n            );\n        });\n\n        // walk list backwards and initialize patterns inside-out.\n        for (const el of matches.reverse()) {\n            for (const name of patterns) {\n                this.initPattern(name, el, trigger);\n            }\n        }\n        document.body.classList.add(\"patterns-loaded\");\n    },\n\n    register(pattern, name) {\n        name = name || pattern.name;\n        if (!name) {\n            log.error(\"Pattern lacks a name.\", pattern);\n            return false;\n        }\n        if (registry.patterns[name]) {\n            log.debug(`Already have a pattern called ${name}.`);\n            return false;\n        }\n        // register pattern to be used for scanning new content\n        registry.patterns[name] = pattern;\n\n        // register pattern as jquery plugin\n        if (pattern.jquery_plugin) {\n            const plugin_name = (\"pat-\" + name).replace(\n                /-([a-zA-Z])/g,\n                function (match, p1) {\n                    return p1.toUpperCase();\n                }\n            );\n            $.fn[plugin_name] = utils.jqueryPlugin(pattern);\n            // BBB 2012-12-10 and also for Mockup patterns.\n            $.fn[plugin_name.replace(/^pat/, \"pattern\")] = $.fn[plugin_name];\n        }\n        log.debug(`Registered pattern ${name}`, pattern);\n        if (window.__patternslib_registry_initialized) {\n            // Once the first initialization has been done, do only scan for\n            // newly registered patterns.\n            registry.scan(document.body, [name]);\n            log.debug(`Re-scanned dom with newly registered pattern ${name}.`);\n        }\n        return true;\n    },\n};\n\nexport default registry;\n","import $ from \"jquery\";\nimport dom from \"./dom\";\n\nconst _MS_PER_DAY = 1000 * 60 * 60 * 24; // Milliseconds per day.\n\n$.fn.safeClone = function () {\n    var $clone = this.clone();\n    return $clone;\n};\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.18\n// Reference: http://es5.github.io/#x15.4.4.18\nif (!Array.prototype.forEach) {\n    Array.prototype.forEach = function (callback, thisArg) {\n        var T, k;\n        if (this === null) {\n            throw new TypeError(\" this is null or not defined\");\n        }\n        // 1. Let O be the result of calling ToObject passing the |this| value as the argument.\n        var O = Object(this);\n        // 2. Let lenValue be the result of calling the Get internal method of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n        // 4. If IsCallable(callback) is false, throw a TypeError exception.\n        // See: http://es5.github.com/#x9.11\n        if (typeof callback !== \"function\") {\n            throw new TypeError(callback + \" is not a function\");\n        }\n        // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n        if (arguments.length > 1) {\n            T = thisArg;\n        }\n        // 6. Let k be 0\n        k = 0;\n        // 7. Repeat, while k < len\n        while (k < len) {\n            var kValue;\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty internal method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n                // i. Let kValue be the result of calling the Get internal method of O with argument Pk.\n                kValue = O[k];\n                // ii. Call the Call internal method of callback with T as the this value and\n                // argument list containing kValue, k, and O.\n                callback.call(T, kValue, k, O);\n            }\n            // d. Increase k by 1.\n            k++;\n        }\n        // 8. return undefined\n    };\n}\n\nvar singleBoundJQueryPlugin = function (pattern, method, options) {\n    /* This is a jQuery plugin for patterns which are invoked ONCE FOR EACH\n     * matched element in the DOM.\n     *\n     * This is how the Mockup-type patterns behave. They are constructor\n     * functions which need to be invoked once per jQuery-wrapped DOM node\n     * for all DOM nodes on which the pattern applies.\n     */\n    var $this = this;\n    $this.each(function () {\n        var pat,\n            $el = $(this);\n        pat = pattern.init($el, options);\n        if (method) {\n            if (pat[method] === undefined) {\n                $.error(\n                    \"Method \" + method + \" does not exist on jQuery.\" + pattern.name\n                );\n                return false;\n            }\n            if (method.charAt(0) === \"_\") {\n                $.error(\"Method \" + method + \" is private on jQuery.\" + pattern.name);\n                return false;\n            }\n            pat[method].apply(pat, [options]);\n        }\n    });\n    return $this;\n};\n\nvar pluralBoundJQueryPlugin = function (pattern, method, options) {\n    /* This is a jQuery plugin for patterns which are invoked ONCE FOR ALL\n     * matched elements in the DOM.\n     *\n     * This is how the vanilla Patternslib-type patterns behave. They are\n     * simple objects with an init method and this method gets called once\n     * with a list of jQuery-wrapped DOM nodes on which the pattern\n     * applies.\n     */\n    var $this = this;\n    if (method) {\n        if (pattern[method]) {\n            return pattern[method].apply($this, [$this].concat([options]));\n        } else {\n            $.error(\"Method \" + method + \" does not exist on jQuery.\" + pattern.name);\n        }\n    } else {\n        pattern.init.apply($this, [$this].concat([options]));\n    }\n    return $this;\n};\n\nvar jqueryPlugin = function (pattern) {\n    return function (method, options) {\n        var $this = this;\n        if ($this.length === 0) {\n            return $this;\n        }\n        if (typeof method === \"object\") {\n            options = method;\n            method = undefined;\n        }\n        if (typeof pattern === \"function\") {\n            return singleBoundJQueryPlugin.call(this, pattern, method, options);\n        } else {\n            return pluralBoundJQueryPlugin.call(this, pattern, method, options);\n        }\n    };\n};\n\n// Is a given variable an object?\nfunction isObject(obj) {\n    var type = typeof obj;\n    return type === \"function\" || (type === \"object\" && !!obj);\n}\n\n// Extend a given object with all the properties in passed-in object(s).\nfunction extend(obj) {\n    if (!isObject(obj)) return obj;\n    var source, prop;\n    for (var i = 1, length = arguments.length; i < length; i++) {\n        source = arguments[i];\n        for (prop in source) {\n            if (hasOwnProperty.call(source, prop)) {\n                obj[prop] = source[prop];\n            }\n        }\n    }\n    return obj;\n}\n// END: Taken from Underscore.js until here.\n\nfunction findLabel(input) {\n    var $label;\n    for (\n        var label = input.parentNode;\n        label && label.nodeType !== 11;\n        label = label.parentNode\n    ) {\n        if (label.tagName === \"LABEL\") {\n            return label;\n        }\n    }\n    if (input.id) {\n        $label = $('label[for=\"' + input.id + '\"]');\n    }\n    if ($label && $label.length === 0 && input.form) {\n        $label = $('label[for=\"' + input.name + '\"]', input.form);\n    }\n    if ($label && $label.length) {\n        return $label[0];\n    } else {\n        return null;\n    }\n}\n\n// Taken from http://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\nfunction escapeRegExp(str) {\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n}\n\n/**\n * Create a RegExp object of a wildcard search string.\n *\n * @param {string} wildcard: A search string which can contain wildcards \"*\".\n *                           The wildcard \"*\" can be anywhere in the string and\n *                           can also be used multiple times. If no wildcard is\n *                           present the search string is used for an exact match.\n\n * @returns {RegExp}: A RegExp object which can be used to match strings.\n */\nfunction regexp_from_wildcard(wildcard) {\n    let regexp = wildcard.replace(/[\\-\\[\\]{}()+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n    regexp = regexp.replace(/[*]/g, \".*\");\n    regexp = new RegExp(`^${regexp}$`);\n    return regexp;\n}\n\n/**\n * Remove classes from a list of targets if they match a specific pattern.\n *\n * @param {Node, NodeList} targets: Dom Node or NodeList where the classes should be removed.\n * @param {string} classes: String matching classes to be removed.\n *                          You can add a \"*\" as wildcard to search for classes to be removed.\n *                          E.g. \"icon-*-alert\" to remove any of \"icon-1-alert icon-2-alert\".\n *\n * @returns {undefined}: This method directly operates on the targets.\n */\nfunction removeWildcardClass(targets, classes) {\n    targets = utils.ensureArray(targets);\n\n    if (classes.indexOf(\"*\") === -1) {\n        for (const target of targets) {\n            target.classList.remove(classes);\n        }\n    } else {\n        const matcher = regexp_from_wildcard(classes);\n        for (const target of targets) {\n            const class_list = (target.getAttribute(\"class\") || \"\").split(/\\s+/);\n            if (!class_list.length) {\n                continue;\n            }\n            const ok = class_list.filter((it) => !matcher.test(it));\n            if (ok.length) {\n                target.setAttribute(\"class\", ok.join(\" \"));\n            } else {\n                target.removeAttribute(\"class\");\n            }\n        }\n    }\n}\n\nfunction hasValue(el) {\n    if (el.tagName === \"INPUT\") {\n        if (el.type === \"checkbox\" || el.type === \"radio\") {\n            return el.checked;\n        }\n        return el.value !== \"\";\n    }\n    if (el.tagName === \"SELECT\") {\n        return el.selectedIndex !== -1;\n    }\n    if (el.tagName === \"TEXTAREA\") {\n        return el.value !== \"\";\n    }\n    return false;\n}\n\nconst hideOrShow = (nodes, visible, options, pattern_name) => {\n    nodes = dom.toNodeArray(nodes);\n\n    const transitions = {\n        none: { hide: \"hide\", show: \"show\" },\n        fade: { hide: \"fadeOut\", show: \"fadeIn\" },\n        slide: { hide: \"slideUp\", show: \"slideDown\" },\n    };\n\n    const duration =\n        options.transition === \"css\" || options.transition === \"none\"\n            ? null\n            : options.effect.duration;\n\n    const on_complete = (el) => {\n        el.classList.remove(\"in-progress\");\n        el.classList.add(visible ? \"visible\" : \"hidden\");\n        $(el).trigger(\"pat-update\", {\n            pattern: pattern_name,\n            action: \"attribute-changed\",\n            dom: el,\n            transition: \"complete\",\n        });\n    };\n\n    for (const el of nodes) {\n        el.classList.remove(\"visible\");\n        el.classList.remove(\"hidden\");\n        el.classList.remove(\"in-progress\");\n\n        if (duration) {\n            const t = transitions[options.transition];\n            el.classList.add(\"in-progress\");\n            $(el).trigger(\"pat-update\", {\n                pattern: pattern_name,\n                action: \"attribute-changed\",\n                dom: el,\n                transition: \"start\",\n            });\n            $(el)[visible ? t.show : t.hide]({\n                duration: duration,\n                easing: options.effect.easing,\n                complete: () => on_complete(el),\n            });\n        } else {\n            if (options.transition !== \"css\") {\n                dom[visible ? \"show\" : \"hide\"](el);\n            }\n            on_complete(el);\n        }\n    }\n};\n\nfunction addURLQueryParameter(fullURL, param, value) {\n    /* Using a positive lookahead (?=\\=) to find the given parameter,\n     * preceded by a ? or &, and followed by a = with a value after\n     * than (using a non-greedy selector) and then followed by\n     * a & or the end of the string.\n     *\n     * Taken from http://stackoverflow.com/questions/7640270/adding-modify-query-string-get-variables-in-a-url-with-javascript\n     */\n    var val = new RegExp(\"(\\\\?|\\\\&)\" + param + \"=.*?(?=(&|$))\"),\n        parts = fullURL.toString().split(\"#\"),\n        url = parts[0],\n        hash = parts[1],\n        qstring = /\\?.+$/,\n        newURL = url;\n    // Check if the parameter exists\n    if (val.test(url)) {\n        // if it does, replace it, using the captured group\n        // to determine & or ? at the beginning\n        newURL = url.replace(val, \"$1\" + param + \"=\" + value);\n    } else if (qstring.test(url)) {\n        // otherwise, if there is a query string at all\n        // add the param to the end of it\n        newURL = url + \"&\" + param + \"=\" + value;\n    } else {\n        // if there's no query string, add one\n        newURL = url + \"?\" + param + \"=\" + value;\n    }\n    if (hash) {\n        newURL += \"#\" + hash;\n    }\n    return newURL;\n}\n\nfunction removeDuplicateObjects(objs) {\n    /* Given an array of objects, remove any duplicate objects which might\n     * be present.\n     */\n    const comparator = function (k, v) {\n        return this[k] === v;\n    };\n\n    return objs.reduce(function (list, next_obj) {\n        let is_duplicate = false;\n        for (const obj of list) {\n            is_duplicate =\n                Object.keys(obj).length === Object.keys(next_obj).length &&\n                Object.entries(obj).filter(\n                    (it) => !comparator.bind(next_obj)(it[0], it[1])\n                ).length === 0;\n        }\n        if (!is_duplicate) {\n            list.push(next_obj);\n        }\n        return list;\n    }, []);\n}\n\nfunction mergeStack(stack, length) {\n    /* Given a list of lists of objects (which for brevity we call a stack),\n     * return a list of objects where each object is the merge of all the\n     * corresponding original objects at that particular index.\n     *\n     * If a certain sub-list doesn't have an object at that particular\n     * index, the last object in that list is merged.\n     */\n    const results = [];\n    for (let i = 0; i < length; i++) {\n        results.push({});\n    }\n    for (const frame of stack) {\n        const frame_length = frame.length - 1;\n        for (let x = 0; x < length; x++) {\n            results[x] = $.extend(\n                results[x] || {},\n                frame[x > frame_length ? frame_length : x]\n            );\n        }\n    }\n    return results;\n}\n\nfunction isElementInViewport(el, partial = false, offset = 0) {\n    /* returns true if element is visible to the user ie. is in the viewport.\n     * Setting partial parameter to true, will only check if a part of the element is visible\n     * in the viewport, specifically that some part of that element is touching the top part\n     * of the viewport. This only applies to the vertical direction, ie. doesnt check partial\n     * visibility for horizontal scrolling\n     * some code taken from:\n     * http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433\n     */\n    if (el instanceof $) {\n        el = el[0];\n    }\n\n    const rec = el.getBoundingClientRect();\n    const rec_values = [rec.top, rec.bottom, rec.left, rec.right];\n\n    if (rec_values.every((val) => val === 0)) {\n        // if every property of rec is 0, the element is invisible;\n        return false;\n    } else if (partial) {\n        // when using getBoundingClientRect() (in the vertical case)\n        // negative means above top of viewport, positive means below top of viewport\n        // therefore for part of the element to be touching or crossing the top of the viewport\n        // rec.top must <= 0 and rec.bottom must >= 0\n        // an optional tolerance offset can be added for when the desired element is not exactly\n        // toucing the top of the viewport but needs to be considered as touching.\n        return (\n            rec.top <= 0 + offset && rec.bottom >= 0 + offset\n            //(rec.top >= 0+offset && rec.top <= window.innerHeight) // this checks if the element\n            // touches bottom part of viewport\n            // XXX do we want to include a check for the padding of an element?\n            // using window.getComputedStyle(target).paddingTop\n        );\n    } else {\n        // this will return true if the entire element is completely in the viewport\n        return (\n            rec.top >= 0 &&\n            rec.left >= 0 &&\n            rec.bottom <=\n                (window.innerHeight || document.documentElement.clientHeight) &&\n            rec.right <= (window.innerWidth || document.documentElement.clientWidth)\n        );\n    }\n}\n\n/* parseTime - Parse a duration from a string and return the parsed time in milliseconds.\n *\n * @param {String} time - A duration/time string like ``1ms``, ``1s`` or ``1m``.\n *\n * @returns {Number} - A integer which represents the parsed time in milliseconds.\n */\nfunction parseTime(time) {\n    var m = /^(\\d+(?:\\.\\d+)?)\\s*(\\w*)/.exec(time);\n    if (!m) {\n        throw new Error(\"Invalid time\");\n    }\n    var amount = parseFloat(m[1]);\n    switch (m[2]) {\n        case \"s\":\n            return Math.round(amount * 1000);\n        case \"m\":\n            return Math.round(amount * 1000 * 60);\n        case \"ms\":\n        default:\n            return Math.round(amount);\n    }\n}\n\n/*\n\n * parseLength - Parse a length from a string and return the parsed length in\n * pixels.\n\n * @param {String} length - A length string like `1px` or `25%`. Lengths without a unit are treated as pixels.\n * @param {Number} reference_length - The reference length to use for percentage lengths.\n *\n * @returns {Number} - A integer which represents the parsed length in pixels.\n *\n * @throws {Error} - If the length string is invalid.\n *\n * @example\n * parseLength(\"1px\"); // 1\n * parseLength(\"10%\", 100); // 10\n *\n */\nfunction parseLength(length, reference_length = null) {\n    const m = /^(\\d+(?:\\.\\d+)?)\\s*(\\%?\\w*)/.exec(length);\n    if (!m) {\n        throw new Error(\"Invalid length\");\n    }\n    const amount = parseFloat(m[1]);\n    switch (m[2]) {\n        case \"px\":\n            return Math.round(amount);\n        case \"%\":\n            if (!reference_length) {\n                return 0;\n            }\n            return (reference_length / 100) * Math.round(amount);\n        case \"vw\":\n            return Math.round((amount * window.innerWidth) / 100);\n        case \"vh\":\n            return Math.round((amount * window.innerHeight) / 100);\n        case \"vmin\":\n            return Math.round(\n                (amount * Math.min(window.innerWidth, window.innerHeight)) / 100\n            );\n        case \"vmax\":\n            return Math.round(\n                (amount * Math.max(window.innerWidth, window.innerHeight)) / 100\n            );\n        default:\n            return Math.round(amount);\n    }\n}\n\n// Return a jQuery object with elements related to an input element.\nfunction findRelatives(el) {\n    var $el = $(el),\n        $relatives = $(el),\n        $label = $();\n\n    $relatives = $relatives.add($el.closest(\"label\"));\n    $relatives = $relatives.add($el.closest(\"fieldset\"));\n\n    if (el.id) $label = $(\"label[for='\" + el.id + \"']\");\n    if (!$label.length) {\n        var $form = $el.closest(\"form\");\n        if (!$form.length) $form = $(document.body);\n        $label = $form.find(\"label[for='\" + el.name + \"']\");\n    }\n    $relatives = $relatives.add($label);\n    return $relatives;\n}\n\nfunction get_bounds(el) {\n    // Return bounds of an element with it's values rounded and converted to ints.\n    const bounds = el.getBoundingClientRect();\n    return {\n        x: parseInt(Math.round(bounds.x), 10) || 0,\n        y: parseInt(Math.round(bounds.y), 10) || 0,\n        top: parseInt(Math.round(bounds.top), 10) || 0,\n        bottom: parseInt(Math.round(bounds.bottom), 10) || 0,\n        left: parseInt(Math.round(bounds.left), 10) || 0,\n        right: parseInt(Math.round(bounds.right), 10) || 0,\n        width: parseInt(Math.round(bounds.width), 10) || 0,\n        height: parseInt(Math.round(bounds.height), 10) || 0,\n    };\n}\n\nfunction checkInputSupport(type, invalid_value) {\n    /* Check input type support.\n     *  See: https://stackoverflow.com/a/10199306/1337474\n     */\n    let support = false;\n    const input = document.createElement(\"input\");\n    input.setAttribute(\"type\", type);\n    support = input.type == type;\n\n    if (invalid_value !== undefined) {\n        // Check for input type UI support\n        input.setAttribute(\"value\", invalid_value);\n        support = input.value !== invalid_value;\n    }\n    return support;\n}\n\nconst checkCSSFeature = (attribute, value, tag = \"div\") => {\n    /* Check for browser support of specific CSS feature.\n     */\n    tag = document.createElement(tag);\n    let supported = tag.style[attribute] !== undefined;\n    if (supported && value !== undefined) {\n        tag.style[attribute] = value;\n        supported = tag.style[attribute] === value;\n    }\n    return supported;\n};\n\nconst animation_frame = () => {\n    // Return promise to await next repaint cycle\n    // Use it in your async function like so: ``await utils.animation_frame()``\n    // From: http://www.albertlobo.com/fractals/async-await-requestanimationframe-buddhabrot\n    return new Promise(window.requestAnimationFrame);\n};\n\nconst timeout = (ms) => {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n};\n\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds.\n * From: https://underscorejs.org/#debounce\n *\n * @param {Function} func - The function to debounce.\n * @param {Number} ms - The time in milliseconds to debounce.\n * @param {Object} timer - A module-global timer as an object.\n * @param {Boolean} [postpone=true] - If true, the function will only be called\n * at the end, after it stops being called for N milliseconds. If false, the\n * function will be called no more than each [ms] milliseconds, ensuring that\n * the function isn't postponed for for too long.\n *\n * @returns {Function} - The debounced function.\n */\nconst debounce = (func, ms, timer = { timer: null }, postpone = true) => {\n    // Returns a function, that, as long as it continues to be invoked, will not\n    // be triggered. The function will be called after it stops being called for\n    // N milliseconds.\n    // From: https://underscorejs.org/#debounce\n    //\n    // Make sure to initialize ``debounce`` only once per to-be-debounced\n    // function to not reinitialize the timer each time and debounce not being\n    // able to cancel previouse runs.\n    //\n    // Pass a module-global timer as an object ``{ timer: null }`` if you want\n    // to also cancel debounced functions from other pattern-invocations.\n    timer.last_run = 0;\n    return function () {\n        const args = arguments;\n        if (!postpone && timer.timer && Date.now() - timer.last_run <= ms) {\n            return;\n        }\n        clearTimeout(timer.timer);\n        timer.last_run = Date.now();\n        timer.timer = setTimeout(() => {\n            func.apply(this, args);\n        }, ms);\n    };\n};\n\nconst isIE = () => {\n    // See: https://stackoverflow.com/a/9851769/1337474\n    // Internet Explorer 6-11\n    return /*@cc_on!@*/ false || !!document.documentMode;\n};\n\nconst jqToNode = (el) => {\n    // Return a DOM node if a jQuery node was passed.\n    if (el.jquery) {\n        el = el[0];\n    }\n    return el;\n};\n\n/**\n * Always return an iterable object.\n *\n * @param {any} it: The object which needs to be wrapped in an array or returned as is if it is iterable.\n * @param {boolean} force_array: If the object is iterable but not an Array, convert it to an array (e.g. For jQuery items or NodeList objects).\n *\n * @returns {Array}: Returns the object wrapped in an Array, expanded to an Array or as-is if it is already iterable.\n */\nconst ensureArray = (it, force_array) => {\n    // Ensure to return always an array\n    const array_like = !!(\n        NodeList.prototype.isPrototypeOf(it) || // eslint-disable-line no-prototype-builtins\n        Array.isArray(it) ||\n        it.jquery\n    );\n    return array_like ? (force_array ? [...it] : it) : [it];\n};\n\nconst localized_isodate = (date) => {\n    // Return a iso date (date only) in the current timezone instead of a\n    // UTC ISO 8601 date+time component which toISOString returns.\n\n    const day = date.getDate().toString().padStart(2, \"0\");\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n    const year = date.getFullYear().toString();\n\n    return `${year}-${month}-${day}`;\n};\n\n/**\n * Replace HTML reserved characters with html entities to add HTML for user\n * editing to e.g. a textarea or a contenteditable.\n *\n * See:\n *  https://stackoverflow.com/a/22706073/1337474\n *  https://developer.mozilla.org/en-US/docs/Glossary/Entity#reserved_characters\n *\n * @param {string} html - The HTML string to encode.\n *\n * @returns {string} - Returns the escaped html string:\n *                     ``&`` will be replaced with ``&amp;``.\n *                     ``<`` will be repalced with ``&lt;``,\n *                     ``>`` will be replaced with ``&gt;``,\n *                     ``\"`` will be replaced with ``&quot;``.\n */\nconst escape_html = (html) => {\n    if (!html) {\n        return \"\";\n    }\n    const el = document.createElement(\"div\");\n    el.appendChild(document.createTextNode(html));\n    // Return escaped html and also replace quotes.\n    return el.innerHTML.replace(/\"/g, \"&quot;\");\n};\n\n/**\n * Return unescaped, raw HTML from an escaped HTML  string.\n *\n * See:\n *  https://stackoverflow.com/a/34064434/1337474\n *  https://developer.mozilla.org/en-US/docs/Glossary/Entity#reserved_characters\n *\n * @param {string} escaped_html - The HTML string to decode.\n *\n * @returns {string} - Returns the escaped html string:\n *                     ``&amp;`` will be replaced with ``&``,\n *                     ``&lt;`` will be repalced with ``<``,\n *                     ``&gt;`` will be replaced with ``>``,\n *                     ``&quot;`` will be replaced with ``\"``.\n */\nconst unescape_html = (escaped_html) => {\n    if (!escaped_html) {\n        return \"\";\n    }\n    const doc = new DOMParser().parseFromString(escaped_html, \"text/html\");\n    // Return unescaped html and also unescape quote named entities.\n    return doc.documentElement.textContent.replace(/&quot;/g, '\"');\n};\n\n/**\n * Return true, if the given value is a valid ISO 8601 date/time string with or without an optional time component.\n *\n * @param {String} value - The date/time value to be checked.\n * @param {Boolean} [optional_time=false] - True, if time component is optional.\n * @return {Boolean} - True, if the given value is a valid Date string. False if not.\n */\nconst is_iso_date_time = (value, optional_time = false) => {\n    const re_date_time = optional_time\n        ? /^\\d{4}-[01]\\d-[0-3]\\d(T[0-2]\\d:[0-5]\\d)?$/\n        : /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d$/;\n    return re_date_time.test(value);\n};\n\n/**\n * Return true, if the given value is a valid ISO 8601 date string and without a time component.\n *\n * @param {String} value - The date value to be checked.\n * @return {Boolean} - True, if the given value is a valid ISO 8601 date string without a time component. False if not.\n */\nconst is_iso_date = (value) => {\n    const re_date_time = /^\\d{4}-[01]\\d-[0-3]\\d$/;\n    return re_date_time.test(value);\n};\n\n/**\n * Return the number of days between two dates.\n * Based on: https://stackoverflow.com/a/15289883/1337474\n *\n * @param {Date} date_1 - First date to compare. We will substract date_2 from date_1.\n * @param {Date} date_2 - Second date to compare.\n * @return {Number} - The number of days between the two dates.\n */\nconst date_diff = (date_1, date_2) => {\n    // Discard the time and time-zone information.\n    const utc_1 = Date.UTC(date_1.getFullYear(), date_1.getMonth(), date_1.getDate());\n    const utc_2 = Date.UTC(date_2.getFullYear(), date_2.getMonth(), date_2.getDate());\n\n    return Math.floor((utc_1 - utc_2) / _MS_PER_DAY);\n};\n\n/**\n * Build intersection observer threshold list.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#building_the_array_of_threshold_ratios\n *\n * @param {Number} num_steps - The number of steps to use.\n *\n * @returns {Array} - Returns the threshold list.\n */\nconst threshold_list = (num_steps = 0) => {\n    let thresholds = [];\n\n    for (let i = 1.0; i <= num_steps; i++) {\n        thresholds.push(i / num_steps);\n    }\n    thresholds.push(0);\n    return thresholds.sort();\n};\n\n/**\n * is_option_truthy - Check if an Pattern option is set.\n *\n * An option is set if it is not one of:\n * - undefined\n * - null\n * - \"none\"\n * - \"\"\n *\n * @param {String} option - The option to check.\n *\n * @returns {Boolean} - Returns true if the option is set, false otherwise.\n *\n * @example\n *\n * is_option_truthy() // false\n * is_option_truthy(undefined) // false\n * is_option_truthy(null) // false\n * is_option_truthy(\"\") // false\n * is_option_truthy(\"none\") // false\n * is_option_truthy(\"false\") // false\n * is_option_truthy(\"foo\") // true\n * is_option_truthy(true) // true\n * is_option_truthy(0) // true\n *\n */\nconst is_option_truthy = (option) => {\n    return ![undefined, null, \"none\", false, \"false\", \"\"].includes(option);\n};\n\nvar utils = {\n    jqueryPlugin: jqueryPlugin,\n    escapeRegExp: escapeRegExp,\n    isObject: isObject,\n    extend: extend,\n    findLabel: findLabel,\n    regexp_from_wildcard: regexp_from_wildcard,\n    removeWildcardClass: removeWildcardClass,\n    hideOrShow: hideOrShow,\n    addURLQueryParameter: addURLQueryParameter,\n    removeDuplicateObjects: removeDuplicateObjects,\n    mergeStack: mergeStack,\n    isElementInViewport: isElementInViewport,\n    hasValue: hasValue,\n    parseTime: parseTime,\n    parseLength: parseLength,\n    findRelatives: findRelatives,\n    get_bounds: get_bounds,\n    checkInputSupport: checkInputSupport,\n    checkCSSFeature: checkCSSFeature,\n    animation_frame: animation_frame,\n    timeout: timeout,\n    debounce: debounce,\n    isIE: isIE,\n    jqToNode: jqToNode,\n    ensureArray: ensureArray,\n    localized_isodate: localized_isodate,\n    escape_html: escape_html,\n    unescape_html: unescape_html,\n    is_iso_date_time: is_iso_date_time,\n    is_iso_date: is_iso_date,\n    date_diff: date_diff,\n    threshold_list: threshold_list,\n    is_option_truthy: is_option_truthy,\n    //getCSSValue: dom.get_css_value, // BBB: moved to dom. TODO: Remove in upcoming version.\n    elementInViewport: (el) => {\n        // BBB: Remove with next major version.\n        console.warn(\"Deprecated. Use utils.isElementInViewport\");\n        return isElementInViewport(el);\n    },\n};\n\nexport default utils;\n","/**\n * Get a universally unique id (uuid).\n *\n * @returns {String} - The uuid.\n */\nconst create_uuid = () => {\n    let uuid;\n    if (window.crypto.randomUUID) {\n        // Create a real UUID\n        // window.crypto.randomUUID does only exist in browsers with secure\n        // context.\n        // See: https://developer.mozilla.org/en-US/docs/Web/API/Crypto/randomUUID\n        uuid = window.crypto.randomUUID();\n    } else {\n        // Create a sufficiently unique ID\n        const array = new Uint32Array(4);\n        uuid = window.crypto.getRandomValues(array).join(\"\");\n    }\n    return uuid;\n};\nexport default create_uuid;\n","/**\n * Patterns store - store pattern state locally in the browser\n *\n * Copyright 2008-2012 Simplon B.V.\n * Copyright 2011 Humberto Sermeo\n * Copyright 2011 Florian Friesdorf\n */\nimport logging from \"./logging\";\n\nconst log = logging.getLogger(\"Patternslib Store\");\n\nfunction Storage(backend, prefix) {\n    this.prefix = prefix;\n    this.backend = backend;\n}\n\nStorage.prototype._key = function Storage_key(name) {\n    return this.prefix + \":\" + name;\n};\n\nStorage.prototype._allKeys = function Storage_allKeys() {\n    var keys = [],\n        prefix = this.prefix + \":\",\n        prefix_length = prefix.length,\n        key,\n        i;\n\n    for (i = 0; i < this.backend.length; i++) {\n        key = this.backend.key(i);\n        if (key.slice(0, prefix_length) === prefix) keys.push(key);\n    }\n    return keys;\n};\n\nStorage.prototype.get = function Storage_get(name) {\n    var key = this._key(name),\n        value = this.backend.getItem(key);\n    if (value !== null) {\n        try {\n            value = JSON.parse(value);\n        } catch {\n            log.warn(`Cannot parse storage value for key ${key}`);\n            return;\n        }\n    }\n    return value;\n};\n\nStorage.prototype.set = function Storage_set(name, value) {\n    var key = this._key(name);\n    return this.backend.setItem(key, JSON.stringify(value));\n};\n\nStorage.prototype.remove = function Storage_remove(name) {\n    var key = this._key(name);\n    return this.backend.removeItem(key);\n};\n\nStorage.prototype.clear = function Storage_clear() {\n    var keys = this._allKeys();\n    for (var i = 0; i < keys.length; i++) this.backend.removeItem(keys[i]);\n};\n\nStorage.prototype.all = function Storage_all() {\n    var keys = this._allKeys(),\n        prefix_length = this.prefix.length + 1,\n        lk,\n        data = {};\n\n    for (var i = 0; i < keys.length; i++) {\n        lk = keys[i].slice(prefix_length);\n        data[lk] = JSON.parse(this.backend.getItem(keys[i]));\n    }\n    return data;\n};\n\nfunction ValueStorage(store, name) {\n    this.store = store;\n    this.name = name;\n}\n\nValueStorage.prototype.get = function ValueStorage_get() {\n    return this.store.get(this.name);\n};\n\nValueStorage.prototype.set = function ValueStorage_get(value) {\n    return this.store.set(this.name, value);\n};\n\nValueStorage.prototype.remove = function ValueStorage_remove() {\n    return this.store.remove(this.name);\n};\n\nvar store = {\n    supported: false,\n\n    local: function (name) {\n        return new Storage(window.localStorage, name);\n    },\n\n    session: function (name) {\n        return new Storage(window.sessionStorage, name);\n    },\n\n    ValueStorage: ValueStorage,\n\n    // Update storage options for a given element.\n    updateOptions: function store_updateOptions(trigger, options) {\n        if (options.store !== \"none\") {\n            if (!trigger.id) {\n                log.warn(\"state persistance requested, but element has no id\");\n                options.store = \"none\";\n            } else if (!store.supported) {\n                log.warn(\n                    \"state persistance requested, but browser does not support webstorage\"\n                );\n                options.store = \"none\";\n            }\n        }\n        return options;\n    },\n};\n\n// Perform the test separately since this may throw a SecurityError as\n// reported in #326\ntry {\n    store.supported = typeof window.sessionStorage !== \"undefined\";\n} catch (e) {\n    // just ignore.\n}\n\nexport default store;\n","/* pat-date-picker  - Polyfill for input type=date */\nimport $ from \"jquery\";\nimport Base from \"../../core/base\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport store from \"../../core/store\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"date-picker\");\n\nexport const parser = new Parser(\"date-picker\");\nparser.addArgument(\"behavior\", \"styled\", [\"native\", \"styled\"]);\nparser.addArgument(\"week-numbers\", [], [\"show\", \"hide\"]);\nparser.addArgument(\"i18n\"); // URL pointing to JSON resource with i18n values\nparser.addArgument(\"first-day\", 0);\nparser.addArgument(\"after\");\nparser.addArgument(\"offset-days\", 0);\n\nparser.add_argument(\"output-format\", null);\nparser.add_argument(\"locale\", null);\n\nparser.addAlias(\"behaviour\", \"behavior\");\n\n/* JSON format for i18n\n * { \"previousMonth\": \"Previous Month\",\n *   \"nextMonth\"    : \"Next Month\",\n *   \"months\"       : [\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\n *   \"weekdays\"     : [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"],\n *   \"weekdaysShort\": [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"]\n * } */\n\nexport const storage = store.session(\"pat-date-picker\");\n\n\nexport default Base.extend({\n    name: \"date-picker\",\n    trigger: \".pat-date-picker\",\n    parser: parser,\n    format: \"YYYY-MM-DD\",\n\n    async init() {\n        const el = this.el;\n        const disabled = this.el.disabled;\n\n        //TODO: make parser with options extend missing options.\n        //this.options = parser.parse(el, opts);\n        this.options = $.extend(parser.parse(el), this.options);\n\n        if (!disabled && this.options.after) {\n            // Set the date depending on another date which must be ``offset-days``\n            // BEFORE this date. Only set it, if the other date is AFTER this\n            // date.\n            const befores = document.querySelectorAll(this.options.after);\n            for (const b_el of befores) {\n                b_el.addEventListener(\"change\", (e) => {\n                    let b_date = e.target.value; // the \"before-date\"\n                    b_date = b_date ? new Date(b_date) : null;\n                    if (!b_date) {\n                        return;\n                    }\n                    let a_date = this.el.value; // the \"after-date\"\n                    a_date = a_date ? new Date(a_date) : null;\n                    if (!a_date || a_date < b_date) {\n                        const offset = this.options.offsetDays || 0;\n                        b_date.setDate(b_date.getDate() + offset);\n                        this.el.value = b_date.toISOString().substring(0, 10);\n                        this.dispatch_change_event();\n                    }\n                });\n            }\n        }\n\n        let display_el;\n        if (this.options.behavior === \"styled\") {\n            dom.hide(el); // hide input, but keep active (e.g. for validation)\n\n            display_el = document.createElement(\"time\");\n            display_el.setAttribute(\"class\", \"output-field\");\n            display_el.setAttribute(\"datetime\", el.value);\n            if (disabled) {\n                display_el.classList.add(\"disabled\");\n            }\n            el.insertAdjacentElement(\"beforebegin\", display_el);\n\n            // Disable click on label, as this invokes a click on the invisible\n            // input field which opens the calendar in Firefox and masks a\n            // click on display_el on Chrome.\n            const label = display_el.closest(\"label\");\n            if (label) {\n                events.add_event_listener(\n                    label,\n                    \"click\",\n                    \"pat-date-picker--label\",\n                    (e) => {\n                        e.preventDefault();\n                    }\n                );\n            }\n\n            let pat_display_time;\n            if (this.options.outputFormat) {\n                const PatDisplayTime = (await import(\"../display-time/display-time\")).default; // prettier-ignore\n                const display_time_config = { format: this.format };\n                if (this.options.outputFormat) {\n                    display_time_config[\"output-format\"] = this.options.outputFormat;\n                }\n                if (this.options.locale) {\n                    display_time_config.locale = this.options.locale;\n                }\n                pat_display_time = new PatDisplayTime(display_el, display_time_config);\n            } else if (this.el.value) {\n                display_el.textContent = el.value;\n            }\n\n            // Add the additional elements \"clear button\" and placeholder to\n            // the `<time>` element.\n            const _add_additional = () => {\n                this.add_clear_button(display_el);\n                if (!this.el.value && this.el.placeholder) {\n                    display_el.innerHTML = `<span class=\"placeholder\">${this.el.placeholder}</span>`;\n                }\n            };\n            if (pat_display_time) {\n                // Add the additional elements after display time has\n                // eventually cleared the contents or done any other changes.\n                $(display_el).on(\"init.display-time.patterns\", () => {\n                    _add_additional();\n                });\n            } else {\n                // If no `pat-display-time` was used, add immediately.\n                _add_additional();\n            }\n\n            this.el.addEventListener(\"change\", () => {\n                display_el.setAttribute(\"datetime\", this.el.value);\n                if (pat_display_time && this.el.value) {\n                    pat_display_time.format();\n                } else {\n                    //} else if (this.el.value) {\n                    display_el.textContent = this.el.value;\n                }\n                _add_additional();\n            });\n\n            if (disabled) {\n                // nothing else to do here...\n                return;\n            }\n        } else if (disabled) {\n            return;\n        } else if (utils.checkInputSupport(\"date\", \"invalid date\")) {\n            // behavior native with native support.\n            return;\n        } else if (el.getAttribute(\"type\") === \"date\") {\n            // behavior native but no native support.\n            // Fallback JS date picker with a text input field.\n            el.setAttribute(\"type\", \"text\");\n        }\n\n        if (window.__patternslib_import_styles) {\n            import(\"./_date-picker.scss\");\n        }\n        const Pikaday = (await import(\"pikaday\")).default;\n\n        const config = {\n            field: el,\n            trigger: display_el || el,\n            format: this.format,\n            firstDay: this.options.firstDay,\n            showWeekNumber: this.options.weekNumbers === \"show\",\n            onSelect: () => this.dispatch_change_event(),\n            onClose: () => {\n                if (this.options.behavior === \"styled\" && !this.el.value) {\n                    // blur the input field so that pat-validate can kick in when\n                    // nothing was selected.\n                    el.dispatchEvent(events.blur_event());\n                }\n            },\n        };\n\n        if (el.getAttribute(\"min\")) {\n            config.minDate = new Date(el.getAttribute(\"min\"));\n        }\n        if (el.getAttribute(\"max\")) {\n            config.maxDate = new Date(el.getAttribute(\"max\"));\n        }\n\n        if (this.options.i18n) {\n            let i18n = storage.get(this.options.i18n);\n            if (!i18n) {\n                try {\n                    const response = await fetch(this.options.i18n);\n                    i18n = await response.json();\n                    storage.set(this.options.i18n, i18n);\n                } catch {\n                    log.error(`date-picker could not load i18n for ${this.options.i18n}`);\n                }\n            }\n            if (i18n) {\n                config.i18n = i18n;\n            }\n        }\n        this.pikaday = new Pikaday(config);\n    },\n\n    add_clear_button(el_append_to) {\n        if (!this.el.disabled && !this.el.required && this.el.value) {\n            // Add clear button\n            const clear_button = document.createElement(\"span\");\n            clear_button.setAttribute(\"class\", \"cancel-button\");\n            clear_button.addEventListener(\"click\", (e) => {\n                e.stopPropagation();\n                this.el.value = null;\n                this.dispatch_change_event();\n            });\n            el_append_to.appendChild(clear_button);\n        }\n    },\n\n    dispatch_change_event() {\n        const event = new Event(\"change\", {\n            bubbles: true,\n            cancelable: true,\n        });\n        // Set ``firedBy` to prevent pikaday to call it's own handler and land\n        // in an infinite loop.\n        event.firedBy = this.pikaday;\n        this.el.dispatchEvent(event);\n\n        // Also trigger input-change\n        $(this.el).trigger(\"input-change\");\n        $(this.el.form).trigger(\"input-change\");\n    },\n});\n","import Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport logging from \"../../core/logging\";\nimport utils from \"../../core/utils\";\n\n// Lazy loading modules.\nlet Moment;\n\nconst log = logging.getLogger(\"pat-display-time\");\n\nexport const parser = new Parser(\"display-time\");\n// input datetime options\nparser.add_argument(\"format\", \"\");\nparser.add_argument(\"locale\", null);\nparser.add_argument(\"strict\", false);\n// output options\nparser.add_argument(\"from-now\", false);\nparser.add_argument(\"no-suffix\", false);\nparser.add_argument(\"output-format\", null);\n\nexport default Base.extend({\n    name: \"display-time\",\n    trigger: \".pat-display-time\",\n\n    async init() {\n        Moment = (await import(\"moment\")).default;\n\n        this.options = parser.parse(this.el, this.options);\n\n        let lang = this.options.locale || dom.acquire_attribute(this.el, \"lang\") || \"en\";\n        // we don't support any country-specific language variants, always use first 2 letters\n        lang = lang.substr(0, 2).toLowerCase();\n        try {\n            await import(`moment/locale/${lang}.js`);\n            Moment.locale(lang);\n            this.lang = lang;\n        } catch {\n            Moment.locale(\"en\");\n            this.lang = \"en\";\n        }\n        log.debug(`Moment.js language used: ${lang}.`);\n        this.format();\n    },\n\n    format() {\n        const datetime = this.el.getAttribute(\"datetime\");\n        let out = \"\";\n        if (datetime) {\n            const date = Moment(datetime, this.options.format, this.options.strict);\n            out = date;\n            if (this.options.fromNow === true) {\n                if (utils.is_iso_date(datetime)) {\n                    // date-only case.\n                    const rtf = new Intl.RelativeTimeFormat(this.lang, {\n                        numeric: \"auto\",\n                    });\n                    const date_diff = utils.date_diff(date.toDate(), new Date());\n                    out = date.calendar(null, {\n                        // when the date is closer, specify custom values\n                        lastWeek: `[${rtf.format(date_diff, \"day\")}]`, // translates to \"x days ago\"\n                        lastDay: `[${rtf.format(-1, \"day\")}]`, // translates to \"yesterday\"\n                        sameDay: `[${rtf.format(0, \"day\")}]`, // translates to \"today\"\n                        nextDay: `[${rtf.format(1, \"day\")}]`, // translates to \"tomorrow\"\n                        nextWeek: \"dddd\", // translates to week day name\n                        // otherwise, just use Intl.RelativeTimeFormat.\n                        sameElse: () => {\n                            return `[${rtf.format(date_diff, \"day\")}]`;\n                        },\n                    });\n                } else {\n                    // datetime case.\n                    out = date.fromNow(this.options.noSuffix);\n                }\n            } else if (this.options.outputFormat) {\n                out = date.format(this.options.outputFormat);\n            }\n        }\n        this.el.textContent = out;\n    },\n});\n","import Base from \"../../core/base\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"close-panel\",\n    trigger: \".close-panel\",\n\n    init() {\n        // Close panel support for dialog panels\n        // Other modals are handled in pat-modal.\n        const dialog_panel = this.el.closest(\"dialog\");\n        if (dialog_panel) {\n            events.add_event_listener(\n                dialog_panel,\n                \"close-panel\",\n                \"close-panel--dialog\",\n                () => {\n                    dialog_panel.close();\n                }\n            );\n        }\n\n        this.el.addEventListener(\"click\", async (e) => {\n            await utils.timeout(0); // Wait for other patterns, like pat-validation.\n\n            if (\n                e.target.matches(\":not([formnovalidate])\") &&\n                e.target.matches(\"[type=submit], button:not([type=button])\") &&\n                this.el.closest(\"form\")?.checkValidity() === false\n            ) {\n                // Prevent closing an invalid form when submitting.\n                return;\n            }\n\n            this.el.dispatchEvent(\n                new Event(\"close-panel\", { bubbles: true, cancelable: true })\n            );\n        });\n    },\n});\n","import $ from \"jquery\";\nimport { BasePattern } from \"../../core/basepattern\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport events from \"../../core/events\";\nimport registry from \"../../core/registry\";\nimport utils from \"../../core/utils\";\n\n// Initialize close-panel functionality.\nimport \"../close-panel/close-panel\";\n\nconst log = logging.getLogger(\"pat-tooltip\");\n\nexport const parser = new Parser(\"tooltip\");\nconst all_positions = [\n    \"tl\",\n    \"tm\",\n    \"tr\",\n    \"rt\",\n    \"rm\",\n    \"rb\",\n    \"br\",\n    \"bm\",\n    \"bl\",\n    \"lb\",\n    \"lm\",\n    \"lt\",\n];\nparser.addArgument(\"position-list\", [], all_positions, true);\nparser.addArgument(\"position-policy\", \"auto\", [\"auto\", \"force\"]);\nparser.addArgument(\"trigger\", \"click\", [\"click\", \"hover\", \"none\"]);\nparser.addArgument(\"source\", \"title\", [\"ajax\", \"content\", \"title\"]);\nparser.addArgument(\"ajax-data-type\", \"html\", [\"html\", \"markdown\"]);\nparser.addArgument(\"closing\", \"auto\", [\"auto\", \"sticky\", \"close-button\"]);\nparser.addArgument(\"delay\");\nparser.addArgument(\"mark-inactive\", true);\nparser.addArgument(\"class\");\nparser.addArgument(\"target\", \"body\");\nparser.addArgument(\"arrow-padding\", null);\nparser.addArgument(\"url\", null);\n\n// Tippy Lifecycle-hooks\n// See: https://tippyjs.bootcss.com/lifecycle-hooks/\n// onCreate\n// onTrigger\n// onShow\n// onMount\n// onShown\n// onUntrigger\n// onHide\n// onHidden\n//\n// onBeforeUpdate\n// onAfterUpdate\n// onDestroy\n\nclass Pattern extends BasePattern {\n    static name = \"tooltip\";\n    static trigger = \".pat-tooltip, .pat-tooltip-ng\";\n    static parser = parser;\n\n    tippy = null;\n\n    active_class = \"tooltip-active-hover\";\n    inactive_class = \"tooltip-inactive\";\n\n    async init() {\n        const el = this.el;\n\n        if (window.__patternslib_import_styles) {\n            import(\"tippy.js/dist/tippy.css\");\n        }\n        const Tippy = (await import(\"tippy.js\")).default;\n        this.tippy_options = this.parseOptionsForTippy(this.options);\n\n        const defaultProps = {\n            animation: false,\n            arrow: true,\n            //'delay': [0, 1800],\n            //'duration': [325, 275],\n            hideOnClick: this.options.closing === \"close-button\" ? false : true,\n            ignoreAttributes: true,\n            interactive: true,\n            onHide: this._onHide.bind(this),\n            onShow: this._onShow.bind(this),\n            trigger: \"click\",\n        };\n\n        Tippy.setDefaultProps(defaultProps);\n        this.tippy = new Tippy(el, this.tippy_options);\n\n        if (this.options.source === \"title\") {\n            // Remove ``title`` attribute when source is set to ``title`` to\n            // disable the browser's built-in tooltip feature\n            el.removeAttribute(\"title\");\n        }\n\n        if (this.options.trigger === \"click\" && this.options.source === \"ajax\") {\n            // prevent default action for \"click\" and \"mouseenter click\"\n            events.add_event_listener(\n                el,\n                \"click\",\n                \"pat-tooltip--click-prevent-default\",\n                (event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            );\n        }\n\n        if (this.options.trigger === \"click\") {\n            this.active_class = \"tooltip-active-click\";\n        }\n        if (this.options.markInactive) {\n            // Initially mark as inactive\n            el.classList.add(this.inactive_class);\n        }\n    }\n\n    show() {\n        // Show this tooltip\n        this.tippy.show();\n    }\n\n    async hide() {\n        // Hide this tooltip\n        await utils.timeout(1); // wait a tick for event being processed by other handlers.\n        this.tippy.hide();\n    }\n\n    destroy() {\n        // Remove this tooltip\n        super.destroy(); // Unregister\n        this.tippy.destroy();\n    }\n\n    parseOptionsForTippy(opts) {\n        const placement = (pos) => {\n            // note that Cornelis needs the positioning to be the placement of the thingy on the bubble\n            // tippy though refers to positioning as the placement of the bubble relatively to the reference element\n            // so we invert the meaning below. It's intentional.\n            const primary = (pos0) =>\n                ({\n                    t: \"bottom\",\n                    r: \"left\",\n                    b: \"top\",\n                    l: \"right\",\n                }[pos0]);\n\n            const secondary = (pos1) =>\n                ({\n                    l: \"-start\",\n                    r: \"-end\",\n                    m: \"\",\n                    t: \"-start\",\n                    b: \"-end\",\n                }[pos1]);\n\n            return `${primary(pos[0])}${secondary(pos[1])}`;\n        };\n\n        const tippy_options = { popperOptions: { modifiers: [] } };\n\n        if (opts.arrowPadding !== null) {\n            tippy_options.popperOptions.modifiers.push({\n                name: \"arrow\",\n                options: {\n                    padding: parseInt(opts.arrowPadding, 10),\n                },\n            });\n        }\n\n        const parsers = {\n            position: () => {\n                if (!opts.position?.list?.length) {\n                    return;\n                }\n                tippy_options.placement = placement(opts.position.list[0]); // main position\n\n                const flip_options = {\n                    name: \"flip\",\n                    enabled: true,\n                };\n\n                if (opts.position.policy === \"force\") {\n                    flip_options.enabled = false;\n                } else if (opts.position.length > 1) {\n                    const fallbacks = opts.position.list.slice(1).map(placement);\n                    flip_options.fallbackPlacements = fallbacks;\n                }\n\n                tippy_options.popperOptions.modifiers.push(flip_options);\n            },\n\n            trigger() {\n                if (opts.trigger === \"hover\") {\n                    tippy_options.trigger = \"mouseenter focus\";\n                } else if (opts.trigger === \"none\") {\n                    tippy_options.trigger = \"manual\";\n                    tippy_options.hideOnClick = false;\n                }\n            },\n\n            source: () => {\n                let content;\n                if (opts.source === \"title\") {\n                    // Tooltip content from title attribute\n                    content = this.el.getAttribute(\"title\");\n                } else if (opts.source === \"content\") {\n                    // Tooltip content from trigger childs.\n                    content = this.el.innerHTML;\n                    tippy_options.allowHTML = true;\n                } else if (opts.source === \"ajax\") {\n                    // Tooltiop content from AJAX request.\n                    content = document.createElement(\"progress\");\n                    tippy_options.allowHTML = true;\n                }\n                tippy_options.content = content;\n            },\n\n            delay() {\n                if (opts.delay) {\n                    tippy_options.delay = [utils.parseTime(opts.delay), 0];\n                }\n            },\n\n            target: () => {\n                if (!opts.target) {\n                    return;\n                }\n                if (opts.target === \"parent\") {\n                    tippy_options.appendTo = \"parent\";\n                } else if (opts.target === \"body\") {\n                    tippy_options.appendTo = document.body;\n                } else {\n                    tippy_options.appendTo = document.querySelector(opts.target);\n                }\n            },\n        };\n\n        for (let arg in opts) {\n            switch (arg) {\n                case \"ajax-data-type\":\n                    arg = \"ajaxDataType\";\n                    break;\n                case \"mark-inactive\":\n                    arg = \"markInactive\";\n                    break;\n            }\n            parsers[arg] && parsers[arg](arg);\n        }\n\n        return tippy_options;\n    }\n\n    _initialize_content() {\n        // Initialize any other patterns.\n        registry.scan(this.tippy.popper);\n    }\n\n    async _onShow() {\n        const tippy_classes = [];\n\n        // Group DOM manipulations\n\n        if (this.options.class) {\n            tippy_classes.push(...this.options.class.split(\" \"));\n        }\n\n        // Add a generic non-tippy related class to identify the tooltip container\n        tippy_classes.push(\"tooltip-container\");\n\n        if (this.options.closing === \"close-button\") {\n            // First, remove previously automatically added close buttons.\n            // Otherwise we would end up adding another close button with every\n            // click on it.\n            for (const close_button of this.tippy.popper.querySelectorAll(\n                \".pat-tooltip--close-button\"\n            )) {\n                close_button.remove();\n            }\n\n            const close_button = document.createElement(\"button\");\n            close_button.setAttribute(\"class\", \"close-panel pat-tooltip--close-button\");\n            const content = this.tippy.popper.querySelector(\".tippy-content\");\n            content.parentNode.insertBefore(close_button, content);\n        }\n\n        // Store reference to method for closing panels on the tooltip element instance.\n        events.add_event_listener(\n            this.tippy.popper,\n            \"close-panel\",\n            \"pat-tooltip--close-panel\",\n            () => this.hide()\n        );\n\n        this.tippy.popper.classList.add(...tippy_classes);\n\n        if (this.options.markInactive) {\n            this.el.classList.remove(this.inactive_class);\n            this.el.classList.add(this.active_class);\n        }\n\n        if (this.options.closing !== \"auto\" && this.options.trigger === \"hover\") {\n            // no auto-close when hovering when closing mode is \"sticky\" or \"close-button\".\n            this.tippy.setProps({ trigger: \"click\" });\n        }\n\n        if (this.options.source === \"ajax\") {\n            await this._get_content();\n        }\n\n        // Notify parent patterns about injected content.\n        // Do not call pat-inject's handler, because all necessary\n        // initialization after injection is done here.\n        $(this.tippy.popper).trigger(\"patterns-injected\", [\n            { skipPatInjectHandler: true },\n            this.el,\n            this.tippy.popper,\n        ]);\n\n        this._initialize_content();\n    }\n\n    _onHide() {\n        if (this.options.markInactive) {\n            this.el.classList.remove(this.active_class);\n            this.el.classList.add(this.inactive_class);\n        }\n\n        if (this.options.closing !== \"auto\" && this.options.trigger === \"hover\") {\n            // re-set hover behavior\n            this.tippy.setProps({ trigger: \"mouseenter focus\" });\n        }\n\n        if (this.options.source === \"ajax\") {\n            this.tippy.setContent(document.createElement(\"progress\"));\n        }\n    }\n\n    async _get_content(url = this.options.url) {\n        let selector;\n        ({ url, selector } = this.get_url_parts(url || this.el.getAttribute(\"href\")));\n        let content;\n        if (url) {\n            // Tooltip from remote page.\n            const handler = this.data_type_handlers[this.options.ajaxDataType];\n            try {\n                // TODO: use pat-inject, once it supports async\n                const response = await fetch(url, {\n                    headers: {\n                        Accept: \"text/html,application/xhtml+xml,application/xml\",\n                    },\n                });\n                const text = await response.text();\n                content = await handler(text, url, selector);\n            } catch (e) {\n                log.error(\"Error on ajax request. ${e}\");\n            }\n        } else if (selector) {\n            // Tooltip content from current DOM tree.\n            content = document.querySelector(selector);\n            content = content?.innerHTML || undefined;\n        }\n        if (content) {\n            this.tippy.setContent(content);\n            await utils.timeout(1); // Wait a tick before forceUpdate. Might fail due to unset popperInstance.\n            this.tippy.popperInstance.forceUpdate(); // re-position tippy after content is known.\n        }\n    }\n\n    async get_content(url = this.options.url) {\n        // API method: _get_content + _initialize_content\n        await this._get_content(url);\n        this._initialize_content();\n    }\n\n    get_url_parts(href) {\n        // Return the URL and a CSS ID selector.\n        let url, selector, query;\n        if (!href) {\n            return { url, selector };\n        }\n        [url, selector] = href.split(\"#\");\n        if (selector) {\n            selector = `#${selector}`;\n            [selector, query] = selector.split(\"?\");\n        }\n        if (query) {\n            url = `${url}?${query}`;\n        }\n        return { url, selector };\n    }\n\n    static data_type_handlers = {\n        html(text, url, selector) {\n            let tmp = document.createElement(\"div\");\n            tmp.innerHTML = text;\n            if (selector) {\n                tmp = tmp.querySelector(selector);\n            }\n            return tmp?.innerHTML || \"\";\n        },\n\n        async markdown(text, url, selector) {\n            const Markdown = registry.patterns.markdown;\n            if (!Markdown) {\n                return text;\n            }\n\n            const instance = new Markdown($(\"<div/>\"));\n            await events.await_pattern_init(instance);\n\n            const cfg = { url };\n            if (selector) {\n                cfg.source = selector;\n            }\n\n            const ret = await instance.renderForInjection(cfg, text);\n            return ret[0];\n        },\n    };\n\n    static register_type_handler(type, handler) {\n        Pattern.data_type_handlers[type] = handler;\n    }\n\n    constructor(...args) {\n        super(...args);\n\n        this.register_type_handler = this.constructor.register_type_handler;\n        this.data_type_handlers = this.constructor.data_type_handlers;\n    }\n}\n\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n","/* i18n integration.\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport I18N from \"./i18n\";\n\n// we're creating a singleton here so we can potentially\n// delay the initialization of the translate catalog\n// until after the dom is available\nlet _translation_domains = {\n    plone: null,\n    widgets: null,\n};\n\nconst translate = function (domain, msgid, keywords) {\n    if (_translation_domains[domain] === null) {\n        var i18n = new I18N();\n        i18n.loadCatalog(domain);\n        _translation_domains[domain] = i18n.MessageFactory(domain);\n    }\n    return _translation_domains[domain](msgid, keywords);\n};\n\nconst translate_widgets = function (msgid, keywords) {\n    return translate(\"widgets\", msgid, keywords);\n};\n\nconst translate_plone = function (msgid, keywords) {\n    return translate(\"plone\", msgid, keywords);\n};\n\n// backwards compatibilty: \"widgets\" domain is default factory\nexport default translate_widgets;\n\n// explicit export of translation domain factories\nexport { translate_widgets, translate_plone };\n","/* i18n integration. This is forked from jarn.jsi18n\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport $ from \"jquery\";\n\nconst i18n = function () {\n    var self = this;\n    self.baseUrl = $(\"body\").attr(\"data-i18ncatalogurl\");\n    self.currentLanguage = $(\"html\").attr(\"lang\") || \"en\";\n\n    // Fix for country specific languages\n    if (self.currentLanguage.split(\"-\").length > 1) {\n        self.currentLanguage =\n            self.currentLanguage.split(\"-\")[0] +\n            \"_\" +\n            self.currentLanguage.split(\"-\")[1].toUpperCase();\n    }\n\n    self.storage = null;\n    self.catalogs = {};\n    self.ttl = 24 * 3600 * 1000;\n\n    // Internet Explorer 8 does not know Date.now() which is used in e.g. loadCatalog, so we \"define\" it\n    if (!Date.now) {\n        Date.now = function () {\n            return new Date().valueOf();\n        };\n    }\n\n    try {\n        if (\n            \"localStorage\" in window &&\n            window.localStorage !== null &&\n            \"JSON\" in window &&\n            window.JSON !== null\n        ) {\n            self.storage = window.localStorage;\n        }\n    } catch (e) {\n        console.log(\"Failed to set local storage\");\n    }\n\n    self.configure = function (config) {\n        for (var key in config) {\n            self[key] = config[key];\n        }\n    };\n\n    self._setCatalog = function (domain, language, catalog) {\n        if (domain in self.catalogs) {\n            self.catalogs[domain][language] = catalog;\n        } else {\n            self.catalogs[domain] = {};\n            self.catalogs[domain][language] = catalog;\n        }\n    };\n\n    self._storeCatalog = function (domain, language, catalog) {\n        var key = domain + \"-\" + language;\n        if (self.storage !== null && catalog !== null) {\n            self.storage.setItem(key, JSON.stringify(catalog));\n            self.storage.setItem(key + \"-updated\", Date.now());\n        }\n    };\n\n    self.getUrl = function (domain, language) {\n        return self.baseUrl + \"?domain=\" + domain + \"&language=\" + language;\n    };\n\n    self.loadCatalog = function (domain, language) {\n        if (language === undefined) {\n            language = self.currentLanguage;\n        }\n        if (self.storage !== null) {\n            var key = domain + \"-\" + language;\n            if (key in self.storage) {\n                if (\n                    Date.now() - parseInt(self.storage.getItem(key + \"-updated\"), 10) <\n                    self.ttl\n                ) {\n                    var catalog = JSON.parse(self.storage.getItem(key));\n                    self._setCatalog(domain, language, catalog);\n                    return;\n                }\n            }\n        }\n        if (!self.baseUrl) {\n            return;\n        }\n        $.getJSON(self.getUrl(domain, language), function (catalog) {\n            if (catalog === null) {\n                return;\n            }\n            self._setCatalog(domain, language, catalog);\n            self._storeCatalog(domain, language, catalog);\n        });\n    };\n\n    self.MessageFactory = function (domain, language) {\n        language = language || self.currentLanguage;\n        return function translate(msgid, keywords) {\n            var msgstr;\n            if (\n                domain in self.catalogs &&\n                language in self.catalogs[domain] &&\n                msgid in self.catalogs[domain][language]\n            ) {\n                msgstr = self.catalogs[domain][language][msgid];\n            } else {\n                msgstr = msgid;\n            }\n            if (keywords) {\n                var regexp, keyword;\n                for (keyword in keywords) {\n                    if (Object.prototype.hasOwnProperty.call(keywords, keyword)) {\n                        regexp = new RegExp(\"\\\\$\\\\{\" + keyword + \"\\\\}\", \"g\");\n                        msgstr = msgstr.replace(regexp, keywords[keyword]);\n                    }\n                }\n            }\n            return msgstr;\n        };\n    };\n};\n\nexport default i18n;\n","import $ from \"jquery\";\nimport logging from \"@patternslib/patternslib/src/core/logging\";\n\nconst logger = logging.getLogger(\"core utils\");\n\nvar QueryHelper = function (options) {\n    /* if pattern argument provided, it can implement the interface of:\n     *    - browsing: boolean if currently browsing\n     *    - currentPath: string of current path to apply to search if browsing\n     *    - basePath: default path to provide if no subpath used\n     */\n\n    var self = this;\n    var defaults = {\n        pattern: null, // must be passed in\n        vocabularyUrl: null,\n        searchParam: \"SearchableText\", // query string param to pass to search url\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        attributes: [\"UID\", \"Title\", \"Description\", \"getURL\", \"portal_type\"],\n        batchSize: 10, // number of results to retrive\n        baseCriteria: [],\n        sort_on: \"is_folderish\",\n        sort_order: \"reverse\",\n        pathDepth: 1,\n    };\n    self.options = $.extend({}, defaults, options);\n\n    self.pattern = self.options.pattern;\n    if (self.pattern === undefined || self.pattern === null) {\n        self.pattern = {\n            browsing: false,\n            basePath: \"/\",\n        };\n    }\n\n    if (self.options.url && !self.options.vocabularyUrl) {\n        self.options.vocabularyUrl = self.options.url;\n    } else if (self.pattern.vocabularyUrl) {\n        self.options.vocabularyUrl = self.pattern.vocabularyUrl;\n    }\n    self.valid = Boolean(self.options.vocabularyUrl);\n\n    self.getBatch = function (page) {\n        return {\n            page: page ? page : 1,\n            size: self.options.batchSize,\n        };\n    };\n\n    self.getCurrentPath = function () {\n        var pattern = self.pattern;\n        var currentPath;\n        /* If currentPath is set on the QueryHelper object, use that first.\n         * Then, check on the pattern.\n         * Finally, see if it is a function and call it if it is.\n         */\n        if (self.currentPath) {\n            currentPath = self.currentPath;\n        } else {\n            currentPath = pattern.currentPath;\n        }\n        if (typeof currentPath === \"function\") {\n            currentPath = currentPath();\n        }\n        var path = currentPath;\n        if (!path) {\n            if (pattern.basePath) {\n                path = pattern.basePath;\n            } else if (pattern.options.basePath) {\n                path = pattern.options.basePath;\n            } else {\n                path = \"/\";\n            }\n        }\n        return path;\n    };\n\n    self.getCriterias = function (term, searchOptions) {\n        if (searchOptions === undefined) {\n            searchOptions = {};\n        }\n        searchOptions = $.extend(\n            {},\n            {\n                useBaseCriteria: true,\n                additionalCriterias: [],\n            },\n            searchOptions\n        );\n\n        var criterias = [];\n        if (searchOptions.useBaseCriteria) {\n            criterias = self.options.baseCriteria.slice(0);\n        }\n        if (term) {\n            term += \"*\";\n            criterias.push({\n                i: self.options.searchParam,\n                o: \"plone.app.querystring.operation.string.contains\",\n                v: term,\n            });\n        }\n        if (searchOptions.searchPath) {\n            criterias.push({\n                i: \"path\",\n                o: self.options.pathOperator,\n                v: searchOptions.searchPath + \"::\" + self.options.pathDepth,\n            });\n        } else if (self.pattern.browsing) {\n            criterias.push({\n                i: \"path\",\n                o: self.options.pathOperator,\n                v: self.getCurrentPath() + \"::\" + self.options.pathDepth,\n            });\n        }\n        criterias = criterias.concat(searchOptions.additionalCriterias);\n        return criterias;\n    };\n\n    self.getQueryData = function (term, page) {\n        var data = {\n            query: JSON.stringify({\n                criteria: self.getCriterias(term),\n                sort_on: self.options.sort_on,\n                sort_order: self.options.sort_order,\n            }),\n            attributes: JSON.stringify(self.options.attributes),\n        };\n        if (page) {\n            data.batch = JSON.stringify(self.getBatch(page));\n        }\n        return data;\n    };\n\n    self.getUrl = function () {\n        var url = self.options.vocabularyUrl;\n        if (url.indexOf(\"?\") === -1) {\n            url += \"?\";\n        } else {\n            url += \"&\";\n        }\n        return url + $.param(self.getQueryData());\n    };\n\n    self.selectAjax = function () {\n        return {\n            url: self.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: 100,\n            data: function (term, page) {\n                return self.getQueryData(term, page);\n            },\n            results: function (data, page) {\n                var more = page * 10 < data.total; // whether or not there are more results available\n                // notice we return the value of more so Select2 knows if more results can be loaded\n                return {\n                    results: data.results,\n                    more: more,\n                };\n            },\n        };\n    };\n\n    self.search = function (term, operation, value, callback, useBaseCriteria, type) {\n        if (useBaseCriteria === undefined) {\n            useBaseCriteria = true;\n        }\n        if (type === undefined) {\n            type = \"GET\";\n        }\n        var criteria = [];\n        if (useBaseCriteria) {\n            criteria = self.options.baseCriteria.slice(0);\n        }\n        criteria.push({\n            i: term,\n            o: operation,\n            v: value,\n        });\n        var data = {\n            query: JSON.stringify({\n                criteria: criteria,\n            }),\n            attributes: JSON.stringify(self.options.attributes),\n        };\n        $.ajax({\n            url: self.options.vocabularyUrl,\n            dataType: \"JSON\",\n            data: data,\n            type: type,\n            success: callback,\n        });\n    };\n\n    return self;\n};\n\nvar Loading = function (options) {\n    /*\n     * Options:\n     *   backdrop(pattern): if you want to have the progress indicator work\n     *                      seamlessly with backdrop pattern\n     *   zIndex(integer or function): to override default z-index used\n     */\n    var self = this;\n    self.className = \"spinner-border\";\n    var defaults = {\n        backdrop: null,\n        zIndex: 10005, // can be a function\n    };\n    if (!options) {\n        options = {};\n    }\n    self.options = $.extend({}, defaults, options);\n\n    self.init = function () {\n        self.$el = $(\".\" + self.className);\n        if (self.$el.length === 0) {\n            self.$el = $(\"<div><div></div></div>\");\n            self.$el.addClass(self.className).hide().appendTo(\"body\");\n        }\n    };\n\n    self.show = function (closable) {\n        self.init();\n        self.$el.show();\n        self.$el.css(\"position\", \"absolute\");\n        self.$el.css(\"top\", \"50%\");\n        self.$el.css(\"left\", \"50%\");\n        var zIndex = self.options.zIndex;\n        if (typeof zIndex === \"function\") {\n            zIndex = Math.max(zIndex(), 10005);\n        } else {\n            // go through all modals and backdrops and make sure we have a higher\n            // z-index to use\n            zIndex = 10005;\n            $(\".modal-wrapper,.-modal-backdrop\").each(function () {\n                zIndex = Math.max(zIndex, $(this).css(\"zIndex\") || 10005);\n            });\n            zIndex += 1;\n        }\n        self.$el.css(\"zIndex\", zIndex);\n\n        if (closable === undefined) {\n            closable = true;\n        }\n        if (self.options.backdrop) {\n            self.options.backdrop.closeOnClick = closable;\n            self.options.backdrop.closeOnEsc = closable;\n            self.options.backdrop.init();\n            self.options.backdrop.show();\n        }\n    };\n\n    self.hide = function () {\n        self.init();\n        self.$el.hide();\n    };\n\n    return self;\n};\n\nvar getAuthenticator = function () {\n    var $el = $('input[name=\"_authenticator\"]');\n    if ($el.length === 0) {\n        $el = $('a[href*=\"_authenticator\"]');\n        if ($el.length > 0) {\n            return $el.attr(\"href\").split(\"_authenticator=\")[1];\n        }\n        return \"\";\n    } else {\n        return $el.val();\n    }\n};\n\nvar generateId = function (prefix) {\n    if (prefix === undefined) {\n        prefix = \"id\";\n    }\n    return (\n        prefix +\n        Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1)\n    );\n};\n\nvar setId = function ($el, prefix) {\n    if (prefix === undefined) {\n        prefix = \"id\";\n    }\n    var id = $el.attr(\"id\");\n    if (id === undefined) {\n        id = generateId(prefix);\n    } else {\n        /* hopefully we don't screw anything up here... changing the id\n         * in some cases so we get a decent selector */\n        id = id.replace(/\\./g, \"-\");\n    }\n    $el.attr(\"id\", id);\n    return id;\n};\n\nvar getWindow = function () {\n    var win = window;\n    if (win.parent !== window) {\n        win = win.parent;\n    }\n    return win;\n};\n\nvar parseBodyTag = function (txt) {\n    return $(\n        /<body[^>]*>[^]*<\\/body>/im\n            .exec(txt)[0]\n            .replace(\"<body\", \"<div\")\n            .replace(\"</body>\", \"</div>\")\n    )\n        .eq(0)\n        .html();\n};\n\nvar featureSupport = {\n    /* Well tested feature support for things we use in mockup.\n     * All gathered from: http://diveintohtml5.info/everything.html\n     * Alternative to using some form of modernizr.\n     */\n    dragAndDrop: function () {\n        return \"draggable\" in document.createElement(\"span\");\n    },\n    fileApi: function () {\n        return typeof FileReader != \"undefined\";\n    },\n    history: function () {\n        return !!(window.history && window.history.pushState);\n    },\n};\n\nvar bool = function (val) {\n    if (typeof val === \"string\") {\n        val = val.trim(val).toLowerCase();\n    }\n    return [\"false\", false, \"0\", 0, \"\", undefined, null].indexOf(val) === -1;\n};\n\nvar escapeHTML = function (val) {\n    return $(\"<div/>\").text(val).html();\n};\n\nvar removeHTML = function (val) {\n    return val.replace(/<[^>]+>/gi, \"\");\n};\n\nvar storage = {\n    // Simple local storage wrapper, which doesn't break down if it's not available.\n    get: function (name) {\n        if (window.localStorage) {\n            var val = window.localStorage[name];\n            return typeof val === \"string\" ? JSON.parse(val) : undefined;\n        }\n    },\n\n    set: function (name, val) {\n        if (window.localStorage) {\n            window.localStorage[name] = JSON.stringify(val);\n        }\n    },\n};\n\nexport const ICON_CACHE = new Map();\n\n/**\n * Return a <svg> element from a icon name.\n *\n * Example:\n *     const dropdownIcon: await utils.resolveIcon('plone-settings');\n *\n * @param {String} name - The name of the icon as stored in the plone registry.\n * @returns {String} - The SVG markup for the icon.\n */\nconst resolveIcon = async function (name) {\n    // if (name === 'plone.icon.plone-rearrange'){debugger}\n    const icon_lookup_name = `plone.icon.${name}`;\n    const cache_key = icon_lookup_name;\n\n    // ATTENTION: async/await trick ahead!\n    if (!ICON_CACHE.has(cache_key)) {\n        // 1) Immediately set the asynchronous function call to _resolve_icon in the icon cache.\n        // Subsequent calls will not re-set this because the cache_key is already set.\n        ICON_CACHE.set(cache_key, _resolve_icon());\n        logger.debug(`Loading icon \"${icon_lookup_name}\"`);\n    }\n    // 2) Await the promise for resolving the icon or just return the icon itself.\n    return await ICON_CACHE.get(cache_key);\n\n    async function _resolve_icon() {\n        // Do the actual loading.\n\n        let icon = \"\";\n        const base_url = document.body.getAttribute(\"data-portal-url\");\n        if (base_url) {\n            const url = base_url + \"/@@iconresolver\";\n            if (url) {\n                try {\n                    // Fetch timeout\n                    const controller = new AbortController();\n                    // 5 second timeout:\n                    setTimeout(() => controller.abort(), 5000);\n\n                    const resp = await fetch(`${url}/${name}`, {\n                        signal: controller.signal,\n                    });\n                    icon = await resp.text();\n                } catch (e) {\n                    logger.warn(`Loading icon \"${name}\" from URL ${url} failed.`);\n                    console.warn(e);\n                }\n            }\n        }\n        if (!icon) {\n            // fallback\n            name = icon_lookup_name;\n            try {\n                import(\"../styles/icons.scss\");\n                const iconmap = await import(\"../iconmap.json\");\n                const parts = iconmap[name]?.split?.(\"/\");\n                if (parts[0].includes(\"bootstrap-icons\")) {\n                    icon = await import(`bootstrap-icons/icons/${parts[1]}`);\n                    icon = icon?.default;\n                }\n            } catch (e) {\n                // import error\n                logger.warn(`Loading icon \"${icon_lookup_name}\" failed from fallback.`);\n                console.warn(e);\n            }\n        }\n        return icon;\n    }\n};\n\nexport default {\n    bool: bool,\n    escapeHTML: escapeHTML,\n    removeHTML: removeHTML,\n    featureSupport: featureSupport,\n    generateId: generateId,\n    getAuthenticator: getAuthenticator,\n    getWindow: getWindow,\n    Loading: Loading,\n    loading: new Loading(), // provide default loader\n    parseBodyTag: parseBodyTag,\n    QueryHelper: QueryHelper,\n    resolveIcon: resolveIcon,\n    setId: setId,\n    storage: storage,\n};\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"autotoc\",\n    trigger: \".pat-autotoc\",\n    parser: \"mockup\",\n    defaults: {\n        section: \"section\",\n        levels: \"h1,h2,h3\",\n        IDPrefix: \"autotoc-item-\",\n        classTOCName: \"autotoc-nav\",\n        classSectionName: \"autotoc-section\",\n        classLevelPrefixName: \"autotoc-level-\",\n        classActiveName: \"active\",\n        scrollDuration: \"slow\",\n        scrollEasing: \"swing\",\n    },\n    init: function () {\n        import(\"./autotoc.scss\");\n\n        var self = this;\n\n        self.$toc = $(\"<nav/>\").addClass(self.options.classTOCName);\n\n        if (self.options.prependTo) {\n            self.$toc.prependTo(self.options.prependTo);\n        } else if (self.options.appendTo) {\n            self.$toc.appendTo(self.options.appendTo);\n        } else {\n            self.$toc.prependTo(self.$el);\n        }\n\n        if (self.options.className) {\n            self.$el.addClass(self.options.className);\n        }\n\n        $(self.options.section, self.$el).addClass(self.options.classSectionName);\n\n        var asTabs = self.$el.hasClass(\"autotabs\");\n\n        var activeId = null;\n\n        $(self.options.levels, self.$el).each(function (i) {\n            var $level = $(this),\n                id = $level.prop(\"id\")\n                    ? $level.prop(\"id\")\n                    : $level.parents(self.options.section).prop(\"id\");\n            if (!id || $(\"#\" + id).length > 0) {\n                id = self.options.IDPrefix + self.name + \"-\" + i;\n            }\n            if (window.location.hash === \"#\" + id) {\n                activeId = id;\n            }\n            if (activeId === null && $level.hasClass(self.options.classActiveName)) {\n                activeId = id;\n            }\n            $level.data(\"navref\", id);\n            $(\"<a/>\")\n                .appendTo(self.$toc)\n                .text($level.text())\n                .attr(\"id\", id)\n                .attr(\"href\", \"#\" + id)\n                .addClass(self.options.classLevelPrefixName + self.getLevel($level))\n                .on(\"click\", function (e, options) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    if (!options) {\n                        options = {\n                            doScroll: true,\n                            skipHash: false,\n                        };\n                    }\n                    var $el = $(this);\n                    self.$toc\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    self.$el\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    $(e.target).addClass(self.options.classActiveName);\n                    $level\n                        .parents(self.options.section)\n                        .addClass(self.options.classActiveName);\n                    if (\n                        options.doScroll !== false &&\n                        self.options.scrollDuration &&\n                        $level &&\n                        !asTabs\n                    ) {\n                        $(\"body,html\").animate(\n                            {\n                                scrollTop: $level.offset().top,\n                            },\n                            self.options.scrollDuration,\n                            self.options.scrollEasing\n                        );\n                    }\n                    if (self.$el.parents(\".plone-modal\").length !== 0) {\n                        self.$el.trigger(\"resize.plone-modal.patterns\");\n                    }\n                    $(this).trigger(\"clicked\");\n                    if (!options.skipHash) {\n                        if (window.history && window.history.pushState) {\n                            window.history.pushState({}, \"\", \"#\" + $el.attr(\"id\"));\n                        }\n                    }\n                });\n            $level.data(\"autotoc-trigger-id\", id);\n        });\n\n        if (activeId) {\n            $(\"a#\" + activeId).trigger(\"click\", {\n                doScroll: true,\n                skipHash: true,\n            });\n        } else {\n            self.$toc.find(\"a\").first().trigger(\"click\", {\n                doScroll: false,\n                skipHash: true,\n            });\n        }\n    },\n    getLevel: function ($el) {\n        var elementLevel = 0;\n        $.each(this.options.levels.split(\",\"), function (level, levelSelector) {\n            if ($el.filter(levelSelector).length === 1) {\n                elementLevel = level + 1;\n                return false;\n            }\n        });\n        return elementLevel;\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"backdrop\",\n    trigger: \".pat-backdrop\",\n    parser: \"mockup\",\n    defaults: {\n        zIndex: null,\n        opacity: 0.8,\n        className: \"plone-backdrop\",\n        classActiveName: \"plone-backdrop-active\",\n        closeOnEsc: true,\n        closeOnClick: true,\n    },\n    init: function () {\n        var self = this;\n        self.$backdrop = $(\"> .\" + self.options.className, self.$el);\n        if (self.$backdrop.length === 0) {\n            self.$backdrop = $(\"<div/>\")\n                .hide()\n                .appendTo(self.$el)\n                .addClass(self.options.className);\n            if (self.options.zIndex !== null) {\n                self.$backdrop.css(\"z-index\", self.options.zIndex);\n            }\n        }\n        if (self.options.closeOnEsc === true) {\n            // eslint-disable-next-line no-unused-vars\n            $(document).on(\"keydown\", function (e, data) {\n                if (self.$el.is(\".\" + self.options.classActiveName)) {\n                    if (e.keyCode === 27) {\n                        // ESC key pressed\n                        self.hide();\n                    }\n                }\n            });\n        }\n        if (self.options.closeOnClick === true) {\n            self.$backdrop.on(\"click\", function () {\n                if (self.$el.is(\".\" + self.options.classActiveName)) {\n                    self.hide();\n                }\n            });\n        }\n    },\n    show: function () {\n        var self = this;\n        if (!self.$el.hasClass(self.options.classActiveName)) {\n            self.emit(\"show\");\n            self.$backdrop.css(\"opacity\", \"0\").show();\n            self.$el.addClass(self.options.classActiveName);\n            self.$backdrop.animate({ opacity: self.options.opacity }, 500);\n            self.emit(\"shown\");\n        }\n    },\n    hide: function () {\n        var self = this;\n        if (self.$el.hasClass(self.options.classActiveName)) {\n            self.emit(\"hide\");\n            self.$backdrop.animate({ opacity: \"0\" }, 500).hide();\n            self.$el.removeClass(self.options.classActiveName);\n            self.emit(\"hidden\");\n        }\n    },\n});\n","import { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport plone_registry from \"@plone/registry\";\n\n// Contentbrowser pattern\n\nexport const parser = new Parser(\"contentbrowser\");\n\nparser.addArgument(\"vocabulary-url\");\nparser.addArgument(\n    \"attributes\",\n    [\n        \"UID\",\n        \"Title\",\n        \"Description\",\n        \"portal_type\",\n        \"path\",\n        \"getURL\",\n        \"getIcon\",\n        \"is_folderish\",\n        \"review_state\",\n        \"created\",\n        \"modified\",\n    ], null, true\n);\nparser.addArgument(\"width\");\nparser.addArgument(\"mode\");\nparser.addArgument(\"max-depth\");\nparser.addArgument(\"root-path\");\nparser.addArgument(\"root-url\");\nparser.addArgument(\"base-path\");\nparser.addArgument(\"context-path\");\nparser.addArgument(\"maximum-selection-size\");\nparser.addArgument(\"selectable-types\");\nparser.addArgument(\"separator\");\nparser.addArgument(\"selection\");\nparser.addArgument(\"selection-template\");\nparser.addArgument(\"favorites\");\nparser.addArgument(\"recently-used\");\nparser.addArgument(\"recently-used-key\");\nparser.addArgument(\"recently-used-max-items\");\nparser.addArgument(\"b-size\");\n\nclass Pattern extends BasePattern {\n    static name = \"contentbrowser\";\n    static trigger = \".pat-contentbrowser\";\n    static parser = parser;\n\n    async init() {\n        this.el.style.display = \"none\";\n\n        // register default components in @plone/registry\n        const SelectedItem = (await import(\"./src/SelectedItem.svelte\")).default;\n\n        plone_registry.registerComponent({\n            name: \"pat-contentbrowser.SelectedItem\",\n            component: SelectedItem,\n        });\n\n        // ensure an id on our element (TinyMCE doesn't have one)\n        let nodeId = this.el.getAttribute(\"id\");\n        if (!nodeId) {\n            nodeId = utils.generateId();\n            this.el.setAttribute(\"id\", nodeId);\n        }\n\n        const ContentBrowserApp = (await import(\"./src/App.svelte\")).default;\n\n        // create browser node\n        const contentBrowserEl = document.createElement(\"div\");\n        contentBrowserEl.classList.add(\"content-browser-wrapper\");\n        this.el.parentNode.insertBefore(contentBrowserEl, this.el);\n\n        this.component_content_browser = new ContentBrowserApp({\n            target: contentBrowserEl,\n            props: {\n                fieldId: nodeId,\n                ...this.options,\n            }\n        });\n    }\n}\n\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"datatables\",\n    trigger: \".pat-datatables\",\n    parser: \"mockup\",\n    table: null,\n\n    defaults: {\n        // Default values for attributes\n    },\n\n    async init() {\n        import(\"datatables.net-bs5/css/dataTables.bootstrap5.min.css\");\n        import(\"datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css\");\n        import(\"datatables.net-colreorder-bs5/css/colReorder.bootstrap5.min.css\");\n        import(\"datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css\"); // prettier-ignore\n        import(\"datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css\"); // prettier-ignore\n        import(\"datatables.net-rowreorder-bs5/css/rowReorder.bootstrap5.min.css\");\n        import(\"datatables.net-select-bs5/css/select.bootstrap5.min.css\");\n\n        await import(\"datatables.net\");\n        await import(\"datatables.net-bs5\");\n        await import(\"datatables.net-buttons\");\n        await import(\"datatables.net-buttons-bs5\");\n        await import(\"datatables.net-buttons/js/buttons.colVis\");\n        await import(\"datatables.net-buttons/js/buttons.html5\");\n        await import(\"datatables.net-buttons/js/buttons.print\");\n        await import(\"datatables.net-colreorder\");\n        await import(\"datatables.net-colreorder-bs5\");\n        await import(\"datatables.net-fixedcolumns\");\n        await import(\"datatables.net-fixedcolumns-bs5\");\n        await import(\"datatables.net-fixedheader\");\n        await import(\"datatables.net-fixedheader-bs5\");\n        await import(\"datatables.net-rowreorder\");\n        await import(\"datatables.net-rowreorder-bs5\");\n        await import(\"datatables.net-select\");\n        await import(\"datatables.net-select-bs5\");\n\n        $(this.el).DataTable(this.options);\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _ from \"underscore\";\nimport Backdrop from \"../backdrop/backdrop\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\nimport utils from \"../../core/utils\";\nimport _t from \"../../core/i18n-wrapper\";\n\nimport \"jquery-form\";\n\nexport default Base.extend({\n    name: \"plone-modal\",\n    trigger: \".pat-plone-modal\",\n    parser: \"mockup\",\n    createModal: null,\n    $model: null,\n    defaults: {\n        width: \"\",\n        height: \"\",\n        modalSizeClass: \"\",\n        margin: 0,\n        position: \"center middle\", // format: '<horizontal> <vertical>' -- allowed values: top, bottom, left, right, center, middle\n        triggers: [],\n        zIndexSelector: \".modal-wrapper,.modal-backdrop\",\n        backdrop: \"body\", // Element to initiate the Backdrop on.\n        backdropOptions: {\n            zIndex: \"1040\",\n            opacity: \"0.85\",\n            className: \"modal-backdrop\",\n            classActiveName: \"backdrop-active\",\n            closeOnEsc: true,\n            closeOnClick: true,\n        },\n        title: null,\n        titleSelector: \"h1:first\",\n        buttons: '.formControls > input[type=\"submit\"], .formControls > button',\n        content: \"#content\",\n        automaticallyAddButtonActions: true,\n        loadLinksWithinModal: true,\n        prependContent: \".portalMessage\",\n        onRender: null,\n        templateOptions: {\n            className: \"modal fade\",\n            classDialog: \"modal-dialog\",\n            classModal: \"modal-content\",\n            classHeaderName: \"modal-header\",\n            classBodyName: \"modal-body\",\n            classFooterName: \"modal-footer\",\n            classWrapperName: \"modal-wrapper\",\n            classWrapperInnerName: \"modal-wrapper-inner\",\n            classActiveName: \"show\",\n            classPrependName: \"\", // String, css class to be applied to the wrapper of the prepended content\n            classContentName: \"\", // String, class name to be applied to the content of the modal, useful for modal specific styling\n            template:\n                \"\" +\n                '<div class=\"<%= options.className %>\">' +\n                '  <div class=\"<%= options.classDialog %><% if (modalSizeClass) { %> <%= modalSizeClass %><% } %>\" role=\"dialog\" <% if (title) { %>aria-labelledby=\"modal-title\" <% } %> tabindex=\"-1\">' +\n                '    <div class=\"<%= options.classModal %>\" role=\"document\">' +\n                '      <div class=\"<%= options.classHeaderName %>\">' +\n                '        <% if (title) { %><h5 class=\"modal-title\" id=\"modal-title\" tabindex=\"0\"><%= title %></h5><% } %>' +\n                '        <button type=\"button\" class=\"btn-close modal-close\" aria-label=\"<%= closeButtonLabel %>\"></button>' +\n                \"      </div>\" +\n                '      <div class=\"<%= options.classBodyName %>\">' +\n                '        <div class=\"<%= options.classPrependName %>\"><%= prepend %></div> ' +\n                '        <div class=\"<%= options.classContentName %>\"><%= content %></div>' +\n                \"      </div>\" +\n                '      <div class=\"<%= options.classFooterName %>\"> ' +\n                \"        <% if (buttons) { %><%= buttons %><% } %>\" +\n                \"      </div>\" +\n                \"    </div>\" +\n                \"  </div>\" +\n                \"</div>\",\n        },\n        actions: {},\n        actionOptions: {\n            eventType: \"click\",\n            disableAjaxFormSubmit: false,\n            target: null,\n            ajaxUrl: null, // string, or function($el, options) that returns a string\n            modalFunction: null, // String, function name on self to call\n            isForm: false,\n            timeout: 5000,\n            displayInModal: true,\n            reloadWindowOnClose: true,\n            error: \".portalMessage.error, .alert-danger\",\n            formFieldError: \".field.error\",\n            onSuccess: null,\n            onError: null,\n            onFormError: null,\n            onTimeout: null,\n            redirectOnResponse: false,\n            redirectToUrl: function ($action, response) {\n                var reg;\n                reg = /<body.*data-view-url=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // view url as data attribute on body (Plone 5)\n                    return reg[1].split('\"')[0];\n                }\n                reg = /<body.*data-base-url=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // Base url as data attribute on body (Plone 5)\n                    return reg[1].split('\"')[0];\n                }\n                reg = /<base.*href=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // base tag available (Plone 4)\n                    return reg[1];\n                }\n                return \"\";\n            },\n        },\n        form: function (actions) {\n            var self = this;\n            var $modal = self.$modal;\n\n            if (self.options.automaticallyAddButtonActions) {\n                actions[self.options.buttons] = {};\n            }\n            actions.a = {};\n\n            $.each(actions, function (action, options) {\n                var actionKeys = _.union(_.keys(self.options.actionOptions), [\n                    \"templateOptions\",\n                ]);\n                var actionOptions = $.extend(\n                    true,\n                    {},\n                    self.options.actionOptions,\n                    _.pick(options, actionKeys)\n                );\n                options.templateOptions = $.extend(\n                    true,\n                    options.templateOptions,\n                    self.options.templateOptions\n                );\n\n                var patternKeys = _.union(_.keys(self.options.actionOptions), [\n                    \"actions\",\n                    \"actionOptions\",\n                ]);\n                var patternOptions = $.extend(\n                    true,\n                    _.omit(options, patternKeys),\n                    self.options\n                );\n                $(action, $(\".\" + options.templateOptions.classBodyName, $modal)).each(\n                    function () {\n                        var $action = $(this);\n                        $action.on(actionOptions.eventType, function (e) {\n                            e.stopPropagation();\n                            e.preventDefault();\n\n                            self.loading.show(false);\n\n                            // handle event on $action using a function on self\n                            if (actionOptions.modalFunction !== null) {\n                                self[actionOptions.modalFunction]();\n                                // handle event on input/button using jquery.form library\n                            } else if (\n                                $.nodeName($action[0], \"input\") ||\n                                $.nodeName($action[0], \"button\") ||\n                                options.isForm === true\n                            ) {\n                                self.options.handleFormAction.apply(self, [\n                                    $action,\n                                    actionOptions,\n                                    patternOptions,\n                                ]);\n                                // handle event on link with jQuery.ajax\n                            } else if (\n                                options.ajaxUrl !== null ||\n                                $.nodeName($action[0], \"a\")\n                            ) {\n                                self.options.handleLinkAction.apply(self, [\n                                    $action,\n                                    actionOptions,\n                                    patternOptions,\n                                ]);\n                            }\n                        });\n                    }\n                );\n            });\n        },\n        handleFormAction: function ($action, options, patternOptions) {\n            var self = this;\n\n            // pass action that was clicked when submiting form\n            var extraData = {};\n            extraData[$action.attr(\"name\")] = $action.attr(\"value\");\n\n            var $form;\n\n            if ($.nodeName($action[0], \"form\")) {\n                $form = $action;\n            } else {\n                $form = $action.parents(\"form:not(.disableAutoSubmit)\");\n            }\n\n            var url;\n            if (options.ajaxUrl !== null) {\n                if (typeof options.ajaxUrl === \"function\") {\n                    url = options.ajaxUrl.apply(self, [$action, options]);\n                } else {\n                    url = options.ajaxUrl;\n                }\n            } else {\n                url = $action.parents(\"form\").attr(\"action\");\n            }\n\n            if (options.disableAjaxFormSubmit) {\n                if ($action.attr(\"name\") && $action.attr(\"value\")) {\n                    $form.append(\n                        $(\n                            '<input type=\"hidden\" name=\"' +\n                            $action.attr(\"name\") +\n                            '\" value=\"' +\n                            $action.attr(\"value\") +\n                            '\" />'\n                        )\n                    );\n                }\n                $form.trigger(\"submit\");\n                return;\n            }\n            // We want to trigger the form submit event but NOT use the default\n            $form.on(\"submit\", function (e) {\n                e.preventDefault();\n            });\n            $form.trigger(\"submit\");\n\n            self.loading.show(false);\n            $form.ajaxSubmit({\n                timeout: options.timeout,\n                data: extraData,\n                url: url,\n                error: function (xhr, textStatus, errorStatus) {\n                    self.loading.hide();\n                    if (textStatus === \"timeout\" && options.onTimeout) {\n                        options.onTimeout.apply(self, xhr, errorStatus);\n                        // on \"error\", \"abort\", and \"parsererror\"\n                    } else if (options.onError) {\n                        if (typeof options.onError === \"string\") {\n                            window[options.onError](xhr, textStatus, errorStatus);\n                        } else {\n                            options.onError(xhr, textStatus, errorStatus);\n                        }\n                    } else {\n                        // window.alert(_t('There was an error submitting the form.'));\n                        console.log(\"error happened\", textStatus, \" do something\");\n                    }\n                    self.emit(\"formActionError\", [xhr, textStatus, errorStatus]);\n                },\n                success: function (response, state, xhr, form) {\n                    self.loading.hide();\n                    // if error is found (NOTE: check for both the portal errors\n                    // and the form field-level errors)\n                    if (\n                        $(options.error, response).length !== 0 ||\n                        $(options.formFieldError, response).length !== 0\n                    ) {\n                        if (options.onFormError) {\n                            if (typeof options.onFormError === \"string\") {\n                                window[options.onFormError](\n                                    self,\n                                    response,\n                                    state,\n                                    xhr,\n                                    form\n                                );\n                            } else {\n                                options.onFormError(self, response, state, xhr, form);\n                            }\n                        } else {\n                            self.redraw(response, patternOptions);\n                        }\n                        return;\n                    }\n\n                    if (options.redirectOnResponse === true) {\n                        if (typeof options.redirectToUrl === \"function\") {\n                            window.parent.location.href = options.redirectToUrl.apply(\n                                self,\n                                [$action, response, options]\n                            );\n                        } else {\n                            window.parent.location.href = options.redirectToUrl;\n                        }\n                        return; // cut out right here since we're changing url\n                    }\n\n                    if (options.onSuccess) {\n                        if (typeof options.onSuccess === \"string\") {\n                            window[options.onSuccess](self, response, state, xhr, form);\n                        } else {\n                            options.onSuccess(self, response, state, xhr, form);\n                        }\n                    }\n\n                    if (options.displayInModal === true) {\n                        self.redraw(response, patternOptions);\n                    } else {\n                        $action.trigger(\"destroy.plone-modal.patterns\");\n                        // also calls hide\n                        if (options.reloadWindowOnClose) {\n                            self.reloadWindow();\n                        }\n                    }\n                    self.emit(\"formActionSuccess\", [response, state, xhr, form]);\n                },\n            });\n        },\n        handleLinkAction: function ($action, options, patternOptions) {\n            var self = this;\n            var url;\n            if ($action.hasClass(\"pat-plone-modal\")) {\n                // if link is a modal pattern, do not reload the page\n                return;\n            }\n\n            // Figure out URL\n            if (options.ajaxUrl) {\n                if (typeof options.ajaxUrl === \"function\") {\n                    url = options.ajaxUrl.apply(self, [$action, options]);\n                } else {\n                    url = options.ajaxUrl;\n                }\n            } else {\n                url = $action.attr(\"href\");\n            }\n\n            // Non-ajax link (I know it says \"ajaxUrl\" ...)\n            if (options.displayInModal === false) {\n                if ($action.attr(\"target\") === \"_blank\") {\n                    window.open(url, \"_blank\");\n                    self.loading.hide();\n                } else {\n                    window.location = url;\n                }\n                return;\n            }\n\n            // ajax version\n            $.ajax({\n                url: url,\n            })\n                .fail(function (xhr, textStatus, errorStatus) {\n                    if (textStatus === \"timeout\" && options.onTimeout) {\n                        options.onTimeout(self.$modal, xhr, errorStatus);\n\n                        // on \"error\", \"abort\", and \"parsererror\"\n                    } else if (options.onError) {\n                        options.onError(xhr, textStatus, errorStatus);\n                    } else {\n                        window.alert(_t(\"There was an error loading modal.\"));\n                    }\n                    self.emit(\"linkActionError\", [xhr, textStatus, errorStatus]);\n                })\n                .done(function (response, state, xhr) {\n                    self.redraw(response, patternOptions);\n                    if (options.onSuccess) {\n                        if (typeof options.onSuccess === \"string\") {\n                            window[options.onSuccess](self, response, state, xhr);\n                        } else {\n                            options.onSuccess(self, response, state, xhr);\n                        }\n                    }\n\n                    self.emit(\"linkActionSuccess\", [response, state, xhr]);\n                })\n                .always(function () {\n                    self.loading.hide();\n                });\n        },\n        render: function (options) {\n            var self = this;\n\n            self.emit(\"before-render\");\n\n            if (!self.$raw) {\n                return;\n            }\n            var $raw = self.$raw.clone();\n\n            // Object that will be passed to the template\n            var tplObject = {\n                title: \"\",\n                prepend: \"<div />\",\n                content: \"\",\n                modalSizeClass: options.modalSizeClass,\n                buttons: '<div class=\"pattern-modal-buttons\"></div>',\n                options: options.templateOptions,\n                closeButtonLabel: _t(\"Close\"),\n            };\n\n            // setup the Title\n            if (options.title === null) {\n                var $title = $(options.titleSelector, $raw);\n                tplObject.title = $title.html();\n                $(options.titleSelector, $raw).remove();\n            } else {\n                tplObject.title = options.title;\n            }\n\n            // Grab items to to insert into the prepend area\n            if (options.prependContent) {\n                tplObject.prepend = $(\"<div />\")\n                    .append($(options.prependContent, $raw).clone())\n                    .html();\n                $(options.prependContent, $raw).remove();\n            }\n\n            // Filter out the content if there is a selector provided\n            if (options.content) {\n                tplObject.content = $(options.content, $raw).html();\n            } else {\n                tplObject.content = $raw.html();\n            }\n\n            // Render html\n            self.$modal = $(\n                _.template(self.options.templateOptions.template)(tplObject)\n            );\n            self.$modalDialog = $(\n                \"> .\" + self.options.templateOptions.classDialog,\n                self.$modal\n            );\n            self.$modalContent = $(\n                \"> .\" + self.options.templateOptions.classModal,\n                self.$modalDialog\n            );\n\n            // In most browsers, when you hit the enter key while a form element is focused\n            // the browser will trigger the form 'submit' event.  Google Chrome also does this,\n            // but not when when the default submit button is hidden with 'display: none'.\n            // The following code will work around this issue:\n            $(\"form\", self.$modal).on(\"keydown\", function (event) {\n                // ignore keys which are not enter, and ignore enter inside a textarea.\n                if (event.key !== \"Enter\" || event.target.nodeName === \"TEXTAREA\") {\n                    return;\n                }\n                event.preventDefault();\n                $(\"input[type=submit], button[type=submit], button:not(type)\", this)\n                    .eq(0)\n                    .trigger(\"click\");\n            });\n\n            // Setup buttons\n            $(options.buttons, self.$modal).each(function () {\n                var $button = $(this);\n                $button\n                    .on(\"click\", function (e) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                    })\n                    .clone()\n                    .appendTo($(\".pattern-modal-buttons\", self.$modal))\n                    .off(\"click\")\n                    .on(\"click\", function (e) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                        $button.trigger(\"click\");\n                    });\n                $button.hide();\n            });\n\n            self.emit(\"before-events-setup\");\n\n            // Wire up events\n            self.$modal[0]\n                .querySelectorAll(\n                    `.modal-header > .modal-close,\n                 .modal-footer > .pattern-modal-buttons > .modal-close,\n                 .modal-footer [name=\"form.buttons.Cancel\" i]`\n                )\n                .forEach((el) => {\n                    $(el)\n                        .off(\"click\")\n                        .on(\"click\", (e) => {\n                            e.stopPropagation();\n                            e.preventDefault();\n                            $(e.target).trigger(\"destroy.plone-modal.patterns\");\n                        });\n                });\n\n            // form\n            if (options.form) {\n                options.form.apply(self, [options.actions]);\n            }\n\n            self.$modal\n                .addClass(self.options.templateOptions.className)\n                .on(\"destroy.plone-modal.patterns\", function (e) {\n                    e.stopPropagation();\n                    self.hide();\n                })\n                .on(\"resize.plone-modal.patterns\", function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    self.positionModal();\n                })\n                .appendTo(self.$wrapperInner);\n\n            if (self.options.loadLinksWithinModal) {\n                self.$modal.on(\"click\", function (e) {\n                    e.stopPropagation();\n                    if ($.nodeName(e.target, \"a\")) {\n                        e.preventDefault();\n                        // TODO: open links inside modal\n                        // and slide modal body\n                    }\n                    self.$modal.trigger(\"modal-click\");\n                });\n            }\n            self.$modal.data(\"pattern-\" + self.name, self);\n            self.emit(\"after-render\");\n            if (options.onRender) {\n                if (typeof options.onRender === \"string\") {\n                    window[options.onRender](self);\n                } else {\n                    options.onRender(self);\n                }\n            }\n        },\n    },\n    reloadWindow: function () {\n        window.parent.location.reload();\n    },\n    init: function () {\n        import(\"./modal.scss\");\n\n        var self = this;\n        self.options.loadLinksWithinModal = $.parseJSON(\n            self.options.loadLinksWithinModal\n        );\n\n        if (self.options.backdropOptions.closeOnEsc === true) {\n            $(document).on(\"keydown\", function (e) {\n                if (self.$el.is(\".\" + self.options.templateOptions.classActiveName)) {\n                    if (e.key === \"Esc\") {\n                        // ESC key pressed\n                        self.hide();\n                    }\n                }\n            });\n        }\n\n        $(window.parent).resize(function () {\n            self.positionModal();\n        });\n\n        if (self.options.triggers) {\n            $.each(self.options.triggers, function (i, item) {\n                var e = item.substring(0, item.indexOf(\" \"));\n                var selector = item.substring(item.indexOf(\" \"), item.length);\n                $(selector || self.$el).on(e, function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    self.show();\n                });\n            });\n        }\n\n        if (self.$el.is(\"a\")) {\n            if (self.$el.attr(\"href\") && !self.options.image) {\n                if (\n                    !self.options.target &&\n                    self.$el.attr(\"href\").substr(0, 1) === \"#\" &&\n                    self.$el.attr(\"href\").length > 1\n                ) {\n                    self.options.target = self.$el.attr(\"href\");\n                    self.options.content = \"\";\n                }\n                if (\n                    !self.options.ajaxUrl &&\n                    self.$el.attr(\"href\").substr(0, 1) !== \"#\"\n                ) {\n                    self.options.ajaxUrl = function () {\n                        // Resolve ``href`` attribute later, when modal is shown.\n                        return self.$el.attr(\"href\");\n                    };\n                }\n            }\n            self.$el.on(\"click\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                self.show();\n            });\n        }\n        self.initModal();\n    },\n\n    createAjaxModal: function () {\n        var self = this;\n        self.emit(\"before-ajax\");\n        self.loading.show();\n\n        var ajaxUrl = self.options.ajaxUrl;\n        if (typeof ajaxUrl === \"function\") {\n            ajaxUrl = ajaxUrl.apply(self, [self.options]);\n        }\n\n        self.ajaxXHR = $.ajax({\n            url: ajaxUrl,\n            type: self.options.ajaxType,\n        })\n            .done(function (response, textStatus, xhr) {\n                self.ajaxXHR = undefined;\n                self.$raw = $(\"<div />\").append($(utils.parseBodyTag(response)));\n                self.emit(\"after-ajax\", self, textStatus, xhr);\n                self._show();\n            })\n            .fail(function (xhr, textStatus, errorStatus) {\n                var options = self.options.actionOptions;\n                if (textStatus === \"timeout\" && options.onTimeout) {\n                    options.onTimeout(self.$modal, xhr, errorStatus);\n                } else if (options.onError) {\n                    options.onError(xhr, textStatus, errorStatus);\n                } else {\n                    window.alert(_t(\"There was an error loading modal.\"));\n                    self.hide();\n                }\n                self.emit(\"linkActionError\", [xhr, textStatus, errorStatus]);\n            })\n            .always(function () {\n                self.loading.hide();\n            });\n    },\n\n    createTargetModal: function () {\n        var self = this;\n        self.$raw = $(self.options.target).clone();\n        self._show();\n    },\n\n    createBasicModal: function () {\n        var self = this;\n        self.$raw = $(\"<div/>\").html(self.$el.clone());\n        self._show();\n    },\n\n    createHtmlModal: function () {\n        var self = this;\n        var $el = $(self.options.html);\n        self.$raw = $el;\n        self._show();\n    },\n\n    createImageModal: function () {\n        var self = this;\n        self.$wrapper.addClass(\"image-modal\");\n        var src = self.$el.attr(\"href\");\n        var srcset = self.$el.attr(\"data-modal-srcset\") || \"\";\n        var title = $.trim(self.$el.context.innerText) || \"Image\";\n        // XXX aria?\n        self.$raw = $(\n            \"<div><h1>\" +\n            title +\n            '</h1><div id=\"content\"><div class=\"modal-image\"><img src=\"' +\n            src +\n            '\" srcset=\"' +\n            srcset +\n            '\" /></div></div></div>'\n        );\n        self._show();\n    },\n\n    initModal: function () {\n        var self = this;\n        if (self.options.ajaxUrl) {\n            self.createModal = self.createAjaxModal;\n        } else if (self.options.target) {\n            self.createModal = self.createTargetModal;\n        } else if (self.options.html) {\n            self.createModal = self.createHtmlModal;\n        } else if (self.options.image) {\n            self.createModal = self.createImageModal;\n        } else {\n            self.createModal = self.createBasicModal;\n        }\n    },\n\n    findPosition: function (\n        horpos,\n        vertpos,\n        margin,\n        modalWidth,\n        modalHeight,\n        wrapperInnerWidth,\n        wrapperInnerHeight\n    ) {\n        var returnpos = {};\n        var absTop, absBottom, absLeft, absRight;\n        absRight = absLeft = absTop = absLeft = \"auto\";\n\n        // -- HORIZONTAL POSITION -----------------------------------------------\n        if (horpos === \"left\") {\n            absLeft = margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the left to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absLeft = \"0px\";\n            }\n            returnpos.left = absLeft;\n        } else if (horpos === \"right\") {\n            absRight = margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the right to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absRight = \"0px\";\n            }\n            returnpos.right = absRight;\n            returnpos.left = \"auto\";\n        }\n        // default, no specified location, is to center\n        else {\n            absLeft = wrapperInnerWidth / 2 - modalWidth / 2 - margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the left to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absLeft = \"0px\";\n            }\n            returnpos.left = absLeft;\n        }\n\n        // -- VERTICAL POSITION -------------------------------------------------\n        if (vertpos === \"top\") {\n            absTop = margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the top to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absTop = \"0px\";\n            }\n            returnpos.top = absTop;\n        } else if (vertpos === \"bottom\") {\n            absBottom = margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the bottom to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absBottom = \"0px\";\n            }\n            returnpos.bottom = absBottom;\n            returnpos.top = \"auto\";\n        } else {\n            // default case, no specified location, is to center\n            absTop = wrapperInnerHeight / 2 - modalHeight / 2 - margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the top to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absTop = \"0px\";\n            }\n            returnpos.top = absTop;\n        }\n        return returnpos;\n    },\n\n    modalInitialized: function () {\n        var self = this;\n        return self.$modal !== null && self.$modal !== undefined;\n    },\n\n    activateFocusTrap: function () {\n        var self = this;\n        const modal_el = self.$modal[0];\n        var inputsBody = modal_el\n            .querySelector(`.${self.options.templateOptions.classBodyName}`)\n            .querySelectorAll(`select, input:not([type=\"hidden\"]), textarea, button, a`);\n        var inputsFooter = modal_el\n            .querySelector(`.${self.options.templateOptions.classFooterName}`)\n            .querySelectorAll(`select, input:not([type=\"hidden\"]), textarea, button, a`);\n        var inputs = [];\n\n        for (const el of [...inputsBody, ...inputsFooter]) {\n            if (dom.is_visible(el)) {\n                inputs.push(el);\n            }\n        }\n\n        if (inputs.length === 0) {\n            inputs = modal_el.querySelectorAll(\".modal-title\");\n        }\n        var firstInput = inputs.length !== 0 ? inputs[0] : null;\n        var lastInput = inputs.length !== 0 ? inputs[inputs.length - 1] : null;\n        var closeInput = modal_el.querySelector(\".modal-close\");\n\n        modal_el.addEventListener(\n            \"keydown\",\n            (e) => {\n                if (e.key === \"Tab\") {\n                    e.preventDefault();\n\n                    var target = e.target;\n                    var currentIndex = inputs.indexOf(target);\n                    if (currentIndex >= 0 && currentIndex < inputs.length) {\n                        var nextIndex = currentIndex + (e.shiftKey ? -1 : 1);\n                        if (nextIndex < 0 || nextIndex >= inputs.length) {\n                            closeInput.focus();\n                        } else {\n                            inputs[nextIndex].focus();\n                        }\n                    } else if (e.shiftKey && lastInput) {\n                        lastInput.focus();\n                    } else if (firstInput) {\n                        firstInput.focus();\n                    }\n                }\n            }\n        );\n        if (self.options.backdropOptions.closeOnClick === true) {\n            modal_el.addEventListener(\"click\", (e) => {\n                if (!e.target.closest(`.${self.options.templateOptions.classModal}`)) {\n                    self.hide();\n                }\n            });\n        }\n\n        if (firstInput && [\"INPUT\", \"SELECT\", \"TEXTAREA\"].includes(firstInput.nodeName)) {\n            // autofocus first element when opening a modal with a form\n            firstInput.focus();\n        }\n    },\n\n    positionModal: function () {\n        /* re-position modal at any point.\n         *\n         * Uses:\n         *  options.margin\n         *  options.width\n         *  options.height\n         *  options.position\n         */\n        var self = this;\n        // modal isn't initialized\n        if (!self.modalInitialized()) {\n            return;\n        }\n        // clear out any previously set styling\n        self.$modal.removeAttr(\"style\");\n\n        // if backdrop wrapper is set on body, then wrapper should have height of\n        // the window, so we can do scrolling of inner wrapper\n        if (self.$wrapper.parent().is(\"body\")) {\n            self.$wrapper.height($(window.parent).height());\n        }\n\n        var margin =\n            typeof self.options.margin === \"function\"\n                ? self.options.margin()\n                : self.options.margin;\n        let modalCss = {\n            position: \"absolute\",\n        };\n        if (margin !== \"0\") {\n            modalCss[\"padding\"] = margin;\n        }\n        self.$modal.css(modalCss);\n        self.$modalDialog.css({\n            // margin: \"0\",\n            // padding: \"0\",\n            width: self.options.width, // defaults to \"\", which doesn't override other css\n            height: self.options.height, // defaults to \"\", which doesn't override other css\n        });\n        self.$modalContent.css({\n            width: self.options.width, // defaults to \"\", which doesn't override other css\n        });\n\n        var posopt = self.options.position.split(\" \"),\n            horpos = posopt[0],\n            vertpos = posopt[1];\n        var modalWidth = self.$modalDialog.outerWidth(true);\n        var modalHeight = self.$modalDialog.outerHeight(true);\n        var wrapperInnerWidth = self.$wrapperInner.width();\n        var wrapperInnerHeight = self.$wrapperInner.height();\n        var pos = self.findPosition(\n            horpos,\n            vertpos,\n            margin,\n            modalWidth,\n            modalHeight,\n            wrapperInnerWidth,\n            wrapperInnerHeight\n        );\n        for (var key in pos) {\n            self.$modalDialog.css(key, pos[key]);\n        }\n    },\n\n    render: function (options) {\n        var self = this;\n        self.emit(\"render\");\n        self.options.render.apply(self, [options]);\n        self.emit(\"rendered\");\n    },\n\n    show: function () {\n        var self = this;\n        self.backdrop = self.createBackdrop();\n        self.createModal();\n    },\n\n    createBackdrop: function () {\n        var self = this,\n            backdrop = new Backdrop(\n                self.$el.parents(self.options.backdrop),\n                self.options.backdropOptions\n            ),\n            zIndex = self.options.backdropOptions.zIndex || 1041;\n\n        $(self.options.zIndexSelector).each(function () {\n            zIndex = Math.max(zIndex, parseInt($(this).css(\"zIndex\")) + 1 || 1041);\n        });\n\n        self.$wrapper = $(\"<div/>\")\n            .hide()\n            .css({\n                \"z-index\": zIndex,\n                \"overflow-y\": \"auto\",\n                \"position\": \"fixed\",\n                \"height\": \"100%\",\n                \"width\": \"100%\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"right\": \"0\",\n                \"top\": \"0\",\n            })\n            .addClass(self.options.templateOptions.classWrapperName)\n            .insertBefore(backdrop.$backdrop)\n            .on(\"click\", function (e) {\n                if (self.options.backdropOptions.closeOnClick) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    backdrop.hide();\n                }\n            });\n        backdrop.on(\"hidden\", function () {\n            if (\n                self.$modal !== undefined &&\n                self.$modal.hasClass(self.options.templateOptions.classActiveName)\n            ) {\n                self.hide();\n            }\n        });\n        self.loading = new utils.Loading({\n            backdrop: backdrop,\n        });\n        self.$wrapperInner = $(\"<div/>\")\n            .addClass(self.options.classWrapperInnerName)\n            .css({\n                position: \"absolute\",\n                bottom: \"0\",\n                left: \"0\",\n                right: \"0\",\n                top: \"0\",\n            })\n            .appendTo(self.$wrapper);\n        return backdrop;\n    },\n\n    _show: function () {\n        var self = this;\n        self.render.apply(self, [self.options]);\n        self.emit(\"show\");\n        self.backdrop.show();\n        self.$wrapper.show();\n        self.loading.hide();\n        self.$el.addClass(self.options.templateOptions.classActiveName);\n        self.$modal.addClass(self.options.templateOptions.classActiveName);\n        registry.scan(self.$modal);\n        self.positionModal();\n        $(window.parent).on(\"resize.plone-modal.patterns\", function () {\n            self.positionModal();\n        });\n        $(\"body\").addClass(\"modal-open\");\n        self.emit(\"shown\");\n        self.activateFocusTrap();\n    },\n    hide: function () {\n        var self = this;\n        if (self.ajaxXHR) {\n            self.ajaxXHR.abort();\n        }\n        self.emit(\"hide\");\n        if (self._suppressHide) {\n            if (!window.confirm(self._suppressHide)) {\n                return;\n            }\n        }\n        self.loading.hide();\n        self.$el.removeClass(self.options.templateOptions.classActiveName);\n        if (self.$modal !== undefined) {\n            self.$modal.remove();\n            self.initModal();\n        }\n        self.$wrapper.remove();\n        if ($(\".modal\", $(\"body\")).length < 1) {\n            self._suppressHide = undefined;\n            self.backdrop.hide();\n            $(\"body\").removeClass(\"modal-open\");\n            $(window.parent).off(\"resize.plone-modal.patterns\");\n        }\n        self.emit(\"hidden\");\n        self.$el.focus();\n    },\n\n    redraw: function (response, options) {\n        var self = this;\n        self.emit(\"beforeDraw\");\n        self.$modal.remove();\n        self.$raw = $(\"<div />\").append($(utils.parseBodyTag(response)));\n        self.render.apply(self, [options || self.options]);\n        self.$modal.addClass(self.options.templateOptions.classActiveName);\n        self.positionModal();\n        registry.scan(self.$modal);\n        self.emit(\"afterDraw\");\n        self.activateFocusTrap();\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport { Pattern as ContentbrowserPattern } from \"../contentbrowser/contentbrowser\";\n\nvar Criteria = function () {\n    this.init.apply(this, arguments);\n};\nCriteria.prototype = {\n    defaults: {\n        indexWidth: \"20em\",\n        remove: \"\",\n        classBetweenDtName: \"querystring-criteria-betweendt\",\n        classWrapperName: \"querystring-criteria-wrapper\",\n        classIndexName: \"querystring-criteria-index\",\n        classOperatorName: \"querystring-criteria-operator\",\n        classValueName: \"querystring-criteria-value\",\n        classRemoveName: \"querystring-criteria-remove\",\n        classResultsName: \"querystring-criteria-results\",\n        classClearName: \"querystring-criteria-clear\",\n        classDepthName: \"querystring-criteria-depth\",\n    },\n    init: function (\n        $el,\n        app,\n        options,\n        indexes,\n        index,\n        operator,\n        value,\n        baseUrl,\n        patternDateOptions,\n        patternAjaxSelectOptions,\n        patternRelateditemsOptions\n    ) {\n        var self = this;\n        self.app = app;\n\n        self.options = {\n            ...self.defaults,\n            ...options,\n        };\n        self.indexes = indexes;\n        self.indexGroups = {};\n        self.baseUrl = baseUrl;\n        self.advanced = false;\n        self.initial = value;\n        // create wrapper criteria and append it to DOM\n        self.$wrapper = $(\"<div/>\")\n            .addClass(self.options.classWrapperName)\n            .appendTo($el);\n\n        // Sub widgets options\n        self.patternDateOptions = patternDateOptions || {};\n        self.patternAjaxSelectOptions = patternAjaxSelectOptions || {};\n        self.patternRelateditemsOptions = patternRelateditemsOptions || {};\n        // Defaults\n        self.patternAjaxSelectOptions = {\n            width: \"250px\",\n            ...self.patternAjaxSelectOptions,\n        };\n        self.patternRelateditemsOptions = {\n            vocabularyUrl:\n                self.baseUrl +\n                \"@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems\",\n            width: \"20rem\",\n            ...self.patternRelateditemsOptions,\n        };\n        // Force set\n        self.patternRelateditemsOptions[\"maximumSelectionSize\"] = 1;\n\n        // Remove button\n        self.$remove = $(\"<div>\" + self.options.remove + \"</div>\")\n            .addClass(self.options.classRemoveName)\n            .appendTo(self.$wrapper)\n            .on(\"click\", function (e) {\n                e.stopPropagation();\n                self.remove();\n            });\n\n        // Index selection\n        self.$index = $(\"<select><option></option></select>\").attr(\n            \"placeholder\",\n            _t(\"Select criteria\")\n        );\n\n        // list of indexes\n        for (const value in self.indexes) {\n            let options = self.indexes[value];\n            if (options.enabled) {\n                if (!self.indexGroups[options.group]) {\n                    self.indexGroups[options.group] = $(\"<optgroup/>\")\n                        .attr(\"label\", options.group)\n                        .appendTo(self.$index);\n                }\n                self.indexGroups[options.group].append(\n                    $(\"<option/>\").attr(\"value\", value).html(options.title)\n                );\n            }\n        }\n\n        // attach index select to DOM\n        self.$wrapper.append(\n            $(\"<div/>\").addClass(self.options.classIndexName).append(self.$index)\n        );\n\n        // add blink (select2)\n        self.$index.patternSelect2({\n            width: self.options.indexWidth,\n            placeholder: _t(\"Select criteria\"),\n        });\n        self.$index.on(\"change\", function (e) {\n            self.removeValue();\n            self.createOperator(e.val);\n            self.createClear();\n            self.trigger(\"index-changed\");\n        });\n\n        if (typeof index !== \"undefined\") {\n            self.$index.val(index);\n            self.createOperator(index, operator, value);\n            self.createClear();\n        }\n\n        self.trigger(\"create-criteria\");\n    },\n    appendOperators: function (index) {\n        var self = this;\n\n        self.$operator = $(\"<select/>\");\n\n        if (self.indexes[index]) {\n            _.each(self.indexes[index].operations, function (value) {\n                var options = self.indexes[index].operators[value];\n                $(\"<option/>\")\n                    .attr(\"value\", value)\n                    .html(options.title)\n                    .appendTo(self.$operator);\n            });\n        }\n\n        // attach operators select to DOM\n        self.$wrapper.append(\n            $(\"<div/>\").addClass(self.options.classOperatorName).append(self.$operator)\n        );\n\n        // add blink (select2)\n        self.$operator.patternSelect2({ width: \"10em\" });\n        self.$operator.on(\"change\", function () {\n            self.createValue(index);\n            self.createClear();\n            self.trigger(\"operator-changed\");\n        });\n    },\n    convertPathOperators: function (oval) {\n        var self = this;\n\n        if (self.advanced) {\n            return oval;\n        }\n        //This allows us to use the same query operation for multiple dropdown options.\n        oval = oval.replace(\"advanced\", \"relativePath\").replace(\"path\", \"relativePath\");\n        return oval;\n    },\n    createPathOperators: function () {\n        var self = this;\n\n        if (self.advanced) {\n            self.resetPathOperators();\n            return;\n        }\n        var newOperator = \"plone.app.querystring.operation.string.advanced\";\n\n        if (typeof self.indexes.path.operators[newOperator] === \"undefined\") {\n            self.indexes.path.operations.push(newOperator);\n            self.indexes.path.operators[newOperator] = {\n                title: \"Advanced\",\n                widget: \"AdvancedPathWidget\",\n                description: \"Enter a custom path string\",\n                operation: \"plone.app.querystring.queryparser._relativePath\",\n            };\n        }\n\n        for (const key in self.indexes.path.operators) {\n            var options = self.indexes.path.operators[key];\n            if (key.indexOf(\"absolute\") > 0) {\n                options.title = \"Custom\";\n            } else if (key.indexOf(\"relative\") > 0) {\n                options.title = \"Parent (../)\";\n            } else if (key.indexOf(\"advanced\") > 0) {\n                options.title = \"Advanced Mode\";\n            } else {\n                options.title = \"Current (./)\";\n                options.widget = \"RelativePathWidget\";\n            }\n        };\n    },\n    resetPathOperators: function () {\n        var self = this;\n        for (const key in self.indexes.path.operators) {\n            var options = self.indexes.path.operators[key];\n            if (key.indexOf(\"absolute\") > 0) {\n                options.title = \"Absolute Path\";\n            } else if (key.indexOf(\"relative\") > 0) {\n                options.title = \"Relative Path\";\n            } else if (key.indexOf(\"advanced\") > 0) {\n                options.title = \"Simple Mode\";\n            } else {\n                options.title = \"Navigation Path\";\n                options.widget = \"ReferenceWidget\";\n            }\n        };\n\n        return;\n    },\n    createOperator: function (index, operator, value) {\n        var self = this;\n\n        self.removeOperator();\n        self.createPathOperators();\n\n        // We must test if we have a \"simple\" path or an \"advanced\" one and change the widgets accordingly\n        if (\n            index === \"path\" &&\n            value &&\n            value !== \".::1\" &&\n            value !== \"..::1\" &&\n            !value.match(/^[0-9a-f\\-]{32,36}::-?[0-9]+$/)\n        ) {\n            self.advanced = true;\n            self.resetPathOperators();\n        }\n\n        self.appendOperators(index);\n\n        if (typeof operator === \"undefined\") {\n            operator = self.$operator.val();\n        }\n\n        self.$operator.val(operator);\n        self.createValue(index, value);\n\n        self.trigger(\"create-operator\");\n    },\n    createValue: function (index, value) {\n        var self = this,\n            widget = self.indexes[index].operators[self.$operator.val()].widget,\n            $wrapper = $(\"<div/>\")\n                .addClass(self.options.classValueName)\n                .appendTo(self.$wrapper);\n\n        self.removeValue();\n\n        var createDepthSelect = function (selected) {\n            // remove previous depth-select-box items\n            $wrapper.remove(\".depth-select-box\");\n            var select =\n                \"<div class='depth-select-box'>\" +\n                \"<label for='depth-select'>Depth</label>\" +\n                \"<select name='depth-select' class='\" +\n                self.options.classDepthName +\n                \"'>\" +\n                \"<option value='-1' selected='selected'>Unlimited</option>\";\n\n            for (var i = 0; i <= 10; i += 1) {\n                select += \"<option value=\" + i + \" \";\n                if (\"\" + i === selected) {\n                    select += \"selected='selected' \";\n                }\n                select += \">\" + i + \"</option>\";\n            }\n            select += \"</select>\" + \"</div>\";\n\n            return $(select).on(\"change\", function () {\n                self.trigger(\"depth-changed\");\n            });\n        };\n\n        if (widget === \"StringWidget\") {\n            self.$value = $('<input type=\"text\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"DateWidget\") {\n            self.$value = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"DateRangeWidget\") {\n            var startwrap = $(\"<span/>\").appendTo($wrapper);\n            var val1 = \"\";\n            var val2 = \"\";\n\n            if (value) {\n                val1 = value[0] ? value[0] : \"\";\n                val2 = value[1] ? value[1] : \"\";\n            }\n\n            var startdt = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .addClass(self.options.classValueName + \"-\" + widget + \"-start\")\n                .val(val1)\n                .appendTo(startwrap)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            $wrapper.append(\n                $(\"<span/>\").html(_t(\"to\")).addClass(self.options.classBetweenDtName)\n            );\n            var endwrap = $(\"<span/>\").appendTo($wrapper);\n            var enddt = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .addClass(self.options.classValueName + \"-\" + widget + \"-end\")\n                .val(val2)\n                .appendTo(endwrap)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            self.$value = [startdt, enddt];\n        } else if (widget === \"RelativeDateWidget\") {\n            self.$value = $('<input type=\"text\"/>')\n                .after($(\"<span/>\").html(_t(\"days\")))\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"AdvancedPathWidget\") {\n            if (self.advanced) {\n                self.advanced = false;\n            } else {\n                self.advanced = true;\n            }\n            self.createPathOperators();\n            self.removeOperator();\n            self.appendOperators(index);\n            self.createValue(index);\n        } else if (widget === \"RelativePathWidget\") {\n            if (self.advanced) {\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(value)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n            } else {\n                var pathAndDepth = [\".\", \"1\"];\n                if (typeof value !== \"undefined\" && value.indexOf(\"::\") != -1) {\n                    pathAndDepth = value.split(\"::\");\n                    if (pathAndDepth[0] === \".\") {\n                        self.$operator.val(\n                            \"plone.app.querystring.operation.string.path\"\n                        );\n                    } else {\n                        self.$operator.val(\n                            \"plone.app.querystring.operation.string.relativePath\"\n                        );\n                    }\n                } else if (\n                    self.$operator.val() ===\n                    \"plone.app.querystring.operation.string.relativePath\"\n                ) {\n                    pathAndDepth = [\"..\", \"1\"];\n                }\n\n                self.$value = $('<input type=\"hidden\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(pathAndDepth[0]);\n                self.$value.after(createDepthSelect(pathAndDepth[1]));\n            }\n        } else if (widget === \"ReferenceWidget\") {\n            if (self.advanced) {\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .val(value)\n                    .appendTo($wrapper)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n            } else {\n                pathAndDepth = [\"\", \"-1\"];\n                if (typeof value !== \"undefined\") {\n                    pathAndDepth = value.split(\"::\");\n                }\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(pathAndDepth[0])\n                const pat = new ContentbrowserPattern(self.$value[0], self.patternRelateditemsOptions);\n                pat.el.addEventListener(\"change\", () => {\n                    self.trigger(\"value-changed\");\n                })\n                self.$value.after(createDepthSelect(pathAndDepth[1]));\n            }\n        } else if (widget === \"MultipleSelectionWidget\") {\n            self.$value = $(\"<select/>\")\n                .prop(\"multiple\", true)\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            if (self.indexes[index]) {\n                for (const value in self.indexes[index].values) {\n                    const options = self.indexes[index].values[value];\n                    $(\"<option/>\")\n                        .attr(\"value\", value)\n                        .html(options.title)\n                        .appendTo(self.$value);\n                };\n            }\n            self.$value.patternSelect2(self.patternAjaxSelectOptions);\n        }\n\n        if (typeof value !== \"undefined\" && typeof self.$value !== \"undefined\") {\n            if (Array.isArray(self.$value)) {\n                $.each(value, function (i, v) {\n                    self.$value[i].val(v);\n                });\n            } else {\n                var trimmedValue = value;\n                if (typeof value === \"string\" && widget !== \"RelativePathWidget\") {\n                    trimmedValue = value.replace(/::-?[0-9]+/, \"\");\n                }\n                self.$value.val(trimmedValue);\n            }\n        }\n\n        self.trigger(\"create-value\");\n    },\n    createClear: function () {\n        var self = this;\n        self.removeClear();\n        self.$clear = $(\"<div/>\")\n            .addClass(self.options.classClearName)\n            .appendTo(self.$wrapper);\n    },\n    remove: function () {\n        var self = this;\n        self.trigger(\"remove\");\n        self.$remove.remove();\n        self.$index.parent().remove();\n        self.removeOperator();\n        self.removeValue();\n        self.removeClear();\n        self.$wrapper.remove();\n    },\n    removeClear: function () {\n        var self = this;\n        self.trigger(\"remove-clear\");\n        if (self.$clear) {\n            self.$clear.remove();\n        }\n    },\n    removeOperator: function () {\n        var self = this;\n        self.trigger(\"remove-operator\");\n        if (self.$operator) {\n            self.$operator.parent().remove();\n        }\n    },\n    removeValue: function () {\n        var self = this;\n        self.trigger(\"remove-value\");\n        if (self.$value) {\n            if (Array.isArray(self.$value)) {\n                // date ranges have 2 values\n                self.$value[0].parents(\".querystring-criteria-value\").remove();\n            } else {\n                self.$value.parents(\".querystring-criteria-value\").remove();\n            }\n        }\n    },\n    // builds the parameters to go into the http querystring for requesting\n    // results from the query builder\n    buildQueryPart: function () {\n        var self = this;\n\n        // index\n        var ival = self.$index.val();\n        if (ival === \"\") {\n            // no index selected, no query\n            return \"\";\n        }\n        var istr = \"query.i:records=\" + ival;\n\n        // operator\n        if (typeof self.$operator === \"undefined\") {\n            // no operator, no query\n            return \"\";\n        }\n        var oval = self.$operator.val();\n\n        if (ival === \"path\") {\n            if (oval.indexOf(\"advanced\") > 0) {\n                return \"\";\n            }\n            oval = self.convertPathOperators(oval);\n        }\n\n        var ostr = \"query.o:records=\" + oval;\n\n        // value(s)\n        var vstrbase = \"query.v:records=\",\n            vstrlistbase = \"query.v:records:list=\",\n            vstr = [];\n        if (typeof self.$value === \"undefined\") {\n            vstr.push(vstrbase);\n        } else if (Array.isArray(self.$value)) {\n            // handles only datepickers from the 'between' operator right now\n            $.each(self.$value, function () {\n                vstr.push(vstrlistbase + $(this).val());\n            });\n        } else if (Array.isArray(self.$value.val())) {\n            // handles multible values\n            $.each(self.$value.val(), function (i, v) {\n                vstr.push(vstrlistbase + v);\n            });\n        } else {\n            var str = vstrbase + self.$value.val();\n            if (ival === \"path\" && self.$value.val() !== \"\") {\n                str += self.getDepthString();\n            } else if (typeof self.initial !== \"undefined\") {\n                str = vstrbase + self.initial;\n                //Sometimes the RelatedItemsWidget won't be loaded by this point.\n                //This only should happen on the initial page load.\n                delete self.initial;\n            }\n            vstr.push(str);\n        }\n\n        return istr + \"&\" + ostr + \"&\" + vstr.join(\"&\");\n    },\n    getJSONListStr: function () {\n        var self = this;\n\n        // index\n        var ival = self.$index.val();\n        if (ival === \"\") {\n            // no index selected, no query\n            return \"\";\n        }\n\n        // operator\n        if (typeof self.$operator === \"undefined\") {\n            // no operator, no query\n            return \"\";\n        }\n        var oval = self.$operator.val();\n\n        if (ival === \"path\") {\n            if (oval.indexOf(\"advanced\") > 0) {\n                //The advanced function is just a placeholder,\n                //We don't want to send an actual query\n                return \"\";\n            }\n            oval = self.convertPathOperators(oval);\n        }\n        // value(s)\n        var varr = [];\n        if (Array.isArray(self.$value)) {\n            // handles only datepickers from the 'between' operator right now\n            $.each(self.$value, function () {\n                varr.push($(this).val());\n            });\n        } else if (typeof self.$value !== \"undefined\") {\n            var value = self.$value.val();\n            if (ival === \"path\" && value) {\n                var depth = self.getDepthString();\n                if (depth) {\n                    value += depth;\n                }\n            }\n            varr.push(value);\n        }\n        var vval;\n        if (varr.length > 1) {\n            vval = '[\"' + varr.join('\",\"') + '\"]';\n        } else if (varr.length === 1) {\n            vval = JSON.stringify(varr[0]);\n        } else {\n            vval = '\"\"';\n        }\n\n        if (typeof self.indexes[ival].operators[oval] === \"undefined\") {\n            return;\n        }\n\n        return '{\"i\":\"' + ival + '\", \"o\":\"' + oval + '\", \"v\":' + vval + \"}\";\n    },\n    getDepthString: function () {\n        var self = this,\n            out = \"\",\n            depth = $(\".\" + self.options.classDepthName).val();\n\n        if (depth !== \"\" && typeof depth !== \"undefined\") {\n            out += \"::\" + depth;\n        }\n        return out;\n    },\n    trigger: function (name) {\n        this.$wrapper.trigger(name + \"-criteria.querystring.patterns\", [this]);\n    },\n    on: function (name, callback) {\n        this.$wrapper.on(name + \"-criteria.querystring.patterns\", callback);\n    },\n};\n\nexport default Base.extend({\n    name: \"querystring\",\n    trigger: \".pat-querystring\",\n    parser: \"mockup\",\n    defaults: {\n        indexes: [],\n        classWrapperName: \"querystring-wrapper\",\n        criteria: {},\n        indexOptionsUrl: null,\n        previewURL: \"portal_factory/@@querybuilder_html_results\", // base url to use to request preview information from\n        previewCountURL: \"portal_factory/@@querybuildernumberofresults\",\n        patternDateOptions: {},\n        patternAjaxSelectOptions: {},\n        patternRelateditemsOptions: {},\n        classSortLabelName: \"querystring-sort-label\",\n        classSortReverseName: \"querystring-sortreverse\",\n        classSortReverseLabelName: \"querystring-sortreverse-label\",\n        classPreviewCountWrapperName: \"querystring-previewcount-wrapper\",\n        classPreviewResultsWrapperName: \"querystring-previewresults-wrapper\",\n        classPreviewWrapperName: \"querystring-preview-wrapper\",\n        classPreviewName: \"querystring-preview\",\n        classPreviewTitleName: \"querystring-preview-title\",\n        classPreviewDescriptionName: \"querystring-preview-description\",\n        classSortWrapperName: \"querystring-sort-wrapper\",\n        showPreviews: true,\n    },\n    init: async function () {\n        await import(\"../select2/select2\");\n\n        import(\"./querystring.scss\");\n\n        var self = this;\n\n        // hide input element\n        self.$el.hide();\n\n        // create wrapper for out criteria\n        self.$wrapper = $(\"<div/>\");\n        self.$el.after(self.$wrapper);\n\n        // initialization can be detailed if by ajax\n        self.initialized = false;\n\n        // get remove icon for criterias\n        self.options.criteria.remove = await utils.resolveIcon(\"x-circle\");\n\n        if (self.options.indexOptionsUrl) {\n            try {\n                const response = await fetch(self.options.indexOptionsUrl);\n                const data = await response.json();\n                self.options.indexes = data.indexes;\n                self.options[\"sortable_indexes\"] = data[\"sortable_indexes\"];\n                self._init();\n            } catch (e) {\n                // XXX handle this...\n            }\n        }\n    },\n    _init: function () {\n        var self = this;\n        self.$criteriaWrapper = $(\"<div/>\")\n            .addClass(self.options.classWrapperName)\n            .appendTo(self.$wrapper);\n\n        self.$sortWrapper = $(\"<div/>\")\n            .addClass(self.options.classSortWrapperName)\n            .appendTo(self.$wrapper);\n\n        if (self.options.showPreviews === \"false\") {\n            self.options.showPreviews = false;\n        }\n        if (self.options.showPreviews) {\n            self.$previewWrapper = $(\"<div/>\")\n                .addClass(self.options.classPreviewWrapperName)\n                .appendTo(self.$wrapper);\n\n            // preview title and description\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewTitleName)\n                .html(_t(\"Preview\"))\n                .appendTo(self.$previewWrapper);\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewDescriptionName)\n                .html(_t(\"Preview of at most 10 items\"))\n                .appendTo(self.$previewWrapper);\n        }\n\n        self.criterias = [];\n\n        // create populated criterias\n        if (self.el.value) {\n            for (const item of JSON.parse(self.el.value)) {\n                self.createCriteria(item.i, item.o, item.v);\n            }\n        }\n\n        // add empty criteria which enables users to create new cr\n        self.createCriteria();\n\n        // add sort/order fields\n        self.createSort();\n\n        // add criteria preview pane to see results from criteria query\n        if (self.options.showPreviews) {\n            self.refreshPreviewEvent();\n        }\n        self.$el.trigger(\"initialized\");\n        self.initialized = true;\n    },\n    createCriteria: function (index, operator, value) {\n        var self = this,\n            baseUrl = self.options.indexOptionsUrl.replace(/(@@.*)/g, \"\"),\n            criteria = new Criteria(\n                self.$criteriaWrapper,\n                self,\n                self.options.criteria,\n                self.options.indexes,\n                index,\n                operator,\n                value,\n                baseUrl,\n                self.options.patternDateOptions,\n                self.options.patternAjaxSelectOptions,\n                self.options.patternRelateditemsOptions\n            );\n\n        criteria.on(\"remove\", function () {\n            if (self.criterias[self.criterias.length - 1] === criteria) {\n                self.createCriteria();\n            }\n        });\n\n        criteria.on(\"index-changed\", function () {\n            if (self.criterias[self.criterias.length - 1] === criteria) {\n                self.createCriteria();\n            }\n        });\n\n        //This prevents multiple requests from going off after making a single change\n        var _doupdates = function () {\n            self.refreshPreviewEvent();\n            self.updateValue();\n        };\n        var _updateTimeout = -1;\n        var doupdates = function () {\n            clearTimeout(_updateTimeout);\n            _updateTimeout = setTimeout(_doupdates, 100);\n        };\n\n        criteria.on(\"remove\", function (e, criteria) {\n            if (self.criterias.indexOf(criteria) !== -1) {\n                self.criterias.splice(self.criterias.indexOf(criteria), 1);\n            }\n            doupdates(e, criteria);\n        });\n        criteria.on(\"remove-clear\", doupdates);\n        criteria.on(\"remove-operator\", doupdates);\n        criteria.on(\"remove-value\", doupdates);\n        criteria.on(\"index-changed\", doupdates);\n        criteria.on(\"operator-changed\", doupdates);\n        criteria.on(\"create-criteria\", doupdates);\n        criteria.on(\"create-operator\", doupdates);\n        criteria.on(\"create-value\", doupdates);\n        criteria.on(\"value-changed\", doupdates);\n        criteria.on(\"depth-changed\", doupdates);\n\n        self.criterias.push(criteria);\n    },\n    createSort: function () {\n        var self = this;\n\n        // elements that may exist already on the page\n        // XXX do this in a way so it'll work with other forms will work\n        // as long as they provide sort_on and sort_reversed fields in z3c form\n        var existingSortOn = $('[id$=\"-sort_on\"]').filter('[id^=\"formfield-\"]');\n        var existingSortOrder = $('[id*=\"-sort_reversed\"]').filter('[id^=\"formfield-\"]');\n\n        $(\"<span/>\")\n            .addClass(self.options.classSortLabelName)\n            .html(_t(\"Sort on\"))\n            .appendTo(self.$sortWrapper);\n        self.$sortOn = $(\"<select/>\")\n            .attr(\"name\", \"sort_on\")\n            .appendTo(self.$sortWrapper)\n            .on(\"change\", function () {\n                self.refreshPreviewEvent();\n                $('[id$=\"sort_on\"]', existingSortOn).val($(this).val());\n            });\n\n        self.$sortOn.append($('<option value=\"\">' + _t(\"No sorting\") + \"</option>\")); // default no sorting\n        for (var key in self.options[\"sortable_indexes\"]) {\n            self.$sortOn.append(\n                $(\"<option/>\").attr(\"value\", key).html(self.options.indexes[key].title)\n            );\n        }\n        self.$sortOn.patternSelect2({ width: \"150px\" });\n\n        self.$sortOrder = $('<input type=\"checkbox\" />')\n            .attr(\"name\", \"sort_reversed:boolean\")\n            .on(\"change\", function () {\n                self.refreshPreviewEvent();\n                if ($(this).prop(\"checked\")) {\n                    $('input[type=\"checkbox\"]', existingSortOrder).prop(\"checked\", true);\n                } else {\n                    $('input[type=\"checkbox\"]', existingSortOrder).prop(\n                        \"checked\",\n                        false\n                    );\n                }\n            });\n\n        $(\"<span/>\")\n            .addClass(self.options.classSortReverseName)\n            .appendTo(self.$sortWrapper)\n            .append(self.$sortOrder)\n            .append(\n                $(\"<span/>\")\n                    .html(_t(\"Reversed Order\"))\n                    .addClass(self.options.classSortReverseLabelName)\n            );\n\n        // if the form already contains the sort fields, hide them! Their values\n        // will be synced back and forth between the querystring's form elements\n        if (existingSortOn.length >= 1 && existingSortOrder.length >= 1) {\n            var reversed = $('input[type=\"checkbox\"]', existingSortOrder).prop(\n                \"checked\"\n            );\n            var sortOn = $('[id$=\"-sort_on\"]', existingSortOn).val();\n            if (reversed) {\n                self.$sortOrder.prop(\"checked\", true);\n            }\n            self.$sortOn.val(sortOn);\n            $(existingSortOn).hide();\n            $(existingSortOrder).hide();\n        }\n    },\n    refreshPreviewEvent: function () {\n        var self = this;\n\n        if (!self.options.showPreviews) {\n            return; // cut out of this if there are no previews available\n        }\n\n        if (typeof self._previewXhr !== \"undefined\") {\n            self._previewXhr.abort();\n        }\n\n        if (typeof self.$previewPane !== \"undefined\") {\n            self.$previewPane.remove();\n        }\n\n        var query = [];\n        for (const criteria of self.criterias) {\n            var querypart = criteria.buildQueryPart();\n            if (querypart !== \"\") {\n                query.push(querypart);\n            }\n        };\n\n        self.$previewPane = $(\"<div/>\")\n            .addClass(self.options.classPreviewName)\n            .appendTo(self.$previewWrapper);\n\n        if (query.length <= 0) {\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewCountWrapperName)\n                .html(\"No results to preview\")\n                .prependTo(self.$previewPane);\n            return; // no query means nothing to send out requests for\n        }\n\n        query.push(\"sort_on=\" + self.$sortOn.val());\n        if (self.$sortOrder.prop(\"checked\")) {\n            query.push(\"sort_order=reverse\");\n        }\n\n        self._previewXhr = $.ajax({\n            url: self.options.previewURL + \"?\" + query.join(\"&\"),\n            success: (data) => {\n                $(\"<div/>\")\n                    .addClass(self.options.classPreviewResultsWrapperName)\n                    .html(utils.parseBodyTag(data))\n                    .appendTo(self.$previewPane);\n            },\n        });\n    },\n    updateValue: function () {\n        // updating the original input with json data in the form:\n        // [\n        //    {i:'index', o:'operator', v:'value'}\n        // ]\n\n        var self = this;\n\n        var criteriastrs = [];\n        for (const criteria of self.criterias) {\n            var jsonstr = criteria.getJSONListStr();\n            if (jsonstr !== \"\") {\n                criteriastrs.push(jsonstr);\n            }\n        }\n        var val = \"[\" + criteriastrs.join(\",\") + \"]\";\n        self.$el.val(val);\n        self.$el.trigger(\"change\");\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport Select2 from \"../select2/select2\";\n\nconst KEY = {\n    LEFT: 37,\n    RIGHT: 39,\n};\n\nexport default Base.extend({\n    name: \"relateditems\",\n    trigger: \".pat-relateditems\",\n    parser: \"mockup\",\n    currentPath: undefined,\n    selectedUIDs: [],\n    openAfterInit: undefined,\n    defaults: {\n        // main option\n        vocabularyUrl: null, // must be set to work\n\n        // more options\n        attributes: [\n            \"UID\",\n            \"Title\",\n            \"portal_type\",\n            \"path\",\n            \"getURL\",\n            \"getIcon\",\n            \"is_folderish\",\n            \"review_state\",\n        ], // used by utils.QueryHelper\n        basePath: \"\",\n        pageSize: 10,\n        browsing: undefined,\n        closeOnSelect: true,\n        contextPath: undefined,\n        dropdownCssClass: \"pat-relateditems-dropdown\",\n        favorites: [],\n        recentlyUsed: false,\n        recentlyUsedMaxItems: 20,\n        recentlyUsedKey: \"relateditems_recentlyused\",\n        maximumSelectionSize: -1,\n        minimumInputLength: 0,\n        mode: \"browse\", // possible values are 'auto', 'search' and 'browse'.\n        orderable: true, // mockup-patterns-select2\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        rootPath: \"/\",\n        rootUrl: \"\", // default to be relative.\n        scanSelection: false, // False, to no unnecessarily use CPU time on this.\n        selectableTypes: null, // null means everything is selectable, otherwise a list of strings to match types that are selectable\n        separator: \",\",\n        sortOn: null,\n        sortOrder: \"ascending\",\n        tokenSeparators: [\",\", \" \"],\n        upload: false,\n        uploadAllowView: undefined,\n\n        // templates\n        breadcrumbTemplateSelector: null,\n        favoriteTemplateSelector: null,\n        recentlyusedTemplateSelector: null,\n        resultTemplateSelector: null,\n        selectionTemplateSelector: null,\n        toolbarTemplateSelector: null,\n\n        // needed\n        multiple: true,\n\n        // ajax settings\n        ajaxTimeout: 500,\n    },\n\n    recentlyUsed(filterSelectable) {\n        let ret = utils.storage.get(this.options.recentlyUsedKey) || [];\n        // hard-limit to 1000 entries\n        ret = ret.slice(ret.length - 1000, ret.length);\n        if (filterSelectable) {\n            // Filter out only selectable items.\n            // This is used only to create the list of items to be displayed.\n            // the list to be stored is unfiltered and can be reused among\n            // different instances of this widget with different settings.\n            ret.filter(this.isSelectable.bind(this));\n        }\n        // max is applied AFTER filtering selectable items.\n        const max = parseInt(this.options.recentlyUsedMaxItems, 10);\n        if (max) {\n            // return the slice from the end, as we want to display newest items first.\n            ret = ret.slice(ret.length - max, ret.length);\n        }\n        return ret;\n    },\n\n    applyTemplate(tpl, item) {\n        let template;\n        if (this.options[tpl + \"TemplateSelector\"]) {\n            template = $(this.options[tpl + \"TemplateSelector\"]).html();\n        }\n        if (!template) {\n            if (this.options[tpl + \"Template\"]) {\n                template = this.options[tpl + \"Template\"];\n            } else {\n                template = this[tpl + \"Template\"];\n            }\n        }\n        // let's give all the options possible to the template generation\n        const options = $.extend(true, {}, this.options, item, {\n            browsing: this.browsing,\n            open_folder: _t(\"Open folder\"),\n            current_directory: _t(\"current directory:\"),\n            one_level_up: _t(\"Go one level up\"),\n        });\n        options._item = item;\n        return _.template(template)(options);\n    },\n\n    setAjax() {\n        const ajaxTimeout = parseInt(this.options.ajaxTimeout || 500, 10);\n\n        const ajax = {\n            url: this.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: ajaxTimeout,\n\n            data: (term, page) => {\n                const criterias = [];\n                if (term) {\n                    term = \"*\" + term + \"*\";\n                    criterias.push({\n                        i: \"SearchableText\",\n                        o: \"plone.app.querystring.operation.string.contains\",\n                        v: term,\n                    });\n                }\n\n                // We don't restrict for selectable types while browsing...\n                if (!this.browsing && this.options.selectableTypes) {\n                    criterias.push({\n                        i: \"portal_type\",\n                        o: \"plone.app.querystring.operation.selection.any\",\n                        v: this.options.selectableTypes,\n                    });\n                }\n\n                criterias.push({\n                    i: \"path\",\n                    o: this.options.pathOperator,\n                    v:\n                        this.options.rootPath +\n                        this.currentPath +\n                        (this.browsing ? \"::1\" : \"\"),\n                });\n\n                let sort_on = this.options.sortOn;\n                let sort_order = sort_on ? this.options.sortOrder : null;\n                if (this.browsing && sort_on === null) {\n                    sort_on = \"getObjPositionInParent\";\n                    sort_order = \"ascending\";\n                }\n\n                const data = {\n                    query: JSON.stringify({\n                        criteria: criterias,\n                        sort_on: sort_on,\n                        sort_order: sort_order,\n                    }),\n                    attributes: JSON.stringify(this.options.attributes),\n                    batch: JSON.stringify({\n                        page: page ? page : 1,\n                        size: this.options.pageSize,\n                    }),\n                };\n                return data;\n            },\n\n            results: (data, page) => {\n                const more = page * this.options.pageSize < data.total;\n                let results = data.results;\n\n                this.selectedUIDs = (this.$el.select2(\"data\") || []).map((el) => {\n                    // populate current selection. Reuse in formatResult\n                    return el.UID;\n                });\n\n                // Filter out items:\n                // While browsing: always include folderish items\n                // Browsing and searching: Only include selectable items which are not already selected, and all folders\n                // even if they're selected, as we need them available for browsing/selecting their children\n                results = results.filter((item) => {\n                    if (\n                        (this.browsing && item.is_folderish) ||\n                        (this.isSelectable(item) &&\n                            this.selectedUIDs.indexOf(item.UID) === -1)\n                    ) {\n                        return true;\n                    }\n                    return false;\n                });\n\n                // Extend ``data`` with a ``oneLevelUp`` item when browsing\n                const path = this.currentPath.split(\"/\");\n                if (\n                    page === 1 && // Show level up only on top.\n                    this.browsing && // only level up when browsing\n                    path.length > 1 && // do not try to level up one level under root.\n                    this.currentPath !== \"/\" // do not try to level up beyond root\n                ) {\n                    results = [\n                        {\n                            oneLevelUp: true,\n                            Title: _t(\"One level up\"),\n                            path: path.slice(0, path.length - 1).join(\"/\") || \"/\",\n                            currentPath: this.currentPath,\n                            is_folderish: true,\n                            selectable: false,\n                        },\n                    ].concat(results);\n                }\n                return {\n                    results: results,\n                    more: more,\n                };\n            },\n        };\n        this.options.ajax = ajax;\n    },\n\n    async renderToolbar() {\n        const path = this.currentPath;\n        let html;\n\n        const parts = path.split(\"/\");\n        let itemPath = \"\";\n        let itemsHtml = \"\";\n        for (const part of parts) {\n            if (part !== \"\") {\n                const item = {};\n                item.path = itemPath = `${itemPath}/${part}`;\n                item.text = part;\n                itemsHtml = itemsHtml + this.applyTemplate(\"breadcrumb\", item);\n            }\n        }\n\n        // favorites\n        let favoritesHtml = \"\";\n        for (const item of this.options.favorites) {\n            const item_copy = _.clone(item);\n            item_copy.path = item_copy.path.substr(this.options.rootPath.length) || \"/\";\n            favoritesHtml = favoritesHtml + this.applyTemplate(\"favorite\", item_copy);\n        }\n\n        let recentlyUsedHtml = \"\";\n        if (this.options.recentlyUsed) {\n            const recentlyUsed = this.recentlyUsed(true); // filter out only those items which can actually be selected\n            for (const item of recentlyUsed.reverse()) {\n                // reverse to get newest first.\n                recentlyUsedHtml =\n                    recentlyUsedHtml + this.applyTemplate(\"recentlyused\", item);\n            }\n        }\n\n        html = this.applyTemplate(\"toolbar\", {\n            items: itemsHtml,\n            favItems: favoritesHtml,\n            favText: _t(\"Favorites\"),\n            searchText: _t(\"Current path:\"),\n            searchModeText: _t(\"Search\"),\n            browseModeText: _t(\"Browse\"),\n            recentlyUsedItems: recentlyUsedHtml,\n            recentlyUsedText: _t(\"Recently Used\"),\n            icon_root: await utils.resolveIcon(\"house-fill\"),\n            icon_recently_used: await utils.resolveIcon(\"grid-fill\"),\n            icon_favorites: await utils.resolveIcon(\"star-fill\"),\n            icon_upload: await utils.resolveIcon(\"cloud-arrow-up\"),\n            upload: this.options.upload,\n            upload_text: _t(\"Upload\"),\n        });\n\n        this.$toolbar.html(html);\n\n        // unbind mouseup event from select2 to override the behavior:\n        $(\".pat-relateditems-dropdown\").off(\"mouseup\");\n        $(\".pat-relateditems-dropdown\").on(\"mouseup\", (e) => {\n            e.stopPropagation();\n        });\n\n        $(\"button.mode.search\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                this.browsing = false;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"button.mode.browse\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (!this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                this.browsing = true;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"a.crumb\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        $(\"a.fav\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        if (this.options.recentlyUsed) {\n            $(\".pat-relateditems-recentlyused-select\", this.$toolbar).on(\n                \"click\",\n                (event) => {\n                    event.preventDefault();\n                    const uid = $(event.currentTarget).data(\"uid\");\n                    let item = this.recentlyUsed().filter((it) => {\n                        return it.UID === uid;\n                    });\n                    if (item.length > 0) {\n                        item = item[0];\n                    } else {\n                        return;\n                    }\n                    this.selectItem(item);\n                    if (this.options.maximumSelectionSize > 0) {\n                        const items = this.$el.select2(\"data\");\n                        if (items.length >= this.options.maximumSelectionSize) {\n                            return;\n                        }\n                    }\n                }\n            );\n        }\n\n        // upload\n        if (\n            this.options.upload &&\n            utils.featureSupport.dragAndDrop() &&\n            utils.featureSupport.fileApi()\n        ) {\n            if (this.options.uploadAllowView) {\n                // Check, if uploads are allowed in current context\n                $.ajax({\n                    url: this.options.uploadAllowView,\n                    // url: this.currentUrl() + this.options.uploadAllowView,  // not working yet\n                    dataType: \"JSON\",\n                    data: {\n                        path: this.options.rootPath + this.currentPath,\n                    },\n                    type: \"GET\",\n                    success: (result) => {\n                        this.initUploadView(!result.allowUpload);\n                    },\n                });\n            } else {\n                // just initialize upload view without checking, if uploads are allowed.\n                this.initUploadView();\n            }\n        }\n    },\n\n    async initUploadView(disabled) {\n        let Upload = await import(\"../upload/upload\");\n        Upload = Upload.default;\n\n        const upload_button = this.$toolbar[0].querySelector(\".upload button\");\n        upload_button.disabled = disabled;\n\n        const upload_el = this.$toolbar[0].querySelector(\".upload .pat-upload\");\n\n        const upload_config = {\n            success: (e, response) => {\n                const uid = response.UID;\n                if (uid) {\n                    const query = new utils.QueryHelper({\n                        vocabularyUrl: this.options.vocabularyUrl,\n                        attributes: this.options.attributes,\n                    });\n                    query.search(\n                        \"UID\",\n                        \"plone.app.querystring.operation.selection.is\",\n                        uid,\n                        (e) => {\n                            const data = this.$el.select2(\"data\");\n                            data.push.apply(data, e.results);\n                            this.$el.select2(\"data\", data, true);\n                            this.emit(\"selected\");\n                        },\n                        false\n                    );\n                }\n            },\n            uloadMultiple: true,\n            allowPathSelection: false,\n            relativePath: \"fileUpload\",\n            baseUrl: this.options.rootUrl,\n        };\n        const upload = new Upload($(upload_el), upload_config);\n\n        upload_button.addEventListener(\"show.bs.dropdown\", () => {\n            if (this.currentPath !== upload.currentPath) {\n                upload.setPath(this.currentPath);\n            }\n        });\n    },\n\n    browseTo(path) {\n        this.emit(\"before-browse\");\n        this.currentPath = path;\n        this.$el.select2(\"close\");\n        this.renderToolbar();\n        this.$el.select2(\"open\");\n        this.emit(\"after-browse\");\n    },\n\n    selectItem(item) {\n        this.emit(\"selecting\");\n        const data = $(this.el).select2(\"data\");\n        data.push(item);\n        $(this.el).select2(\"data\", data, true);\n\n        if (this.options.recentlyUsed) {\n            // add to recently added items\n            const recentlyUsed = this.recentlyUsed(); // do not filter for selectable but get all. append to that list the new item.\n            const alreadyPresent = recentlyUsed.filter((it) => {\n                return it.UID === item.UID;\n            });\n            if (alreadyPresent.length > 0) {\n                recentlyUsed.splice(recentlyUsed.indexOf(alreadyPresent[0]), 1);\n            }\n            recentlyUsed.push(item);\n            utils.storage.set(this.options.recentlyUsedKey, recentlyUsed);\n        }\n\n        this.emit(\"selected\");\n    },\n\n    deselectItem(item) {\n        this.emit(\"deselecting\");\n        const data = this.$el.select2(\"data\");\n        data.forEach((obj, i) => {\n            if (obj.UID === item.UID) {\n                data.splice(i, 1);\n            }\n        });\n        this.$el.select2(\"data\", data, true);\n        this.emit(\"deselected\");\n    },\n\n    isSelectable(item) {\n        if (item.selectable === false) {\n            return false;\n        }\n        if (this.options.selectableTypes === null) {\n            return true;\n        } else {\n            return this.options.selectableTypes.indexOf(item.portal_type) !== -1;\n        }\n    },\n\n    async init() {\n        (await import(\"bootstrap\")).Dropdown;\n        import(\"./relateditems.scss\");\n\n        // templates\n        this.breadcrumbTemplate = (await import(\"./templates/breadcrumb.xml\")).default; // prettier-ignore\n        this.favoriteTemplate = (await import(\"./templates/favorite.xml\")).default; // prettier-ignore\n        this.recentlyusedTemplate = (await import(\"./templates/recentlyused.xml\")).default; // prettier-ignore\n        this.resultTemplate = (await import(\"./templates/result.xml\")).default; // prettier-ignore\n        this.selectionTemplate = (await import(\"./templates/selection.xml\")).default; // prettier-ignore\n        this.toolbarTemplate = (await import(\"./templates/toolbar.xml\")).default; // prettier-ignore\n\n        this.browsing = this.options.mode !== \"search\";\n\n        // Remove trailing slash\n        this.options.rootPath = this.options.rootPath.replace(/\\/$/, \"\");\n        // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'\n        this.currentPath =\n            this.options.basePath.substr(this.options.rootPath.length) || \"/\";\n\n        this.setAjax();\n\n        this.$el.wrap('<div class=\"pat-relateditems-container\" />');\n        this.$container = this.$el.parents(\".pat-relateditems-container\");\n\n        Select2.prototype.initializeValues.call(this);\n        Select2.prototype.initializeTags.call(this);\n\n        this.options.formatSelection = (item) => {\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                },\n                item\n            );\n\n            // activate petterns on the result set.\n            const $selection = $(this.applyTemplate(\"selection\", item));\n            if (this.options.scanSelection) {\n                registry.scan($selection);\n            }\n            if (this.options.maximumSelectionSize == 1) {\n                // If this related field accepts only 1 item, the breadcrumbs should\n                // reflect the location for this particular item\n                let itemPath = item.path;\n                let path_split = itemPath.split(\"/\");\n                path_split = path_split.slice(0, -1); // Remove last part of path, we always want the parent path\n                itemPath = path_split.join(\"/\");\n                this.currentPath = itemPath;\n                this.renderToolbar();\n            }\n            return $selection;\n        };\n\n        const icon_level_up = await utils.resolveIcon(\"arrow-left-circle\");\n        const icon_level_down = await utils.resolveIcon(\"arrow-right-circle\");\n\n        this.options.formatResult = (item) => {\n            item.selectable = this.isSelectable(item);\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    is_folderish: false,\n                    oneLevelUp: false,\n                    iconLevelUp: icon_level_up,\n                    iconLevelDown: icon_level_down,\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                    selectable: false,\n                },\n                item\n            );\n\n            if (this.selectedUIDs.indexOf(item.UID) !== -1) {\n                // do not allow already selected items to be selected again.\n                item.selectable = false;\n            }\n            const result = $(this.applyTemplate(\"result\", item));\n\n            $(\".pat-relateditems-result-select\", result).on(\"click\", (event) => {\n                const _el = event.currentTarget;\n                event.preventDefault();\n                // event.stopPropagation();\n                if ($(_el).is(\".selectable\")) {\n                    const $parent = $(_el).parents(\".pat-relateditems-result\");\n                    if ($parent.is(\".pat-relateditems-active\")) {\n                        $parent.removeClass(\"pat-relateditems-active\");\n                        this.deselectItem(item);\n                    } else {\n                        if (this.options.maximumSelectionSize > 0) {\n                            const items = this.$el.select2(\"data\");\n                            if (items.length >= this.options.maximumSelectionSize) {\n                                this.$el.select2(\"close\");\n                            }\n                        }\n                        this.selectItem(item);\n                        $parent.addClass(\"pat-relateditems-active\");\n                        if (this.options.closeOnSelect) {\n                            this.$el.select2(\"close\");\n                        }\n                    }\n                }\n            });\n\n            $(\".pat-relateditems-result-browse\", result).on(\"click\", (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                const path = $(event.currentTarget).data(\"path\");\n                this.browseTo(path);\n            });\n\n            return $(result);\n        };\n\n        this.options.initSelection = (element, callback) => {\n            const value = $(element).val();\n            if (value !== \"\") {\n                const ids = value.split(this.options.separator);\n                const query = new utils.QueryHelper(\n                    $.extend(true, {}, this.options, {\n                        pattern: this,\n                    })\n                );\n                query.search(\n                    \"UID\",\n                    \"plone.app.querystring.operation.list.contains\",\n                    ids,\n                    (data) => {\n                        const results = data.results.reduce((prev, item) => {\n                            prev[item.UID] = item;\n                            return prev;\n                        }, {});\n\n                        try {\n                            callback(\n                                ids\n                                    .map((uid) => results[uid])\n                                    .filter((item) => item !== undefined)\n                            );\n                        } catch (e) {\n                            // Select2 3.5.4 throws an error in some cases in\n                            // updateSelection, ``this.selection.find(\".select2-search-choice\").remove();``\n                            // No idea why, hard to track.\n                        }\n\n                        if (this.openAfterInit) {\n                            // open after initialization\n                            this.$el.select2(\"open\");\n                            this.openAfterInit = undefined;\n                        }\n                    },\n                    false\n                );\n            }\n        };\n\n        this.options.tokenizer = (input) => {\n            if (this.options.mode === \"auto\") {\n                this.browsing = input ? false : true;\n            }\n        };\n\n        this.options.id = (item) => item.UID;\n\n        await Select2.prototype.initializeSelect2.call(this);\n        await Select2.prototype.initializeOrdering.call(this);\n\n        this.$toolbar = $('<div class=\"toolbar d-flex\" />');\n        this.$container.prepend(this.$toolbar);\n        this.$el.on(\"select2-selecting\", (event) => {\n            if (!this.isSelectable(event.choice)) {\n                event.preventDefault();\n            }\n        });\n        this.renderToolbar();\n        this.$el.on(\"select2-loaded\", () => {\n            let yMax = window.innerHeight || document.documentElement.clientHeight;\n            const relitem_rect = this.el.parentElement.getBoundingClientRect();\n            const element = $(\n                \"#select2-drop.pat-relateditems-dropdown.select2-drop-active .select2-results\"\n            )[0];\n            const rect = element.getBoundingClientRect();\n            const maxHeight = ((relitem_rect.top > rect.top) ? relitem_rect.top : yMax - rect.top) - 18;\n            $(element).css(\"max-height\", `${maxHeight}px`);\n        });\n\n        $(document).on(\"keyup\", this.$el, (event) => {\n            const isOpen = Select2.prototype.opened.call(this);\n            if (!isOpen) {\n                return;\n            }\n\n            if (event.which === KEY.LEFT || event.which === KEY.RIGHT) {\n                event.stopPropagation();\n\n                const selectorContext =\n                    event.which === KEY.LEFT\n                        ? \".pat-relateditems-result.one-level-up\"\n                        : \".select2-highlighted\";\n\n                const browsableItemSelector = \".pat-relateditems-result-browse\";\n                const browsableItem = $(browsableItemSelector, selectorContext);\n\n                if (browsableItem.length !== 1) {\n                    return;\n                }\n\n                const path = browsableItem.data(\"path\");\n\n                this.browseTo(path);\n            }\n        });\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport I18n from \"../../core/i18n\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"select2\",\n    trigger: \".pat-select2\",\n    parser: \"mockup\",\n    defaults: {\n        separator: \",\",\n        ajaxTimeout: 300,\n    },\n\n    initializeValues() {\n        // Init Selection ---------------------------------------------\n        if (this.options.initialValues) {\n            this.options.id = (term) => {\n                return term.id;\n            };\n            this.options.initSelection = ($el, callback) => {\n                const data = [];\n                const value = $el.val();\n                let seldefaults = this.options.initialValues;\n\n                // Create the initSelection value that contains the default selection,\n                // but in a javascript object\n                if (\n                    typeof this.options.initialValues === \"string\" &&\n                    this.options.initialValues !== \"\"\n                ) {\n                    // if default selection value starts with a '{', then treat the value as\n                    // a JSON object that needs to be parsed\n                    if (this.options.initialValues[0] === \"{\") {\n                        seldefaults = JSON.parse(this.options.initialValues);\n                    }\n                    // otherwise, treat the value as a list, separated by the defaults.separator value of\n                    // strings in the format \"id:text\", and convert it to an object\n                    else {\n                        seldefaults = {};\n                        const initial_values = $(\n                            this.options.initialValues.split(this.options.separator)\n                        );\n                        for (const it of initial_values) {\n                            const selection = it.split(\":\");\n                            const id = selection[0].trim();\n                            const text = selection[1].trim();\n                            seldefaults[id] = text;\n                        }\n                    }\n                }\n\n                const items = $(value.split(this.options.separator));\n                for (const it of items) {\n                    let text = it;\n                    if (seldefaults[it]) {\n                        text = seldefaults[it];\n                    }\n                    data.push({\n                        id: utils.removeHTML(it),\n                        text: utils.removeHTML(text),\n                    });\n                }\n                callback(data);\n            };\n        }\n    },\n\n    initializeTags() {\n        if (this.options.tags && typeof this.options.tags === \"string\") {\n            if (this.options.tags.substr(0, 1) === \"[\") {\n                this.options.tags = JSON.parse(this.options.tags);\n            } else {\n                this.options.tags = this.options.tags.split(this.options.separator);\n            }\n        }\n\n        if (this.options.tags && !this.options.allowNewItems) {\n            this.options.data = this.options.tags.map((value) => {\n                return { id: value, text: value };\n            });\n            this.options.multiple = true;\n            delete this.options.tags;\n        }\n    },\n\n    async initializeOrdering() {\n        if (!this.options.orderable) {\n            return;\n        }\n        const Sortable = (await import(\"sortablejs\")).default;\n        const _initializeOrdering = () => {\n            const sortable_el = this.$select2[0].querySelector(\".select2-choices\");\n            new Sortable(sortable_el, {\n                draggable: \"li\",\n                dragClass: \"select2-choice-dragging\",\n                chosenClass: \"dragging\",\n                onStart: () => this.$el.select2(\"onSortStart\"),\n                onEnd: () => this.$el.select2(\"onSortEnd\"),\n            });\n        };\n        this.$el.on(\"change\", _initializeOrdering.bind(this));\n        _initializeOrdering();\n    },\n\n    async initializeSelect2() {\n        import(\"select2/select2.css\");\n        import(\"./select2.scss\");\n        await import(\"select2\");\n        try {\n            // Don't load \"en\" which is the default where no separate language file exists.\n            if (this.options.language && this.options.language !== \"en\") {\n                await import(`select2/select2_locale_${this.options.language}`);\n            }\n        } catch {\n            console.warn(\"Language file could not be loaded\", this.options.language);\n        }\n\n        this.options.formatResultCssClass = (ob) => {\n            if (ob.id) {\n                return (\n                    \"select2-option-\" +\n                    ob.id.toLowerCase().replace(/[ \\:\\)\\(\\[\\]\\{\\}\\_\\+\\=\\&\\*\\%\\#]/g, \"-\")\n                );\n            }\n        };\n\n        function callback(action, e) {\n            if (action) {\n                if (this.options.debug) {\n                    console.debug(\"callback\", action, e);\n                }\n                if (typeof action === \"string\") {\n                    action = window[action];\n                }\n                return action(e);\n            } else {\n                return action;\n            }\n        }\n\n        this.$el.select2(this.options);\n        this.$el.on(\"select2-selected\", (e) => callback(this.options.onSelected, e));\n        this.$el.on(\"select2-selecting\", (e) => callback(this.options.onSelecting, e));\n        this.$el.on(\"select2-deselecting\", (e) =>\n            callback(this.options.onDeselecting, e)\n        );\n        this.$el.on(\"select2-deselected\", (e) => callback(this.options.onDeselected, e));\n        this.$select2 = this.$el.parent().find(\".select2-container\");\n        this.$el.parent().off(\"close.plone-modal.patterns\");\n        if (this.options.orderable) {\n            this.$select2.addClass(\"select2-orderable\");\n        }\n    },\n\n    opened() {\n        const isOpen = $(\".select2-dropdown-open\", this.$el.parent()).length === 1;\n        return isOpen;\n    },\n\n    async init() {\n        const i18n = new I18n();\n        this.options.language = i18n.currentLanguage;\n        this.options.allowNewItems = this.options.allowNewItems\n            ? JSON.parse(this.options.allowNewItems)\n            : true;\n\n        // TODO: Select2 respects the select fields multiple attribute.\n        //       Currently, only when multiple is set in the pattern options\n        //       the replacement to a hidden input field is done.\n        //       A collection's querystring widget has the multiple attribute\n        //       but must not be replaced with a hidden inout, otherwise robot\n        //       tests fail.\n        //if (this.el.hasAttribute(\"multiple\")) {\n        //    this.options.multiple = true;\n        //}\n\n        if (this.options.ajax || this.options.vocabularyUrl) {\n            if (this.options.vocabularyUrl) {\n                this.options.multiple =\n                    this.options.multiple === undefined ? true : this.options.multiple;\n                this.options.ajax = this.options.ajax || {};\n                this.options.ajax.url = this.options.vocabularyUrl;\n                // XXX removing the following function does'nt break tests. dead code?\n                this.options.initSelection = ($el, callback) => {\n                    const data = [];\n                    const value = $el.val();\n                    for (const val of value.split(this.options.separator)) {\n                        const _val = utils.removeHTML(val);\n                        data.push({ id: _val, text: _val });\n                    }\n                    callback(data);\n                };\n            }\n\n            let queryTerm = \"\";\n\n            const ajaxTimeout = parseInt(this.options.ajaxTimeout || 300, 10);\n            delete this.options.ajaxTimeout;\n            this.options.ajax = $.extend(\n                {\n                    quietMillis: ajaxTimeout,\n                    data: (term, page) => {\n                        queryTerm = term;\n                        return {\n                            query: term,\n                            page_limit: 10,\n                            page: page,\n                        };\n                    },\n                    results: (data) => {\n                        let results = data.results;\n                        if (this.options.vocabularyUrl) {\n                            const dataIds = [];\n                            for (const it of data.results) {\n                                dataIds.push(it.id);\n                            }\n                            results = [];\n\n                            const haveResult =\n                                queryTerm === \"\" || dataIds.includes(queryTerm);\n                            if (this.options.allowNewItems && !haveResult) {\n                                queryTerm = utils.removeHTML(queryTerm);\n                                results.push({\n                                    id: queryTerm,\n                                    text: queryTerm,\n                                });\n                            }\n\n                            for (const it of data.results) {\n                                results.push(it);\n                            }\n                        }\n                        return { results: results };\n                    },\n                },\n                this.options.ajax\n            );\n        } else if (this.options.multiple && this.$el.is(\"select\")) {\n            // Multiselects are converted to input[type=hidden] for Select2\n            // TODO: This should actually not be necessary.\n            //       This is kept for backwards compatibility but should be\n            //       re-checked and removed if possible.\n            this.$el.attr(\"multiple\", true);\n            const vals = this.$el.val() || [];\n            const options = [...this.el.querySelectorAll(\"option\")].map((it) => {\n                return { text: it.innerHTML, id: it.value };\n            });\n\n            const el = document.createElement(\"input\");\n            el.type = \"hidden\";\n            el.value = vals.join(this.options.separator);\n            el.className = this.el.getAttribute(\"class\");\n            el.name = this.el.name;\n            el.id = this.el.id;\n            this.el.after(el);\n            this.el.remove();\n            this.el = el;\n            this.$el = $(el);\n\n            this.options.data = options;\n        }\n        this.initializeValues();\n        this.initializeTags();\n        await this.initializeSelect2();\n        await this.initializeOrdering();\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"sortable\",\n    trigger: \".pat-sortable\",\n    parser: \"mockup\",\n    defaults: {\n        selector: \"li\",\n        dragClass: \"item-dragging\",\n        cloneClass: \"dragging\",\n        drop: undefined, // callback function or name of global function\n    },\n    init: async function () {\n        let Sortable = await import(\"sortablejs\");\n        Sortable = Sortable.default;\n        this.sortable = new Sortable(this.$el[0], {\n            animation: 150,\n            draggable: this.options.selector,\n            chosenClass: this.options.dragClass,\n            dragClass: this.options.cloneClass,\n            onEnd: function (e) {\n                var cb = this.options.drop;\n                if (!cb) {\n                    return;\n                }\n                if (typeof cb === \"string\") {\n                    cb = window[this.options.drop];\n                }\n                cb($(e.item), e.newIndex - e.oldIndex);\n            }.bind(this),\n        });\n    },\n    disableSort: function () {\n        this.sortable.option(\"sort\", false);\n    },\n    enableSort: function () {\n        this.sortable.option(\"sort\", true);\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport utils from \"../../core/utils\";\n\nconst log = logger.getLogger(\"pat-upload\");\n\nlet Dropzone;\n\nexport default Base.extend({\n    name: \"upload\",\n    trigger: \".pat-upload\",\n    parser: \"mockup\",\n    defaults: {\n        showTitle: true,\n        url: null, // XXX MUST provide url to submit to OR be in a form\n        className: \"upload\",\n        wrap: false,\n        wrapperTemplate: '<div class=\"upload-wrapper\"/>',\n        fileaddedClassName: \"dropping\",\n        useTus: false,\n        container: \"\",\n        ajaxUpload: true,\n\n        paramName: \"file\",\n        addRemoveLinks: false,\n        autoCleanResults: true,\n        previewsContainer: \".previews\",\n        previewTemplate: null,\n        maxFiles: null,\n        maxFilesize: 99999999, // let's not have a max by default...\n\n        allowPathSelection: undefined,\n        relatedItems: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"getURL\",\n                \"portal_type\",\n                \"path\",\n                \"ModificationDate\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: 500,\n            maximumSelectionSize: 1,\n            selectableTypes: [\"Folder\"],\n        },\n    },\n\n    init: async function () {\n        import(\"dropzone/dist/dropzone.css\");\n        import(\"./upload.scss\");\n        Dropzone = (await import(\"dropzone\")).default;\n        /* we do not want this plugin to auto discover */\n        Dropzone.autoDiscover = false;\n\n        const UploadTemplate = (await import(\"./templates/upload.xml\")).default;\n\n        var self = this;\n\n        if (self.$el.find(\".upload-area\").length) {\n            log.info(\"Found already a dropzone on element, skipping!\");\n            return;\n        }\n\n        if (typeof self.options.allowPathSelection === \"undefined\") {\n            // Set allowPathSelection to true, if we can use path based urls.\n            self.options.allowPathSelection =\n                self.options.baseUrl && self.options.relativePath;\n        }\n\n        // TODO: find a way to make this work in firefox (and IE)\n        $(document).on(\"paste\", function (e) {\n            var oe = e.originalEvent;\n            var items = oe.clipboardData.items;\n            if (items) {\n                for (var i = 0; i < items.length; i++) {\n                    if (items[i].type.indexOf(\"image\") !== -1) {\n                        var blob = items[i].getAsFile();\n                        self.dropzone.addFile(blob);\n                    }\n                }\n            }\n        });\n        // values that will change current processing\n        self.currentPath = self.options.currentPath;\n        self.currentFile = 0;\n\n        let template = _.template(UploadTemplate)({\n            _t: _t,\n            allowPathSelection: self.options.allowPathSelection,\n        });\n        self.$el.addClass(self.options.className);\n        self.$el.append(template);\n\n        self.$progress = $(\".progress-bar-success\", self.$el);\n\n        if (!self.options.showTitle) {\n            self.$el.find(\"h2.title\").hide();\n        }\n\n        if (!self.options.ajaxUpload) {\n            // no ajax upload, drop the fallback\n            $(\".fallback\", this.$el).remove();\n            if (this.$el.hasClass(\".upload-container\")) {\n                this.$el.addClass(\"no-ajax-upload\");\n            } else {\n                this.$el.closest(\".upload-container\").addClass(\"no-ajax-upload\");\n            }\n        }\n\n        if (self.options.wrap) {\n            self.$el.wrap(self.options.wrapperTemplate);\n            self.$el = self.$el.parent();\n        }\n\n        if (self.options.allowPathSelection) {\n            // only use related items if we can generate path based urls and if it's not turned off.\n            self.$pathInput = $('input[name=\"location\"]', self.$el);\n            self.relatedItems = await self.setupRelatedItems(self.$pathInput);\n        } else {\n            $('input[name=\"location\"]', self.$el).parent().remove();\n            self.relatedItems = null;\n        }\n\n        self.$dropzone = $(\".upload-area\", self.$el);\n\n        $(\"div.browse-select button.browse\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (\n                !self.options.maxFiles ||\n                self.dropzone.files.length < self.options.maxFiles\n            ) {\n                self.dropzone.hiddenFileInput.click();\n            }\n        });\n\n        var dzoneOptions = await this.getDzoneOptions();\n\n        try {\n            // if init of Dropzone fails it says nothing and\n            // it fails silently. Using this block we make sure\n            // that if you break it w/ some weird or missing option\n            // you can get a proper log of it\n            //\n            self.dropzone = new Dropzone(self.$dropzone[0], dzoneOptions);\n        } catch (e) {\n            if (window.DEBUG) {\n                // log it!\n                console.log(e);\n            }\n            throw e;\n        }\n\n        self.dropzone.on(\"maxfilesreached\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"addedfile\", function (/* file */) {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"removedfile\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"success\", function (e, response) {\n            // Trigger event 'uploadAllCompleted' and pass the server's reponse and\n            // the path uid. This event can be listened to by patterns using the\n            // upload pattern, e.g. the TinyMCE pattern's link plugin.\n            var data;\n            try {\n                data = $.parseJSON(response);\n            } catch (ex) {\n                data = response;\n            }\n            self.$el.trigger(\"uploadAllCompleted\", {\n                data: data,\n                path_uid: self.$pathInput ? self.$pathInput.val() : null,\n            });\n        });\n\n        if (self.options.autoCleanResults) {\n            self.dropzone.on(\"complete\", function (file) {\n                if (file.status === Dropzone.SUCCESS) {\n                    setTimeout(function () {\n                        $(file.previewElement).fadeOut();\n                    }, 3000);\n                }\n            });\n        }\n\n        self.dropzone.on(\"complete\", function (file) {\n            if (file.status === Dropzone.SUCCESS && self.dropzone.files.length === 1) {\n                self.showHideControls();\n            }\n        });\n\n        self.dropzone.on(\"error\", function (file, response, xmlhr) {\n            if (typeof xmlhr !== \"undefined\" && xmlhr.status !== 403) {\n                // If error other than 403, just print a generic message\n                $(\".dz-error-message span\", file.previewElement).html(\n                    _t(\"The file transfer failed\")\n                );\n            }\n        });\n\n        self.dropzone.on(\"totaluploadprogress\", function (pct) {\n            // need to caclulate total pct here in reality since we're manually\n            // processing each file one at a time.\n            pct =\n                (((self.currentFile - 1) * 100 + pct) /\n                    (self.dropzone.files.length * 100)) *\n                100;\n            self.$progress.attr(\"aria-valuenow\", pct).css(\"width\", pct + \"%\");\n        });\n\n        $(\".upload-all\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.processUpload({\n                finished: function () {\n                    self.$progress.attr(\"aria-valuenow\", 0).css(\"width\", \"0%\");\n                },\n            });\n        });\n        if (self.options.clipboardfile) {\n            self.dropzone.addFile(self.options.clipboardfile);\n        }\n    },\n\n    showHideControls: function () {\n        /* we do this delayed because this can be called multiple times\n         AND we need to do this hide/show AFTER dropzone is done with\n         all it's own events. This is NASTY but the only way we can\n         enforce some numFiles with dropzone! */\n        var self = this;\n        if (self._showHideTimeout) {\n            clearTimeout(self._showHideTimeout);\n        }\n        self._showHideTimeout = setTimeout(function () {\n            self._showHideControls();\n        }, 50);\n    },\n\n    _showHideControls: function () {\n        var self = this;\n        var $controls = $(\".controls\", self.$el);\n        var $browse = $(\".browse-select\", self.$el);\n        var $input = $(\".dz-hidden-input\");\n\n        if (self.options.maxFiles) {\n            if (self.dropzone.files.length < self.options.maxFiles) {\n                $browse.show();\n                $input.prop(\"disabled\", false);\n            } else {\n                $browse.hide();\n                $input.prop(\"disabled\", true);\n            }\n        }\n        if (self.dropzone.files.length > 0) {\n            $controls.fadeIn(\"slow\");\n            var file = self.dropzone.files[0];\n            $(\".dz-error-message span\", file.previewElement).html(\"\");\n        } else {\n            $controls.fadeOut(\"slow\");\n        }\n    },\n\n    pathJoin: function () {\n        var parts = [];\n        _.each(arguments, function (part) {\n            if (!part) {\n                return;\n            }\n            if (part[0] === \"/\") {\n                part = part.substring(1);\n            }\n            if (part[part.length - 1] === \"/\") {\n                part = part.substring(0, part.length - 1);\n            }\n            parts.push(part);\n        });\n        return parts.join(\"/\");\n    },\n\n    getUrl: function () {\n        var self = this;\n        var url = self.options.url;\n        if (!url) {\n            if (self.options.baseUrl && self.options.relativePath) {\n                url = self.options.baseUrl;\n                if (url[url.length - 1] !== \"/\") {\n                    url = url + \"/\";\n                }\n                url = url + self.pathJoin(self.currentPath, self.options.relativePath);\n            } else {\n                var $form = self.$el.parents(\"form\");\n                if ($form.length > 0) {\n                    url = $form.attr(\"action\");\n                } else {\n                    url = window.location.href;\n                }\n            }\n        }\n        return url;\n    },\n\n    getDzoneOptions: async function () {\n        let PreviewTemplate = await import(\"./templates/preview.xml\");\n        PreviewTemplate = PreviewTemplate.default;\n\n        var self = this;\n\n        // This pattern REQUIRE dropzone to be clickable\n        self.options.clickable = true;\n\n        var options = $.extend({}, self.options);\n        options.url = self.getUrl();\n\n        options.headers = {\n            \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n        };\n\n        // XXX force to only upload one to the server at a time,\n        // right now we don't support multiple for backends\n        options.uploadMultiple = false;\n\n        delete options.wrap;\n        delete options.wrapperTemplate;\n        delete options.resultTemplate;\n        delete options.autoCleanResults;\n        delete options.fileaddedClassName;\n        delete options.useTus;\n\n        if (self.options.previewsContainer) {\n            /*\n             * if they have a select but it's not an id, let's make an id selector\n             * so we can target the correct container. dropzone is weird here...\n             */\n            var $preview = self.$el.find(self.options.previewsContainer);\n            if ($preview.length > 0) {\n                options.previewsContainer = $preview[0];\n            }\n        }\n\n        // XXX: do we need to allow this?\n        options.autoProcessQueue = false;\n        // options.addRemoveLinks = true;  // we show them in the template\n        options.previewTemplate = PreviewTemplate;\n\n        // if our element is a form we should force some values\n        // https://github.com/enyo/dropzone/wiki/Combine-normal-form-with-Dropzone\n        return options;\n    },\n\n    processUpload: function (options) {\n        if (!options) {\n            options = {};\n        }\n\n        var self = this,\n            processing = false,\n            useTus = self.options.useTus,\n            fileaddedClassName = self.options.fileaddedClassName,\n            finished = options.finished;\n\n        self.currentFile = 0;\n\n        function process() {\n            processing = true;\n            if (self.dropzone.files.length === 0) {\n                processing = false;\n            }\n\n            var file = self.dropzone.files[0];\n            if (processing && file.status === Dropzone.ERROR) {\n                // Put the file back as \"queued\" for retrying\n                file.status = Dropzone.QUEUED;\n                processing = false;\n            }\n\n            if (!processing) {\n                self.$el.removeClass(fileaddedClassName);\n                if (finished !== undefined && typeof finished === \"function\") {\n                    finished();\n                }\n                return;\n            }\n\n            if ([Dropzone.SUCCESS, Dropzone.CANCELED].indexOf(file.status) !== -1) {\n                // remove it\n                self.dropzone.removeFile(file);\n                process();\n            } else if (file.status !== Dropzone.UPLOADING) {\n                // start processing file\n                if (useTus && window.tus) {\n                    // use tus upload if installed\n                    self.handleTusUpload(file);\n                } else {\n                    // otherwise, just use dropzone to process\n                    self.currentFile += 1;\n                    self.dropzone.processFile(file);\n                }\n                setTimeout(process, 100);\n            } else {\n                // currently processing\n                setTimeout(process, 100);\n            }\n        }\n        process();\n    },\n\n    handleTusUpload: function (file) {\n        /* this needs fixing... */\n        var self = this,\n            chunkSize = 1024 * 1024 * 5; // 5mb chunk size\n\n        file.status = Dropzone.UPLOADING;\n\n        window.tus\n            .upload(file, {\n                endpoint: self.dropzone.options.url,\n                headers: {\n                    \"FILENAME\": file.name,\n                    \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n                },\n                chunkSize: chunkSize,\n            })\n            .fail(function () {\n                if (window.DEBUG) {\n                    console.alert(_t(\"Error uploading with TUS resumable uploads\"));\n                }\n                file.status = Dropzone.ERROR;\n            })\n            .progress(function (e, bytesUploaded, bytesTotal) {\n                var percentage = (bytesUploaded / bytesTotal) * 100;\n                self.$progress\n                    .attr(\"aria-valuenow\", percentage)\n                    .css(\"width\", percentage + \"%\");\n                self.$progress.html(\n                    _t(\"uploading...\") +\n                        \"<br />\" +\n                        self.formatBytes(bytesUploaded) +\n                        \" / \" +\n                        self.formatBytes(bytesTotal)\n                );\n            })\n            .done(function (url, file) {\n                file.status = Dropzone.SUCCESS;\n                self.dropzone.emit(\"success\", file);\n                self.dropzone.emit(\"complete\", file);\n            });\n    },\n\n    formatBytes: function (bytes) {\n        var kb = Math.round(bytes / 1024);\n        if (kb < 1024) {\n            return kb + \" KiB\";\n        }\n        var mb = Math.round(kb / 1024);\n        if (mb < 1024) {\n            return mb + \" MB\";\n        }\n        return Math.round(mb / 1024) + \" GB\";\n    },\n\n    setPath: function (path) {\n        var self = this;\n        self.currentPath = path;\n        self.options.url = null;\n        self.options.url = self.dropzone.options.url = self.getUrl();\n    },\n\n    setupRelatedItems: async function ($input) {\n        const RelatedItems = (await import(\"../relateditems/relateditems\")).default;\n\n        var self = this;\n        var options = self.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        if (self.options.initialFolder) {\n            $input.attr(\"value\", self.options.initialFolder);\n        }\n        var ri = new RelatedItems($input, options);\n        ri.$el.on(\"change\", function () {\n            var result = $(this).select2(\"data\");\n            var path = null;\n            if (result.length > 0) {\n                path = result[0].path;\n            }\n            self.setPath(path);\n        });\n        return ri;\n    },\n});\n","/**\n * @license\n * Patterns @VERSION@ jquery-ext - various jQuery extensions\n *\n * Copyright 2011 Humberto Sermeo\n */\n\nimport $ from \"jquery\";\n\nvar methods = {\n    init: function (options) {\n        var settings = {\n            time: 3 /* time it will wait before moving to \"timeout\" after a move event */,\n            initialTime: 8 /* time it will wait before first adding the \"timeout\" class */,\n            exceptionAreas: [] /* IDs of elements that, if the mouse is over them, will reset the timer */,\n        };\n        return this.each(function () {\n            var $this = $(this),\n                data = $this.data(\"timeout\");\n\n            if (!data) {\n                if (options) {\n                    $.extend(settings, options);\n                }\n                $this.data(\"timeout\", {\n                    lastEvent: new Date(),\n                    trueTime: settings.time,\n                    time: settings.initialTime,\n                    untouched: true,\n                    inExceptionArea: false,\n                });\n\n                $this.on(\"mouseover.timeout\", methods.mouseMoved);\n                $this.on(\"mouseenter.timeout\", methods.mouseMoved);\n\n                $(settings.exceptionAreas).each(function () {\n                    $this\n                        .find(this)\n                        .live(\n                            \"mouseover.timeout\",\n                            { parent: $this },\n                            methods.enteredException\n                        )\n                        .live(\n                            \"mouseleave.timeout\",\n                            { parent: $this },\n                            methods.leftException\n                        );\n                });\n\n                if (settings.initialTime > 0) $this.timeout(\"startTimer\");\n                else $this.addClass(\"timeout\");\n            }\n        });\n    },\n\n    enteredException: function (event) {\n        var data = event.data.parent.data(\"timeout\");\n        data.inExceptionArea = true;\n        event.data.parent.data(\"timeout\", data);\n        event.data.parent.trigger(\"mouseover\");\n    },\n\n    leftException: function (event) {\n        var data = event.data.parent.data(\"timeout\");\n        data.inExceptionArea = false;\n        event.data.parent.data(\"timeout\", data);\n    },\n\n    destroy: function () {\n        return this.each(function () {\n            var $this = $(this),\n                data = $this.data(\"timeout\");\n\n            $(window).off(\".timeout\");\n            data.timeout.remove();\n            $this.removeData(\"timeout\");\n        });\n    },\n\n    mouseMoved: function () {\n        var $this = $(this),\n            data = $this.data(\"timeout\");\n\n        if ($this.hasClass(\"timeout\")) {\n            $this.removeClass(\"timeout\");\n            $this.timeout(\"startTimer\");\n        } else if (data.untouched) {\n            data.untouched = false;\n            data.time = data.trueTime;\n        }\n\n        data.lastEvent = new Date();\n        $this.data(\"timeout\", data);\n    },\n\n    startTimer: function () {\n        var $this = $(this),\n            data = $this.data(\"timeout\");\n        var fn = function () {\n            var data = $this.data(\"timeout\");\n            if (data && data.lastEvent) {\n                if (data.inExceptionArea) {\n                    setTimeout(fn, Math.floor(data.time * 1000));\n                } else {\n                    var now = new Date();\n                    var diff = Math.floor(data.time * 1000) - (now - data.lastEvent);\n                    if (diff > 0) {\n                        // the timeout has not ocurred, so set the timeout again\n                        setTimeout(fn, diff + 100);\n                    } else {\n                        // timeout ocurred, so set the class\n                        $this.addClass(\"timeout\");\n                    }\n                }\n            }\n        };\n\n        setTimeout(fn, Math.floor(data.time * 1000));\n    },\n};\n\n$.fn.timeout = function (method) {\n    if (methods[method]) {\n        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));\n    } else if (typeof method === \"object\" || !method) {\n        return methods.init.apply(this, arguments);\n    } else {\n        $.error(\"Method \" + method + \" does not exist on jQuery.timeout\");\n    }\n};\n\n// Custom jQuery selector to find elements with scrollbars\n$.extend($.expr[\":\"], {\n    scrollable: function (element) {\n        var vertically_scrollable, horizontally_scrollable;\n        if (\n            $(element).css(\"overflow\") === \"scroll\" ||\n            $(element).css(\"overflowX\") === \"scroll\" ||\n            $(element).css(\"overflowY\") === \"scroll\"\n        )\n            return true;\n\n        vertically_scrollable =\n            element.clientHeight < element.scrollHeight &&\n            ($.inArray($(element).css(\"overflowY\"), [\"scroll\", \"auto\"]) !== -1 ||\n                $.inArray($(element).css(\"overflow\"), [\"scroll\", \"auto\"]) !== -1);\n\n        if (vertically_scrollable) return true;\n\n        horizontally_scrollable =\n            element.clientWidth < element.scrollWidth &&\n            ($.inArray($(element).css(\"overflowX\"), [\"scroll\", \"auto\"]) !== -1 ||\n                $.inArray($(element).css(\"overflow\"), [\"scroll\", \"auto\"]) !== -1);\n        return horizontally_scrollable;\n    },\n});\n\n// Make Visible in scroll\n$.fn.makeVisibleInScroll = function (parent_id) {\n    var absoluteParent = null;\n    if (typeof parent_id === \"string\") {\n        absoluteParent = $(\"#\" + parent_id);\n    } else if (parent_id) {\n        absoluteParent = $(parent_id);\n    }\n\n    return this.each(function () {\n        var $this = $(this),\n            parent;\n        if (!absoluteParent) {\n            parent = $this.parents(\":scrollable\");\n            if (parent.length > 0) {\n                parent = $(parent[0]);\n            } else {\n                parent = $(window);\n            }\n        } else {\n            parent = absoluteParent;\n        }\n\n        var elemTop = $this.position().top;\n        var elemBottom = $this.height() + elemTop;\n\n        var viewTop = parent.scrollTop();\n        var viewBottom = parent.height() + viewTop;\n\n        if (elemTop < viewTop) {\n            parent.scrollTop(elemTop);\n        } else if (elemBottom > viewBottom - parent.height() / 2) {\n            parent.scrollTop(elemTop - (parent.height() - $this.height()) / 2);\n        }\n    });\n};\n\n//Work around warning for jQuery 3.x:\n//JQMIGRATE: jQuery.fn.offset() requires an element connected to a document\n$.fn.safeOffset = function () {\n    var docElem,\n        elem = this[0],\n        origin = { top: 0, left: 0 };\n\n    if (!elem || !elem.nodeType) {\n        return origin;\n    }\n\n    docElem = (elem.ownerDocument || document).documentElement;\n    if (!$.contains(docElem, elem)) {\n        return origin;\n    }\n\n    return $.fn.offset.apply(this, arguments);\n};\n\n//Make absolute location\n$.fn.setPositionAbsolute = function (element, offsettop, offsetleft) {\n    return this.each(function () {\n        // set absolute location for based on the element passed\n        // dynamically since every browser has different settings\n        var $this = $(this);\n        var thiswidth = $(this).width();\n        var pos = element.safeOffset();\n        var width = element.width();\n        var height = element.height();\n        var setleft = pos.left + width - thiswidth + offsetleft;\n        var settop = pos.top + height + offsettop;\n        $this.css({\n            \"z-index\": 1,\n            \"position\": \"absolute\",\n            \"marginLeft\": 0,\n            \"marginTop\": 0,\n            \"left\": setleft + \"px\",\n            \"top\": settop + \"px\",\n            \"width\": thiswidth,\n        });\n        $this.remove().appendTo(\"body\").show();\n    });\n};\n\n$.fn.positionAncestor = function (selector) {\n    var left = 0;\n    var top = 0;\n    this.each(function () {\n        // check if current element has an ancestor matching a selector\n        // and that ancestor is positioned\n        var $ancestor = $(this).closest(selector);\n        if ($ancestor.length && $ancestor.css(\"position\") !== \"static\") {\n            var $child = $(this);\n            var childMarginEdgeLeft =\n                $child.safeOffset().left - parseInt($child.css(\"marginLeft\"), 10);\n            var childMarginEdgeTop =\n                $child.safeOffset().top - parseInt($child.css(\"marginTop\"), 10);\n            var ancestorPaddingEdgeLeft =\n                $ancestor.safeOffset().left +\n                parseInt($ancestor.css(\"borderLeftWidth\"), 10);\n            var ancestorPaddingEdgeTop =\n                $ancestor.safeOffset().top +\n                parseInt($ancestor.css(\"borderTopWidth\"), 10);\n            left = childMarginEdgeLeft - ancestorPaddingEdgeLeft;\n            top = childMarginEdgeTop - ancestorPaddingEdgeTop;\n            // we have found the ancestor and computed the position\n            // stop iterating\n            return false;\n        }\n    });\n    return {\n        left: left,\n        top: top,\n    };\n};\n\n$.fn.findInclusive = function (selector) {\n    return this.find(\"*\").addBack().filter(selector);\n};\n\n$.fn.slideIn = function (speed, easing, callback) {\n    return this.animate({ width: \"show\" }, speed, easing, callback);\n};\n\n$.fn.slideOut = function (speed, easing, callback) {\n    return this.animate({ width: \"hide\" }, speed, easing, callback);\n};\n\n// case-insensitive :contains\n$.expr[\":\"].Contains = function (a, i, m) {\n    return $(a).text().toUpperCase().indexOf(m[3].toUpperCase()) >= 0;\n};\n\n$.fn.scopedFind = function (selector) {\n    /*  If the selector starts with an object id do a global search,\n     *  otherwise do a local search.\n     */\n    if (selector.indexOf(\"#\") === 0) {\n        return $(selector);\n    } else {\n        return this.find(selector);\n    }\n};\n\nexport default undefined;\n","import Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\nimport \"../../core/jquery-ext\";\n\nexport const parser = new Parser(\"checklist\");\nparser.addArgument(\"select\", \".select-all\");\nparser.addArgument(\"deselect\", \".deselect-all\");\nparser.addArgument(\"toggle\", \".toggle-all\");\n\nexport default Base.extend({\n    name: \"checklist\",\n    trigger: \".pat-checklist\",\n    jquery_plugin: true,\n    all_selects: [],\n    all_deselects: [],\n    all_toggles: [],\n    all_checkboxes: [],\n    all_radios: [],\n\n    init() {\n        this.options = parser.parse(this.el, this.options, false);\n        this.$el.on(\"patterns-injected\", this._init.bind(this));\n\n        this.change_handler = utils.debounce(() => {\n            this.change_buttons_and_toggles();\n            this.change_checked();\n        }, 50);\n\n        this._init();\n    },\n\n    _init() {\n        this.all_checkboxes = this.el.querySelectorAll(`input[type=checkbox]`);\n        this.all_radios = this.el.querySelectorAll(\"input[type=radio]\");\n\n        this.all_selects = dom.find_scoped(this.el, this.options.select);\n        for (const btn of this.all_selects) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--select-all--click\",\n                this.select_all.bind(this)\n            );\n        }\n\n        this.all_deselects = dom.find_scoped(this.el, this.options.deselect);\n        for (const btn of this.all_deselects) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--deselect-all--click\",\n                this.deselect_all.bind(this)\n            );\n        }\n\n        this.all_toggles = dom.find_scoped(this.el, this.options.toggle);\n        for (const btn of this.all_toggles) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--toggle-all--click\",\n                this.toggle_all.bind(this)\n            );\n        }\n\n        // update select/deselect button status\n        this.change_buttons_and_toggles();\n        this.change_checked();\n        events.add_event_listener(\n            this.el,\n            \"change\",\n            \"pat-checklist--change-handler--change\",\n            this.change_handler.bind(this)\n        );\n    },\n\n    destroy() {\n        for (const it of this.all_selects) {\n            events.remove_event_listener(it, \"pat-checklist--select-all--click\");\n        }\n        for (const it of this.all_deselects) {\n            events.remove_event_listener(it, \"pat-checklist--deselect-all--click\");\n        }\n        for (const it of this.all_toggles) {\n            events.remove_event_listener(it, \"pat-checklist--toggle-all--click\");\n        }\n        events.remove_event_listener(this.el, \"pat-checklist--change-handler--change\");\n        this.$el.off(\"patterns_injected\");\n    },\n\n    find_siblings(el, sel) {\n        // Looks for the closest elements within the `el` tree that match the\n        // `sel` selector\n        let res;\n        let parent = el.parentNode;\n        while (parent) {\n            res = parent.querySelectorAll(`${sel}:not(${this.options.toggle})`);\n            if (res.length || parent === this.el) {\n                // return if results were found or we reached the pattern top\n                return res;\n            }\n            parent = parent.parentNode;\n        }\n    },\n\n    find_checkboxes(ref_el, sel) {\n        let chkbxs = [];\n        if (this.options.select.indexOf(\"#\") === 0) {\n            chkbxs = this.el.querySelectorAll(sel);\n        } else {\n            chkbxs = this.find_siblings(ref_el, sel);\n        }\n        return chkbxs;\n    },\n\n    change_buttons_and_toggles() {\n        let chkbxs;\n        for (const btn of this.all_selects) {\n            chkbxs = this.find_checkboxes(btn, \"input[type=checkbox]\");\n            btn.disabled = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === true);\n        }\n        for (const btn of this.all_deselects) {\n            chkbxs = this.find_checkboxes(btn, \"input[type=checkbox]\");\n            btn.disabled = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === false);\n        }\n        for (const tgl of this.all_toggles) {\n            chkbxs = this.find_checkboxes(tgl, \"input[type=checkbox]\");\n            tgl.checked = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === true);\n        }\n    },\n\n    select_all(e) {\n        e.preventDefault();\n        const chkbxs = this.find_checkboxes(\n            e.target,\n            \"input[type=checkbox]:not(:checked)\"\n        );\n        for (const box of chkbxs) {\n            box.checked = true;\n            box.dispatchEvent(events.change_event());\n            box.dispatchEvent(events.input_event());\n        }\n    },\n\n    deselect_all(e) {\n        e.preventDefault();\n        const chkbxs = this.find_checkboxes(e.target, \"input[type=checkbox]:checked\");\n        for (const box of chkbxs) {\n            box.checked = false;\n            box.dispatchEvent(events.change_event());\n            box.dispatchEvent(events.input_event());\n        }\n    },\n\n    toggle_all(e) {\n        e.preventDefault();\n        const checked = e.target.checked;\n        const chkbxs = this.find_checkboxes(e.target, \"input[type=checkbox]\");\n        for (const box of chkbxs) {\n            box.checked = checked;\n            box.dispatchEvent(events.change_event());\n            box.dispatchEvent(events.input_event());\n        }\n    },\n\n    change_checked() {\n        for (const it of [...this.all_checkboxes, ...this.all_radios]) {\n            for (const label of it.labels) {\n                label.classList.remove(\"checked\", \"unchecked\");\n                label.classList.add(it.checked ? \"checked\" : \"unchecked\");\n            }\n        }\n\n        for (const fieldset of dom.querySelectorAllAndMe(this.el, \"fieldset\")) {\n            if (\n                fieldset.querySelectorAll(\n                    `input[type=checkbox]:checked:not(${this.options.toggle}), input[type=radio]:checked`\n                ).length\n            ) {\n                fieldset.classList.remove(\"unchecked\");\n                fieldset.classList.add(\"checked\");\n            } else {\n                fieldset.classList.remove(\"checked\");\n                fieldset.classList.add(\"unchecked\");\n            }\n        }\n    },\n});\n","/* pat-datetime-picker  - Polyfill for input type=datetime-local */\nimport Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport utils from \"../../core/utils\";\nimport dom from \"../../core/dom\";\n\nexport const parser = new Parser(\"datetime-picker\");\nparser.addArgument(\"format\", \"YYYY-MM-DD\");\nparser.addArgument(\"week-numbers\", [], [\"show\", \"hide\"]);\nparser.addArgument(\"i18n\"); // URL pointing to JSON resource with i18n values\nparser.addArgument(\"today\", \"Today\");\nparser.addArgument(\"clear\", \"Clear\");\nparser.addArgument(\"first-day\", 0);\n\nexport default Base.extend({\n    name: \"datetime-picker\",\n    trigger: \".pat-datetime-picker\",\n    parser: parser,\n    el_date: null,\n    el_time: null,\n\n    async init() {\n        const el = this.el;\n        this.options = parser.parse(this.el, this.options);\n\n        if (utils.checkInputSupport(\"datetime-local\", \"invalid date\")) {\n            return;\n        }\n\n        if (window.__patternslib_import_styles) {\n            import(\"./_datetime-picker.scss\");\n        }\n        const DatePicker = (await import(\"../date-picker/date-picker\")).default;\n\n        const value = this.el.value.split(\"T\");\n        const date_value = value[0] || \"\";\n        const time_value = value[1] || \"\";\n\n        const el_wrapper = document.createElement(\"div\");\n        el_wrapper.setAttribute(\"class\", \"pat-datetime-picker__wrapper\");\n\n        dom.hide(el);\n\n        // let the buttons be of type button otherwise they are submit buttons\n        const html_btn_now = `\n            <button type=\"button\" class=\"_btn _now\" title=\"${this.options.today}\">\n                <span class=\"_icon\"/>\n                <span class=\"_text\">${this.options.today}</span>\n            </button>`;\n        const html_btn_clear = `\n            <button type=\"button\" class=\"_btn _clear\" title=\"${this.options.clear}\">\n                <span class=\"_icon\"/>\n                <span class=\"_text\">${this.options.clear}</span>\n            </button>`;\n\n        el_wrapper.innerHTML = `\n            <input type=\"date\" placeholder=\"YYYY-MM-DD\" value=\"${date_value}\" />\n            <input type=\"time\" placeholder=\"hh:mm\" value=\"${time_value}\" />\n            ${this.options.today ? html_btn_now : \"\"}\n            ${this.options.clear ? html_btn_clear : \"\"}\n        `;\n\n        this.el_time = el_wrapper.querySelector(\"input[type=time]\");\n        this.el_time.addEventListener(\"change\", () => this.update());\n\n        this.el_date = el_wrapper.querySelector(\"input[type=date]\");\n        this.el_date.addEventListener(\"change\", () => {\n            if (!this.el_time.value) {\n                // Set time on date change, if time was empty.\n                this.el_time.value = this.isotime();\n            }\n            this.update();\n        });\n\n        const date_options = {\n            behavior: \"native\",\n            format: this.options.format,\n            weekNumbers: this.options.weekNumbers,\n            firstDay: this.options.firstDay,\n        };\n        await DatePicker.init(this.el_date, date_options);\n\n        if (this.options.today) {\n            const btn_now = el_wrapper.querySelector(\"._btn._now\");\n            btn_now.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                this.el_date.value = this.isodate();\n                this.el_time.value = this.isotime();\n                this.update();\n            });\n        }\n\n        if (this.options.clear) {\n            const btn_clear = el_wrapper.querySelector(\"._btn._clear\");\n            btn_clear.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                this.el_date.value = \"\";\n                this.el_time.value = \"\";\n                this.update();\n            });\n        }\n\n        // TODO: timezone\n        el.parentNode.insertBefore(el_wrapper, el);\n    },\n\n    update() {\n        if (this.el_date.value && this.el_time.value) {\n            this.el.value = `${this.el_date.value}T${this.el_time.value}`;\n        } else {\n            this.el.value = \"\";\n        }\n        this.el.dispatchEvent(new Event(\"change\", { bubbles: true, cancelable: true }));\n    },\n\n    isodate() {\n        const now = new Date();\n        return now.toISOString().substr(0, 10);\n    },\n\n    isotime() {\n        const now = new Date();\n        return now.toTimeString().substr(0, 5);\n    },\n});\n","// Patterns validate - Form vlidation\nimport \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport { BasePattern } from \"../../core/basepattern\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport logging from \"../../core/logging\";\nimport utils from \"../../core/utils\";\nimport registry from \"../../core/registry\";\n\nconst logger = logging.getLogger(\"pat-validation\");\n//logger.setLevel(logging.Level.DEBUG);\n\nexport const parser = new Parser(\"validation\");\nparser.addArgument(\"disable-selector\", \"[type=submit], button:not([type=button])\"); // Elements which must be disabled if there are errors\nparser.addArgument(\"message-date\", \"\"); // \"This value must be a valid date\");\nparser.addArgument(\"message-datetime\", \"\"); // \"This value must be a valid date and time\");\nparser.addArgument(\"message-email\", \"\"); // \"This value must be a valid email address\");\nparser.addArgument(\"message-max\", \"\"); // \"This value must be less than or equal to %{count}\");\nparser.addArgument(\"message-min\", \"\"); // \"This value must be greater than or equal to %{count}\"); // prettier-ignore\nparser.addArgument(\"message-number\", \"\"); // \"This value must be a number\");\nparser.addArgument(\"message-required\", \"\"); // \"This field is required\");\nparser.addArgument(\"message-equality\", \"is not equal to %{attribute}.\");\nparser.addArgument(\"not-after\", null);\nparser.addArgument(\"not-before\", null);\nparser.addArgument(\"equality\", null);\nparser.addArgument(\"delay\", 100); // Delay before validation is done to avoid validating while typing.\n\n// BBB\n// TODO: deprecated. Will be removed with next major version.\nparser.addAlias(\"message-integer\", \"message-number\");\nparser.addArgument(\"error-template\");\n\nconst KEY_ERROR_EL = \"__patternslib__input__error__el\";\nconst KEY_ERROR_MSG = \"__patternslib__input__error__msg\";\n\nclass Pattern extends BasePattern {\n    static name = \"validation\";\n    static trigger = \"form.pat-validation\";\n    static parser = parser;\n\n    init() {\n        events.add_event_listener(\n            this.el,\n            \"submit\",\n            `pat-validation--submit--validator`,\n            (e) => {\n                // On submit, check all.\n                // Immediate, non-debounced check with submit. Otherwise submit\n                // is not cancelable.\n                for (const input of this.inputs) {\n                    logger.debug(\"Checking input for submit\", input, e);\n                    this.check_input({ input: input, event: e });\n                }\n            },\n            // Make sure this event handler is run early, in the capturing\n            // phase in order to be able to cancel later non-capturing submit\n            // events.\n            { capture: true }\n        );\n\n        this.initialize_inputs();\n        $(this.el).on(\"pat-update\", () => {\n            this.initialize_inputs();\n        });\n\n        // Set ``novalidate`` attribute to disable the browser's validation\n        // bubbles but not disable the validation API.\n        this.el.setAttribute(\"novalidate\", \"\");\n    }\n\n    initialize_inputs() {\n        this.inputs = [\n            ...this.el.querySelectorAll(\"input[name], select[name], textarea[name]\"),\n        ];\n        this.disabled_elements = [\n            ...this.el.querySelectorAll(this.options.disableSelector),\n        ];\n\n        for (const [cnt, input] of this.inputs.entries()) {\n            // Cancelable debouncer.\n            const debouncer = utils.debounce((e) => {\n                logger.debug(\"Checking input for event\", input, e);\n                this.check_input({ input: input, event: e });\n            }, this.options.delay);\n\n            events.add_event_listener(\n                input,\n                \"input\",\n                `pat-validation--input-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n            events.add_event_listener(\n                input,\n                \"change\",\n                `pat-validation--change-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n            events.add_event_listener(\n                input,\n                \"blur\",\n                `pat-validation--blur-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n        }\n    }\n\n    check_input({ input, event, stop = false }) {\n        if (input.disabled) {\n            // No need to check disabled inputs.\n            return;\n        }\n\n        // In any case, clear the custom validity first.\n        this.set_validity({ input: input, msg: \"\" });\n        const validity_state = input.validity;\n\n        if (event?.submitter?.hasAttribute(\"formnovalidate\")) {\n            // Do not check when a button with ``formnovalidate`` was used.\n            return;\n        }\n\n        logger.debug(`\n            validity_state.badInput ${validity_state.badInput}\n            validity_state.customError ${validity_state.customError}\n            validity_state.patternMismatch ${validity_state.patternMismatch}\n            validity_state.rangeOverflow ${validity_state.rangeOverflow}\n            validity_state.rangeUnderflow ${validity_state.rangeUnderflow}\n            validity_state.stepMismatch ${validity_state.stepMismatch}\n            validity_state.tooLong ${validity_state.tooLong}\n            validity_state.tooShort ${validity_state.tooShort}\n            validity_state.typeMismatch ${validity_state.typeMismatch}\n            validity_state.valid ${validity_state.valid}\n            validity_state.valueMissing ${validity_state.valueMissing}\n        `);\n\n        const input_options = parser.parse(input);\n\n        if (validity_state.valid) {\n            // Custom error cases or no invalid state.\n\n            if (\n                input_options.equality &&\n                this.el.querySelector(`[name=${input_options.equality}]`)?.value !==\n                    input.value\n            ) {\n                const message =\n                    input_options.message.equality ||\n                    `The value is not equal to %{attribute}`;\n                this.set_validity({\n                    input: input,\n                    msg: message,\n                    attribute: input_options.equality,\n                });\n            } else if (input_options.not.after || input_options.not.before) {\n                const msg = input_options.message.date || input_options.message.datetime;\n                const msg_default_not_before = \"The date must be after %{attribute}\";\n                const msg_default_not_after = \"The date must be before %{attribute}\";\n\n                let not_after;\n                let not_after_el;\n                if (input_options.not.after) {\n                    if (utils.is_iso_date_time(input_options.not.after, true)) {\n                        not_after = new Date(input_options.not.after);\n                    } else {\n                        // Handle value as selector\n                        not_after_el = document.querySelector(input_options.not.after);\n                        not_after = not_after_el?.value\n                            ? new Date(not_after_el?.value)\n                            : undefined;\n                    }\n\n                    // Use null if no valid date.\n                    not_after = isNaN(not_after) ? null : not_after;\n                }\n\n                let not_before;\n                let not_before_el;\n                if (input_options.not.before) {\n                    if (utils.is_iso_date_time(input_options.not.before, true)) {\n                        not_before = new Date(input_options.not.before);\n                    } else {\n                        // Handle value as selector\n                        not_before_el = document.querySelector(input_options.not.before);\n                        not_before = not_before_el?.value\n                            ? new Date(not_before_el?.value)\n                            : undefined;\n                    }\n\n                    // Use null if no valid date.\n                    not_before = isNaN(not_before) ? null : not_before;\n                }\n\n                if (\n                    input.value &&\n                    utils.is_iso_date_time(input.value, true) &&\n                    !isNaN(new Date(input.value))\n                ) {\n                    // That's 1 valid date!\n                    const date = new Date(input.value);\n\n                    if (not_after && date > not_after) {\n                        let msg_attr;\n                        // Try to construct a meaningfull error message\n                        if (!not_after_el && input_options.not.after) {\n                            // fixed date case\n                            msg_attr = input_options.not.after;\n                        } else {\n                            // Get the label + other text content within the\n                            // label and replace all whitespace and newlines\n                            // with a single space.\n                            msg_attr = not_after_el?.labels?.[0]?.textContent.replace(\n                                /\\s\\s+/g, // replace all whitespace\n                                \" \" // with a single space\n                            );\n                            msg_attr = msg_attr || not_after_el.name;\n                        }\n                        this.set_validity({\n                            input: input,\n                            msg: msg || msg_default_not_after,\n                            attribute: msg_attr.trim(),\n                        });\n                    } else if (not_before && date < not_before) {\n                        let msg_attr;\n                        // Try to construct a meaningfull error message\n                        if (!not_before_el && input_options.not.before) {\n                            // fixed date case\n                            msg_attr = input_options.not.before;\n                        } else {\n                            // Get the label + other text content within the\n                            // label and replace all whitespace and newlines\n                            // with a single space.\n                            msg_attr = not_before_el?.labels?.[0]?.textContent.replace(\n                                /\\s\\s+/g, // replace all whitespace\n                                \" \" // with a single space\n                            );\n                            msg_attr = msg_attr || not_before_el.name;\n                        }\n                        this.set_validity({\n                            input: input,\n                            msg: msg || msg_default_not_before,\n                            attribute: msg_attr.trim(),\n                        });\n                    }\n                }\n\n                // always check the other input to clear/set errors\n                // do not re-check when stop is set to avoid infinite loops\n                if (!stop && not_after_el) {\n                    logger.debug(\"Check `not-after` input.\", not_after_el);\n                    this.check_input({ input: not_after_el, stop: true });\n                }\n                if (!stop && not_before_el) {\n                    logger.debug(\"Check `no-before` input.\", not_after_el);\n                    this.check_input({ input: not_before_el, stop: true });\n                }\n            }\n\n            if (!validity_state.customError) {\n                // No error to handle. Return.\n                this.remove_error(input, true);\n                return;\n            }\n        } else {\n            // Default error cases with custom messages.\n\n            if (validity_state.valueMissing && input_options.message.required) {\n                this.set_validity({ input: input, msg: input_options.message.required });\n            } else if (validity_state.rangeUnderflow && input_options.message.min) {\n                this.set_validity({\n                    input: input,\n                    msg: input_options.message.min,\n                    min: input.getAttribute(\"min\"),\n                });\n            } else if (validity_state.rangeOverflow && input_options.message.max) {\n                this.set_validity({\n                    input: input,\n                    msg: input_options.message.max,\n                    max: input.getAttribute(\"max\"),\n                });\n            } else if (\n                (validity_state.badInput || validity_state.stepMismatch) &&\n                input.type === \"number\" &&\n                input_options.message.number\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.number });\n            } else if (\n                validity_state.typeMismatch &&\n                input.type === \"email\" &&\n                input_options.message.email\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.email });\n            } else if (\n                validity_state.rangeUnderflow &&\n                input.type === \"date\" &&\n                input_options.message.date\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.date });\n            } else if (\n                validity_state.rangeOverflow &&\n                input.type === \"date\" &&\n                input_options.message.date\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.date });\n            } else if (\n                validity_state.rangeUnderflow &&\n                input.type === \"datetime\" &&\n                input_options.message.datetime\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.datetime });\n            } else if (\n                validity_state.rangeOverflow &&\n                input.type === \"datetime\" &&\n                input_options.message.datetime\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.datetime });\n            }\n        }\n\n        if (event?.type === \"submit\") {\n            // Do not submit in error case and prevent other handlers to take action.\n            event.preventDefault();\n            event.stopPropagation();\n            event.stopImmediatePropagation();\n        }\n        this.set_error_message(input);\n    }\n\n    set_validity({ input, msg, attribute = null, min = null, max = null }) {\n        // Replace some variables, as like validate.js\n        if (attribute) {\n            msg = msg.replace(/%{attribute}/g, attribute);\n        }\n        if (min) {\n            msg = msg.replace(/%{count}/g, min);\n        }\n        if (max) {\n            msg = msg.replace(/%{count}/g, max);\n        }\n        msg = msg.replace(/%{value}/g, JSON.stringify(input.value));\n\n        input.setCustomValidity(msg);\n        // Store the error message on the input.\n        // Hidden inputs do not participate in validation but we need this\n        // (e.g. styled date input).\n        input[KEY_ERROR_MSG] = msg;\n    }\n\n    remove_error(input, all_of_group = false) {\n        // Remove error message and related referencesfrom input.\n\n        let inputs = [input];\n        if (all_of_group) {\n            // Get all inputs with the same name - e.g. radio buttons, checkboxes.\n            inputs = this.inputs.filter((it) => it.name === input.name);\n        }\n        for (const it of inputs) {\n            const error_node = it[KEY_ERROR_EL];\n            it[KEY_ERROR_EL] = null;\n            error_node?.remove();\n        }\n\n        // disable selector\n        if (this.el.checkValidity()) {\n            for (const it of this.disabled_elements) {\n                if (it.disabled) {\n                    it.removeAttribute(\"disabled\");\n                    it.classList.remove(\"disabled\");\n                }\n            }\n        }\n    }\n\n    set_error_message(input) {\n        this.remove_error(input);\n\n        // Do not set a error message for a input group like radio buttons or\n        // checkboxes where one has already been set.\n        const inputs = this.inputs.filter((it) => it.name === input.name);\n        if (inputs.length > 1 && inputs.some((it) => !!it[KEY_ERROR_EL])) {\n            // error message for input group already set.\n            return;\n        }\n\n        // Create the validation error DOM node from the template\n        const validation_message = input.validationMessage || input[KEY_ERROR_MSG];\n        const error_node = dom.create_from_string(\n            this.error_template(validation_message)\n        ).firstChild;\n\n        let fieldset;\n        if (input.type === \"radio\" || input.type === \"checkbox\") {\n            fieldset = input.closest(\"fieldset.pat-checklist\");\n        }\n        if (fieldset) {\n            fieldset.append(error_node);\n        } else {\n            input.after(error_node);\n        }\n        input[KEY_ERROR_EL] = error_node;\n\n        let did_disable = false;\n        for (const it of this.disabled_elements) {\n            // Disable for melements if they are not already disabled and which\n            // do not have set the `formnovalidate` attribute, e.g.\n            // `<button formnovalidate>cancel</button>`.\n            if (!it.disabled && !it.formNoValidate) {\n                did_disable = true;\n                it.setAttribute(\"disabled\", \"disabled\");\n                it.classList.add(\"disabled\");\n                logger.debug(\"Disable element\", it);\n            }\n        }\n\n        // Do an initial check of the whole form when a form element (e.g. the\n        // submit button) was disabled. We want to show the user all possible\n        // errors at once and after the submit button is disabled there is no\n        // way to check the whole form at once. ... well we also do not want to\n        // check the whole form when one input was changed....\n        if (did_disable) {\n            logger.debug(\"Checking whole form after element was disabled.\");\n            for (const _input of this.inputs.filter((it) => it !== input)) {\n                this.check_input({ input: _input, stop: true });\n            }\n        }\n    }\n\n    error_template(message) {\n        // Template for the validation message\n        return `<em class=\"validation warning message\">${message}</em>`;\n    }\n}\n\nregistry.register(Pattern);\n\nexport default Pattern;\nexport { Pattern };\n","import { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport events from \"@patternslib/patternslib/src/core/events\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\nexport const parser = new Parser(\"code-editor\");\nparser.addArgument(\"language\", null); // programming language to use.\nparser.addArgument(\"linenumbers\", false);\nparser.addArgument(\"theme\", \"dark\"); // dark or light or any other theme variant.\n\n// CodeJar options\nparser.addArgument(\"tab\", \"    \"); // The tab-string. \"\\t\" for real tabs.\nparser.addArgument(\"indent-on\", \"{$\");\nparser.addArgument(\"spellcheck\", false);\nparser.addArgument(\"catch-tab\", true);\nparser.addArgument(\"preserve-ident\", true);\nparser.addArgument(\"add-closing\", true);\nparser.addArgument(\"history\", true);\n\nconst language_mapping = {\n    atom: \"xml\",\n    html: \"xml\",\n    plist: \"xml\",\n    rss: \"xml\",\n    svg: \"xml\",\n    wsf: \"xml\",\n    xhtml: \"xml\",\n    xjb: \"xml\",\n    xsd: \"xml\",\n    xsl: \"xml\",\n};\n\nclass Pattern extends BasePattern {\n    static name = \"code-editor\";\n    static trigger = \".pat-code-editor\";\n    static parser = parser;\n\n    async init() {\n        const CodeJar = (await import(\"codejar\")).CodeJar;\n        const hljs = (await import(\"highlight.js/lib/core\")).default;\n        let el = this.el;\n\n        // Set and load the theme.\n        let theme;\n        if (this.options.theme === \"light\") {\n            theme = \"stackoverflow-light\";\n        } else if (this.options.theme === \"dark\" || this.options.theme === \"okaidia\") {\n            theme = \"stackoverflow-dark\";\n        } else {\n            theme = this.options.theme;\n        }\n\n        // Need to await the style import, otherwise theme might not be applied.\n        await import(`highlight.js/styles/${theme}.css`);\n        if (window.__patternslib_import_styles) {\n            await import(\"./_code-editor.scss\");\n        }\n\n        // Custom hightlighting function, as of:\n        // https://github.com/antonmedv/codejar/blob/master/index.html\n        const highlight = (editor) => {\n            // highlight.js does not trim old tags,\n            // let's do it by this hack.\n            editor.textContent = editor.textContent;\n            hljs.highlightElement(editor);\n        };\n        let highlight_wrapper = highlight;\n\n        // Optional line numbers.\n        if (this.options.linenumbers) {\n            const linenumbers = (await import(\"codejar/linenumbers\")).withLineNumbers;\n            highlight_wrapper = linenumbers(highlight, {\n                class: `codejar-linenumbers ${theme}`,\n            });\n        }\n\n        // Import and register the language.\n        let language = [...el.classList].filter((it) => it.startsWith(\"language-\"))[0];\n        language = language ? language.replace(\"language-\", \"\") : this.options.language;\n        language = language || \"plaintext\";\n        const hljs_language = (\n            await import(\n                `highlight.js/lib/languages/${language_mapping[language] || language}`\n            )\n        ).default;\n        hljs.registerLanguage(language, hljs_language);\n\n        // Create a editor element in case of an input element.\n        if ([\"textarea\", \"input\"].includes(this.el.nodeName.toLowerCase())) {\n            const pre_el = document.createElement(\"pre\");\n            pre_el.innerHTML = `<code contenteditable></code>`;\n            el = pre_el.querySelector(\"code\");\n            el.textContent = this.el.value; // value is already unescaped.\n            this.el.parentNode.insertBefore(pre_el, this.el);\n            this.el.setAttribute(\"hidden\", \"\");\n        }\n\n        // Add some classes to the editor element.\n        el.classList.add(\n            \"code-editor\",\n            `theme-${this.options.theme}`,\n            `language-${language}`\n        );\n\n        // Allow spaces within quotes to be added as tab argument.\n        // Replace escaped tab character with real tab.\n        const tab = this.options.tab\n            .replace(/'/g, \"\") // Allow spaces within quotes\n            .replace(/\"/g, \"\")\n            .replace(/\\\\t/g, \"\\t\"); // Replace double escaped tab character\n\n        // Create the editor.\n        const config = {\n            tab: tab,\n            indentOn: new RegExp(this.options.indentOn),\n            spellcheck: this.options.spellcheck,\n            catchTab: this.options.catchTab,\n            preserveIdent: this.options.preserveIdent,\n            addClosing: this.options.addClosing,\n            history: this.options.history,\n        };\n        this.codeeditor = CodeJar(el, highlight_wrapper, config);\n\n        // Update the input element.\n        if (el !== this.el) {\n            // Update <textarea> or <input>, if one of these were the\n            // initializing elements.\n            this.codeeditor.onUpdate((code) => {\n                this.el.value = code.trim();\n                this.el.dispatchEvent(events.input_event());\n            });\n        }\n    }\n}\n\nregistry.register(Pattern);\n\nexport default Pattern;\nexport { Pattern };\n","/**\n * Patterns ajax - AJAX injection for forms and anchors\n *\n * Copyright 2012-2013 Florian Friesdorf\n * Copyright 2012-2013 Marko Durkovic\n */\nimport \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport registry from \"../../core/registry\";\n\nconst log = logging.getLogger(\"pat.ajax\");\n\nexport const parser = new Parser(\"ajax\");\nparser.addArgument(\"accept\", \"text/html\");\nparser.addArgument(\"url\", function ($el) {\n    const el = $el[0];\n    const value =\n        el.tagName === \"A\"\n            ? el.getAttribute(\"href\")\n            : el.tagName === \"FORM\"\n            ? el.getAttribute(\"action\")\n            : \"\";\n    return (value || \"\").split(\"#\")[0];\n});\nparser.addArgument(\"browser-cache\", \"no-cache\", [\"cache\", \"no-cache\"]); // Cache ajax requests\n\nconst xhrCount = {};\nxhrCount.get = function (a) {\n    return this[a] !== undefined ? this[a] : 0;\n};\nxhrCount.inc = function (a) {\n    this[a] = this.get(a) + 1;\n    return this.get(a);\n};\n\nconst _ = {\n    name: \"ajax\",\n    trigger: \".pat-ajax\",\n    parser: parser,\n\n    init($el) {\n        $el.off(\".pat-ajax\");\n        $el.filter(\"a\").on(\"click.pat-ajax\", _.onTriggerEvents);\n        $el.filter(\"form\")\n            .on(\"submit.pat-ajax\", _.onTriggerEvents)\n            .on(\"click.pat-ajax\", \"[type=submit]\", _.onClickSubmit);\n        $el.filter(\":not(form,a)\").each(function () {\n            log.warn(\"Unsupported element:\", this);\n        });\n        return $el;\n    },\n\n    destroy($el) {\n        $el.off(\".pat-ajax\");\n    },\n\n    onClickSubmit(event) {\n        const el = event.submitter || event.target;\n        const form = el.form;\n        const data = {};\n        if (el.name) {\n            data[el.name] = el.value;\n        }\n        $(form).data(\"pat-ajax.clicked-data\", data);\n    },\n\n    onTriggerEvents(event) {\n        if (event) {\n            event.preventDefault();\n        }\n        _.request($(this));\n    },\n\n    request($el, opts) {\n        return $el.each(function () {\n            _._request($(this), opts);\n        });\n    },\n\n    _request($el, opts) {\n        const cfg = _.parser.parse($el, opts);\n        const onError = function (jqxhr, status, error) {\n            // error can also stem from a javascript\n            // exception, not only errors described in the\n            // jqxhr.\n            log.error(\"load error for \" + cfg.url + \":\", error, jqxhr);\n            $el.trigger({\n                type: \"pat-ajax-error\",\n                jqxhr: jqxhr,\n            });\n        };\n        const seqNumber = xhrCount.inc(cfg.url);\n        const onSuccess = function (data, status, jqxhr) {\n            log.debug(\"success: jqxhr:\", jqxhr);\n            if (seqNumber === xhrCount.get(cfg.url)) {\n                // if this url is requested multiple time, only return the last result\n                $el.trigger({\n                    type: \"pat-ajax-success\",\n                    jqxhr: jqxhr,\n                });\n            } else {\n                // ignore\n            }\n        };\n        const temp = $el.data(\"pat-ajax.clicked-data\");\n        const clickedData = temp ? $.param(temp) : \"\";\n        const args = {\n            context: $el,\n            data: [$el.serialize(), clickedData].filter(Boolean).join(\"&\"),\n            headers: {},\n            url: cfg.url,\n            method: $el.attr(\"method\") ? $el.attr(\"method\") : \"GET\",\n            cache: cfg.browserCache === \"cache\" ? true : false,\n        };\n\n        if (cfg.accept) {\n            args.headers.Accept = cfg.accept;\n        }\n\n        if (\n            $el.is(\"form\") &&\n            $el.attr(\"method\") &&\n            $el.attr(\"method\").toUpperCase() == \"POST\"\n        ) {\n            const formdata = new FormData($el[0]);\n            for (const key in temp) {\n                formdata.append(key, temp[key]);\n            }\n            args[\"method\"] = \"POST\";\n            args[\"data\"] = formdata;\n            args[\"cache\"] = false;\n            args[\"contentType\"] = false;\n            args[\"processData\"] = false;\n            args[\"type\"] = \"POST\";\n        }\n\n        $el.removeData(\"pat-ajax.clicked-data\");\n        log.debug(\"request:\", args, $el[0]);\n\n        // Make it happen\n        const ajax_deferred = $.ajax(args);\n\n        if (ajax_deferred) ajax_deferred.done(onSuccess).fail(onError);\n    },\n};\n\nregistry.register(_);\n\nexport default _;\n","import \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport ajax from \"../ajax/ajax\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport registry from \"../../core/registry\";\nimport create_uuid from \"../../core/uuid\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"pat.inject\");\n//log.setLevel(logging.Level.DEBUG);\n\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\n\nexport const parser = new Parser(\"inject\");\nparser.addArgument(\"default-selector\");\nparser.addArgument(\"target\");\nparser.addArgument(\"data-type\", \"html\");\nparser.addArgument(\"next-href\");\nparser.addArgument(\"source\");\nparser.addArgument(\"trigger\", \"default\", [\n    \"default\",\n    \"autoload\",\n    \"autoload-visible\",\n    \"idle\",\n]);\nparser.addArgument(\"delay\"); // only used in autoload\nparser.addArgument(\"browser-cache\", \"no-cache\", [\"cache\", \"no-cache\"]); // Cache ajax requests. Pass to pat-ajax.\nparser.addArgument(\"confirm\", \"class\", [\"never\", \"always\", \"form-data\", \"class\"]);\nparser.addArgument(\"confirm-message\", \"Are you sure you want to leave this page?\");\nparser.addArgument(\"loading-class\", \"injecting\"); // Add a class to the target while content is still loading.\nparser.addArgument(\"executing-class\", \"executing\"); // Add a class to the element while content is still loading.\nparser.addArgument(\"executed-class\", \"executed\"); // Add a class to the element when content is loaded.\nparser.addArgument(\"class\"); // Add a class to the injected content.\nparser.addArgument(\"history\", \"none\", [\"none\", \"record\"]);\nparser.addArgument(\"push-marker\");\nparser.addArgument(\"scroll\");\n\n// Note: this should not be here but the parser would bail on unknown\n// parameters and expand/collapsible need to pass the url to us.\nparser.addArgument(\"url\");\n\nconst inject = {\n    name: \"inject\",\n    trigger: \"a.pat-inject, form.pat-inject, .pat-subform.pat-inject\",\n    parser: parser,\n\n    async init($el, opts) {\n        // We need to wait a tick. Modern BasePattern based patterns like\n        // pat-validation do always wait a tick before initializing. The\n        // patterns registry always initializes pat-validation first but since\n        // it is waiting a tick the event handlers are registerd after the ones\n        // from pat-inject. Waiting a tick in pat-inject solves this -\n        // pat-validation's event handlers are initialized first.\n        await utils.timeout(1);\n\n        const el = utils.jqToNode($el);\n\n        const cfgs = this.extractConfig($el, opts);\n        if (cfgs.some((e) => e.history === \"record\") && !(\"pushState\" in history)) {\n            // if the injection shall add a history entry and HTML5 pushState\n            // is missing, then don't initialize the injection.\n            log.warn(\"HTML5 pushState is missing, aborting\");\n            return $el;\n        }\n        $el.data(\"pat-inject\", cfgs);\n\n        if (cfgs[0].nextHref && cfgs[0].nextHref.indexOf(\"#\") === 0) {\n            // In case the next href is an anchor, and it already\n            // exists in the page, we do not activate the injection\n            // but instead just change the anchors href.\n\n            // Note: This is used in only one project for linked fullcalendars,\n            // it's sanity is wonky and we should probably solve it differently.\n            if (el.nodeName === \"A\" && $(cfgs[0].nextHref).length > 0) {\n                log.debug(\n                    \"Skipping as next href is anchor, which already exists\",\n                    cfgs[0].nextHref\n                );\n                // TODO: reconsider how the injection enters exhausted state\n                el.setAttribute(\n                    \"href\",\n                    (window.location.href.split(\"#\")[0] || \"\") + cfgs[0].nextHref\n                );\n                return $el;\n            }\n        }\n        if (cfgs[0].pushMarker) {\n            $(\"body\").on(\"push\", (event, data) => {\n                log.debug(\"received push message: \" + data);\n                if (data == cfgs[0].pushMarker) {\n                    log.debug(\"re-injecting \" + data);\n                    this.onTrigger({ currentTarget: el });\n                }\n            });\n        }\n        if (cfgs[0].idleTrigger) {\n            this._initIdleTrigger($el, cfgs[0].idleTrigger);\n        } else {\n            switch (cfgs[0].trigger) {\n                case \"default\":\n                    for (const cfg of cfgs) {\n                        if (cfg.delay) {\n                            cfg.processDelay = cfg.delay;\n                        }\n                    }\n                    // setup event handlers\n                    if (el?.nodeName === \"FORM\") {\n                        log.debug(\"Initializing form with injection on\", el);\n                        events.add_event_listener(\n                            el,\n                            \"submit\",\n                            \"pat-inject--form-submit\",\n                            (e) => {\n                                if (\n                                    e.submitter?.matches(\n                                        \"[type=submit], button:not([type=button]), [type=image]\"\n                                    )\n                                ) {\n                                    // make sure the submitting button is sent\n                                    // with the form\n                                    ajax.onClickSubmit(e);\n                                }\n                                this.onTrigger(e);\n                            }\n                        );\n                    } else if (el?.matches(\".pat-subform\")) {\n                        log.debug(\"Initializing subform with injection\");\n                    } else {\n                        $el.on(\"click.pat-inject\", this.onTrigger.bind(this));\n                    }\n                    break;\n                case \"autoload\":\n                    if (!cfgs[0].delay) {\n                        this.onTrigger({ currentTarget: el });\n                    } else {\n                        // generate UUID\n                        const uuid = create_uuid();\n                        el.setAttribute(\"data-pat-inject-uuid\", uuid);\n\n                        // function to trigger the autoload and mark as triggered\n                        const delayed_trigger = (uuid_) => {\n                            // Check if the element has been removed from the dom\n                            const still_there = document.querySelector(\n                                `[data-pat-inject-uuid=\"${uuid_}\"]`\n                            );\n                            if (!still_there) {\n                                return false;\n                            }\n\n                            $el.data(\"pat-inject-autoloaded\", true);\n                            this.onTrigger({ currentTarget: el });\n                            // Cleanup again.\n                            still_there.removeAttribute(\"data-pat-inject-uuid\");\n                            return true;\n                        };\n                        window.setTimeout(\n                            delayed_trigger.bind(null, uuid),\n                            cfgs[0].delay\n                        );\n                    }\n                    break;\n                case \"autoload-visible\":\n                    this._initAutoloadVisible($el, cfgs);\n                    break;\n                case \"idle\":\n                    this._initIdleTrigger($el, cfgs[0].delay);\n                    break;\n            }\n        }\n\n        log.debug(\"initialised:\", el);\n        return $el;\n    },\n\n    destroy($el) {\n        $el.off(\".pat-inject\");\n        $el.data(\"pat-inject\", null);\n        return $el;\n    },\n\n    onTrigger(e) {\n        /* Injection has been triggered, either via form submission or a\n         * link has been clicked.\n         */\n\n        // Prevent the original event from doing it's work.\n        // We want an AJAX request instead.\n        e.preventDefault && e.preventDefault();\n\n        const el = e.currentTarget;\n        const $el = $(el);\n        let cfgs = $el.data(\"pat-inject\");\n        if (el.nodeName === \"FORM\" && e.type === \"submit\") {\n            const form = el;\n            const submitter = e.submitter;\n\n            // Do not submit invalid forms, if validation is active.\n            // Works with native form validation and with pat-validation.\n            if (\n                !submitter?.matches(\"[formnovalidate]\") &&\n                !form.matches(\"[novalidate]\") &&\n                form.matches(\":invalid\")\n            ) {\n                log.debug(\"Form is invalid, aborting\");\n                return;\n            }\n\n            const formaction = submitter?.getAttribute(\"formaction\");\n            if (formaction) {\n                const opts = {\n                    url: formaction,\n                };\n\n                // Support custom data-pat-inject on formaction buttons.\n                const cfg_node = submitter.closest(\"[data-pat-inject]\");\n                cfgs = this.extractConfig($(cfg_node), opts);\n            }\n\n            // store the params of the form in the config, to be used by history\n            for (const cfg of cfgs) {\n                cfg.params = $.param($el.serializeArray());\n            }\n        }\n\n        $el.trigger(\"patterns-inject-triggered\");\n        this.execute(cfgs, $el);\n    },\n\n    submitSubform($sub) {\n        /* This method is called from pat-subform\n         */\n        const $el = $($sub[0].closest(\"form\"));\n        const cfgs = $sub.data(\"pat-inject\");\n\n        // store the params of the subform in the config, to be used by history\n        for (const cfg of cfgs) {\n            cfg.params = $.param($sub.serializeArray());\n        }\n\n        try {\n            $el.trigger(\"patterns-inject-triggered\");\n        } catch (e) {\n            log.error(\"patterns-inject-triggered\", e);\n        }\n        this.execute(cfgs, $el);\n    },\n\n    extractConfig($el, options = {}) {\n        const el = utils.jqToNode($el);\n        options = Object.assign({}, options); // copy\n\n        const cfgs = parser.parse($el, options, true);\n        for (const cfg of cfgs) {\n            cfg.$context = $el;\n            // options and cfg have priority, fall back to href/action\n            cfg.url =\n                options.url ||\n                cfg.url ||\n                el?.getAttribute(\"href\") ||\n                el?.getAttribute(\"action\") ||\n                el?.closest(\"form\")?.getAttribute(\"action\") ||\n                \"\";\n\n            // separate selector from url\n            const urlparts = cfg.url.split(\"#\");\n            cfg.url = urlparts[0];\n\n            if (urlparts.length > 2) {\n                log.warn(\"Ignoring additional source ids:\", urlparts.slice(2));\n            }\n\n            if (!cfg.defaultSelector) {\n                // if no selector, check for selector as part of original url\n                cfg.defaultSelector = (urlparts[1] && \"#\" + urlparts[1]) || \"body\";\n            }\n            if (cfg.delay) {\n                try {\n                    cfg.delay = utils.parseTime(cfg.delay);\n                } catch (e) {\n                    log.warn(\"Invalid delay value: \", cfg.delay);\n                    cfg.delay = null;\n                }\n            }\n            cfg.processDelay = 0;\n        }\n        return cfgs;\n    },\n\n    elementIsDirty(m) {\n        /* Check whether the passed in form element contains a value.\n         */\n        const data = $.map(m.find(\":input:not(select)\"), (i) => {\n            const val = $(i).val();\n            return Boolean(val) && val !== $(i).attr(\"placeholder\");\n        });\n        return $.inArray(true, data) !== -1;\n    },\n\n    askForConfirmation(cfgs) {\n        /* If configured to do so, show a confirmation dialog to the user.\n         * This is done before attempting to perform injection.\n         */\n        let should_confirm = false;\n        let message;\n\n        for (const cfg of cfgs) {\n            let _confirm = false;\n            if (cfg.confirm == \"always\") {\n                _confirm = true;\n            } else if (\n                cfg.confirm === \"form-data\" &&\n                cfg.target &&\n                cfg.target !== \"none\"\n            ) {\n                _confirm = this.elementIsDirty(cfg.$target);\n            } else if (cfg.confirm === \"class\" && cfg.target && cfg.target !== \"none\") {\n                _confirm = cfg.$target.hasClass(\"is-dirty\");\n            }\n            if (_confirm) {\n                should_confirm = true;\n                message = cfg.confirmMessage;\n            }\n        }\n        if (should_confirm) {\n            if (!window.confirm(message)) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    ensureTarget(cfg) {\n        /* Make sure that a target element exists and that it's assigned to\n         * cfg.$target.\n         */\n        // make sure target exist\n        if (cfg.target === \"none\") {\n            // special case, we don't want to inject anything\n            return true;\n        }\n        cfg.$target =\n            cfg.$target || (cfg.target === \"self\" ? cfg.$context : $(cfg.target));\n        if (cfg.$target.length === 0) {\n            if (!cfg.target) {\n                log.error(\"Need target selector\", cfg);\n                return false;\n            }\n            cfg.$target = this.createTarget(cfg.target);\n            cfg.$created_target = cfg.$target;\n        }\n        return true;\n    },\n\n    verifySingleConfig(url, cfg) {\n        /* Verify one of potentially multiple configs (i.e. argument lists).\n         *\n         * Extract modifiers such as ::element or ::after.\n         * Ensure that a target element exists.\n         */\n        if (cfg.url !== url) {\n            // in case of multi-injection, all injections need to use\n            // the same url\n            log.error(\"Unsupported different urls for multi-inject\");\n            return false;\n        }\n        // defaults\n        cfg.source = cfg.source || cfg.defaultSelector;\n        cfg.target = cfg.target || cfg.defaultSelector;\n\n        if (!this.extractModifiers(cfg)) {\n            return false;\n        }\n        if (!this.ensureTarget(cfg)) {\n            return false;\n        }\n        this.listenForFormReset(cfg);\n        return true;\n    },\n\n    verifyConfig(cfgs) {\n        /* Verify and post-process all the configurations.\n         * Each \"config\" is an arguments list separated by the &&\n         * combination operator.\n         *\n         * In case of multi-injection, only one URL is allowed, which\n         * should be specified in the first config (i.e. arguments list).\n         *\n         * Verification for each cfg in the array needs to succeed.\n         */\n        return cfgs.every((cfg) => this.verifySingleConfig(cfgs[0].url, cfg));\n    },\n\n    listenForFormReset(cfg) {\n        /* if pat-inject is used to populate target in some form and when\n         * Cancel button is pressed (this triggers reset event on the\n         * form) you would expect to populate with initial placeholder\n         */\n        if (cfg.target === \"none\") {\n            // Special case, we don't want to display any return value.\n            return;\n        }\n        const $form = cfg.$target.parents(\"form\");\n        if ($form.length !== 0 && cfg.$target.data(\"initial-value\") === undefined) {\n            cfg.$target.data(\"initial-value\", cfg.$target.html());\n            $form.on(\"reset\", () => {\n                cfg.$target.html(cfg.$target.data(\"initial-value\"));\n            });\n        }\n    },\n\n    extractModifiers(cfg) {\n        /* The user can add modifiers to the source and target arguments.\n         * Modifiers such as ::element, ::before and ::after.\n         * We identifiy and extract these modifiers here.\n         */\n        const source_re = /^(.*?)(::element)?$/;\n        const target_re = /^(.*?)(::element)?(::after|::before)?$/;\n        const source_match = source_re.exec(cfg.source);\n        const target_match = target_re.exec(cfg.target);\n\n        cfg.source = source_match[1];\n        cfg.sourceMod = source_match[2] ? \"element\" : \"content\";\n        cfg.target = target_match[1];\n        const targetMod = target_match[2] ? \"element\" : \"content\";\n        const targetPosition = (target_match[3] || \"::\").slice(2); // position relative to target\n\n        if (cfg.loadingClass) {\n            cfg.loadingClass += \" \" + cfg.loadingClass + \"-\" + targetMod;\n            if (targetPosition && cfg.loadingClass) {\n                cfg.loadingClass += \" \" + cfg.loadingClass + \"-\" + targetPosition;\n            }\n        }\n        cfg.action = targetMod + targetPosition;\n        // Once we start detecting illegal combinations, we'll\n        // return false in case of error\n        return true;\n    },\n\n    createTarget(selector) {\n        /* create a target that matches the selector\n         *\n         * Note: so far we only support #target and create a div with that id\n         * appended to the body.\n         */\n        if (selector.slice(0, 1) !== \"#\") {\n            log.error(\"only id supported for non-existing target\");\n            return null;\n        }\n        const $target = $(\"<div />\").attr({ id: selector.slice(1) });\n        $(\"body\").append($target);\n        return $target;\n    },\n\n    _performInjection(target, $el, $sources, cfg, trigger, $title) {\n        /* Called after the XHR has succeeded and we have a new $sources\n         * element to inject.\n         */\n        const wrapper = document.createElement(\"div\");\n        if ($sources.length > 0) {\n            const method = cfg.sourceMod === \"content\" ? \"innerHTML\" : \"outerHTML\";\n            // There might be multiple sources, so we need to loop over them.\n            // Access them with \"innerHTML\" or \"outerHTML\" depending on the sourceMod.\n            const sources_string = [...$sources].map(source => source[method]).join(\"\\n\");\n            wrapper.innerHTML = sources_string;\n\n            for (const img of wrapper.querySelectorAll(\"img\")) {\n                events.add_event_listener(\n                    img,\n                    \"load\",\n                    \"inject_img_load\",\n                    (e) => {\n                        $(e.currentTarget).trigger(\"pat-inject-content-loaded\");\n                    },\n                    { once: true }\n                );\n            }\n        }\n\n        // Copy, because after insertion wrapper.children is empty.\n        const source_nodes = [...wrapper.childNodes];\n\n        // Now the injection actually happens.\n        if (this._inject(trigger, source_nodes, target, cfg)) {\n            // Update history\n            this._update_history(cfg, trigger, $title);\n            // Post-injection\n            this._afterInjection($el, cfg.$created_target || $(source_nodes), cfg);\n        }\n    },\n\n    _update_history(cfg, trigger, $title) {\n        // History support. if subform is submitted, append form params\n        if (cfg.history !== \"record\" || !history?.pushState) {\n            return;\n        }\n        let url = cfg.url;\n        if (cfg.params) {\n            const glue = url.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n            url = `${url}${glue}${cfg.params}`;\n        }\n        history.pushState({ url: url }, \"\", url);\n        // Also inject title element if we have one\n        if ($title?.length) {\n            const title_el = document.querySelector(\"title\");\n            if (title_el) {\n                this._inject(trigger, $title, title_el, {\n                    action: \"element\",\n                });\n            }\n        }\n    },\n\n    _afterInjection($el, $injected, cfg) {\n        /* Set a class on the injected elements and fire the\n         * patterns-injected event.\n         */\n        const el = utils.jqToNode($el);\n        $injected\n            .filter((idx, el_) => {\n                return el_.nodeType !== TEXT_NODE;\n            })\n            .data(\"pat-injected\", { origin: cfg.url });\n\n        if ($injected.length === 1 && $injected[0].nodeType == TEXT_NODE) {\n            // Only one element injected, and it was a text node.\n            // So we trigger \"patterns-injected\" on the parent.\n            // The event handler should check whether the\n            // injected element and the triggered element are\n            // the same.\n            $injected.parent().trigger(\"patterns-injected\", [cfg, el, $injected[0]]);\n        } else {\n            $injected.each((idx, el_) => {\n                // patterns-injected event will be triggered for each injected (non-text) element.\n                if (el_.nodeType !== TEXT_NODE) {\n                    $(el_)\n                        .addClass(cfg[\"class\"])\n                        .trigger(\"patterns-injected\", [cfg, el, el_]);\n                }\n            });\n        }\n\n        if (cfg.scroll && cfg.scroll !== \"none\") {\n            // Get the scroll target for\n            // 1) finding the scroll container\n            // 2) getting the element to scroll to (if not \"top\")\n            const scroll_target = [\"top\", \"target\"].includes(cfg.scroll)\n                ? cfg.$target[0]\n                : dom.querySelectorAllAndMe($injected[0], cfg.scroll);\n\n            const scroll_container = dom.find_scroll_container(\n                scroll_target,\n                null,\n                window\n            );\n\n            if (cfg.scroll === \"top\") {\n                dom.scroll_to_top(scroll_container);\n            } else if (scroll_target) {\n                dom.scroll_to_element(scroll_target, scroll_container);\n            }\n        }\n\n        el.dispatchEvent(\n            new Event(\"pat-inject-success\", { bubbles: true, cancelable: true })\n        );\n    },\n\n    async _onInjectSuccess($el, cfgs, ev) {\n        let data = ev?.jqxhr?.responseText;\n        if (!data) {\n            log.warn(\"No response content, aborting\", ev);\n            return;\n        }\n        if (cfgs[0].source === \"none\") {\n            // Special case, we want to call something, but we don't want to inject anything\n            data = \"\";\n        }\n        const sources$ = await this.callTypeHandler(cfgs[0].dataType, \"sources\", $el, [\n            cfgs,\n            data,\n            ev,\n        ]);\n        /* pick the title source for dedicated handling later\n          Title - if present - is always appended at the end. */\n        let $title;\n        if (\n            sources$ &&\n            sources$[sources$.length - 1] &&\n            sources$[sources$.length - 1][0] &&\n            sources$[sources$.length - 1][0].nodeName === \"TITLE\"\n        ) {\n            $title = sources$[sources$.length - 1];\n        }\n        cfgs.forEach((cfg, idx1) => {\n            const perform_inject = () => {\n                if (cfg.target !== \"none\") {\n                    for (const target of cfg.$target) {\n                        this._performInjection(\n                            target,\n                            $el,\n                            sources$[idx1],\n                            cfg,\n                            ev.target,\n                            $title\n                        );\n                    }\n                }\n            };\n            if (cfg.processDelay) {\n                setTimeout(() => perform_inject(), cfg.processDelay);\n            } else {\n                perform_inject();\n            }\n        });\n        if (cfgs[0].nextHref && $el.is(\"a\")) {\n            // In case next-href is specified the anchor's href will\n            // be set to it after the injection is triggered.\n            $el.attr({ href: cfgs[0].nextHref.replace(/&amp;/g, \"&\") });\n            this.destroy($el);\n        }\n        $el.off(\"pat-ajax-success.pat-inject\");\n        $el.off(\"pat-ajax-error.pat-inject\");\n    },\n\n    async _onInjectError($el, cfgs, event) {\n        let explanation = \"\";\n        const status = event.jqxhr.status;\n        const timestamp = new Date();\n        if (status % 100 == 4) {\n            explanation =\n                \"Sorry! We couldn't find the page to load. Please make a screenshot and send it to support. Thank you!\";\n        } else if (status % 100 == 5) {\n            explanation =\n                \"I am very sorry! There was an error at the server. Please make a screenshot and contact support. Thank you!\";\n        } else if (status == 0) {\n            explanation =\n                \"It seems, the server is down. Please make a screenshot and contact support. Thank you!\";\n        }\n\n        let error_page;\n        let error_page_fragment;\n        const url_params = new URLSearchParams(window.location.search);\n        if (url_params.get(\"pat-inject-errorhandler.off\") === null) {\n            // Prepare a error page to be injected into the document.\n\n            // Try to get a suitable error message from pre-configured error pages.\n            const error_page_url = document\n                ?.querySelector(`meta[name^=pat-inject-status-${status}]`)\n                ?.getAttribute(\"content\", false);\n            error_page_fragment = error_page_url?.split(\"#\")[1];\n            error_page_fragment = error_page_fragment ? `#${error_page_fragment}` : null;\n\n            if (error_page_fragment) {\n                error_page = document.createElement(\"html\");\n                error_page.innerHTML = event.jqxhr.responseText;\n                error_page = error_page.querySelector(error_page_fragment);\n            }\n\n            if (!error_page && error_page_url) {\n                try {\n                    const error_page_response = await fetch(error_page_url, {\n                        method: \"GET\",\n                    });\n                    error_page = document.createElement(\"html\");\n                    error_page.innerHTML = await error_page_response.text();\n                    error_page = error_page.querySelector(error_page_fragment || \"body\");\n                } catch {\n                    // fall back to standard error message and ignore.\n                }\n            }\n        }\n\n        // clean up\n        for (const cfg of cfgs) {\n            if (\"$created_target\" in cfg) {\n                cfg.$created_target.remove();\n            }\n            cfg.$target.removeClass(cfg.loadingClass);\n            $el.removeClass(cfg.executingClass);\n        }\n        $el.off(\"pat-ajax-success.pat-inject\");\n        $el.off(\"pat-ajax-error.pat-inject\");\n\n        if (error_page) {\n            const error_zone = document.querySelector(error_page_fragment || \"body\");\n            error_zone.innerHTML = error_page.innerHTML;\n            registry.scan(error_zone); // initialize any patterns in error page\n        } else {\n            const msg_attr = `${explanation} Status is ${status} ${event.jqxhr.statusText}, time was ${timestamp}. You can click to close this.`;\n            $(\"body\").attr(\"data-error-message\", msg_attr);\n            $(\"body\").on(\"click\", () => {\n                $(\"body\").removeAttr(\"data-error-message\");\n                window.location.href = window.location.href; // reload\n            });\n        }\n    },\n\n    execute(cfgs, $el) {\n        /* Actually execute the injection.\n         *\n         * Either by making an ajax request or by spoofing an ajax\n         * request when the content is readily available in the current page.\n         */\n        const el = utils.jqToNode($el);\n        // get a kinda deep copy, we scribble on it\n        cfgs = cfgs.map((cfg) => $.extend({}, cfg));\n        if (!this.verifyConfig(cfgs)) {\n            return;\n        }\n        if (!this.askForConfirmation(cfgs)) {\n            return;\n        }\n        if ($el.data(\"pat-inject-triggered\")) {\n            // Prevent double triggers;\n            return;\n        }\n        $el.data(\"pat-inject-triggered\", true);\n\n        for (const cfg of cfgs) {\n            // Add a execute class on the pat-inject element.\n            if (cfg?.executingClass) {\n                el.classList.add(cfg.executingClass);\n            }\n            // Add a loading class to the target.\n            // Can be used for loading-spinners.\n            if (cfg?.loadingClass && cfg?.target !== \"none\") {\n                cfg.$target.addClass(cfg.loadingClass);\n            }\n        }\n\n        $el.on(\"pat-ajax-success.pat-inject\", async (e) => {\n            this._onInjectSuccess($el, cfgs, e);\n\n            // Wait for the next tick to ensure that the close-panel listener\n            // is called before this one, even for non-async local injects.\n            await utils.timeout(1);\n            // Remove the close-panel event listener.\n            events.remove_event_listener(el, \"pat-inject--close-panel\");\n            // Only close the panel if a close-panel event was catched previously.\n            if (do_close_panel) {\n                do_close_panel = false;\n                // Re-trigger close-panel event if it was caught while injection was in progress.\n                el.dispatchEvent(\n                    new Event(\"close-panel\", { bubbles: true, cancelable: true })\n                );\n            }\n        });\n        $el.on(\"pat-ajax-error.pat-inject\", this._onInjectError.bind(this, $el, cfgs));\n        $el.on(\"pat-ajax-success.pat-inject pat-ajax-error.pat-inject\", () =>\n            $el.removeData(\"pat-inject-triggered\")\n        );\n\n        // Prevent closing the panel while injection is in progress.\n        let do_close_panel = false;\n        events.add_event_listener(el, \"close-panel\", \"pat-inject--close-panel\", (e) => {\n            e.stopPropagation();\n            e.stopImmediatePropagation();\n            do_close_panel = true;\n        });\n\n        if (cfgs[0].url.length) {\n            ajax.request($el, {\n                \"url\": cfgs[0].url,\n                \"browser-cache\": cfgs[0].browserCache,\n            });\n        } else {\n            // If there is no url specified, then content is being fetched\n            // from the same page.\n            // No need to do an ajax request for this, so we spoof the ajax\n            // event.\n            $el.trigger({\n                type: \"pat-ajax-success\",\n                jqxhr: {\n                    responseText: $(\"body\").html(),\n                },\n            });\n        }\n    },\n\n    _inject(trigger, source_nodes, target, cfg) {\n        if (cfg.source === \"none\") {\n            // Special case. Clear the target after ajax call.\n            target.replaceWith(\"\");\n            return true;\n        }\n        if (source_nodes.length === 0) {\n            log.warn(\"Aborting injection, source not found:\", source_nodes);\n            $(trigger).trigger(\"pat-inject-missingSource\", {\n                url: cfg.url,\n                selector: cfg.source,\n            });\n            return false;\n        }\n        if (cfg.target === \"none\") {\n            // Special case. Don't do anything, we don't want any result\n            return true;\n        }\n        if (!target) {\n            log.warn(\"Aborting injection, target not found:\", target);\n            $(trigger).trigger(\"pat-inject-missingTarget\", {\n                selector: cfg.target,\n            });\n            return false;\n        }\n\n        // cfg.action to DOM method mapping\n        const method = {\n            content: \"replaceChildren\",\n            contentafter: \"append\",\n            contentbefore: \"prepend\",\n            element: \"replaceWith\",\n            elementafter: \"after\",\n            elementbefore: \"before\",\n        }[cfg.action];\n\n        // Inject the content HERE!\n        target[method](...source_nodes);\n\n        return true;\n    },\n\n    _sourcesFromHtml(html, url, sources) {\n        const $html = this._parseRawHtml(html, url);\n        return sources.map((source) => {\n            if (source === \"body\") {\n                source = \"#__original_body\";\n            }\n            if (source === \"none\") {\n                return $(\"<!-- -->\");\n            }\n            const $source = $html.find(source);\n\n            if ($source.length === 0) {\n                if (source != \"title\") {\n                    log.warn(\"No source elements for selector:\", source, $html);\n                }\n            }\n\n            $source.find('a[href^=\"#\"]').each((idx, el_) => {\n                const href = el_.getAttribute(\"href\");\n                if (href.indexOf(\"#{1}\") !== -1) {\n                    // We ignore hrefs containing #{1} because they're not\n                    // valid and only applicable in the context of\n                    // pat-clone.\n                    return;\n                }\n                // Skip in-document links pointing to an id that is inside\n                // this fragment.\n                if (href.length === 1) {\n                    // Special case for top-of-page links\n                    el_.href = url;\n                } else if (!$source.find(href).length) {\n                    el_.href = url + href;\n                }\n            });\n            return $source;\n        });\n    },\n\n    _rebaseAttrs: {\n        a: \"href\",\n        form: \"action\",\n        img: \"src\",\n        object: \"data\",\n        source: \"src\",\n        video: \"src\",\n    },\n\n    _rebaseOptions: {\n        \"calendar\": [\"url\", \"event-sources\"],\n        \"collapsible\": [\"load-content\"],\n        \"date-picker\": [\"i18n\"],\n        \"datetime-picker\": [\"i18n\"],\n        \"inject\": [\"url\"],\n    },\n\n    _rebaseURL(base, url) {\n        if (url.indexOf(\"://\") !== -1 || url[0] === \"/\" || url.indexOf(\"data:\") === 0) {\n            return url;\n        }\n        base = new URL(base, window.location).href; // If base is relative make it absolute.\n        return base.slice(0, base.lastIndexOf(\"/\") + 1) + url;\n    },\n\n    _rebaseHTML(base, html) {\n        if (html === \"\") {\n            // Special case, source is none\n            return \"\";\n        }\n\n        // Parse the html string into a DOM tree.\n        const page = document.createElement(\"div\");\n        page.innerHTML = html;\n\n        // Create efficient selector for any tag with it's corresponding\n        // attribute from _rebaseAttrs. Note: the current data structure allows\n        // only for one attribute to be rebased per tag.\n        const rebase_selector = Object.entries(this._rebaseAttrs)\n            .map(([tag, attr]) => `${tag}[${attr}]`)\n            .join(\", \");\n        for (const el_ of page.querySelectorAll(rebase_selector)) {\n            const attr = this._rebaseAttrs[el_.nodeName.toLowerCase()];\n            let value = el_.getAttribute(attr);\n\n            if (\n                value &&\n                value.slice(0, 2) !== \"@@\" &&\n                value[0] !== \"#\" &&\n                value.slice(0, 7) !== \"mailto:\" &&\n                value.slice(0, 4) !== \"tel:\" &&\n                value.slice(0, 4) !== \"fax:\" &&\n                value.slice(0, 7) !== \"callto:\" &&\n                value.slice(0, 10) !== \"ts3server:\" &&\n                value.slice(0, 6) !== \"teams:\" &&\n                value.slice(0, 11) !== \"javascript:\"\n            ) {\n                value = this._rebaseURL(base, value);\n                el_.setAttribute(attr, value);\n            }\n        }\n\n        for (const [pattern_name, opts] of Object.entries(this._rebaseOptions)) {\n            for (const el_ of dom.querySelectorAllAndMe(\n                page,\n                `[data-pat-${pattern_name}]`\n            )) {\n                const pattern = registry.patterns?.[pattern_name];\n                const pattern_parser = pattern?.parser;\n                if (!pattern_parser) {\n                    continue;\n                }\n                // parse: no default options, possibly multiple configs, no grouping.\n                const options = pattern_parser.parse(el_, {}, true, false, false);\n                let changed = false;\n                for (const config of options) {\n                    for (const opt of opts) {\n                        const val = config[opt];\n                        if (!val) {\n                            continue;\n                        }\n                        changed = true;\n                        if (Array.isArray(val)) {\n                            config[opt] = val.map((it) => this._rebaseURL(base, it));\n                        } else {\n                            config[opt] = this._rebaseURL(base, val);\n                        }\n                    }\n                }\n                if (changed) {\n                    el_.setAttribute(\n                        `data-pat-${pattern_name}`,\n                        JSON.stringify(options.length === 1 ? options[0] : options)\n                    );\n                }\n            }\n        }\n\n        return page.innerHTML.trim();\n    },\n\n    _parseRawHtml(html, url = \"\") {\n        // remove script tags and head and replace body by a div\n        const title = html.match(/\\<title\\>(.*)\\<\\/title\\>/);\n        let clean_html = html\n            .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, \"\")\n            .replace(/<head\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/head>/gi, \"\")\n            .replace(/<html([^>]*?)>/gi, \"\")\n            .replace(/<\\/html([^>]*?)>/gi, \"\")\n            .replace(/<body([^>]*?)>/gi, '<div id=\"__original_body\">')\n            .replace(/<\\/body([^>]*?)>/gi, \"</div>\");\n\n        if (title && title.length == 2) {\n            clean_html = title[0] + clean_html;\n        }\n        try {\n            clean_html = this._rebaseHTML(url, clean_html);\n        } catch (e) {\n            log.error(\"Error rebasing urls\", e);\n        }\n        const $html = $(\"<div/>\").html(clean_html);\n        if ($html.children().length === 0) {\n            log.warn(\"Parsing html resulted in empty jquery object:\", clean_html);\n        }\n        return $html;\n    },\n\n    _initAutoloadVisible($el, cfgs) {\n        if ($el.data(\"pat-inject-autoloaded\")) {\n            // ignore executed autoloads\n            return false;\n        }\n\n        const el = utils.jqToNode($el);\n\n        // delay: default is 200ms to allow scrolling over and past autoload-visible elements without loading them.\n        const delay = cfgs[0].delay || 200;\n        log.debug(`Delay time: ${delay}`);\n\n        // function to trigger the autoload and mark as triggered\n        const trigger = (event) => {\n            if ($el.data(\"pat-inject-autoloaded\")) {\n                log.debug(`autoload-visible trigger skipped ${el}`);\n                return false;\n            }\n            $el.data(\"pat-inject-autoloaded\", true);\n            this.onTrigger({ currentTarget: el });\n            event && event.preventDefault();\n            log.debug(`autoload-visible trigger run ${el}`);\n            return true;\n        };\n\n        // Config see: https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n        const intersection_observer_config = {\n            threshold: 0, // If even one pixel is visible, the callback will be run.\n            root: null, // Root is browser viewport. If the element is visible to the user, the callback will be run.\n            margin: \"0px\", // No margins. The element is not preloaded.\n        };\n\n        let timeout_id = null;\n        const observer = new IntersectionObserver((entries) => {\n            for (const entry of entries) {\n                if (entry.isIntersecting) {\n                    // Run the callback after 200ms to prevent loading all\n                    // visible elements when scrolling over.\n                    timeout_id = window.setTimeout(() => {\n                        observer.disconnect(); // Stop observing loaded elements.\n                        trigger();\n                    }, delay);\n                    log.debug(`autoload-visible intersecting ${el}`);\n                } else {\n                    window.clearTimeout(timeout_id);\n                    log.debug(`autoload-visible not intersecting ${el}`);\n                }\n            }\n        }, intersection_observer_config);\n        observer.observe(el);\n    },\n\n    _initIdleTrigger($el, delay) {\n        // TODO: handle item removed from DOM\n        const timeout = parseInt(delay, 10);\n        let timer;\n\n        const el = utils.jqToNode($el);\n\n        const onTimeout = () => {\n            this.onTrigger({ currentTarget: el });\n            unsub();\n            clearTimeout(timer);\n        };\n\n        const onInteraction = utils.debounce(() => {\n            if (!document.body.contains(el)) {\n                unsub();\n                return;\n            }\n            clearTimeout(timer);\n            timer = setTimeout(onTimeout, timeout);\n        }, timeout);\n\n        const unsub = () => {\n            for (const event of [\"scroll\", \"resize\"]) {\n                window.removeEventListener(event, onInteraction);\n            }\n            for (const event of [\n                \"click\",\n                \"keypress\",\n                \"keyup\",\n                \"mousemove\",\n                \"touchstart\",\n                \"touchend\",\n            ]) {\n                document.removeEventListener(event, onInteraction);\n            }\n        };\n\n        onInteraction();\n\n        for (const event of [\"scroll\", \"resize\"]) {\n            window.addEventListener(event, onInteraction);\n        }\n        for (const event of [\n            \"click\",\n            \"keypress\",\n            \"keyup\",\n            \"mousemove\",\n            \"touchstart\",\n            \"touchend\",\n        ]) {\n            document.addEventListener(event, onInteraction);\n        }\n    },\n\n    registerTypeHandler(type, handler) {\n        this.handlers[type] = handler;\n    },\n\n    async callTypeHandler(type, fn, context, params) {\n        type = type || \"html\";\n        if (this.handlers[type] && $.isFunction(this.handlers[type][fn])) {\n            return await this.handlers[type][fn].bind(this)(...params);\n        } else {\n            return null;\n        }\n    },\n\n    handlers: {\n        html: {\n            sources(cfgs, data) {\n                const sources = cfgs.map((cfg) => cfg.source);\n                sources.push(\"title\");\n                const result = this._sourcesFromHtml(data, cfgs[0].url, sources);\n                return result;\n            },\n        },\n    },\n};\n\n$(document).on(\"patterns-injected.inject\", async (ev, cfg, trigger, injected) => {\n    /* Listen for the patterns-injected event.\n     *\n     * Remove the \"loading-class\" classes from all injection targets and\n     * then scan the injected content for new patterns.\n     */\n    if (cfg?.skipPatInjectHandler) {\n        // Allow skipping this handler but still have other handlers in other\n        // patterns listen to ``patterns-injected``.\n        return;\n    }\n    if (cfg) {\n        cfg.$target.removeClass(cfg.loadingClass);\n        // Remove the executing class, add the executed class to the element with pat.inject on it.\n        $(trigger).removeClass(cfg.executingClass).addClass(cfg.executedClass);\n    }\n    if (injected.nodeType !== TEXT_NODE && injected.nodeType !== COMMENT_NODE) {\n        registry.scan(injected, null, { type: \"injection\", element: trigger });\n        $(injected).trigger(\"patterns-injected-scanned\");\n\n        await utils.timeout(10); // Wait a bit before dispatching next event.\n        injected.dispatchEvent(\n            new CustomEvent(\"patterns-injected-delayed\", {\n                bubbles: true,\n                cancelable: true,\n                detail: {\n                    injected: injected,\n                },\n            })\n        );\n    }\n});\n\n$(window).on(\"popstate\", (event) => {\n    // popstate also triggers on traditional anchors\n    if (!event.originalEvent.state && \"replaceState\" in history) {\n        try {\n            history.replaceState(\"anchor\", \"\", document.location.href);\n        } catch (e) {\n            log.debug(e);\n        }\n        return;\n    }\n    // Not only change the URL, also reload the page.\n    window.location.reload();\n});\n\n// this entry ensures that the initally loaded page can be reached with\n// the back button\nif (\"replaceState\" in history) {\n    try {\n        history.replaceState(\"pageload\", \"\", document.location.href);\n    } catch (e) {\n        log.debug(e);\n    }\n}\n\nregistry.register(inject);\nexport default inject;\n","import $ from \"jquery\";\nimport { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport events from \"../../core/events\";\nimport dom from \"../../core/dom\";\nimport logging from \"../../core/logging\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"depends\");\n\nexport const parser = new Parser(\"depends\");\nparser.addArgument(\"condition\");\nparser.addArgument(\"action\", \"show\", [\"show\", \"enable\", \"both\"]);\nparser.addArgument(\"transition\", \"none\", [\"none\", \"css\", \"fade\", \"slide\"]);\nparser.addArgument(\"effect-duration\", \"fast\");\nparser.addArgument(\"effect-easing\", \"swing\");\n\n\n// A custom input event which differs from the one in `core/events` in that it\n// accepts a `detail` object to pass arbitrary information around.\n// TODO: The events in `core/events` should be refactored to accept a `detail`\n// object.\nconst input_event = (detail = {}) => {\n    return new CustomEvent(\"input\", {\n        bubbles: true,\n        cancelable: false,\n        detail: detail,\n    });\n};\n\n\nclass Pattern extends BasePattern {\n    static name = \"depends\";\n    static trigger = \".pat-depends\";\n    static parser = parser;\n\n    async init() {\n        this.$el = $(this.el);\n        const DependsHandler = (await import(\"../../lib/dependshandler\")).default; // prettier-ignore\n\n        try {\n            this.handler = new DependsHandler(this.el, this.options.condition);\n        } catch (e) {\n            log.error(\"Invalid condition: \" + e.message, this.el);\n            return;\n        }\n\n        // Initialize\n        this.set_state();\n\n        for (const input of this.handler.getAllInputs()) {\n            // Note: One input can be a dependency for multiple other dependent\n            // elements. Therefore we need to bind the events not uniquely and\n            // add a uuid to the event bindings id.\n\n            events.add_event_listener(\n                input,\n                \"input\",\n                `pat-depends--input--${this.uuid}`,\n                (e) => {\n                    if (e?.detail?.pattern_uuid === this.uuid) {\n                        // Ignore input events invoked from this pattern\n                        // instance to avoid infinite loops.\n                        return;\n                    }\n                    this.set_state();\n                }\n            );\n\n            if (input.form) {\n                events.add_event_listener(\n                    input.form,\n                    \"reset\",\n                    `pat-depends--reset--${this.uuid}`,\n                    async () => {\n                        // TODO: note sure, what this timeout is for.\n                        await utils.timeout(50);\n                        this.set_state.bind(this);\n                    }\n                );\n            }\n        }\n    }\n\n    update_modal() {\n        const modal = this.el.closest(\".pat-modal\");\n\n        // If we're in a modal, make sure that it gets resized.\n        if (modal) {\n            $(document).trigger(\"pat-update\", { pattern: \"depends\" });\n        }\n    }\n\n    enable() {\n        const inputs = dom.find_inputs(this.el);\n        for (const input of inputs) {\n            if (input.disabled === false) {\n                // Do not re-enable an already enabled input.\n                continue;\n            }\n\n            // Now, enable the input element.\n            input.disabled = false;\n\n            if (input === this.el) {\n                // Do not re-trigger this pattern on it's own element to avoid\n                // infinite loops.\n                continue;\n            }\n\n            if (dom.is_button(input)) {\n                // Do not trigger the input event on buttons as they do not\n                // support it.\n                continue;\n            }\n\n            // Trigger the input after enabling so that any other bound\n            // actions can react on that.\n            input.dispatchEvent(input_event({ pattern_uuid: this.uuid }));\n        }\n\n        // Restore the original click behavior for anchor elements.\n        if (this.el.tagName === \"A\") {\n            events.remove_event_listener(this.el, \"pat-depends--click\");\n        }\n\n        // Remove the disabled class from the element.\n        this.el.classList.remove(\"disabled\");\n\n        // Trigger the pat-update event to notify other patterns about enabling.\n        this.$el.trigger(\"pat-update\", {\n            pattern: \"depends\",\n            action: \"attribute-changed\",\n            dom: this.el,\n            enabled: true,\n        });\n    }\n\n    disable() {\n        const inputs = dom.find_inputs(this.el);\n        for (const input of inputs) {\n            if (input.disabled === true) {\n                // Do not re-disable an already disabled input.\n                continue;\n            }\n\n            // Now, disable the input element.\n            input.disabled = true;\n\n            if (input === this.el) {\n                // Do not re-trigger this pattern on it's own element to avoid\n                // infinite loops.\n                continue;\n            }\n\n            if (dom.is_button(input)) {\n                // Do not trigger the input event on buttons as they do not\n                // support it.\n                continue;\n            }\n\n            // Trigger the input after disabling so that any other bound\n            // actions can react on that.\n            input.dispatchEvent(input_event({ pattern_uuid: this.uuid }));\n        }\n\n        // Prevent the default click behavior for anchor elements.\n        if (this.el.tagName === \"A\") {\n            events.add_event_listener(this.el, \"click\", \"pat-depends--click\", (e) =>\n                e.preventDefault()\n            );\n        }\n\n        // Add the disabled class to the element.\n        this.el.classList.add(\"disabled\");\n\n        // Trigger the pat-update event to notify other patterns about disabling.\n        this.$el.trigger(\"pat-update\", {\n            pattern: \"depends\",\n            action: \"attribute-changed\",\n            dom: this.el,\n            enabled: false,\n        });\n    }\n\n    set_state() {\n        const state = this.handler.evaluate();\n        switch (this.options.action) {\n            case \"show\":\n                utils.hideOrShow(this.el, state, this.options, this.name);\n                this.update_modal();\n                break;\n            case \"enable\":\n                if (state) {\n                    this.enable();\n                } else {\n                    this.disable();\n                }\n                break;\n            case \"both\":\n                utils.hideOrShow(this.el, state, this.options, this.name);\n                this.update_modal();\n                if (state) {\n                    this.enable();\n                } else {\n                    this.disable();\n                }\n                break;\n        }\n    }\n}\n\n// Register Pattern class in the global pattern registry\nregistry.register(Pattern);\n\n// Make it available\nexport default Pattern;\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport _ from \"underscore\";\n\nconst log = logger.getLogger(\"pat-contentloader\");\n\nexport default Base.extend({\n    name: \"contentloader\",\n    trigger: \".pat-contentloader\",\n    parser: \"mockup\",\n    defaults: {\n        url: null,\n        content: null,\n        trigger: \"click\",\n        target: null,\n        template: null,\n        dataType: \"html\",\n    },\n    init: function () {\n        var that = this;\n        if (that.options.url === \"el\" && that.$el[0].tagName === \"A\") {\n            that.options.url = that.$el.attr(\"href\");\n        }\n        that.$el.removeClass(\"loading-content\");\n        that.$el.removeClass(\"content-load-error\");\n        if (that.options.trigger === \"immediate\") {\n            that._load();\n        } else {\n            that.$el.on(that.options.trigger, function (e) {\n                e.preventDefault();\n                that._load();\n            });\n        }\n    },\n    _load: function () {\n        var that = this;\n        that.$el.addClass(\"loading-content\");\n        if (that.options.url) {\n            that.loadRemote();\n        } else {\n            that.loadLocal();\n        }\n    },\n    loadRemote: function () {\n        var that = this;\n        $.ajax({\n            url: that.options.url,\n            dataType: that.options.dataType,\n            success: function (data) {\n                var $el;\n                if (that.options.dataType === \"html\") {\n                    if (data.indexOf(\"<html\") !== -1) {\n                        data = utils.parseBodyTag(data);\n                    }\n                    $el = $(\"<div>\" + data + \"</div>\"); // jQuery starts to search at the first child element.\n                } else if (that.options.dataType.indexOf(\"json\") !== -1) {\n                    // must have template defined with json\n                    if (data.constructor === Array && data.length === 1) {\n                        // normalize json if it makes sense since some json returns as array with one item\n                        data = data[0];\n                    }\n                    try {\n                        $el = $(_.template(that.options.template)(data));\n                    } catch (e) {\n                        that.$el.removeClass(\"loading-content\");\n                        that.$el.addClass(\"content-load-error\");\n                        log.warn(\n                            \"error rendering template. pat-contentloader will not work\"\n                        );\n                        return;\n                    }\n                }\n                if (that.options.content !== null) {\n                    $el = $el.find(that.options.content);\n                }\n                that.loadLocal($el);\n            },\n            error: function () {\n                that.$el.removeClass(\"loading-content\");\n                that.$el.addClass(\"content-load-error\");\n            },\n        });\n    },\n    loadLocal: function ($content) {\n        var that = this;\n        if (!$content && that.options.content === null) {\n            that.$el.removeClass(\"loading-content\");\n            that.$el.addClass(\"content-load-error\");\n            log.warn(\"No selector configured\");\n            return;\n        }\n        var $target = that.$el;\n        if (that.options.target !== null) {\n            $target = $(that.options.target);\n            if ($target.length === 0) {\n                that.$el.removeClass(\"loading-content\");\n                that.$el.addClass(\"content-load-error\");\n                log.warn(\"No target nodes found\");\n                return;\n            }\n        }\n\n        if (!$content) {\n            $content = $(that.options.content).clone();\n        }\n        if ($content.length) {\n            $content.show();\n            $target.replaceWith($content);\n            registry.scan($content);\n        } else {\n            // empty target node instead of removing it.\n            // allows for subsequent content loader calls to work sucessfully.\n            $target.empty();\n        }\n\n        that.$el.removeClass(\"loading-content\");\n        that.emit(\"loading-done\");\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\n\nexport default Base.extend({\n    name: \"cookietrigger\",\n    trigger: \".pat-cookietrigger\",\n    parser: \"mockup\",\n\n    isCookiesEnabled: function () {\n        /* Test whether cookies are enabled by attempting to set a cookie\n         * and then change its value set test cookie.\n         */\n        var c = \"areYourCookiesEnabled=0\";\n        document.cookie = c;\n        var dc = document.cookie;\n        // cookie not set?  fail\n        if (dc.indexOf(c) === -1) {\n            return 0;\n        }\n        // change test cookie\n        c = \"areYourCookiesEnabled=1\";\n        document.cookie = c;\n        dc = document.cookie;\n        // cookie not changed?  fail\n        if (dc.indexOf(c) === -1) {\n            return 0;\n        }\n        // delete cookie\n        document.cookie = \"areYourCookiesEnabled=; expires=Thu, 01-Jan-70 00:00:01 GMT\";\n        return 1;\n    },\n\n    showIfCookiesDisabled: function () {\n        /* Show the element on which this pattern is defined if cookies are\n         * disabled.\n         */\n        if (this.isCookiesEnabled()) {\n            dom.hide(this.el);\n        } else {\n            dom.show(this.el);\n        }\n    },\n\n    init: function () {\n        this.showIfCookiesDisabled();\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"formautofocus\",\n    trigger: \".pat-formautofocus\",\n    parser: \"mockup\",\n    defaults: {\n        condition: \"div.error\",\n        target: \"div.error :input:not(.formTabs):visible:first\",\n        always: \":input:not(.formTabs):visible:first\",\n    },\n    init() {\n        if ($(this.options.condition, this.$el).length !== 0) {\n            $(this.options.target, this.$el).focus();\n        } else {\n            $(this.options.always, this.$el).focus();\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\n\nexport default Base.extend({\n    name: \"formunloadalert\",\n    trigger: \".pat-formunloadalert\",\n    parser: \"mockup\",\n    _changed: false, // Stores a listing of raised changes by their key\n    _suppressed: false, // whether or not warning should be suppressed\n    defaults: {\n        message: _t(\"Discard changes? If you click OK, any changes you have made will be lost.\"), // prettier-ignore\n        // events on which to check for changes\n        changingEvents: \"change keyup paste\",\n        // fields on which to check for changes\n        changingFields: \"input,select,textarea,fileupload\",\n    },\n    init() {\n        var self = this;\n        // if this is not a form just return\n        if (!self.$el.is(\"form\")) {\n            return;\n        }\n\n        $(self.options.changingFields, self.$el).on(self.options.changingEvents, () => {\n            self._changed = true;\n        });\n\n        var $modal = self.$el.parents(\".plone-modal\");\n        if ($modal.length !== 0) {\n            $modal.on(\"hide\", function (e) {\n                var modal = $modal.data(\"patternPloneModal\");\n                if (modal) {\n                    modal._suppressHide = self._handleUnload.call(self, e);\n                }\n            });\n        } else {\n            $(window).on(\"beforeunload\", (e) => {\n                return self._handleUnload(e);\n            });\n        }\n\n        self.$el.on(\"submit\", () => {\n            self._suppressed = true;\n        });\n    },\n    _handleUnload(e) {\n        var self = this;\n        if (self._suppressed) {\n            self._suppressed = false;\n            return undefined;\n        }\n        if (self._changed) {\n            var msg = self.options.message;\n            self._handleMsg(e, msg);\n            $(window).trigger(\"messageset\");\n            return msg;\n        }\n    },\n    _handleMsg(e, msg) {\n        (e || window.event).returnValue = msg;\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\n\nexport default Base.extend({\n    name: \"livesearch\",\n    trigger: \".pat-livesearch\",\n    parser: \"mockup\",\n    timeout: null,\n    active: false,\n    results: null,\n    selectedItem: -1,\n    resultsClass: \"livesearch-results list-group d-none\",\n    defaults: {\n        ajaxUrl: null,\n        defaultSortOn: \"\",\n        perPage: 7,\n        quietMillis: 350,\n        timeoutHide: 200,\n        minimumInputLength: 4,\n        inputSelector: 'input[type=\"text\"]',\n        itemTemplate:\n            '<li class=\"search-result <%- state %> list-group-item list-group-item-action\">' +\n            '<a class=\"text-reset text-decoration-none\" href=\"<%- url %>\">' +\n            '<div class=\"row\">' +\n            '<div class=\"col info\">' +\n            '<div class=\"heading\"><%- title %></div>' +\n            '<div class=\"description\"><%- description %></div>' +\n            \"</div>\" +\n            \"<% if (img_tag) { %> \" +\n            '<div class=\"col img\">' +\n            \"<%= img_tag %>\" +\n            \"</div>\" +\n            \"<% } %> \" +\n            \"</div>\" +\n            \"</a>\" +\n            \"</li>\",\n    },\n    doSearch: function (page) {\n        var self = this;\n        self.active = true;\n        self.render();\n        self.$el.addClass(\"searching\");\n        var query = self.$el.serialize();\n        if (page === undefined) {\n            page = 1;\n        }\n        var sort_on = (function () {\n            var parameters = location.search,\n                sorton_position = parameters.indexOf(\"sort_on\");\n            if (sorton_position === -1) {\n                // return default sort\n                var $searchResults = $(\"#search-results\");\n                if ($searchResults.length > 0) {\n                    return $searchResults.attr(\"data-default-sort\");\n                }\n                return self.options.defaultSortOn;\n            }\n            // cut string before sort_on parameter\n            var sort_on = parameters.substring(sorton_position);\n            // cut other parameters\n            sort_on = sort_on.split(\"&\")[0];\n            // get just the value\n            sort_on = sort_on.split(\"=\")[1];\n            return sort_on;\n        })();\n\n        $.ajax({\n            url:\n                self.options.ajaxUrl +\n                \"?\" +\n                query +\n                \"&page=\" +\n                page +\n                \"&perPage=\" +\n                self.options.perPage +\n                \"&sort_on=\" +\n                sort_on,\n            dataType: \"json\",\n        })\n            .done(function (data) {\n                self.results = data;\n                self.page = page;\n                // maybe odd here.. but we're checking to see if the user\n                // has typed while a search was being performed. Perhap another search if so\n                if (query !== self.$el.serialize()) {\n                    self.doSearch();\n                }\n            })\n            .fail(function () {\n                self.results = {\n                    items: [\n                        {\n                            url: \"\",\n                            title: _t(\"Error\"),\n                            description: _t(\"There was an error searching\"),\n                            state: \"error\",\n                            error: false,\n                        },\n                    ],\n                    total: 1,\n                };\n                self.page = 1;\n            })\n            .always(function () {\n                self.active = false;\n                self.selectedItem = -1;\n                self.$el.removeClass(\"searching\");\n                self.render();\n            });\n    },\n    render: function () {\n        var self = this;\n        self.$results.empty();\n\n        /* find a status message */\n\n        if (self.active) {\n            self.$results.append(\n                $('<li class=\"searching list-group-item\">' + _t(\"searching\") + \"</li>\")\n            );\n        } else if (self.results === null) {\n            // no results gathered yet\n            self.$results.append(\n                $(\n                    '<li class=\"no-results no-search list-group-item\">' +\n                        _t(\"enter search phrase\") +\n                        \"</li>\"\n                )\n            );\n        } else if (self.results.total === 0) {\n            self.$results.append(\n                $(\n                    '<li class=\"no-results list-group-item\">' +\n                        _t(\"no results found\") +\n                        \"</li>\"\n                )\n            );\n        } else {\n            self.$results.append(\n                $(\n                    '<li class=\"results-summary list-group-item\">' +\n                        _t(\"found\") +\n                        \" \" +\n                        self.results.total +\n                        \" \" +\n                        _t(\"results\") +\n                        \"</li>\"\n                )\n            );\n        }\n\n        if (self.results !== null) {\n            var template = _.template(self.options.itemTemplate);\n            _.each(self.results.items, function (item, index) {\n                var $el = $(template($.extend({ _t: _t }, item)));\n                $el.attr(\"data-url\", item.url).on(\"click\", function () {\n                    if (!item.error) {\n                        window.location = item.url;\n                    }\n                });\n                if (index === self.selectedItem) {\n                    $el.addClass(\"active\");\n                }\n                self.$results.append($el);\n            });\n            var nav = {};\n            if (self.page > 1) {\n                var $prev = $(\n                    '<a href=\"#\" class=\"prev position-absolute ps-3 start-0\">' +\n                        _t(\"Previous\") +\n                        \"</a>\"\n                );\n                $prev.on(\"click\", function (e) {\n                    self.disableHiding = true;\n                    e.preventDefault();\n                    self.doSearch(self.page - 1);\n                });\n                nav.prev = $prev;\n            }\n            if (self.page * self.options.perPage < self.results.total) {\n                var $next = $(\n                    '<a href=\"#\" class=\"next position-absolute pe-3 end-0\">' +\n                        _t(\"Next\") +\n                        \"</a>\"\n                );\n                $next.on(\"click\", function (e) {\n                    self.disableHiding = true;\n                    e.preventDefault();\n                    self.doSearch(self.page + 1);\n                });\n                nav.next = $next;\n            }\n            if (nav.next || nav.prev) {\n                var $li = $(\n                    '<li class=\"list-group-item load-more d-flex justify-content-center\"><span class=\"page\">' +\n                        self.page +\n                        \"</span></li>\"\n                );\n                if (nav.prev) {\n                    $li.prepend(nav.prev);\n                }\n                if (nav.next) {\n                    $li.append(nav.next);\n                }\n                self.$results.append($li);\n            }\n        }\n        self.show();\n    },\n    show: function () {\n        /* we are positioning directly below the\n         input box, same width */\n        var self = this;\n\n        self.$results[0].classList.remove(\"d-none\");\n        self.$el[0].classList.add(\"livesearch-active\");\n    },\n    hide: function () {\n        this.$el[0].classList.remove(\"livesearch-active\");\n        this.$results[0].classList.add(\"d-none\");\n    },\n    init: function () {\n        // import(\"./livesearch.scss\");\n\n        var self = this;\n\n        self.$input = self.$el.find(self.options.inputSelector);\n        self.$input\n            .off(\"focusout\")\n            .on(\"focusout\", function () {\n                /* we put this in a timer so click events still\n           get trigger on search results */\n                setTimeout(function () {\n                    /* hack, look above, to handle dealing with clicks\n             unfocusing element */\n                    if (!self.disableHiding) {\n                        self.hide();\n                    } else {\n                        self.disableHiding = false;\n                        // and refocus elemtn\n                        self.$input.focus();\n                    }\n                }, self.options.timeoutHide);\n            })\n            .off(\"focusin\")\n            .on(\"focusin\", function () {\n                if (!self.onceFocused) {\n                    /* Case: field already filled out but no reasons\n             present yet, do ajax search and grab some results */\n                    self.onceFocused = true;\n                    if (self.$input.val().length >= self.options.minimumInputLength) {\n                        self.doSearch();\n                    }\n                } else if (!dom.is_visible(self.$results[0])) {\n                    self.render();\n                }\n            })\n            .attr(\"autocomplete\", \"off\")\n            .off(\"keyup\")\n            .on(\"keyup\", function (e) {\n                var code = e.keyCode || e.which;\n                // first off, we're capturing esc presses\n                if (code === 27) {\n                    self.$input.val(\"\");\n                    self.hide();\n                    return;\n                }\n                // then, we're capturing up, down and enter key presses\n                if (\n                    self.results &&\n                    self.results.items &&\n                    self.results.items.length > 0\n                ) {\n                    if (code === 13) {\n                        /* enter key, check to see if there is a selected item */\n                        if (self.selectedItem !== -1) {\n                            window.location = self.results.items[self.selectedItem].url;\n                        }\n                        return;\n                    } else if (code === 38) {\n                        /* up key */\n                        if (self.selectedItem !== -1) {\n                            self.selectedItem -= 1;\n                            self.render();\n                        }\n                        return;\n                    } else if (code === 40) {\n                        /* down key */\n                        if (self.selectedItem < self.results.items.length) {\n                            self.selectedItem += 1;\n                            self.render();\n                        }\n                        return;\n                    }\n                }\n\n                /* then, we handle timeouts for doing ajax search */\n                if (self.timeout !== null) {\n                    clearTimeout(self.timeout);\n                    self.timeout = null;\n                }\n                if (self.active) {\n                    return;\n                }\n                if (self.$input.val().length >= self.options.minimumInputLength) {\n                    self.timeout = setTimeout(function () {\n                        self.doSearch();\n                    }, self.options.quietMillis);\n                } else {\n                    self.results = null;\n                    self.render();\n                }\n            });\n        $(\"#sorting-options a\").on(\"click\", function (e) {\n            e.preventDefault();\n            self.onceFocused = false;\n        });\n\n        /* create result dom */\n        self.$results = $('<ul class=\"' + self.resultsClass + '\"></ul>').insertAfter(\n            self.$el\n        );\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"markspeciallinks\",\n    trigger: \".pat-markspeciallinks\",\n    parser: \"mockup\",\n\n    defaults: {\n        external_links_open_new_window: false,\n        mark_special_links: true,\n    },\n\n    protocol_icon_map: {\n        // For a list of supported default protocol hander, see:\n        // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/registerProtocolHandler#permitted_schemes\n        https: \"link-45deg\",\n        http: \"link-45deg\",\n        ftp: \"cloud-download\", // deprecated\n        callto: \"telephone\", // non-standard for skype\n        bitcoin: \"credit-card\", // no bitcoin icon yet\n        geo: \"geo-alt\",\n        im: \"chat\",\n        irc: \"chat\",\n        ircs: \"chat\",\n        magnet: \"link-45deg\",\n        mailto: \"envelope\",\n        mms: \"chat\",\n        news: \"newspaper\",\n        nntp: \"newspaper\",\n        openpgp4fpr: \"key\",\n        sip: \"telephone\",\n        sms: \"chat\",\n        smsto: \"chat\",\n        ssh: \"lock\",\n        tel: \"telephone\",\n        urn: \"link-45deg\",\n        webcal: \"calendar\",\n        wtai: \"telephone\",\n        xmpp: \"chat\",\n    },\n\n    async init() {\n        // first make external links open in a new window, afterwards do the\n        // normal plone link wrapping in only the content area\n\n        let open_new_window = false;\n        if (typeof this.options.external_links_open_new_window === \"string\") {\n            open_new_window =\n                this.options.external_links_open_new_window.toLowerCase() === \"true\";\n        } else if (typeof this.options.external_links_open_new_window === \"boolean\") {\n            open_new_window = this.options.external_links_open_new_window;\n        }\n\n        let mark_special_links = false;\n        if (typeof this.options.mark_special_links === \"string\") {\n            mark_special_links =\n                this.options.mark_special_links.toLowerCase() === \"true\";\n        } else if (typeof this.options.mark_special_links === \"boolean\") {\n            mark_special_links = this.options.mark_special_links;\n        }\n\n        if (mark_special_links) {\n            import(\"./markspeciallinks.scss\");\n        }\n\n        // All links with an http href (without the link-plain class), not within this site,\n        // and no img children should be wrapped in a link-external span\n        const url = window.location.protocol + \"//\" + window.location.host;\n        const links = this.el.querySelectorAll(\n            `a[href]:not(.link-plain):not([href^=\"${url}\"]):not([href^=\"#\"])`\n        );\n        //:not(:has(img))\n        for (const link of links) {\n            let link_url;\n            try {\n                link_url = new URL(link.getAttribute(\"href\"));\n            } catch (e) {\n                // Not a valid URL.\n                // Ignore and continue.\n                continue;\n            }\n\n            if (open_new_window && link_url.protocol.startsWith(\"http\")) {\n                link.setAttribute(\"target\", \"_blank\");\n                link.setAttribute(\"rel\", \"noopener\");\n            }\n\n            if (mark_special_links) {\n                const icon_name =\n                    this.protocol_icon_map[link_url.protocol.split(\":\")[0]];\n                if (icon_name) {\n                    const icon = await utils.resolveIcon(icon_name);\n                    const icon_el = dom.create_from_string(icon);\n                    icon_el.querySelector(\"svg\").classList.add(\"markspeciallinks__icon\");\n                    link.parentNode.insertBefore(icon_el, link);\n                }\n            }\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"navigationmarker\",\n    trigger: \".pat-navigationmarker\",\n    parser: \"mockup\",\n    init: function () {\n        const portal_url = document.body.dataset.portalUrl;\n        var href =\n            document.querySelector('head link[rel=\"canonical\"]').href ||\n            window.location.href;\n\n        $(\"a\", this.$el).each(function () {\n            var navlink = this.href.replace(\"/view\", \"\");\n            if (href.indexOf(navlink) !== -1) {\n                var parent = $(this).parent();\n\n                // check the input-openers within the path\n                var check = parent.find(\"> input\");\n                if (check.length) {\n                    check[0].checked = true;\n                }\n\n                // set \"inPath\" to all nav items which are within the current path\n                // check if parts of navlink are in canonical url parts\n                var hrefParts = href.split(\"/\");\n                var navParts = navlink.split(\"/\");\n                var inPath = false;\n                for (var i = 0, size = navParts.length; i < size; i++) {\n                    // The last path-part must match.\n                    inPath = false;\n                    if (navParts[i] === hrefParts[i]) {\n                        inPath = true;\n                    }\n                }\n                if (navlink === portal_url && href !== portal_url) {\n                    // Avoid marking \"Home\" with \"inPath\", when not actually there\n                    inPath = false;\n                }\n                if (inPath) {\n                    parent.addClass(\"inPath\");\n                }\n\n                // set \"current\" to the current selected nav item, if it is in the navigation structure.\n                if (href === navlink) {\n                    parent.addClass(\"current\");\n                }\n            }\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nfunction loadScript(src) {\n    var s,\n        i,\n        head,\n        scripts = document.getElementsByTagName(\"script\");\n\n    // Check script element doesn't already exist\n    for (i = 0; i < scripts.length; i++) {\n        if (scripts[i].src.indexOf(src) !== -1) {\n            return;\n        }\n    }\n\n    // If not, add it to page\n    s = document.createElement(\"script\");\n    s.type = \"text/javascript\";\n    s.async = true;\n    s.src = src;\n    // use head tag to find a place to insert the script node\n    head = document.getElementsByTagName(\"head\")[0];\n    head.insertBefore(s, head.firstChild);\n}\nfunction htmlToElement(html) {\n    var htmltmp = document.createElement(\"div\");\n    html = html.trim(); // Never return a text node of whitespace as the result\n    htmltmp.innerHTML = html;\n    return htmltmp.firstElementChild;\n}\n\nexport default Base.extend({\n    name: \"passwordstrength\",\n    trigger: \".pat-passwordstrength\",\n    parser: \"mockup\",\n    defaults: {\n        zxcvbn: \"//cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js\",\n    },\n    init: function () {\n        var self = this,\n            pwfield = this.el,\n            pwmeterContainer = htmlToElement(\n                '<div class=\"progress my-3\"><div class=\"progress-bar\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\"></div></div>'\n            ),\n            pwmeter = pwmeterContainer.firstChild,\n            indicators = {\n                0: \"bg-transparent\",\n                1: \"bg-danger\",\n                2: \"bg-warning\",\n                3: \"bg-warning\",\n                4: \"bg-success\",\n            };\n        function setLevel() {\n            var score = 0;\n\n            if (pwfield.value.length > 0) {\n                // Run zxcvbn, supplying the value of any other widgets in the form\n                score = Math.max(\n                    1,\n                    window.zxcvbn(\n                        pwfield.value,\n                        [].map\n                            .call(\n                                (pwfield.form || { elements: [] }).elements,\n                                function (inp) {\n                                    if (inp === pwfield) {\n                                        return null;\n                                    }\n                                    return inp.value || null;\n                                }\n                            )\n                            .filter(function (x) {\n                                return x;\n                            })\n                    ).score\n                );\n            }\n            var wclass = \"\";\n            if (score != 0) {\n                wclass = \" w-\" + 25 * score;\n            }\n            pwmeter.className = \"progress-bar\" + wclass + \" \" + indicators[score];\n            pwmeter.setAttribute(\"aria-valuenow\", 25 * score);\n        }\n\n        pwfield.parentNode.insertBefore(pwmeterContainer, pwfield.nextSibling);\n        // set up key strokes to change the meter\n        pwfield.onkeyup = function () {\n            setLevel();\n        };\n        // init zxcvbn\n        if (typeof window.zxcvbn !== \"function\") {\n            // No zxcvbn yet, try and load it\n            loadScript(self.options.zxcvbn);\n        }\n        // initial pwmeter setting\n        setLevel();\n    },\n});\n","import $ from \"jquery\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"preventdoublesubmit\",\n    trigger: \".pat-preventdoublesubmit\",\n    parser: \"mockup\",\n    defaults: {\n        message: _t(\"You already clicked the submit button. Do you really want to submit this form again?\"), // prettier-ignore\n        guardClassName: \"submitting\",\n        optOutClassName: \"allowMultiSubmit\",\n    },\n    init() {\n        var self = this;\n\n        // if this is not a form just return\n        if (!self.$el.is(\"form\")) {\n            return;\n        }\n\n        $(\":submit\", self.$el).on(\"click\", function () {\n            // mark the button as clicked\n            $(\":submit\").removeAttr(\"clicked\");\n            $(this).attr(\"clicked\", \"clicked\");\n\n            // if submitting and no opt-out guardClassName is found\n            // pop up confirmation dialog\n            if (\n                $(this).hasClass(self.options.guardClassName) &&\n                !$(this).hasClass(self.options.optOutClassName)\n            ) {\n                return self._confirm.call(self);\n            }\n\n            $(this).addClass(self.options.guardClassName);\n        });\n    },\n\n    _confirm() {\n        return window.confirm(this.options.message);\n    },\n});\n","import $ from \"jquery\";\nimport Modal from \"../modal/modal\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport utils from \"../../core/utils\";\nimport _t from \"../../core/i18n-wrapper\";\n\nconst log = logger.getLogger(\"pat-manage-portlets\");\n\nexport default Base.extend({\n    name: \"manage-portlets\",\n    trigger: \".pat-manage-portlets\",\n    parser: \"mockup\",\n    messageTimeout: 0,\n    submitTimeout: 0,\n    switchTimeout: 0,\n    isModal: false,\n    dirty: false,\n    init: async function () {\n        (await import(\"jquery-form\")).default;\n        var that = this;\n        var $modal = that.$el.parents(\".plone-modal\");\n        if ($modal.length === 1) {\n            this.isModal = true;\n            /* want to do something on exit from modal now */\n            var modal = $modal.data(\"pattern-plone-modal\");\n            modal.on(\"hide\", function () {\n                if (that.dirty) {\n                    window.location.reload();\n                }\n            });\n            that.loading = modal.loading;\n        } else {\n            that.loading = utils.loading;\n        }\n        that.bind();\n    },\n    bind: function () {\n        var that = this;\n        that.setupAddDropdown();\n        that.setupSwitchPortletManager();\n        that.setupSavePortletsSettings();\n        that.setupPortletEdit();\n        if (that.isModal) {\n            /* if we're in a modal, it's possible we have a link to\n            parent case, bind the link so we can reload modal */\n            $(\".portlets-link-to-parent\")\n                .off(\"click\")\n                .on(\"click\", function (e) {\n                    that.loading.show();\n                    var $el = $(this);\n                    e.preventDefault();\n                    $.ajax({\n                        url: $el.attr(\"href\"),\n                        data: {\n                            ajax_load: 1,\n                        },\n                    }).done(function (html) {\n                        var $body = $(utils.parseBodyTag(html));\n                        var $modal = $el.parents(\".plone-modal-body\");\n                        $modal.empty();\n                        var $content = $(\"#content\", $body);\n                        var $h1 = $(\"h1\", $content);\n                        $(\".plone-modal-header\", $modal.parent())\n                            .find(\"h2\")\n                            .html($h1.html());\n                        $h1.remove();\n                        $modal.append($content);\n                        that.rebind($(\".pat-manage-portlets\", $content), true);\n                        that.loading.hide();\n                    });\n                });\n        }\n    },\n    rebind: function ($el, suppress) {\n        log.info(\"rebind\");\n        if ($.contains(document, this.$el[0])) {\n            // $el is not detached, replace it\n            this.$el.replaceWith($el);\n        }\n        this.$el = $el;\n        this.bind();\n        if (!suppress) {\n            this.statusMessage();\n        }\n        this.dirty = true;\n    },\n    statusMessage: function (msg) {\n        if (msg === undefined) {\n            msg = _t(\"Portlet changes saved\");\n        }\n        var that = this;\n\n        var $message = $(\"#portlet-message\");\n        if ($message.length === 0) {\n            $message = $(\n                '<div class=\"alert alert-info\" role=\"alert\" id=\"portlet-message\" style=\"opacity: 0\"></div>'\n            );\n            if (that.isModal) {\n                $(\".plone-modal-body:visible\").prepend($message);\n            } else {\n                $(\"#content-core\").prepend($message);\n            }\n        }\n        $message.html('<strong class=\"mr-1\">' + _t(\"Info\") + \"</strong>\" + msg);\n        clearTimeout(that.messageTimeout);\n        $message.fadeTo(500, 1);\n        that.messageTimeout = window.setTimeout(function () {\n            $message.fadeTo(500, 0.6);\n        }, 3000);\n    },\n    showEditPortlet: function (url) {\n        log.info(\"show edit portlet in modal\");\n        var that = this;\n        var $a = $(\"<a/>\");\n        $(\"body\").append($a);\n        var pattern = new Modal($a, {\n            ajaxUrl: url,\n            actionOptions: {\n                displayInModal: false,\n                reloadWindowOnClose: false,\n                isForm: true,\n                onSuccess: function (modal, html) {\n                    pattern.hide();\n                    var $body = $(utils.parseBodyTag(html));\n                    that.rebind($(\"#\" + that.$el.attr(\"id\"), $body).eq(0));\n                    that.statusMessage(_t(\"Portlet added\"));\n                },\n            },\n        });\n        pattern.on(\"after-render\", function () {\n            var $el = $(\"#\" + that.$el.attr(\"id\"), pattern.$raw);\n            /* this is a check that the add form doesn't just automatically\n            create the portlet without an actual form.\n            If element is found here, we can short circuit and\n            continue on. */\n            if ($el.length === 1) {\n                /* hacky, trying to prevent modal parts from flickering here */\n                $el = $el.clone();\n                pattern.on(\"shown\", function () {\n                    pattern.hide();\n                });\n                that.rebind($el);\n                that.statusMessage(_t(\"Portlet added\"));\n            }\n        });\n        pattern.show();\n    },\n    setupPortletEdit: function () {\n        var that = this;\n        $(\".managedPortlet .portletHeader > a\", that.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            that.showEditPortlet($(this).attr(\"href\"));\n        });\n    },\n    setupAddDropdown: function () {\n        var that = this;\n        $(\".add-portlet\", that.$el).on(\"change\", function (e) {\n            e.preventDefault();\n            var $select = $(this);\n            var $form = $select.parents(\"form\");\n            var contextUrl = $select.attr(\"data-context-url\");\n            var url =\n                contextUrl +\n                $select.val() +\n                \"?_authenticator=\" +\n                $('[name=\"_authenticator\"]').val() +\n                \"&referer=\" +\n                $('[name=\"referer\"]', $form).val();\n            that.showEditPortlet(url);\n        });\n    },\n    setupSavePortletsSettings: function () {\n        var that = this;\n        $(\".portlets-settings, form.portlet-action\", that.$el).ajaxForm({\n            beforeSubmit: function () {\n                that.loading.show();\n            },\n            success: function (html) {\n                that.loading.hide();\n                log.info(\"form submit\");\n                var $body = $(utils.parseBodyTag(html));\n                that.rebind($(\"#\" + that.$el.attr(\"id\"), $body).eq(0));\n            },\n        });\n        // Block/unblock inherited portlets (parent, group and content type portlets)\n        $(\".portlets-settings select\", that.$el).on(\"change\", function () {\n            log.info(\"select change\");\n            clearTimeout(that.submitTimeout);\n            that.submitTimeout = window.setTimeout(function () {\n                $(\".portlets-settings\", that.$el).trigger(\"submit\");\n            }, 100);\n        });\n    },\n    setupSwitchPortletManager: function () {\n        var that = this;\n        $(\"#main-container\").on(\"change\", \".switch-portlet-manager\", function (e) {\n            e.stopImmediatePropagation();\n            log.info(\"switch portlet manager\");\n            var url_ = $(this).val();\n            clearTimeout(that.switchTimeout);\n            that.switchTimeout = window.setTimeout(function () {\n                that._reloadPortletManager(url_);\n            }, 100);\n        });\n        // Handle back/forward browser buttons\n        $(window).on(\"popstate\", function (e) {\n            e.stopImmediatePropagation();\n            if (e && e.state === undefined) {\n                var url_ = window.location.href;\n                log.info(\"redirecting to: \" + url_);\n                that._reloadPortletManager(url_, true);\n            }\n        });\n    },\n    _reloadPortletManager: function (url_, is_popstate) {\n        var that = this;\n        that.loading.show();\n        $.get(url_, { ajax_load: 1 }).done(function (html) {\n            var $html = $(utils.parseBodyTag(html));\n            var $content = (\"#content\", $html);\n            $(\"#content\").html($content);\n            that.rebind($(\".pat-manage-portlets\", $content), true);\n            if (!is_popstate) {\n                window.history.pushState(null, null, url_);\n            } else {\n                window.history.replaceState(null, null, url_);\n            }\n            that.loading.hide();\n        });\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport DisplayTemplate from \"./templates/display.xml\";\nimport FormTemplate from \"./templates/form.xml\";\nimport OccurrenceTemplate from \"./templates/occurrence.xml\";\nimport Modal from \"../modal/modal\";\nimport utils from \"../../core/utils\";\n\n// Formatting function (mostly) from jQueryTools dateinput\nvar Re = /d{1,4}|m{1,4}|yy(?:yy)?|\"[^\"]*\"|'[^']*'/g;\n\nfunction zeropad(val, len) {\n    val = val.toString();\n    len = len || 2;\n    while (val.length < len) {\n        val = \"0\" + val;\n    }\n    return val;\n}\n\nfunction format(date, fmt, conf) {\n    var d = date.getDate(),\n        D = date.getDay(),\n        m = date.getMonth(),\n        y = date.getFullYear(),\n        flags = {\n            d: d,\n            dd: zeropad(d),\n            ddd: conf.localization.shortWeekdays[D],\n            dddd: conf.localization.weekdays[D],\n            m: m + 1,\n            mm: zeropad(m + 1),\n            mmm: conf.localization.shortMonths[m],\n            mmmm: conf.localization.months[m],\n            yy: String(y).slice(2),\n            yyyy: y,\n        };\n\n    var result = fmt.replace(Re, function ($0) {\n        return Object.prototype.hasOwnProperty.call(flags, $0)\n            ? flags[$0]\n            : $0.slice(1, $0.length - 1);\n    });\n\n    return result;\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction widgetSaveToRfc5545(form, RDATE, EXDATE, conf, tz) {\n    var value = form.find(\"select[name=rirtemplate]\").val();\n    var rtemplate = conf.rtemplate[value];\n    var result = \"RRULE:\" + rtemplate.rrule;\n    var human = conf.localization.rtemplate[value];\n    var interval, month, year, occurrences, day;\n    var weekdays, i18nweekdays, input, monthlyType, index;\n    var yearlyType, rangeType;\n\n    for (const field_id of rtemplate.fields) {\n        const field = form.find(`#${field_id}`);\n\n        switch (field.attr(\"id\")) {\n            case \"ridailyinterval\":\n                interval = field.find(\"input[name=ridailyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.dailyInterval2}`;\n                break;\n\n            case \"riweeklyinterval\":\n                interval = field.find(\"input[name=riweeklyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.weeklyInterval2}`;\n                break;\n\n            case \"riweeklyweekdays\":\n                weekdays = [];\n                i18nweekdays = [];\n                for (let j = 0; j < conf.weekdays.length; j++) {\n                    input = field.find(`input[name=riweeklyweekdays${j}]`);\n                    if (input.is(\":checked\")) {\n                        weekdays.push(conf.weekdays[j]);\n                        i18nweekdays.push(conf.localization.weekdays[j]);\n                    }\n                }\n                if (weekdays.length > 0) {\n                    result += `;BYDAY=${weekdays.join(\",\")}`;\n                    human += ` ${\n                        conf.localization.weeklyWeekdaysHuman\n                    } ${i18nweekdays.join(\",\")}`;\n                }\n                break;\n\n            case \"rimonthlyinterval\":\n                interval = field.find(\"input[name=rimonthlyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.monthlyInterval2}`;\n                break;\n\n            case \"rimonthlyoptions\":\n                monthlyType = $(\"input[name=rimonthlytype]:checked\", form).val();\n                if (monthlyType === \"DAYOFMONTH\") {\n                    day = $(\"select[name=rimonthlydayofmonthday]\", form).val();\n                    result += `;BYMONTHDAY=${day}`;\n                    human += `, ${conf.localization.monthlyDayOfMonth1Human} ${day} ${conf.localization.monthlyDayOfMonth2}`;\n                } else if (monthlyType === \"WEEKDAYOFMONTH\") {\n                    index = $(\"select[name=rimonthlyweekdayofmonthindex]\", form).val();\n                    day =\n                        conf.weekdays[\n                            $(\"select[name=rimonthlyweekdayofmonth]\", form).val()\n                        ];\n                    if ([\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"].includes(day)) {\n                        result += `;BYDAY=${index}${day}`;\n                        human += `, ${conf.localization.monthlyWeekdayOfMonth1Human} `;\n                        human += `${\n                            conf.localization.orderIndexes[\n                                conf.orderIndexes.indexOf(index)\n                            ]\n                        } ${conf.localization.monthlyWeekdayOfMonth2} `;\n                        human += `${\n                            conf.localization.weekdays[conf.weekdays.indexOf(day)]\n                        } ${conf.localization.monthlyDayOfMonth2}`;\n                    }\n                }\n                break;\n\n            case \"riyearlyinterval\":\n                interval = field.find(\"input[name=riyearlyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.yearlyInterval2}`;\n                break;\n\n            case \"riyearlyoptions\":\n                yearlyType = $(\"input[name=riyearlyType]:checked\", form).val();\n                month = \"\";\n\n                if (yearlyType === \"DAYOFMONTH\") {\n                    month = $(\"select[name=riyearlydayofmonthmonth]\", form).val();\n                    day = $(\"select[name=riyearlydayofmonthday]\", form).val();\n                    result += `;BYMONTH=${month};BYMONTHDAY=${day}`;\n                    human += `, ${conf.localization.yearlyDayOfMonth1Human} ${\n                        conf.localization.months[month - 1]\n                    } ${day}`;\n                } else if (yearlyType === \"WEEKDAYOFMONTH\") {\n                    index = $(\"select[name=riyearlyweekdayofmonthindex]\", form).val();\n                    day =\n                        conf.weekdays[\n                            $(\"select[name=riyearlyweekdayofmonthday]\", form).val()\n                        ];\n                    month = $(\"select[name=riyearlyweekdayofmonthmonth]\", form).val();\n                    result += `;BYMONTH=${month}`;\n                    if ([\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"].includes(day)) {\n                        result += `;BYDAY=${index}${day}`;\n                        human += \", \" + conf.localization.yearlyWeekdayOfMonth1Human;\n                        human +=\n                            \" \" +\n                            conf.localization.orderIndexes[\n                                $.inArray(index, conf.orderIndexes)\n                            ];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth2;\n                        human +=\n                            \" \" +\n                            conf.localization.weekdays[$.inArray(day, conf.weekdays)];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth3;\n                        human += \" \" + conf.localization.months[month - 1];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth4;\n                    }\n                }\n                break;\n\n            case \"rirangeoptions\":\n                rangeType = form.find(\"input[name=rirangetype]:checked\").val();\n                if (rangeType === \"BYOCCURRENCES\") {\n                    occurrences = form\n                        .find(\"input[name=rirangebyoccurrencesvalue]\")\n                        .val();\n                    result += `;COUNT=${occurrences}`;\n                    human += `, ${conf.localization.rangeByOccurrences1Human} ${occurrences} ${conf.localization.rangeByOccurrences2}`;\n                } else if (rangeType === \"BYENDDATE\") {\n                    let date = form.find(\"input[name=rirangebyenddatecalendar]\").val();\n                    if (date === \"\") {\n                        const today = new Date();\n                        date = `${today.getFullYear()}-${(today.getMonth() + 1)\n                            .toString()\n                            .padStart(2, \"0\")}-${today.getDate()}`;\n                    }\n                    result += `;UNTIL=${date.replaceAll(\"-\", \"\")}T000000${\n                        tz === true ? \"Z\" : \"\"\n                    }`;\n                    human += `, ${conf.localization.rangeByEndDateHuman} `;\n                    var date_parts = date.split(\"-\");\n                    human += format(\n                        new Date(date_parts[0], date_parts[1] - 1, date_parts[2]),\n                        conf.localization.longDateFormat,\n                        conf\n                    );\n                }\n                break;\n        }\n    }\n\n    if (RDATE.length) {\n        RDATE.sort();\n        let tmp_dates = [];\n        let tmp_human = [];\n\n        // make sure our additional RDATE dates have the same start time\n        // XXX: not used, remove if superfluous\n        //const rdate_time = start_date\n        //    ? `T${start_date.getHours()}:${start_date.getMinutes()}:00`\n        //    : \"T00:00:00\";\n\n        for (let rdate of RDATE) {\n            if (rdate !== \"\") {\n                // RDATE values are \"YYYY-MM-DD\"\n                // by adding \"T000000\" the recurrence sequence generator of\n                // plone.event.recurrence adds the current start time correctly\n                rdate += rdate.length === 10 ? \"T000000\" : \"\";\n                rdate += tz ? \"Z\" : \"\";\n                tmp_dates.push(rdate);\n\n                // human readable RDATE\n                year = parseInt(rdate.substring(0, 4), 10);\n                month = parseInt(rdate.substring(5, 7), 10) - 1;\n                day = parseInt(rdate.substring(8, 10), 10);\n                tmp_human.push(\n                    format(\n                        new Date(year, month, day),\n                        conf.localization.longDateFormat,\n                        conf\n                    )\n                );\n            }\n        }\n        if (tmp_dates.length) {\n            result += `\\nRDATE:${tmp_dates.join(\",\")}`;\n            human += `${conf.localization.including} ${tmp_human.join(\"; \")}`;\n        }\n    }\n\n    if (EXDATE.length) {\n        EXDATE.sort();\n        let tmp_dates = [];\n        let tmp_human = [];\n        for (let exdate of EXDATE) {\n            if (exdate !== \"\") {\n                // EXDATE values are \"YYYYMMDDTHHMMZ\"\n                tmp_dates.push(exdate);\n\n                // human readable EXDATE\n                year = parseInt(exdate.substring(0, 4), 10);\n                month = parseInt(exdate.substring(4, 6), 10) - 1;\n                day = parseInt(exdate.substring(6, 8), 10);\n                tmp_human.push(\n                    format(\n                        new Date(year, month, day),\n                        conf.localization.longDateFormat,\n                        conf\n                    )\n                );\n            }\n        }\n        if (tmp_dates.length) {\n            result += `\\nEXDATE:${tmp_dates.join(\",\")}`;\n            human += `${conf.localization.except} ${tmp_human.join(\"; \")}`;\n        }\n    }\n\n    return { result: result, description: human };\n}\n\nfunction parseLine(icalline) {\n    var result = {};\n    var pos = icalline.indexOf(\":\");\n    var property = icalline.substring(0, pos);\n    result.value = icalline.substring(pos + 1);\n\n    if (property.indexOf(\";\") !== -1) {\n        pos = property.indexOf(\";\");\n        result.parameters = property.substring(pos + 1);\n        result.property = property.substring(0, pos);\n    } else {\n        result.parameters = null;\n        result.property = property;\n    }\n    return result;\n}\n\nfunction cleanDates(dates) {\n    // Get rid of timezones\n    // TODO: We could parse dates and range here, maybe?\n    var result = [];\n\n    for (const date of dates.split(\",\")) {\n        if (date.indexOf(\"Z\") !== -1) {\n            result.push(date.substring(0, 15));\n        } else {\n            result.push(date);\n        }\n    }\n    return result;\n}\n\nfunction parseIcal(icaldata) {\n    var lines = [];\n    var result = {\n        RRULE: \"\",\n        RDATE: [],\n        EXDATE: [],\n    };\n    var line = null;\n    var nextline;\n\n    lines = icaldata.split(\"\\n\");\n    lines.reverse();\n    while (line !== \"\") {\n        if (lines.length > 0) {\n            nextline = lines.pop();\n            if (nextline.charAt(0) === \" \" || nextline.charAt(0) === \"\\t\") {\n                // Line continuation:\n                line = line + nextline;\n                continue;\n            }\n        } else {\n            nextline = \"\";\n        }\n\n        // New line; the current one is finished, add it to the result.\n        if (line !== null) {\n            line = parseLine(line);\n            // We ignore properties for now\n            if (line.property === \"RDATE\" || line.property === \"EXDATE\") {\n                result[line.property] = cleanDates(line.value);\n            } else {\n                result[line.property] = line.value;\n            }\n        }\n\n        line = nextline;\n    }\n    return result;\n}\n\nfunction widgetLoadFromRfc5545(form, conf, icaldata, force) {\n    var unsupportedFeatures = [];\n    var matches, rtemplate, d, input, index;\n    var selectors, field, radiobutton;\n    var freq, interval, byday, bymonth, bymonthday, count, until;\n    var day, month, year, weekday;\n\n    if (icaldata.RRULE === undefined) {\n        unsupportedFeatures.push(conf.localization.noRule);\n        if (!force) {\n            return -1; // Fail!\n        }\n    } else {\n        matches = /FREQ=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            freq = matches[1];\n        } else {\n            freq = \"DAILY\";\n        }\n\n        matches = /INTERVAL=([0-9]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            interval = matches[1];\n        } else {\n            interval = \"1\";\n        }\n\n        matches = /BYDAY=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            byday = matches[1];\n        } else {\n            byday = \"\";\n        }\n\n        matches = /BYMONTHDAY=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            bymonthday = matches[1].split(\",\");\n        } else {\n            bymonthday = null;\n        }\n\n        matches = /BYMONTH=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            bymonth = matches[1].split(\",\");\n        } else {\n            bymonth = null;\n        }\n\n        matches = /COUNT=([0-9]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            count = matches[1];\n        } else {\n            count = null;\n        }\n\n        matches = /UNTIL=([0-9T]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            until = matches[1];\n        } else {\n            until = null;\n        }\n\n        matches = /BYSETPOS=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            unsupportedFeatures.push(conf.localization.bysetpos);\n        }\n\n        // Find the best rule:\n        if (Object.prototype.hasOwnProperty.call(conf.rtemplate, freq.toLowerCase())) {\n            rtemplate = conf.rtemplate[freq.toLowerCase()];\n        } else {\n            for (freq of conf.rtemplate) {\n                /* fallback to first available template if no match above*/\n                rtemplate = conf.rtemplate[freq];\n                break;\n            }\n            unsupportedFeatures.push(conf.localization.noTemplateMatch);\n        }\n\n        // set rirtemplate selector to computed value\n        form.find(\"select[name='rirtemplate']\").val(freq.toLowerCase());\n\n        for (const field_id of rtemplate.fields) {\n            field = form.find(`#${field_id}`);\n            switch (field.attr(\"id\")) {\n                case \"ridailyinterval\":\n                    field.find(\"input[name=ridailyinterval]\").val(interval);\n                    break;\n\n                case \"riweeklyinterval\":\n                    field.find(\"input[name=riweeklyinterval]\").val(interval);\n                    break;\n\n                case \"riweeklyweekdays\":\n                    if (byday.length === 0) break;\n                    byday = byday.split(\",\");\n                    for (d = 0; d < conf.weekdays.length; d++) {\n                        input = field.find(`input[name=\"riweeklyweekdays${d}\"]`);\n                        if (input.length === 0) continue;\n                        day = conf.weekdays[d];\n                        input.attr(\"checked\", byday.includes(day));\n                    }\n                    break;\n\n                case \"rimonthlyinterval\":\n                    field.find(\"input[name=rimonthlyinterval]\").val(interval);\n                    break;\n\n                case \"rimonthlyoptions\":\n                    var monthlyType = \"DAYOFMONTH\"; // Default to using BYMONTHDAY\n\n                    if (bymonthday) {\n                        monthlyType = \"DAYOFMONTH\";\n                        if (bymonthday.length > 1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            // Just keep the first\n                            bymonthday = bymonthday[0];\n                        }\n                        field\n                            .find(\"select[name=rimonthlydayofmonthday]\")\n                            .val(bymonthday);\n                    }\n\n                    if (byday) {\n                        monthlyType = \"WEEKDAYOFMONTH\";\n\n                        if (byday.indexOf(\",\") !== -1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            byday = byday.split(\",\")[0];\n                        }\n                        index = byday.slice(0, -2);\n                        if (index.charAt(0) !== \"+\" && index.charAt(0) !== \"-\") {\n                            index = \"+\" + index;\n                        }\n                        weekday = byday.slice(-2);\n                        field\n                            .find(\"select[name=rimonthlyweekdayofmonthindex]\")\n                            .val(index);\n                        const day_index = conf.weekdays.indexOf(weekday);\n                        field.find(\"select[name=rimonthlyweekdayofmonth]\").val(day_index);\n                    }\n\n                    selectors = field.find(\"input[name=rimonthlytype]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\n                            \"checked\",\n                            radiobutton.value === monthlyType\n                        );\n                    }\n                    break;\n\n                case \"riyearlyinterval\":\n                    field.find(\"input[name=riyearlyinterval]\").val(interval);\n                    break;\n\n                case \"riyearlyoptions\":\n                    var yearlyType = \"DAYOFMONTH\"; // Default to using BYMONTHDAY\n\n                    if (bymonthday) {\n                        yearlyType = \"DAYOFMONTH\";\n                        if (bymonthday.length > 1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            bymonthday = bymonthday[0];\n                        }\n                        field.find(\"select[name=riyearlydayofmonthmonth]\").val(bymonth);\n                        field.find(\"select[name=riyearlydayofmonthday]\").val(bymonthday);\n                    }\n\n                    if (byday) {\n                        yearlyType = \"WEEKDAYOFMONTH\";\n\n                        if (byday.indexOf(\",\") !== -1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            byday = byday.split(\",\")[0];\n                        }\n                        index = byday.slice(0, -2);\n                        if (index.charAt(0) !== \"+\" && index.charAt(0) !== \"-\") {\n                            index = \"+\" + index;\n                        }\n                        weekday = byday.slice(-2);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthindex]\")\n                            .val(index);\n\n                        const weekday_index = conf.weekdays.indexOf(weekday);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthday]\")\n                            .val(weekday_index);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthmonth]\")\n                            .val(bymonth);\n                    }\n\n                    selectors = field.find(\"input[name=riyearlyType]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\"checked\", radiobutton.value === yearlyType);\n                    }\n                    break;\n\n                case \"rirangeoptions\":\n                    // default value per configuration\n                    var rangeType = conf.hasRepeatForeverButton ? \"NOENDDATE\" : \"BYOCCURRENCES\";\n\n                    if (count) {\n                        rangeType = \"BYOCCURRENCES\";\n                        field.find(\"input[name=rirangebyoccurrencesvalue]\").val(count);\n                    }\n\n                    if (until) {\n                        rangeType = \"BYENDDATE\";\n                        input = field.find(\"input[name=rirangebyenddatecalendar]\");\n                        year = until.slice(0, 4);\n                        month = until.slice(4, 6);\n                        day = until.slice(6, 8);\n                        input.val(`${year}-${month}-${day}`);\n                    }\n\n                    selectors = field.find(\"input[name=rirangetype]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\"checked\", radiobutton.value === rangeType);\n                    }\n                    break;\n            }\n        }\n    }\n\n    var messagearea = form.find(\"#messagearea\");\n    if (unsupportedFeatures.length !== 0) {\n        messagearea.text(\n            conf.localization.unsupportedFeatures + \" \" + unsupportedFeatures.join(\"; \")\n        );\n        messagearea.show();\n        return 1;\n    } else {\n        messagearea.text(\"\");\n        messagearea.hide();\n        return 0;\n    }\n}\n\nconst RecurrenceInput = function (conf, textarea) {\n    var self = this;\n    var $textarea = $(textarea);\n\n    // initalize parsed icaldata\n    if (textarea.innerHTML) {\n        textarea[\"ical\"] = parseIcal(textarea.innerHTML);\n    } else {\n        textarea[\"ical\"] = {\n            RRULE: \"\",\n            RDATE: [],\n            EXDATE: [],\n        };\n    }\n\n    // Extend conf with non-configurable data used by templates.\n    var orderedWeekdays = [];\n    var now_date = new Date().toISOString().substring(0, 10);\n    var index;\n\n    for (let i = 0; i < 7; i++) {\n        index = i + conf.firstDay;\n        if (index > 6) {\n            index = index - 7;\n        }\n        orderedWeekdays.push(index);\n    }\n\n    conf = {\n        ...conf,\n        orderIndexes: [\"+1\", \"+2\", \"+3\", \"+4\", \"-1\"],\n        weekdays: [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"],\n        orderedWeekdays: orderedWeekdays,\n    };\n\n    // The recurrence type dropdown should show certain fields depending\n    // on selection:\n    function displayFields(selector) {\n        // First hide all the fields\n        self.$modalForm.find(\".rifield\").hide();\n        // Then show the ones that should be shown.\n        var value = selector.val();\n        if (value) {\n            for (const rtField of conf.rtemplate[value].fields) {\n                self.$modalForm.find(`#${rtField}`).show();\n            }\n        }\n    }\n\n    function occurrenceExclude(event) {\n        event.preventDefault();\n        textarea[\"ical\"].EXDATE.push(this.attributes.date.value);\n        var $this = $(this);\n        $this.addClass(\"exdate\");\n        $this.parent().parent().addClass(\"exdate\");\n        $this.off(\"click\").on(\"click\", occurrenceInclude);\n    }\n\n    function occurrenceInclude(event) {\n        event.preventDefault();\n        textarea[\"ical\"].EXDATE.splice(\n            $.inArray(this.attributes.date.value, textarea[\"ical\"].EXDATE),\n            1\n        );\n        var $this = $(this);\n        $this.removeClass(\"exdate\");\n        $this.parent().parent().removeClass(\"exdate\");\n        $this.off(\"click\").on(\"click\", occurrenceExclude);\n    }\n\n    function occurrenceDelete(event) {\n        event.preventDefault();\n        textarea[\"ical\"].RDATE.splice(\n            $.inArray(this.attributes.date.value, textarea[\"ical\"].RDATE),\n            1\n        );\n        $(this)\n            .parent()\n            .parent()\n            .hide(\"slow\", function () {\n                $(this).remove();\n            });\n    }\n\n    function occurrenceAdd(event) {\n        event.preventDefault();\n        var datevalue = self.$modalForm.find(\".riaddoccurrence input#adddate\").val();\n        var date_parts = datevalue.split(\"-\");\n        datevalue += datevalue.length === 10 ? \"T000000\" : \"\";\n        var errorarea = self.$modalForm.find(\".riaddoccurrence div.alert\");\n        errorarea.text(\"\");\n        errorarea.hide();\n\n        // Add date only if it is not already in RDATE\n        if (!textarea[\"ical\"].RDATE.includes(datevalue)) {\n            textarea[\"ical\"].RDATE.push(datevalue);\n            var $newdate =\n                $(`<div class=\"d-flex justify-content-between occurrence rdate\">\n                <span class=\"rdate\">\n                    ${format(\n                        new Date(date_parts[0], date_parts[1] - 1, date_parts[2]),\n                        conf.localization.longDateFormat,\n                        conf\n                    )},\n                    <span class=\"rlabel\">${conf.localization.additionalDate}</span>\n                </span>\n                <span class=\"action\">\n                    <a date=\"${datevalue}\" href=\"#\" class=\"btn btn-sm btn-secondary rdate\" >\n                        ${conf.icons.remove}\n                    </a>\n                </span>\n                </div>`);\n            $newdate.hide();\n            self.$modalForm.find(\"div.rioccurrences\").prepend($newdate);\n            $newdate.slideDown();\n            $newdate.find(\"a.rdate\").on(\"click\", occurrenceDelete);\n        } else {\n            errorarea.text(conf.localization.alreadyAdded).show();\n        }\n    }\n\n    // element is where to find the tag in question. Can be the form\n    // or the display widget. Defaults to the self.$modalForm.\n    function loadOccurrences(startdate, rfc5545, start, readonly) {\n        var element, occurrenceDiv;\n\n        if (!readonly) {\n            element = self.$modalForm;\n        } else {\n            element = self.display;\n        }\n\n        occurrenceDiv = element.find(\".rioccurrences\");\n        occurrenceDiv.hide();\n\n        const year = startdate.getFullYear();\n        const month = startdate.getMonth() + 1;\n        const day = startdate.getDate();\n\n        var data = {\n            year: year,\n            month: month, // Sending January as 0? I think not.\n            day: day,\n            rrule: rfc5545,\n            format: conf.localization.longDateFormat,\n            start: start,\n        };\n\n        $.ajax({\n            url: conf.ajaxURL,\n            async: false, // Can't be tested if it's asynchronous, annoyingly.\n            type: \"post\",\n            dataType: \"json\",\n            contentType: conf.ajaxContentType,\n            cache: false,\n            data: data,\n            success: function (resp) {\n                var result;\n\n                resp.readOnly = readonly;\n                resp.localization = conf.localization;\n                resp.icons = conf.icons;\n\n                // Format dates:\n                var date, y, m, d;\n                for (let occurrence of resp.occurrences) {\n                    date = occurrence.date;\n                    y = parseInt(date.substring(0, 4), 10);\n                    m = parseInt(date.substring(4, 6), 10) - 1; // jan=0\n                    d = parseInt(date.substring(6, 8), 10);\n                    occurrence.date = `${y}-${zeropad(m+1)}-${zeropad(d)}T000000`;\n                    occurrence.formattedDate = format(\n                        new Date(y, m, d),\n                        conf.localization.longDateFormat,\n                        conf\n                    );\n                }\n\n                result = _.template(OccurrenceTemplate)(resp);\n                occurrenceDiv.replaceWith(result);\n\n                // Add the batch actions:\n                element.find(\".rioccurrences .batching a\").on(\"click\", function (event) {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    loadOccurrences(\n                        startdate,\n                        rfc5545,\n                        this.attributes.start.value,\n                        readonly\n                    );\n                });\n\n                // Add the delete/undelete actions:\n                if (!readonly) {\n                    element\n                        .find(\".rioccurrences .action a.rrule\")\n                        .on(\"click\", occurrenceExclude);\n                    element\n                        .find(\".rioccurrences .action a.exdate\")\n                        .on(\"click\", occurrenceInclude);\n                    element\n                        .find(\".rioccurrences .action a.rdate\")\n                        .on(\"click\", occurrenceDelete);\n                }\n                // Show the new div\n                occurrenceDiv.show();\n            },\n            error: function (jqXHR, textStatus) {\n                alert(textStatus);\n            },\n        });\n    }\n\n    function getField(field) {\n        // See if it is a field already\n        var realField = $(field);\n        if (!realField.length) {\n            // Otherwise, we assume it's an id:\n            realField = $(\"#\" + field);\n        }\n        if (!realField.length) {\n            // Still not? Then it's a name.\n            realField = $(\"input[name='\" + field + \"']\");\n        }\n        return realField;\n    }\n    function findStartDate() {\n        var startdate = null;\n        var startField, startFieldYear, startFieldMonth, startFieldDay;\n\n        // Find the default byday and bymonthday from the start date, if any:\n        if (conf.startField) {\n            startField = getField(conf.startField);\n            if (!startField.length) {\n                // Field not found\n                return null;\n            }\n            startdate = startField.val();\n            if (startdate === \"\") {\n                // Probably not an input at all. Try to see if it contains a date\n                startdate = startField.text();\n            }\n\n            if (typeof startdate === \"string\") {\n                // convert human readable, non ISO8601 dates, like\n                // '2014-04-24 19:00', where the 'T' separator is missing.\n                startdate = startdate.replace(\" \", \"T\");\n            }\n\n            startdate = new Date(startdate);\n        } else if (conf.startFieldYear && conf.startFieldMonth && conf.startFieldDay) {\n            startFieldYear = getField(conf.startFieldYear);\n            startFieldMonth = getField(conf.startFieldMonth);\n            startFieldDay = getField(conf.startFieldDay);\n            if (\n                !startFieldYear.length &&\n                !startFieldMonth.length &&\n                !startFieldDay.length\n            ) {\n                // Field not found\n                return null;\n            }\n            startdate = new Date(\n                startFieldYear.val(),\n                startFieldMonth.val() - 1,\n                startFieldDay.val()\n            );\n        }\n        if (startdate === null) {\n            return null;\n        }\n        // We have some sort of startdate:\n        if (isNaN(startdate)) {\n            return null;\n        }\n        return startdate;\n    }\n    function findEndDate() {\n        var endField, enddate;\n\n        endField = self.$modalForm.find(\"input[name=rirangebyenddatecalendar]\");\n        enddate = endField.val();\n        enddate = new Date(enddate);\n\n        // if the end date is incorrect or the field is left empty\n        if (isNaN(enddate) || endField.val() === \"\") {\n            return null;\n        }\n        return enddate;\n    }\n    function findIntField(fieldName) {\n        var field, num;\n\n        field = self.$modalForm.find(\"input[name=\" + fieldName + \"]\");\n\n        num = field.val();\n\n        // if it's not a number or the field is left empty\n        if (isNaN(num) || num.toString().indexOf(\".\") !== -1 || field.val() === \"\") {\n            return null;\n        }\n        return num;\n    }\n\n    // Loading (populating) display and form widget with\n    // passed RFC5545 string (data)\n    function loadData(form) {\n        widgetLoadFromRfc5545(form, conf, textarea[\"ical\"], true);\n\n        const startdate = findStartDate();\n\n        if (startdate !== null) {\n            // If the date is a real date, set the defaults in the form\n            document.querySelector(\"select[name=rimonthlydayofmonthday]\").value =\n                startdate.getDate();\n            const dayindex =\n                conf.orderIndexes[Math.floor((startdate.getDate() - 1) / 7)];\n            const day = conf.weekdays[startdate.getDay()];\n            document.querySelector(\"select[name=rimonthlyweekdayofmonthindex]\").value =\n                dayindex;\n            document.querySelector(\"select[name=rimonthlyweekdayofmonth]\").value = day;\n\n            document.querySelector(\"select[name=riyearlydayofmonthmonth]\").value =\n                startdate.getMonth() + 1;\n            document.querySelector(\"select[name=riyearlydayofmonthday]\").value =\n                startdate.getDate();\n            document.querySelector(\"select[name=riyearlyweekdayofmonthindex]\").value =\n                dayindex;\n            document.querySelector(\"select[name=riyearlyweekdayofmonthday]\").value = day;\n            document.querySelector(\"select[name=riyearlyweekdayofmonthmonth]\").value =\n                startdate.getMonth() + 1;\n\n            // Now when we have a start date, we can also do an ajax call to calculate occurrences:\n            var rfc5545 =\n                textarea.innerHTML ||\n                widgetSaveToRfc5545(\n                    form,\n                    textarea[\"ical\"].RDATE,\n                    textarea[\"ical\"].EXDATE,\n                    conf,\n                    false\n                ).result;\n\n            loadOccurrences(startdate, rfc5545, 0, false);\n\n            // Show the add and refresh buttons:\n            document.querySelector(\"div.rioccurrencesactions\").style.display = \"block\";\n        } else {\n            // No EXDATE/RDATE support\n            document.querySelector(\"div.rioccurrencesactions\").style.display = \"none\";\n        }\n\n        displayFields(form.find(\"select[name=rirtemplate]\"));\n    }\n\n    function recurrenceOn(form) {\n        var RFC5545 = widgetSaveToRfc5545(\n            form,\n            textarea[\"ical\"].RDATE,\n            textarea[\"ical\"].EXDATE,\n            conf,\n            false\n        );\n        var label = self.display.find(\"label[class=ridisplay-label]\");\n        label.text(conf.localization.displayActivate + \" \" + RFC5545.description);\n        textarea[\"ical\"] = parseIcal(RFC5545.result);\n        textarea.innerHTML = RFC5545.result;\n        $textarea.trigger(\"change\");\n        var startdate = findStartDate();\n        if (startdate !== null) {\n            loadOccurrences(startdate, RFC5545.result, 0, true);\n        }\n        self.display.find('a[name=\"riedit\"]').text(conf.localization.edit_rules);\n        self.display.find('a[name=\"ridelete\"]').show();\n    }\n\n    function recurrenceOff() {\n        var label = self.display.find(\"label[class=ridisplay-label]\");\n        label.text(conf.localization.displayUnactivate);\n        // reset ical object\n        textarea[\"ical\"] = {\n            RRULE: \"\",\n            RDATE: [],\n            EXDATE: [],\n        };\n        textarea.innerHTML = \"\";\n        $textarea.trigger(\"change\"); // Clear the textarea.\n        self.display.find(\".rioccurrences\").hide();\n        self.display.find('a[name=\"riedit\"]').text(conf.localization.add_rules);\n        self.display.find('a[name=\"ridelete\"]').hide();\n    }\n\n    function checkFields(form) {\n        var startDate, endDate, num, messagearea;\n        startDate = findStartDate();\n\n        // Hide any error message from before\n        messagearea = self.$modalForm.find(\"#messagearea\");\n        messagearea.text(\"\");\n        messagearea.hide();\n\n        // Hide add field errors\n        self.$modalForm.find(\".riaddoccurrence div.alert\").text(\"\").hide();\n\n        // Repeats Daily\n        if (self.$modalForm.find(\"#ridailyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"ridailyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n        }\n\n        // Repeats Weekly\n        if (self.$modalForm.find(\"#riweeklyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"riweeklyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n        }\n\n        // Repeats Monthly\n        if (self.$modalForm.find(\"#rimonthlyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"rimonthlyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n\n            // Check repeat on\n            if (self.$modalForm.find(\"#rimonthlyoptions input:checked\").length === 0) {\n                messagearea.text(conf.localization.noRepeatOn).show();\n                return false;\n            }\n        }\n\n        // Repeats Yearly\n        if (self.$modalForm.find(\"#riyearlyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"riyearlyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n\n            // Check repeat on\n            if (self.$modalForm.find(\"#riyearlyoptions input:checked\").length === 0) {\n                messagearea.text(conf.localization.noRepeatOn).show();\n                return false;\n            }\n        }\n\n        // End recurrence fields\n\n        // If after N occurences is selected, check its value\n        if (\n            self.$modalForm.find('input[value=\"BYOCCURRENCES\"]:visible:checked').length >\n            0\n        ) {\n            num = findIntField(\"rirangebyoccurrencesvalue\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noEndAfterNOccurrences).show();\n                return false;\n            }\n        }\n\n        // If end date is selected, check its value\n        if (\n            self.$modalForm.find('input[value=\"BYENDDATE\"]:visible:checked').length > 0\n        ) {\n            endDate = findEndDate(form);\n            if (!endDate) {\n                // if endDate is null that means the field is empty\n                messagearea.text(conf.localization.noEndDate).show();\n                return false;\n            } else if (endDate < startDate) {\n                // the end date cannot be before start date\n                messagearea.text(conf.localization.pastEndDate).show();\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    function save(event) {\n        event.preventDefault();\n        // if no field errors, process the request\n        if (checkFields(self.$modalForm)) {\n            // close modal\n            self.modal.hide();\n            recurrenceOn(self.$modalForm);\n            self.$modalForm = null;\n        }\n    }\n\n    function cancel(event) {\n        event.preventDefault();\n        // close modal\n        self.modal.hide();\n        self.$modalForm = null;\n    }\n\n    function updateOccurrences() {\n        var startDate;\n        startDate = findStartDate();\n\n        // if no field errors, process the request\n        if (checkFields(form)) {\n            loadOccurrences(\n                startDate,\n                widgetSaveToRfc5545(\n                    self.$modalForm,\n                    textarea[\"ical\"].RDATE,\n                    textarea[\"ical\"].EXDATE,\n                    conf,\n                    false\n                ).result,\n                0,\n                false\n            );\n        }\n    }\n\n    function initModalForm() {\n        var enddate = self.$modalForm.find(\"input[name=rirangebyenddatecalendar]\");\n        if (!enddate.val()) {\n            var start_date = findStartDate();\n            start_date.setDate(start_date.getDate() + 1);\n            enddate.val(start_date.toISOString().substring(0, 10));\n        }\n\n        self.$modalForm.find(\"input#addaction\").on(\"click\", occurrenceAdd);\n\n        // When selecting template, update what fieldsets are visible and the occurrences.\n        self.$modalForm.find('select[name=\"rirtemplate\"]').on(\"change\", function () {\n            displayFields($(this));\n            updateOccurrences();\n        });\n\n        // Update the selected dates section\n        self.$modalForm\n            .find(\n                `\n                input:radio,\n                input:checkbox,\n                .riweeklyweekday > input,\n                input[name=ridailyinterval],\n                input[name=riweeklyinterval],\n                input[name=rimonthlyinterval],\n                input[name=riyearlyinterval],\n                input[name=rirangebyoccurrencesvalue],\n                input[name=rirangebyenddatecalendar],\n                #rimonthlyoptions select,\n                #riyearlyoptions select,\n                #riyearlyinterval select`\n            )\n            .on(\"change\", function () {\n                // Update only if the occurances are shown\n                if (self.$modalForm.find(\".rioccurrencesactions:visible\").length !== 0) {\n                    updateOccurrences();\n                }\n            });\n\n        // initialize occurrence adddate value\n        self.$modalForm.find(\"div.riaddoccurrence input#adddate\").val(now_date);\n\n        /*\n        Save and cancel methods:\n        */\n        self.$modalForm.find(\".ricancelbutton\").on(\"click\", cancel);\n        self.$modalForm.find(\".risavebutton\").on(\"click\", save);\n    }\n\n    /*\n      Load the templates\n    */\n\n    self.display = $(_.template(DisplayTemplate)(conf));\n    var form = $(_.template(FormTemplate)(conf));\n\n    form.appendTo(\"body\");\n    form.hide();\n\n    // Make an modal and hide it\n    self.modal = new Modal(form, {\n        content: \"div.riform\",\n        buttons: \".ributtons > button\",\n        modalSizeClass: \"modal-lg\",\n        backdropOptions: {\n            opacity: \"0.5\",\n        },\n    });\n\n    if (textarea.innerHTML) {\n        var result = widgetLoadFromRfc5545(form, conf, textarea[\"ical\"], false);\n        if (result === -1) {\n            var label = self.display.find(\"label[class=ridisplay-label]\");\n            label.text(conf.localization.noRule);\n        } else {\n            recurrenceOn(form);\n        }\n    }\n\n    /*\n      Do all the GUI stuff:\n    */\n\n    // When you click \"Delete...\", the recurrence rules should be cleared.\n    self.display.find('a[name=\"ridelete\"]').on(\"click\", function (e) {\n        e.preventDefault();\n        recurrenceOff();\n    });\n\n    // Show form modal when you click on the \"Edit...\" link\n    self.display.find('a[name=\"riedit\"]').on(\"click\", function (e) {\n        // Load the form to set up the right fields to show, etc.\n        e.preventDefault();\n        self.modal.show();\n        self.$modalForm = $(\"form\", self.modal.$modalContent);\n        loadData(self.$modalForm);\n        initModalForm();\n    });\n};\n\nexport default Base.extend({\n    name: \"recurrence\",\n    trigger: \".pat-recurrence\",\n    parser: \"mockup\",\n    defaults: {\n        localization: {\n            displayUnactivate: \"Does not repeat\",\n            displayActivate: \"Repeats every\",\n            add_rules: \"Add\",\n            edit_rules: \"Edit\",\n            delete_rules: \"Delete\",\n            add: \"Add\",\n            refresh: \"Refresh\",\n\n            title: \"Repeat\",\n            preview: \"Selected dates\",\n            addDate: \"Add date\",\n\n            recurrenceType: \"Repeats:\",\n\n            dailyInterval1: \"Repeat every:\",\n            dailyInterval2: \"days\",\n\n            weeklyInterval1: \"Repeat every:\",\n            weeklyInterval2: \"week(s)\",\n            weeklyWeekdays: \"Repeat on:\",\n            weeklyWeekdaysHuman: \"on:\",\n\n            monthlyInterval1: \"Repeat every:\",\n            monthlyInterval2: \"month(s)\",\n            monthlyDayOfMonth1: \"Day\",\n            monthlyDayOfMonth1Human: \"on day\",\n            monthlyDayOfMonth2: \"of the month\",\n            monthlyDayOfMonth3: \"month(s)\",\n            monthlyWeekdayOfMonth1: \"The\",\n            monthlyWeekdayOfMonth1Human: \"on the\",\n            monthlyWeekdayOfMonth2: \"\",\n            monthlyWeekdayOfMonth3: \"of the month\",\n            monthlyRepeatOn: \"Repeat on:\",\n\n            yearlyInterval1: \"Repeat every:\",\n            yearlyInterval2: \"year(s)\",\n            yearlyDayOfMonth1: \"Every\",\n            yearlyDayOfMonth1Human: \"on\",\n            yearlyDayOfMonth2: \"\",\n            yearlyDayOfMonth3: \"\",\n            yearlyWeekdayOfMonth1: \"The\",\n            yearlyWeekdayOfMonth1Human: \"on the\",\n            yearlyWeekdayOfMonth2: \"\",\n            yearlyWeekdayOfMonth3: \"of\",\n            yearlyWeekdayOfMonth4: \"\",\n            yearlyRepeatOn: \"Repeat on:\",\n\n            range: \"End recurrence:\",\n            rangeNoEnd: \"Never\",\n            rangeByOccurrences1: \"After\",\n            rangeByOccurrences1Human: \"ends after\",\n            rangeByOccurrences2: \"occurrence(s)\",\n            rangeByEndDate: \"On\",\n            rangeByEndDateHuman: \"ends on\",\n\n            including: \", and also\",\n            except: \", except for\",\n\n            cancel: \"Cancel\",\n            save: \"Save\",\n\n            recurrenceStart: \"Start of the recurrence\",\n            additionalDate: \"Additional date\",\n            include: \"Include\",\n            exclude: \"Exclude\",\n            remove: \"Remove\",\n\n            orderIndexes: [\"first\", \"second\", \"third\", \"fourth\", \"last\"],\n            months: [\n                \"January\",\n                \"February\",\n                \"March\",\n                \"April\",\n                \"May\",\n                \"June\",\n                \"July\",\n                \"August\",\n                \"September\",\n                \"October\",\n                \"November\",\n                \"December\",\n            ],\n            shortMonths: [\n                \"Jan\",\n                \"Feb\",\n                \"Mar\",\n                \"Apr\",\n                \"May\",\n                \"Jun\",\n                \"Jul\",\n                \"Aug\",\n                \"Sep\",\n                \"Oct\",\n                \"Nov\",\n                \"Dec\",\n            ],\n            weekdays: [\n                \"Sunday\",\n                \"Monday\",\n                \"Tuesday\",\n                \"Wednesday\",\n                \"Thursday\",\n                \"Friday\",\n                \"Saturday\",\n            ],\n            shortWeekdays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n\n            longDateFormat: \"mmmm dd, yyyy\",\n            shortDateFormat: \"mm/dd/yyyy\",\n\n            unsupportedFeatures:\n                \"Warning: This event uses recurrence features not \" +\n                \"supported by this widget. Saving the recurrence \" +\n                \"may change the recurrence in unintended ways:\",\n            noTemplateMatch: \"No matching recurrence template\",\n            multipleDayOfMonth:\n                \"This widget does not support multiple days in monthly or yearly recurrence\",\n            bysetpos: \"BYSETPOS is not supported\",\n            noRule: \"No RRULE in RRULE data\",\n            noRepeatEvery: 'Error: The \"Repeat every\"-field must be between 1 and 1000',\n            noEndDate: \"Error: End date is not set. Please set a correct value\",\n            noRepeatOn: 'Error: \"Repeat on\"-value must be selected',\n            pastEndDate: \"Error: End date cannot be before start date\",\n            noEndAfterNOccurrences:\n                'Error: The \"After N occurrences\"-field must be between 1 and 1000',\n            alreadyAdded: \"This date was already added\",\n\n            rtemplate: {\n                daily: \"Daily\",\n                mondayfriday: \"Monday and Friday\",\n                weekdays: \"Weekday\",\n                weekly: \"Weekly\",\n                monthly: \"Monthly\",\n                yearly: \"Yearly\",\n            },\n        },\n\n        readOnly: false,\n        firstDay: 0,\n\n        // \"REMOTE\" FIELD\n        startField: null,\n        startFieldYear: null,\n        startFieldMonth: null,\n        startFieldDay: null,\n        ajaxURL: null,\n        ajaxContentType: \"application/json; charset=utf8\",\n        ributtonExtraClass: \"\",\n\n        // INPUT CONFIGURATION\n        hasRepeatForeverButton: true,\n\n        // JQUERY TEMPLATE NAMES\n        template: {\n            form: \"#jquery-recurrenceinput-form-tmpl\",\n            display: \"#jquery-recurrenceinput-display-tmpl\",\n        },\n\n        // RECURRENCE TEMPLATES\n        rtemplate: {\n            daily: {\n                rrule: \"FREQ=DAILY\",\n                fields: [\"ridailyinterval\", \"rirangeoptions\"],\n            },\n            mondayfriday: {\n                rrule: \"FREQ=WEEKLY;BYDAY=MO,FR\",\n                fields: [\"rirangeoptions\"],\n            },\n            weekdays: {\n                rrule: \"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR\",\n                fields: [\"rirangeoptions\"],\n            },\n            weekly: {\n                rrule: \"FREQ=WEEKLY\",\n                fields: [\"riweeklyinterval\", \"riweeklyweekdays\", \"rirangeoptions\"],\n            },\n            monthly: {\n                rrule: \"FREQ=MONTHLY\",\n                fields: [\"rimonthlyinterval\", \"rimonthlyoptions\", \"rirangeoptions\"],\n            },\n            yearly: {\n                rrule: \"FREQ=YEARLY\",\n                fields: [\"riyearlyinterval\", \"riyearlyoptions\", \"rirangeoptions\"],\n            },\n        },\n    },\n\n    load_icons: async function () {\n        return {\n            reload: await utils.resolveIcon(\"arrow-clockwise\"),\n            remove: await utils.resolveIcon(\"trash\"),\n            exclude: await utils.resolveIcon(\"calendar-x\"),\n            include: await utils.resolveIcon(\"plus-circle\"),\n        };\n    },\n\n    init: async function () {\n        // tmpl BEFORE recurrenceinput\n        import(\"./recurrence.scss\");\n\n        this.el.classList.add(\"recurrence-widget\");\n        var icons = await this.load_icons();\n\n        var config = {\n            ...this.options,\n            ...this.options.configuration,\n            icons: icons,\n        };\n\n        // our recurrenceinput widget instance\n        var recurrenceinput = new RecurrenceInput(config, this.el);\n        // hide textarea and place display widget after textarea\n        this.$el.after(recurrenceinput.display);\n\n        // hide the textarea\n        this.el.style.display = \"none\";\n    },\n});\n","// Plone extended search.\nimport $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"search\",\n    trigger: \".pat-search\",\n    init: function () {\n        var loading = new utils.Loading();\n\n        var $filter = $(\"#search-filter\");\n        var $filterBtn = $(\"#search-filter-toggle\", $filter);\n        var $advSearchInput = $(\"#advanced-search-input\");\n        var $ctSelectAll = $(\"#pt_toggle\");\n        var $selectAllContainer = $(\".search-type-options\");\n        var $sortingContainer = $(\"#sorting-options\");\n\n        /* handle history */\n        if (window.history && window.history.pushState) {\n            $(window).on(\"popstate\", function () {\n                /* we're just going to cheat and reload the page so\n                   we aren't keep moving around state here..\n                   Here, I'm lazy, we're not using react here... */\n                window.location = window.location.href;\n            });\n        }\n\n        var pushHistory = function () {\n            if (window.history && window.history.pushState) {\n                var url =\n                    window.location.origin +\n                    window.location.pathname +\n                    \"?\" +\n                    $(\"#searchform\").serialize();\n                window.history.pushState(null, null, url);\n            }\n        };\n\n        var timeout = 0;\n        var search = function () {\n            loading.show();\n            pushHistory();\n            $.ajax({\n                url: window.location.origin + window.location.pathname + \"?ajax_load=1\",\n                data: $(\"#searchform\").serialize(),\n            }).done(function (html) {\n                var $html = $(html);\n                $(\"#search-results\").replaceWith($(\"#search-results\", $html));\n                $(\"#search-term\").replaceWith($(\"#search-term\", $html));\n                $(\"#results-count\").replaceWith($(\"#results-count\", $html));\n                loading.hide();\n            });\n        };\n        var searchDelayed = function () {\n            clearTimeout(timeout);\n            timeout = setTimeout(search, 200);\n        };\n\n        var setBatchStart = function (b_start) {\n            $(\"#search-batch-start\").attr(\"value\", b_start);\n        };\n\n        // for sorme reason the backend always flag with active class the sorting options\n        var updateSortingState = function ($el) {\n            $(\"a\", $sortingContainer).removeClass(\"active\");\n            $el.addClass(\"active\");\n        };\n        var default_sort = $(\"#search-results\").attr(\"data-default-sort\");\n        updateSortingState($(\"a[data-sort=\" + default_sort + \"]\"));\n\n        /* sorting */\n        $(\"a\", $sortingContainer).on(\"click\", function (e) {\n            e.preventDefault();\n            updateSortingState($(this));\n            var sort = $(this).attr(\"data-sort\");\n            var order = $(this).attr(\"data-order\");\n            if (sort) {\n                $('[name=\"sort_on\"]').attr(\"value\", sort);\n                if (order && order == \"reverse\") {\n                    $('[name=\"sort_order\"]').attr(\"value\", \"reverse\");\n                } else {\n                    $('[name=\"sort_order\"]').attr(\"value\", \"\");\n                }\n            } else {\n                $('[name=\"sort_on\"]').attr(\"value\", \"\");\n                $('[name=\"sort_order\"]').attr(\"value\", \"\");\n            }\n            search();\n        });\n\n        /* form submission */\n        $(\".searchPage\").on(\"submit\", function (e) {\n            e.preventDefault();\n            setBatchStart(\"0\");\n            search();\n        });\n\n        /* filters */\n        $filterBtn.on(\"click\", function (e) {\n            e.preventDefault();\n            $filter.toggleClass(\"activated\");\n            if ($filter.hasClass(\"activated\")) {\n                $advSearchInput.attr(\"value\", \"True\");\n            } else {\n                $advSearchInput.attr(\"value\", \"False\");\n            }\n        });\n\n        $ctSelectAll.on(\"change\", function () {\n            if ($ctSelectAll[0].checked) {\n                $(\"input\", $selectAllContainer).each(function () {\n                    this.checked = true;\n                });\n            } else {\n                $(\"input\", $selectAllContainer).each(function () {\n                    this.checked = false;\n                });\n            }\n        });\n\n        $(\"input\", $filter).on(\"change\", function () {\n            setBatchStart(\"0\");\n            searchDelayed();\n        });\n\n        /* pagination */\n        $(\"#searchform\").on(\"click\", \".pagination a\", function (e) {\n            var urlParams = new URLSearchParams($(e.currentTarget).attr(\"href\")),\n                b_start = urlParams.get(\"b_start:int\");\n            if (!b_start) {\n                // not plone pagination\n                return;\n            }\n            e.preventDefault();\n            setBatchStart(b_start);\n            search();\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"structure\",\n    trigger: \".pat-structure\",\n    parser: \"mockup\",\n    defaults: {\n        // for implementing history changes\n        // Example: {base: 'http://mysite.com', appended: '/folder_contents'}\n        urlStructure: null,\n        vocabularyUrl: null,\n        indexOptionsUrl: null, // for querystring widget\n        contextInfoUrl: null, // for add new dropdown and other info\n        setDefaultPageUrl: null,\n        menuOptions: null, // default action menu options per item.\n        backdropSelector: \".plone-modal\", // Element upon which to apply backdrops used for popovers\n\n        activeColumnsCookie: \"activeColumns\",\n\n        attributes: [\n            \"CreationDate\",\n            \"EffectiveDate\",\n            \"ExpirationDate\",\n            \"exclude_from_nav\",\n            \"getIcon\",\n            \"getMimeIcon\",\n            \"getObjSize\",\n            \"getURL\",\n            \"id\",\n            \"is_folderish\",\n            \"last_comment_date\",\n            \"ModificationDate\",\n            \"path\",\n            \"portal_type\",\n            \"review_state\",\n            \"Subject\",\n            \"Title\",\n            \"total_comments\",\n            \"UID\",\n        ],\n\n        activeColumns: [\"ModificationDate\", \"EffectiveDate\", \"review_state\"],\n\n        availableColumns: {\n            id: \"ID\",\n            ModificationDate: \"Last modified\",\n            EffectiveDate: \"Published\",\n            ExpirationDate: \"Expiration\",\n            CreationDate: \"Created\",\n            review_state: \"Review state\",\n            Subject: \"Tags\",\n            portal_type: \"Type\",\n            is_folderish: \"Folder\",\n            exclude_from_nav: \"Excluded from navigation\",\n            getObjSize: \"Object Size\",\n            last_comment_date: \"Last comment date\",\n            total_comments: \"Total comments\",\n        },\n\n        typeToViewAction: {\n            File: \"/view\",\n            Image: \"/view\",\n            Blob: \"/view\",\n        },\n\n        defaultPageTypes: [\"Document\", \"Event\", \"News Item\", \"Collection\"],\n\n        language: \"en\",\n        dateFormat: {\n            dateStyle: \"medium\",\n            timeStyle: \"medium\",\n        },\n        rearrange: {\n            properties: {\n                id: \"ID\",\n                sortable_title: \"Title\",\n                // icon: \"plone-rearrange\",\n            },\n            url: \"/rearrange\",\n        },\n        moveUrl: null,\n\n        buttons: [\n            {\n                tooltip: \"Cut\",\n                url: \"/cut\",\n                icon: \"plone-cut\",\n            },\n            {\n                tooltip: \"Copy\",\n                url: \"/copy\",\n                icon: \"plone-copy\",\n            },\n            {\n                tooltip: \"Paste\",\n                url: \"/paste\",\n                icon: \"plone-paste\",\n            },\n            {\n                tooltip: \"Delete\",\n                url: \"/delete\",\n                context: \"danger\",\n                icon: \"plone-delete\",\n            },\n            {\n                tooltip: \"Workflow\",\n                url: \"/workflow\",\n                icon: \"plone-lock\",\n            },\n            {\n                tooltip: \"Tags\",\n                url: \"/tags\",\n                icon: \"tags\",\n            },\n            {\n                tooltip: \"Properties\",\n                url: \"/properties\",\n                icon: \"plone-edit\",\n            },\n            {\n                tooltip: \"Rename\",\n                url: \"/rename\",\n                icon: \"plone-rename\",\n            },\n        ],\n\n        datatables_options: {},\n\n        upload: {\n            uploadMultiple: true,\n            showTitle: true,\n        },\n    },\n\n    async init() {\n        import(\"./structure.scss\");\n        (await import(\"bootstrap\")).Dropdown;\n\n        // backbone paginator, loaded by app-view expects Backbone and\n        // Underscore to be in global namespace.\n        const _ = (await import(\"underscore\")).default;\n        const Backbone = (await import(\"backbone\")).default;\n        window._ = _;\n        window.Backbone = Backbone;\n\n        const AppView = (await import(\"./js/views/app\")).default;\n\n        this.browsing = true; // so all queries will be correct with QueryHelper\n        this.options.collectionUrl = this.options.vocabularyUrl;\n        this.options.pattern = this;\n        this.options.language =\n            document.querySelector(\"html\").getAttribute(\"lang\") || \"en\";\n\n        // the ``attributes`` options key is not compatible with backbone,\n        // but queryHelper that will be constructed by the default\n        // ResultCollection will expect this to be passed into it.\n        this.options.queryHelperAttributes = this.options.attributes;\n        delete this.options.attributes;\n\n        const view = new AppView(this.options);\n        await view.render();\n        this.$el.append(view.$el);\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"structureupdater\",\n    trigger: \".template-folder_contents\",\n    parser: \"mockup\",\n    defaults: {\n        titleSelector: \"\",\n        descriptionSelector: \"\",\n    },\n\n    init: function () {\n        $(\"body\").on(\"context-info-loaded\", (e, data) => {\n            if (this.options.titleSelector) {\n                $(this.options.titleSelector, this.$el).html(\n                    (data.object && data.object.Title) || \"&nbsp;\"\n                );\n            }\n            if (this.options.descriptionSelector) {\n                $(this.options.descriptionSelector, this.$el).html(\n                    (data.object && data.object.Description) || \"&nbsp;\"\n                );\n            }\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport I18n from \"../../core/i18n\";\nimport _t from \"../../core/i18n-wrapper\";\n\nexport default Base.extend({\n    name: \"tinymce\",\n    trigger: \".pat-tinymce\",\n    parser: \"mockup\",\n    defaults: {\n        upload: {\n            uploadMultiple: false,\n            maxFiles: 1,\n            showTitle: false,\n        },\n        contentBrowser: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"portal_type\",\n                \"path\",\n                \"getURL\",\n                \"getIcon\",\n                \"is_folderish\",\n                \"review_state\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: \"95%\",\n            // maxSelectionSize: 1,\n            placeholder: _t(\"Search for item on site...\"),\n        },\n        text: {\n            insertBtn: _t(\"Insert\"), // so this can be configurable for different languages\n            cancelBtn: _t(\"Cancel\"),\n            insertHeading: _t(\"Insert link\"),\n            title: _t(\"Title\"),\n            internal: _t(\"Internal\"),\n            external: _t(\"External\"),\n            externalText: _t(\"External URL (can be relative within this site or absolute if it starts with http:// or https://)\"), // prettier-ignore\n            email: _t(\"Email Address\"),\n            anchor: _t(\"Anchor\"),\n            anchorLabel: _t(\"Select an anchor\"),\n            target: _t(\"Target\"),\n            subject: _t(\"Email Subject (optional)\"),\n            image: _t(\"Image\"),\n            imageAlign: _t(\"Align\"),\n            enableImageZoom: _t(\"Enable image zoom\"),\n            scale: _t(\"Size\"),\n            alt: _t(\"Alternative Text\"),\n            insertImageHelp: _t(\"Specify an image. It can be on this site already (Internal Image), an image you upload (Upload), or from an external site (External Image).\"), // prettier-ignore\n            internalImage: _t(\"Internal Image\"),\n            externalImage: _t(\"External Image\"),\n            externalImageText: _t(\"External Image URL (can be relative within this site or absolute if it starts with http:// or https://)\"), // prettier-ignore\n            upload: _t(\"Upload\"),\n            insertLinkHelp: _t(\"Specify the object to link to. It can be on this site already (Internal), an object you upload (Upload), from an external site (External), an email address (Email), or an anchor on this page (Anchor).\"), // prettier-ignore\n            captionFromDescription: _t(\"Show Image Caption from Image Description\"),\n            caption: _t(\"Image Caption\"),\n        },\n        // URL generation options\n        loadingBaseUrl: \"++plone++static/tinybase\",\n        prependToUrl: \"\",\n        appendToUrl: \"\",\n        linkAttribute: \"path\", // attribute to get link value from data\n        prependToScalePart: \"/imagescale/\",\n        appendToScalePart: \"\",\n        appendToOriginalScalePart: \"\",\n        // defaultScale: \"large\",\n        defaultSrcset: \"medium\",\n        imageCaptioningEnabled: true,\n        imageClasses: {\n            \"image-inline\": _t(\"Inline\"),\n            \"image-right\": _t(\"Right\"),\n            \"image-left\": _t(\"Left\"),\n        },\n        targetList: [\n            { text: _t(\"Open in this window / frame\"), value: \"\" },\n            { text: _t(\"Open in new window\"), value: \"_blank\" },\n            { text: _t(\"Open in parent window / frame\"), value: \"_parent\" },\n            {\n                text: _t(\"Open in top frame (replaces all frames)\"),\n                value: \"_top\",\n            },\n        ],\n        imageTypes: [\"Image\"],\n        folderTypes: [\"Folder\", \"Plone Site\"],\n        tiny: {\n            //content_css:\n            //    \"/base/node_modules/tinymce-builded/js/tinymce/skins/lightgray/content.min.css\",\n            theme: \"silver\",\n            plugins: [\n                \"advlist\",\n                \"autolink\",\n                \"lists\",\n                \"charmap\",\n                \"print\",\n                \"preview\",\n                \"anchor\",\n                \"searchreplace\",\n                \"visualblocks\",\n                \"code\",\n                \"fullscreen\",\n                \"insertdatetime\",\n                \"media\",\n                \"table\",\n                \"contextmenu\",\n                \"paste\",\n                \"plonelink\",\n                \"ploneimage\",\n            ],\n            menubar: \"edit table format tools view insert\",\n            toolbar:\n                \"undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage\",\n            //'autoresize_max_height': 900,\n            height: 400,\n            language: \"en\",\n        },\n        inline: false,\n    },\n    init: async function () {\n        const implementation = (await import(\"./tinymce--implementation\")).default;\n        var i18n = new I18n();\n        var lang = i18n.currentLanguage;\n        this.options.tiny.language = lang;\n        this.instance = new implementation(this.el, this.options);\n        await this.instance.init();\n    },\n    destroy: function () {\n        this.instance.destroy();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport \"../tinymce/tinymce\";\n\nexport default Base.extend({\n    name: \"textareamimetypeselector\",\n    trigger: \".pat-textareamimetypeselector\",\n    parser: \"mockup\",\n    current_widgets: [],\n    defaults: {\n        textareaName: \"\",\n        widgets: {\n            \"text/html\": { pattern: \"tinymce\", patternOptions: {} },\n        },\n    },\n\n    async init() {\n        this.el.addEventListener(\"input\", async (e) => await this.init_textareas(e.target.value));\n        await this.init_textareas(this.el.value);\n    },\n\n    async init_textareas(mimetype) {\n        const pattern_config = this.options.widgets[mimetype];\n\n        // there might be more than one textareas with the same name\n        // set up all of them with the same pattern options.\n        // the pattern itself must take care of an unique identifier!\n        const textareas = document.querySelectorAll(\n            `textarea[name=\"${this.options.textareaName}\"]`\n        );\n\n        // First, destroy current\n        this.current_widgets.forEach((wdgt) => {\n            // The pattern must implement the destroy method.\n            wdgt.destroy();\n        });\n        // and clean\n        this.current_widgets = [];\n\n        // Then, setup new\n        if (pattern_config && textareas.length) {\n            textareas.forEach(async (area) => {\n                this.current_widgets.push(\n                    await new registry.patterns[pattern_config.pattern](\n                        area,\n                        pattern_config.patternOptions || {}\n                    )\n                );\n            });\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\n\nconst log = logger.getLogger(\"pat-toggle\");\n\nexport default Base.extend({\n    name: \"toggle\",\n    trigger: \".pat-toggle\",\n    parser: \"mockup\",\n    defaults: {\n        attribute: \"class\",\n        event: \"click\",\n        targetScope: \"global\",\n    },\n    init: function () {\n        var self = this;\n\n        if (!self.options.target) {\n            self.$target = self.$el;\n        } else if (self.options.targetScope === \"global\") {\n            self.$target = $(self.options.target);\n        } else {\n            //self.$target = self.$el[self.options.menu](self.options.target);\n            self.$target = self.$el\n                .parents(self.options.targetScope)\n                .first()\n                .find(self.options.target);\n        }\n\n        if (!self.$target || self.$target.length === 0) {\n            log.error(`No target found for \"${self.options.target}\".`);\n        }\n\n        self.on(self.options.event, function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            self.toggle();\n        });\n    },\n    isMarked: function () {\n        var self = this;\n        var marked = false;\n\n        for (var i = 0; i < this.$target.length; i = i + 1) {\n            if (self.options.attribute === \"class\") {\n                if (this.$target.eq(i).hasClass(this.options.value)) {\n                    marked = true;\n                } else {\n                    marked = false;\n                    break;\n                }\n            } else {\n                if (\n                    this.$target.eq(i).attr(this.options.attribute) ===\n                    this.options.value\n                ) {\n                    marked = true;\n                } else {\n                    marked = false;\n                    break;\n                }\n            }\n        }\n        return marked;\n    },\n    toggle: function () {\n        var self = this;\n        if (self.isMarked()) {\n            self.remove();\n        } else {\n            self.add();\n        }\n    },\n    remove: function () {\n        var self = this;\n        self.emit(\"remove-attr\");\n        if (self.options.attribute === \"class\") {\n            self.$target.removeClass(self.options.value);\n        } else {\n            self.$target.removeAttr(self.options.attribute);\n        }\n        self.emit(\"attr-removed\");\n    },\n    add: function () {\n        var self = this;\n        self.emit(\"add-attr\");\n        if (self.options.attribute === \"class\") {\n            self.$target.addClass(self.options.value);\n        } else {\n            self.$target.attr(self.options.attribute, self.options.value);\n        }\n        self.emit(\"added-attr\");\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport Cookies from \"js-cookie\";\n\nexport default Base.extend({\n    name: \"toolbar\",\n    trigger: \".pat-toolbar\",\n    parser: \"mockup\",\n    defaults: {},\n\n    init: function () {\n        $(\"body\").on(\"structure-url-changed\", (e, path) => {\n            $.ajax({\n                url: $(\"body\").attr(\"data-portal-url\") + path + \"/@@render-toolbar\",\n            }).done((data) => {\n                const wrapper = $(utils.parseBodyTag(data));\n                const $main_toolbar = wrapper.find(\"#edit-zone .plone-toolbar-main\");\n                const $personal_tools = wrapper.find(\n                    \"#edit-zone #collapse-personaltools\"\n                );\n                // setup modals\n                registry.scan($main_toolbar);\n                $(\".plone-toolbar-main\", this.$el).replaceWith($main_toolbar);\n                $(\"#collapse-personaltools\", this.$el).replaceWith($personal_tools);\n            });\n        });\n\n        // unpin toolbar and save state\n        this.$el.on(\"click\", \".toolbar-collapse\", () => {\n            $(\"body\").removeClass(\"plone-toolbar-left-expanded\");\n            Cookies.set(\"plone-toolbar\", JSON.stringify({ expanded: false }), {\n                path: \"/\",\n            });\n        });\n\n        // pin toolbar and save state\n        this.$el.on(\"click\", \".toolbar-expand\", () => {\n            $(\"body\").addClass(\"plone-toolbar-left-expanded\");\n            Cookies.set(\"plone-toolbar\", JSON.stringify({ expanded: true }), {\n                path: \"/\",\n            });\n        });\n\n        this.el.classList.add(\"initialized\");\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"tree\",\n    trigger: \".pat-tree\",\n    parser: \"mockup\",\n    defaults: {\n        dragAndDrop: false,\n        autoOpen: false,\n        selectable: true,\n        keyboardSupport: true,\n        onLoad: null,\n    },\n\n    async init() {\n        import(\"jqtree/jqtree.css\");\n        import(\"./tree.scss\");\n        await import(\"jqtree\");\n\n        var self = this;\n        /* convert all bool options */\n        for (var optionKey in self.options) {\n            var def = self.defaults[optionKey];\n            if (def !== undefined && typeof def === \"boolean\") {\n                self.options[optionKey] = utils.bool(self.options[optionKey]);\n            }\n        }\n\n        if (self.options.onCanMoveTo === undefined) {\n            self.options.onCanMoveTo = function (moved, target, position) {\n                /* if not using folder option, just allow, otherwise, only allow if folder */\n                if (position === \"inside\") {\n                    return target.folder === undefined || target.folder === true;\n                }\n                return true;\n            };\n        }\n\n        if (self.options.data && typeof self.options.data === \"string\") {\n            self.options.data = $.parseJSON(self.options.data);\n        }\n        if (self.options.onLoad !== null) {\n            // delay generating tree...\n            var options = $.extend({}, self.options);\n\n            $.getJSON(options.dataUrl, function (data) {\n                options.data = data;\n                delete options.dataUrl;\n                self.tree = self.$el.tree(options);\n                self.options.onLoad(self);\n            }).fail(function (response) {  // eslint-disable-line no-unused-vars\n                console.log(\"failed to load json data\");\n            });\n        } else {\n            self.tree = self.$el.tree(self.options);\n        }\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"dexterity-types-listing\",\n    trigger: \"form[action$='dexterity-types']\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (\n            await import(\"./dexterity-types-listing--implementation\")\n        ).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"registry\",\n    trigger: \".pat-registry\",\n    parser: \"mockup\",\n    init: async function () {\n        const implementation = (await import(\"./registry--implementation.js\")).default;\n        const reg = new implementation(this.el);\n        reg.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"schemaeditor\",\n    trigger: \".pat-schemaeditor\",\n    parser: \"mockup\",\n    init: async function () {\n        const implementation = (await import(\"./schemaeditor--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"contentrules\",\n    trigger: \"form[name='ruleSettings']\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./contentrules--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"contentrules-elements\",\n    trigger: \"pat-contentrules-elements\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./contentrule-elements--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion\",\n    trigger: \"form#DiscussionSettingsEditForm\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion-comments\",\n    trigger: \".pat-discussion\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion-comments--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion-moderation\",\n    trigger: \"#fieldset-moderate-comments\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion-moderation--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","/* Patterns bundle configuration.\n * All imports here will go into the compiled bundle.\n */\n\n// Core\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\n// Patternslib patterns\nimport \"@patternslib/patternslib/src/pat/checklist/checklist\";\nimport \"@patternslib/patternslib/src/pat/date-picker/date-picker\";\nimport \"@patternslib/patternslib/src/pat/datetime-picker/datetime-picker\";\nimport \"@patternslib/patternslib/src/pat/display-time/display-time\";\nimport { Pattern as ValidationPattern } from \"@patternslib/patternslib/src/pat/validation/validation\"; // Also loads the Pattern itself.\nimport { parser as tooltip_parser } from \"@patternslib/patternslib/src/pat/tooltip/tooltip\";\nimport \"@patternslib/pat-code-editor/src/code-editor\";\nimport \"@patternslib/patternslib/src/pat/inject/inject\";\nimport \"@patternslib/patternslib/src/pat/depends/depends\";\n\n// Import all used patterns for the bundle to be generated\nimport \"./pat/autotoc/autotoc\";\nimport \"./pat/backdrop/backdrop\";\nimport \"./pat/contentloader/contentloader\";\nimport \"./pat/contentbrowser/contentbrowser\";\nimport \"./pat/cookietrigger/cookietrigger\";\nimport \"./pat/datatables/datatables\";\nimport \"./pat/formautofocus/formautofocus\";\nimport \"./pat/formunloadalert/formunloadalert\";\nimport \"./pat/livesearch/livesearch\";\nimport \"./pat/markspeciallinks/markspeciallinks\";\nimport \"./pat/modal/modal\";\nimport \"./pat/navigationmarker/navigationmarker\";\nimport \"./pat/passwordstrength/passwordstrength\";\nimport \"./pat/preventdoublesubmit/preventdoublesubmit\";\nimport \"./pat/manageportlets/manageportlets.js\";\nimport \"./pat/querystring/querystring\";\nimport \"./pat/recurrence/recurrence\";\nimport \"./pat/relateditems/relateditems\";\nimport \"./pat/search/search\";\nimport \"./pat/select2/select2\";\nimport \"./pat/sortable/sortable\";\nimport \"./pat/structure/structure\";\nimport \"./pat/structure-updater/structure-updater\";\nimport \"./pat/textareamimetypeselector/textareamimetypeselector\";\nimport \"./pat/tinymce/tinymce\";\nimport \"./pat/toggle/toggle\";\nimport \"./pat/toolbar/toolbar\";\nimport \"./pat/tree/tree\";\nimport \"./pat/upload/upload\";\n\n// REMOVE obsolete patterns\n//import \"./pat/texteditor/texteditor\";\n\n// Controlpanels\nimport \"./pat/controlpanels/dexterity-types-listing\";\nimport \"./pat/controlpanels/registry\";\nimport \"./pat/controlpanels/schemaeditor\";\nimport \"./pat/controlpanels/contentrules\";\nimport \"./pat/controlpanels/contentrule-elements\";\nimport \"./pat/controlpanels/discussion\";\nimport \"./pat/controlpanels/discussion-comments\";\nimport \"./pat/controlpanels/discussion-moderation\";\n\n// Change default value for pat-tooltip trigger\ntooltip_parser.parameters.trigger.value = \"hover\";\n\n// Change validation error template to be BS compatible\nValidationPattern.prototype.error_template = (message) =>\n    `<em class=\"invalid-feedback\">${message}</em>`;\n\n// Import pattern styles in JavaScript\nwindow.__patternslib_import_styles = true;\n\nregistry.init();\n"],"names":["getOptions","$el","patternName","options","length","$","this","parent","elOptions","data","tmpOptions","split","i","item","reverse","key","pop","replace","value","join","log","logging","getLogger","initBasePattern","trigger","jquery","name","prototype","plog","pattern","undefined","Registry","patterns","parser","mockupParser","e","error","Base","async","warn","el","defaults","emit","init","constructor","on","eventName","eventCallback","one","args","extend","patternProps","child","Error","Object","hasOwnProperty","call","apply","arguments","jquery_plugin","Surrogate","__super__","autoregister","register","BasePattern","static","parser_group_options","parser_multiple","parser_inherit","uuid","create_uuid","dispatchEvent","Event","bubbles","cancelable","window","setTimeout","debug","parse","event_name","event_callback","events","add_event_listener","once","destroy","logger","DATA_PREFIX","DATA_STYLE_DISPLAY","INPUT_SELECTOR","querySelectorAllAndMe","selector","querySelectorAll","all","matches","unshift","get_css_value","property","as_pixels","as_float","getComputedStyle","getPropertyValue","parseFloat","parseInt","Math","round","get_relative_position","reference_el","document","body","left","abs","getBoundingClientRect","scrollLeft","dom","top","scrollTop","get_data","default_value","set_data","document_ready","fn","event_id","_ready","readyState","remove_event_listener","toNodeArray","nodes","NodeList","Array","wrap","wrapper","parentNode","insertBefore","appendChild","hide","style","display","show","val","find_inputs","find_parents","ret","closest","push","find_scoped","indexOf","get_parents","parents","HTMLElement","acquire_attribute","attribute","include_empty","include_all","_el","getAttribute","parentElement","is_visible","offsetWidth","offsetHeight","is_input","test","nodeName","is_button","create_from_string","string","createRange","createContextualFragment","trim","find_scroll_container","direction","fallback","overflow_y","includes","overflow_x","get_scroll_x","scroll_reference","scrollX","get_scroll_y","scrollY","scroll_to_element","scroll_container","offset","position","behavior","scrollTo","scroll_to_top","scroll_to_bottom","scrollHeight","delete_data","template","template_string","template_variables","Function","get_visible_ratio","container","rect","container_rect","bottom","innerHeight","visible_ratio","rect_height","min","max","escape_css_id","id","CSS","escape","element_uuid","find_form","form","querySelector","event_listener_map","Map","els","keys","removeEventListener","el_events","get","entries","filter","entry","utils","regexp_from_wildcard","delete","size","event_type","cb","opts","addEventListener","has","set","_cb","capture","await_event","Promise","resolve","await_pattern_init","reject","target","catch","generic_event","blur_event","click_event","change_event","focus_event","input_event","mousedown_event","mouseup_event","scroll_event","submit_event","submitter","event","dragstart_event","dragend_event","root","writer","bind","oThis","TypeError","aArgs","slice","fToBind","fNOP","fBound","concat","Level","DEBUG","INFO","WARN","ERROR","FATAL","ConsoleWriter","Logger","_loggers","_parent","_enabled","_level","setWriter","w","output","log_name","level","messages","console","info","path","route","shift","_getFlag","flag","context","setEnabled","state","isEnabled","setLevel","toUpperCase","getLevel","fatal","match","logconfig","exec","location","search","api","getWriter","ArgumentParser","order","parameters","enum_values","enum_conflicts","groups","possible_groups","group_pattern","json_param_pattern","named_param_pattern","token_pattern","_camelCase","str","__","p1","addAlias","alias","original","addGroupToSpec","spec","m","group","field","first_spec","first_name","dest","addArgument","choices","multiple","addJSONArgument","type","isArray","_typeof","choice","obj","_coerce","JSON","toLowerCase","num","isNaN","toString","_set","parts","part","v","_split","text","tokens","quoted","simple","_parseExtendedNotation","argstring","map","RegExp","arg","values","it","subopt","_parseShorthandNotation","parameter","sense","positional","_parse","sep","extended","_defaults","result","_cleanupOptions","group_options","inherit","stack","$possible_config_providers","final_length","hasClass","addBack","provider","frame","attr","results","removeDuplicateObjects","mergeStack","current_value","add_argument","last_btn","submitable_buttons","canditates","activeElement","candidate","disable_re","dont_catch_re","disabled","dont_catch","__patternslib_registry","PATTERN_REGISTRY","__patternslib_registry_initialized","registry","sort","scan","clear","transformPattern","content","transform","initPattern","orderPatterns","splice","Text","selectors","selector_string","classList","add","plugin_name","jqueryPlugin","safeClone","clone","forEach","callback","thisArg","T","k","O","len","kValue","singleBoundJQueryPlugin","method","each","pat","charAt","pluralBoundJQueryPlugin","$this","isObject","wildcard","regexp","isElementInViewport","partial","rec","right","every","documentElement","clientHeight","innerWidth","clientWidth","escapeRegExp","source","prop","findLabel","input","$label","label","nodeType","tagName","removeWildcardClass","targets","classes","ensureArray","remove","matcher","class_list","ok","setAttribute","removeAttribute","hideOrShow","visible","pattern_name","transitions","none","fade","slide","duration","transition","effect","on_complete","action","t","easing","complete","addURLQueryParameter","fullURL","param","url","hash","newURL","objs","comparator","reduce","list","next_obj","is_duplicate","frame_length","x","hasValue","checked","selectedIndex","parseTime","time","amount","parseLength","reference_length","findRelatives","$relatives","$form","find","get_bounds","bounds","y","width","height","checkInputSupport","invalid_value","support","createElement","checkCSSFeature","tag","supported","animation_frame","requestAnimationFrame","timeout","ms","debounce","func","timer","postpone","last_run","Date","now","clearTimeout","isIE","documentMode","jqToNode","force_array","isPrototypeOf","localized_isodate","date","day","getDate","padStart","month","getMonth","getFullYear","escape_html","html","createTextNode","innerHTML","unescape_html","escaped_html","DOMParser","parseFromString","textContent","is_iso_date_time","is_iso_date","date_diff","date_1","date_2","utc_1","UTC","utc_2","floor","threshold_list","num_steps","thresholds","is_option_truthy","option","elementInViewport","crypto","randomUUID","array","Uint32Array","getRandomValues","Storage","backend","prefix","ValueStorage","store","_key","_allKeys","prefix_length","getItem","setItem","stringify","removeItem","local","localStorage","session","sessionStorage","updateOptions","Parser","storage","format","after","befores","b_el","b_date","a_date","offsetDays","setDate","toISOString","substring","dispatch_change_event","display_el","insertAdjacentElement","pat_display_time","preventDefault","outputFormat","PatDisplayTime","default","display_time_config","locale","_add_additional","add_clear_button","placeholder","__patternslib_import_styles","Pikaday","config","firstDay","showWeekNumber","weekNumbers","onSelect","onClose","minDate","maxDate","i18n","response","fetch","json","pikaday","el_append_to","required","clear_button","stopPropagation","firedBy","Moment","lang","substr","datetime","out","strict","fromNow","rtf","Intl","RelativeTimeFormat","numeric","toDate","calendar","lastWeek","lastDay","sameDay","nextDay","nextWeek","sameElse","noSuffix","dialog_panel","close","checkValidity","Pattern","tippy","active_class","inactive_class","Tippy","tippy_options","parseOptionsForTippy","defaultProps","animation","arrow","hideOnClick","closing","ignoreAttributes","interactive","onHide","_onHide","onShow","_onShow","setDefaultProps","markInactive","super","placement","pos","pos0","r","b","l","pos1","popperOptions","modifiers","arrowPadding","padding","parsers","flip_options","enabled","policy","fallbacks","fallbackPlacements","allowHTML","delay","appendTo","_initialize_content","popper","tippy_classes","class","close_button","setProps","_get_content","skipPatInjectHandler","setContent","get_url_parts","handler","data_type_handlers","ajaxDataType","headers","Accept","popperInstance","forceUpdate","get_content","href","query","tmp","markdown","Markdown","instance","cfg","renderForInjection","register_type_handler","_translation_domains","plone","widgets","translate","domain","msgid","keywords","I18N","loadCatalog","MessageFactory","translate_plone","self","baseUrl","currentLanguage","catalogs","ttl","valueOf","configure","_setCatalog","language","catalog","_storeCatalog","getUrl","msgstr","keyword","Loading","className","backdrop","zIndex","addClass","closable","css","closeOnClick","closeOnEsc","generateId","random","featureSupport","dragAndDrop","fileApi","FileReader","history","pushState","ICON_CACHE","bool","escapeHTML","removeHTML","getAuthenticator","getWindow","win","loading","parseBodyTag","txt","eq","QueryHelper","vocabularyUrl","searchParam","pathOperator","attributes","batchSize","baseCriteria","sort_on","sort_order","pathDepth","browsing","basePath","valid","Boolean","getBatch","page","getCurrentPath","currentPath","getCriterias","term","searchOptions","criterias","useBaseCriteria","additionalCriterias","o","searchPath","getQueryData","criteria","batch","selectAjax","dataType","quietMillis","more","total","operation","success","resolveIcon","icon_lookup_name","cache_key","icon","base_url","controller","AbortController","abort","resp","signal","iconmap","_resolve_icon","setId","section","levels","IDPrefix","classTOCName","classSectionName","classLevelPrefixName","classActiveName","scrollDuration","scrollEasing","$toc","prependTo","asTabs","activeId","$level","doScroll","skipHash","children","removeClass","animate","first","elementLevel","levelSelector","opacity","$backdrop","is","keyCode","SelectedItem","plone_registry","component","nodeId","ContentBrowserApp","contentBrowserEl","component_content_browser","props","fieldId","table","DataTable","createModal","$model","modalSizeClass","margin","triggers","zIndexSelector","backdropOptions","title","titleSelector","buttons","automaticallyAddButtonActions","loadLinksWithinModal","prependContent","onRender","templateOptions","classDialog","classModal","classHeaderName","classBodyName","classFooterName","classWrapperName","classWrapperInnerName","classPrependName","classContentName","actions","actionOptions","eventType","disableAjaxFormSubmit","ajaxUrl","modalFunction","isForm","displayInModal","reloadWindowOnClose","formFieldError","onSuccess","onError","onFormError","onTimeout","redirectOnResponse","redirectToUrl","$action","reg","$modal","a","actionKeys","_","patternKeys","patternOptions","handleFormAction","handleLinkAction","extraData","append","ajaxSubmit","xhr","textStatus","errorStatus","redraw","reloadWindow","fail","alert","_t","done","always","open","render","$raw","tplObject","prepend","closeButtonLabel","$title","$modalDialog","$modalContent","$button","off","positionModal","$wrapperInner","reload","resize","image","initModal","createAjaxModal","ajaxXHR","ajaxType","_show","createTargetModal","createBasicModal","createHtmlModal","createImageModal","$wrapper","src","srcset","innerText","findPosition","horpos","vertpos","modalWidth","modalHeight","wrapperInnerWidth","wrapperInnerHeight","absTop","absBottom","absLeft","absRight","returnpos","modalInitialized","activateFocusTrap","modal_el","inputsBody","inputsFooter","inputs","firstInput","lastInput","closeInput","currentIndex","nextIndex","shiftKey","focus","removeAttr","modalCss","posopt","outerWidth","outerHeight","createBackdrop","Backdrop","_suppressHide","confirm","Criteria","indexWidth","classBetweenDtName","classIndexName","classOperatorName","classValueName","classRemoveName","classResultsName","classClearName","classDepthName","app","indexes","index","operator","patternDateOptions","patternAjaxSelectOptions","patternRelateditemsOptions","indexGroups","advanced","initial","$remove","$index","patternSelect2","removeValue","createOperator","createClear","appendOperators","$operator","operations","operators","createValue","convertPathOperators","oval","createPathOperators","resetPathOperators","newOperator","widget","description","removeOperator","createDepthSelect","selected","select","$value","startwrap","val1","val2","startdt","endwrap","enddt","pathAndDepth","ContentbrowserPattern","trimmedValue","removeClear","$clear","buildQueryPart","ival","istr","ostr","vstrbase","vstrlistbase","vstr","getDepthString","getJSONListStr","vval","varr","depth","indexOptionsUrl","previewURL","previewCountURL","classSortLabelName","classSortReverseName","classSortReverseLabelName","classPreviewCountWrapperName","classPreviewResultsWrapperName","classPreviewWrapperName","classPreviewName","classPreviewTitleName","classPreviewDescriptionName","classSortWrapperName","showPreviews","initialized","_init","$criteriaWrapper","$sortWrapper","$previewWrapper","createCriteria","createSort","refreshPreviewEvent","_doupdates","updateValue","_updateTimeout","doupdates","existingSortOn","existingSortOrder","$sortOn","$sortOrder","reversed","sortOn","_previewXhr","$previewPane","querypart","criteriastrs","jsonstr","KEY","selectedUIDs","openAfterInit","pageSize","closeOnSelect","contextPath","dropdownCssClass","favorites","recentlyUsed","recentlyUsedMaxItems","recentlyUsedKey","maximumSelectionSize","minimumInputLength","mode","orderable","rootPath","rootUrl","scanSelection","selectableTypes","separator","sortOrder","tokenSeparators","upload","uploadAllowView","breadcrumbTemplateSelector","favoriteTemplateSelector","recentlyusedTemplateSelector","resultTemplateSelector","selectionTemplateSelector","toolbarTemplateSelector","ajaxTimeout","filterSelectable","isSelectable","applyTemplate","tpl","open_folder","current_directory","one_level_up","_item","setAjax","ajax","select2","UID","is_folderish","oneLevelUp","Title","selectable","renderToolbar","itemPath","itemsHtml","favoritesHtml","item_copy","recentlyUsedHtml","items","favItems","favText","searchText","searchModeText","browseModeText","recentlyUsedItems","recentlyUsedText","icon_root","icon_recently_used","icon_favorites","icon_upload","upload_text","$toolbar","toggleClass","browseTo","currentTarget","uid","selectItem","initUploadView","allowUpload","Upload","upload_button","upload_el","upload_config","uloadMultiple","allowPathSelection","relativePath","setPath","alreadyPresent","deselectItem","portal_type","Dropdown","breadcrumbTemplate","favoriteTemplate","recentlyusedTemplate","resultTemplate","selectionTemplate","toolbarTemplate","$container","Select2","initializeValues","initializeTags","formatSelection","getIcon","getURL","review_state","$selection","path_split","icon_level_up","icon_level_down","formatResult","iconLevelUp","iconLevelDown","$parent","initSelection","element","ids","prev","tokenizer","initializeSelect2","initializeOrdering","yMax","relitem_rect","maxHeight","opened","which","selectorContext","browsableItemSelector","browsableItem","initialValues","seldefaults","initial_values","selection","tags","allowNewItems","Sortable","_initializeOrdering","sortable_el","$select2","draggable","dragClass","chosenClass","onStart","onEnd","formatResultCssClass","ob","onSelected","onSelecting","onDeselecting","onDeselected","I18n","_val","queryTerm","page_limit","dataIds","haveResult","vals","cloneClass","drop","sortable","newIndex","oldIndex","disableSort","enableSort","Dropzone","showTitle","wrapperTemplate","fileaddedClassName","useTus","ajaxUpload","paramName","addRemoveLinks","autoCleanResults","previewsContainer","previewTemplate","maxFiles","maxFilesize","relatedItems","autoDiscover","UploadTemplate","originalEvent","clipboardData","blob","getAsFile","dropzone","addFile","currentFile","$progress","$pathInput","setupRelatedItems","$dropzone","files","hiddenFileInput","click","dzoneOptions","getDzoneOptions","showHideControls","ex","path_uid","file","status","SUCCESS","previewElement","fadeOut","xmlhr","pct","processUpload","finished","clipboardfile","_showHideTimeout","_showHideControls","$controls","$browse","$input","fadeIn","pathJoin","PreviewTemplate","clickable","uploadMultiple","$preview","autoProcessQueue","processing","process","QUEUED","CANCELED","removeFile","UPLOADING","tus","handleTusUpload","processFile","endpoint","chunkSize","progress","bytesUploaded","bytesTotal","percentage","formatBytes","bytes","kb","mb","RelatedItems","initialFolder","ri","methods","settings","initialTime","exceptionAreas","lastEvent","trueTime","untouched","inExceptionArea","mouseMoved","live","enteredException","leftException","removeData","startTimer","diff","scrollable","scrollWidth","makeVisibleInScroll","parent_id","absoluteParent","elemTop","elemBottom","viewTop","viewBottom","safeOffset","docElem","elem","origin","ownerDocument","setPositionAbsolute","offsettop","offsetleft","thiswidth","setleft","settop","positionAncestor","$ancestor","$child","childMarginEdgeLeft","childMarginEdgeTop","ancestorPaddingEdgeLeft","ancestorPaddingEdgeTop","findInclusive","slideIn","speed","slideOut","Contains","scopedFind","all_selects","all_deselects","all_toggles","all_checkboxes","all_radios","change_handler","change_buttons_and_toggles","change_checked","btn","select_all","deselect","deselect_all","toggle","toggle_all","find_siblings","sel","res","find_checkboxes","ref_el","chkbxs","tgl","box","labels","fieldset","el_date","el_time","DatePicker","date_value","time_value","el_wrapper","html_btn_now","today","html_btn_clear","update","isotime","date_options","isodate","toTimeString","KEY_ERROR_EL","KEY_ERROR_MSG","check_input","initialize_inputs","disabled_elements","disableSelector","cnt","debouncer","_ref","stop","set_validity","msg","validity_state","validity","hasAttribute","badInput","customError","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valueMissing","input_options","equality","message","not","before","msg_default_not_before","msg_default_not_after","not_after","not_after_el","not_before","not_before_el","msg_attr","remove_error","number","email","stopImmediatePropagation","set_error_message","_ref2","setCustomValidity","error_node","some","validation_message","validationMessage","error_template","firstChild","did_disable","formNoValidate","_input","language_mapping","atom","plist","rss","svg","wsf","xhtml","xjb","xsd","xsl","CodeJar","hljs","theme","highlight","editor","highlightElement","highlight_wrapper","linenumbers","withLineNumbers","startsWith","hljs_language","registerLanguage","pre_el","tab","indentOn","spellcheck","catchTab","preserveIdent","addClosing","codeeditor","onUpdate","code","xhrCount","onTriggerEvents","onClickSubmit","request","_request","seqNumber","inc","temp","clickedData","serialize","cache","browserCache","accept","formdata","FormData","ajax_deferred","jqxhr","inject","cfgs","extractConfig","nextHref","pushMarker","onTrigger","idleTrigger","_initIdleTrigger","processDelay","delayed_trigger","uuid_","still_there","_initAutoloadVisible","formaction","cfg_node","params","serializeArray","execute","submitSubform","$sub","assign","$context","urlparts","defaultSelector","elementIsDirty","askForConfirmation","should_confirm","_confirm","$target","confirmMessage","ensureTarget","createTarget","$created_target","verifySingleConfig","extractModifiers","listenForFormReset","verifyConfig","source_match","target_match","sourceMod","targetMod","targetPosition","loadingClass","_performInjection","$sources","sources_string","img","source_nodes","childNodes","_inject","_update_history","_afterInjection","glue","title_el","$injected","idx","el_","scroll","scroll_target","_onInjectSuccess","ev","responseText","sources$","callTypeHandler","idx1","perform_inject","_onInjectError","explanation","timestamp","error_page","error_page_fragment","URLSearchParams","error_page_url","error_page_response","executingClass","error_zone","statusText","do_close_panel","replaceWith","contentafter","contentbefore","elementafter","elementbefore","_sourcesFromHtml","sources","$html","_parseRawHtml","$source","_rebaseAttrs","object","video","_rebaseOptions","_rebaseURL","base","URL","lastIndexOf","_rebaseHTML","rebase_selector","pattern_parser","changed","opt","clean_html","timeout_id","observer","IntersectionObserver","isIntersecting","disconnect","threshold","observe","unsub","onInteraction","contains","registerTypeHandler","handlers","injected","executedClass","CustomEvent","detail","replaceState","DependsHandler","condition","set_state","getAllInputs","pattern_uuid","update_modal","enable","disable","evaluate","that","_load","loadRemote","loadLocal","$content","empty","isCookiesEnabled","c","cookie","dc","showIfCookiesDisabled","_changed","_suppressed","changingEvents","changingFields","modal","_handleUnload","_handleMsg","returnValue","active","selectedItem","resultsClass","defaultSortOn","perPage","timeoutHide","inputSelector","itemTemplate","doSearch","sorton_position","$searchResults","$results","nav","$prev","disableHiding","$next","next","$li","onceFocused","insertAfter","external_links_open_new_window","mark_special_links","protocol_icon_map","https","http","ftp","callto","bitcoin","geo","im","irc","ircs","magnet","mailto","mms","news","nntp","openpgp4fpr","sip","sms","smsto","ssh","tel","urn","webcal","wtai","xmpp","open_new_window","protocol","host","links","link","link_url","icon_name","icon_el","portal_url","dataset","portalUrl","navlink","check","hrefParts","navParts","inPath","zxcvbn","htmltmp","pwfield","pwmeterContainer","firstElementChild","pwmeter","indicators","score","elements","inp","wclass","nextSibling","onkeyup","s","head","scripts","getElementsByTagName","loadScript","guardClassName","optOutClassName","messageTimeout","submitTimeout","switchTimeout","isModal","dirty","setupAddDropdown","setupSwitchPortletManager","setupSavePortletsSettings","setupPortletEdit","ajax_load","$body","$h1","rebind","suppress","statusMessage","$message","fadeTo","showEditPortlet","$a","Modal","$select","ajaxForm","beforeSubmit","url_","_reloadPortletManager","is_popstate","Re","zeropad","fmt","conf","d","D","getDay","flags","dd","ddd","localization","shortWeekdays","dddd","weekdays","mm","mmm","shortMonths","mmmm","months","yy","String","yyyy","$0","widgetSaveToRfc5545","RDATE","EXDATE","tz","interval","year","occurrences","i18nweekdays","monthlyType","yearlyType","rangeType","rtemplate","rrule","human","field_id","fields","dailyInterval2","weeklyInterval2","j","weeklyWeekdaysHuman","monthlyInterval2","monthlyDayOfMonth1Human","monthlyDayOfMonth2","monthlyWeekdayOfMonth1Human","orderIndexes","monthlyWeekdayOfMonth2","yearlyInterval2","yearlyDayOfMonth1Human","yearlyWeekdayOfMonth1Human","yearlyWeekdayOfMonth2","yearlyWeekdayOfMonth3","yearlyWeekdayOfMonth4","rangeByOccurrences1Human","rangeByOccurrences2","replaceAll","rangeByEndDateHuman","date_parts","longDateFormat","tmp_dates","tmp_human","rdate","including","exdate","except","parseLine","icalline","cleanDates","dates","parseIcal","icaldata","nextline","lines","RRULE","line","widgetLoadFromRfc5545","force","radiobutton","freq","byday","bymonth","bymonthday","count","until","weekday","unsupportedFeatures","noRule","bysetpos","noTemplateMatch","multipleDayOfMonth","day_index","weekday_index","hasRepeatForeverButton","messagearea","RecurrenceInput","textarea","$textarea","orderedWeekdays","now_date","displayFields","$modalForm","rtField","occurrenceExclude","occurrenceInclude","occurrenceDelete","occurrenceAdd","datevalue","errorarea","alreadyAdded","$newdate","additionalDate","icons","slideDown","loadOccurrences","startdate","rfc5545","start","readonly","occurrenceDiv","ajaxURL","contentType","ajaxContentType","readOnly","occurrence","formattedDate","jqXHR","getField","realField","findStartDate","startField","startFieldYear","startFieldMonth","startFieldDay","findIntField","fieldName","recurrenceOn","RFC5545","displayActivate","edit_rules","checkFields","startDate","endDate","endField","enddate","noRepeatEvery","noRepeatOn","noEndAfterNOccurrences","noEndDate","pastEndDate","save","cancel","updateOccurrences","displayUnactivate","add_rules","dayindex","loadData","start_date","initModalForm","delete_rules","refresh","preview","addDate","recurrenceType","dailyInterval1","weeklyInterval1","weeklyWeekdays","monthlyInterval1","monthlyDayOfMonth1","monthlyDayOfMonth3","monthlyWeekdayOfMonth1","monthlyWeekdayOfMonth3","monthlyRepeatOn","yearlyInterval1","yearlyDayOfMonth1","yearlyDayOfMonth2","yearlyDayOfMonth3","yearlyWeekdayOfMonth1","yearlyRepeatOn","range","rangeNoEnd","rangeByOccurrences1","rangeByEndDate","recurrenceStart","include","exclude","shortDateFormat","daily","mondayfriday","weekly","monthly","yearly","ributtonExtraClass","load_icons","configuration","recurrenceinput","$filter","$filterBtn","$advSearchInput","$ctSelectAll","$selectAllContainer","$sortingContainer","pathname","pushHistory","setBatchStart","b_start","updateSortingState","default_sort","urlStructure","contextInfoUrl","setDefaultPageUrl","menuOptions","backdropSelector","activeColumnsCookie","activeColumns","availableColumns","ModificationDate","EffectiveDate","ExpirationDate","CreationDate","Subject","exclude_from_nav","getObjSize","last_comment_date","total_comments","typeToViewAction","File","Image","Blob","defaultPageTypes","dateFormat","dateStyle","timeStyle","rearrange","properties","sortable_title","moveUrl","tooltip","datatables_options","Backbone","AppView","collectionUrl","queryHelperAttributes","view","descriptionSelector","Description","contentBrowser","insertBtn","cancelBtn","insertHeading","internal","external","externalText","anchor","anchorLabel","subject","imageAlign","enableImageZoom","scale","alt","insertImageHelp","internalImage","externalImage","externalImageText","insertLinkHelp","captionFromDescription","caption","loadingBaseUrl","prependToUrl","appendToUrl","linkAttribute","prependToScalePart","appendToScalePart","appendToOriginalScalePart","defaultSrcset","imageCaptioningEnabled","imageClasses","targetList","imageTypes","folderTypes","tiny","plugins","menubar","toolbar","inline","implementation","current_widgets","textareaName","init_textareas","mimetype","pattern_config","textareas","wdgt","area","targetScope","isMarked","marked","$main_toolbar","$personal_tools","Cookies","expanded","autoOpen","keyboardSupport","onLoad","optionKey","def","onCanMoveTo","moved","folder","dataUrl","tree","tooltip_parser","ValidationPattern"],"sourceRoot":""}