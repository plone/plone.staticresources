(self.webpackChunkplone_staticresources=self.webpackChunkplone_staticresources||[]).push([[55611],{55611:function(){!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");var t=tinymce.util.Tools.resolve("tinymce.util.Delay"),r=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),o=tinymce.util.Tools.resolve("tinymce.util.Tools");const a=e=>{const t=/^(\d+)([ms]?)$/.exec(e);return(t&&t[2]?{s:1e3,m:6e4}[t[2]]:1)*parseInt(e,10)},s=e=>t=>t.options.get(e),n=s("autosave_ask_before_unload"),i=s("autosave_restore_when_empty"),u=s("autosave_interval"),l=s("autosave_retention"),c=e=>{const t=document.location;return e.options.get("autosave_prefix").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},d=(e,t)=>{if((e=>void 0===e)(t))return e.dom.isEmpty(e.getBody());{const r=o.trim(t);if(""===r)return!0;{const t=(new DOMParser).parseFromString(r,"text/html");return e.dom.isEmpty(t)}}},m=e=>{var t;const o=parseInt(null!==(t=r.getItem(c(e)+"time"))&&void 0!==t?t:"0",10)||0;return!((new Date).getTime()-o>l(e)&&(f(e,!1),1))},f=(e,t)=>{const o=c(e);r.removeItem(o+"draft"),r.removeItem(o+"time"),!1!==t&&(e=>{e.dispatch("RemoveDraft")})(e)},v=e=>{const t=c(e);!d(e)&&e.isDirty()&&(r.setItem(t+"draft",e.getContent({format:"raw",no_events:!0})),r.setItem(t+"time",(new Date).getTime().toString()),(e=>{e.dispatch("StoreDraft")})(e))},p=e=>{var t;const o=c(e);m(e)&&(e.setContent(null!==(t=r.getItem(o+"draft"))&&void 0!==t?t:"",{format:"raw"}),(e=>{e.dispatch("RestoreDraft")})(e))};var y=tinymce.util.Tools.resolve("tinymce.EditorManager");const g=e=>t=>{const r=()=>m(e)&&!e.mode.isReadOnly();t.setEnabled(r());const o=()=>t.setEnabled(r());return e.on("StoreDraft RestoreDraft RemoveDraft",o),()=>e.off("StoreDraft RestoreDraft RemoveDraft",o)};e.add("autosave",(e=>((e=>{const t=e.options.register,r=e=>{const t=(e=>"string"===(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(r=o=e,(a=String).prototype.isPrototypeOf(r)||(null===(s=o.constructor)||void 0===s?void 0:s.name)===a.name)?"string":t;var r,o,a,s})(e))(e);return t?{value:a(e),valid:t}:{valid:!1,message:"Must be a string."}};t("autosave_ask_before_unload",{processor:"boolean",default:!0}),t("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),t("autosave_restore_when_empty",{processor:"boolean",default:!1}),t("autosave_interval",{processor:r,default:"30s"}),t("autosave_retention",{processor:r,default:"20m"})})(e),(e=>{e.editorManager.on("BeforeUnload",(e=>{let t;o.each(y.get(),(e=>{e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&n(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))})),t&&(e.preventDefault(),e.returnValue=t)}))})(e),(e=>{(e=>{const r=u(e);t.setEditorInterval(e,(()=>{v(e)}),r)})(e);const r=()=>{(e=>{e.undoManager.transact((()=>{p(e),f(e)})),e.focus()})(e)};e.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:r,onSetup:g(e)}),e.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:r,onSetup:g(e)})})(e),e.on("init",(()=>{i(e)&&e.dom.isEmpty(e.getBody())&&p(e)})),(e=>({hasDraft:()=>m(e),storeDraft:()=>v(e),restoreDraft:()=>p(e),removeDraft:t=>f(e,t),isEmpty:t=>d(e,t)}))(e))))}()}}]);
//# sourceMappingURL=55611.7c4daeea822fbdb15603.min.js.map