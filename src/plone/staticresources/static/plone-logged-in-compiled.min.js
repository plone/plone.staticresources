define("mockup-patterns-inlinevalidation",["jquery","pat-base"],function(s,e){"use strict";return e.extend({name:"inlinevalidation",trigger:".pat-inlinevalidation",parser:"mockup",render_error:function(e,t){var n=s("div.fieldErrorBox",e);""!==t?(e.addClass("error"),n.html(t)):(e.removeClass("error"),n.html(""))},render_error_bootstrap:function(e,t){var n=s("input",e),i=s(".invalid-feedback",e);""!==t?(n.addClass("is-invalid"),i.length?i.html(t):s('<div class="invalid-feedback">'+t+"</div>").insertAfter(n)):(n.removeClass("is-invalid"),i.length&&i.remove())},append_url_path:function(e,t){var n,i,a=e.split(/\?/);for("/"!==(i=a[0])[i.length-1]&&(i+="/"),i+=t,n=1;n<a.length;n+=1)i+="?"+a[n];return i},queue:function(e,t){void 0===t&&(t=e,e="fx"),s(window).queue(e,t)},validate_archetypes_field:function(e){var t=s(e),n=t.closest(".field"),i=n.attr("data-uid"),a=n.attr("data-fieldname"),o=t.val();t.prop("multiple")&&null===o&&(o=s([]).serialize());var r=s.param({uid:i,fname:a,value:o},!0);n&&i&&a&&this.queue(s.proxy(function(t){s.ajax({type:"POST",url:s("base").attr("href")+"/at_validate_field?"+r,iframe:!1,success:s.proxy(function(e){this.render_error(n,e.errmsg),t()},this),error:function(){t()},dataType:"json"})},this))},validate_formlib_field:function(e){var n=s(e).closest(".field"),i=n.closest("form").clone(),a=n.attr("data-fieldname");i.find("input[type=file]").remove(),this.queue(s.proxy(function(t){i.ajaxSubmit({url:this.append_url_path(i.attr("action"),"@@formlib_validate_field"),data:{fname:a},iframe:!1,success:s.proxy(function(e){this.render_error(n,e.errmsg),t()},this),error:function(){t()},dataType:"json"})},this))},validate_z3cform_field:function(e){var t=s(e),n=t.closest(".field"),i=n.closest("form"),a=i.clone(),o=t.closest("fieldset").attr("data-fieldset"),r=n.attr("data-fieldname");s.each(s("select",i),function(e,t){s('select[name="'+t.name+'"]',a).val(s(t).val())}),a.find("input[type=file]").remove(),r&&this.queue(s.proxy(function(t){a.ajaxSubmit({url:this.append_url_path(a.attr("action"),"@@z3cform_validate_field"),data:{fname:r,fset:o},iframe:!1,success:s.proxy(function(e){n.hasClass("form-group")?this.render_error_bootstrap(n,e.errmsg):this.render_error(n,e.errmsg),t()},this),error:function(){t()},dataType:"json"})},this))},init:function(){this.$el.find('input[type="text"], input[type="password"], input[type="checkbox"], select, textarea').on("blur",s.proxy(function(e){"archetypes"===this.options.type?this.validate_archetypes_field(e.target):"z3c.form"===this.options.type?this.validate_z3cform_field(e.target):"formlib"===this.options.type&&this.validate_formlib_field(e.target)},this))}})}),function(e){define("resource-plone-app-jquerytools-js",["jquery"],function(){return function(){function p(e,t){var n=f(t);return n.length<2?n:e.parent().find(t)}function n(e,r){var s=this,l=e.add(s),c=e.children(),d=0,u=r.vertical;if(m=m||s,1<c.length&&(c=f(r.items,e)),1<r.size&&(r.circular=!1),f.extend(s,{getConf:function(){return r},getIndex:function(){return d},getSize:function(){return s.getItems().size()},getNaviButtons:function(){return n.add(o)},getRoot:function(){return e},getItemWrap:function(){return c},getItems:function(){return c.find(r.item).not("."+r.clonedClass)},move:function(e,t){return s.seekTo(d+e,t)},next:function(e){return s.move(r.size,e)},prev:function(e){return s.move(-r.size,e)},begin:function(e){return s.seekTo(0,e)},end:function(e){return s.seekTo(s.getSize()-1,e)},focus:function(){return m=s},addItem:function(e){return e=f(e),r.circular?(c.children().last().before(e),c.children().first().replaceWith(e.clone().addClass(r.clonedClass))):(c.append(e),o.removeClass("disabled")),l.trigger("onAddItem",[e]),s},seekTo:function(e,t,n){if(e.jquery||(e*=1),r.circular&&0===e&&-1==d&&0!==t)return s;if(!r.circular&&e<0||e>s.getSize()||e<-1)return s;var i=e;e.jquery?e=s.getItems().index(e):i=s.getItems().eq(e);var a=f.Event("onBeforeSeek");if(!n&&(l.trigger(a,[e,t]),a.isDefaultPrevented()||!i.length))return s;var o=u?{top:-i.position().top}:{left:-i.position().left};return d=e,m=s,void 0===t&&(t=r.speed),c.animate(o,t,r.easing,n||function(){l.trigger("onSeek",[e])}),s}}),f.each(["onBeforeSeek","onSeek","onAddItem"],function(e,t){f.isFunction(r[t])&&f(s).on(t,r[t]),s[t]=function(e){return e&&f(s).on(t,e),s}}),r.circular){var i=s.getItems().slice(-1).clone().prependTo(c),a=s.getItems().eq(1).clone().appendTo(c);i.add(a).addClass(r.clonedClass),s.onBeforeSeek(function(e,t,n){if(!e.isDefaultPrevented())return-1==t?(s.seekTo(i,n,function(){s.end(0)}),e.preventDefault()):void(t==s.getSize()&&s.seekTo(a,n,function(){s.begin(0)}))});var t=e.parents().add(e).filter(function(){if("none"===f(this).css("display"))return!0});t.length?(t.show(),s.seekTo(0,0,function(){}),t.hide()):s.seekTo(0,0,function(){})}var n=p(e,r.prev).click(function(e){e.stopPropagation(),s.prev()}),o=p(e,r.next).click(function(e){e.stopPropagation(),s.next()});if(r.circular||(s.onBeforeSeek(function(e,t){setTimeout(function(){e.isDefaultPrevented()||(n.toggleClass(r.disabledClass,t<=0),o.toggleClass(r.disabledClass,t>=s.getSize()-1))},1)}),r.initialIndex||n.addClass(r.disabledClass)),s.getSize()<2&&n.add(o).addClass(r.disabledClass),r.mousewheel&&f.fn.mousewheel&&e.mousewheel(function(e,t){if(r.mousewheel)return s.move(t<0?1:-1,r.wheelSpeed||50),!1}),r.touch){var h={};c[0].ontouchstart=function(e){var t=e.touches[0];h.x=t.clientX,h.y=t.clientY},c[0].ontouchmove=function(e){if(1==e.touches.length&&!c.is(":animated")){var t=e.touches[0],n=h.x-t.clientX,i=h.y-t.clientY;s[u&&0<i||!u&&0<n?"next":"prev"](),e.preventDefault()}}}r.keyboard&&f(document).on("keydown.scrollable",function(e){if(!(!r.keyboard||e.altKey||e.ctrlKey||e.metaKey||f(e.target).is(":input")||"static"!=r.keyboard&&m!=s)){var t=e.keyCode;return!u||38!=t&&40!=t?u||37!=t&&39!=t?void 0:(s.move(37==t?-1:1),e.preventDefault()):(s.move(38==t?-1:1),e.preventDefault())}}),r.initialIndex&&s.seekTo(r.initialIndex,0,function(){})}var f,m,i,a,o,r,t,s,l,c,d,u,h,g;function v(e){if(e){var t=o.contentWindow.document;t.open().close(),t.location.hash=e}}function y(){if(/msie/.test(navigator.userAgent.toLowerCase())){var e=s(document).height(),t=s(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e-t<20?t:e]}return[s(document).width(),s(document).height()]}function b(e){if(e)return e.call(s.mask)}!function(f){f.tools=f.tools||{version:"@VERSION"},f.tools.overlay={addEffect:function(e,t,n){g[e]=[t,n]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!/msie/.test(navigator.userAgent.toLowerCase())||6<navigator.appVersion,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var m=[],g={};function n(e,r){var t,s,l,c=this,d=e.add(c),u=f(window),h=f.tools.expose&&(r.mask||r.expose),p=Math.random().toString().slice(10);h&&("string"==typeof h&&(h={color:h}),h.closeOnClick=h.closeOnEsc=!1);var n=r.target||e.attr("rel");if(!(s=n?f(n):e).length)throw"Could not find Overlay: "+n;e&&-1==e.index(s)&&e.click(function(e){return c.load(e),e.preventDefault()}),f.extend(c,{load:function(e){if(c.isOpened())return c;var t=g[r.effect];if(!t)throw'Overlay: cannot find effect : "'+r.effect+'"';if(r.oneInstance&&f.each(m,function(){this.close(e)}),(e=e||f.Event()).type="onBeforeLoad",d.trigger(e),e.isDefaultPrevented())return c;l=!0,h&&f(s).expose(h);var n=r.top,i=r.left,a=s.outerWidth(!0),o=s.outerHeight(!0);return"string"==typeof n&&(n="center"==n?Math.max((u.height()-o)/2,0):parseInt(n,10)/100*u.height()),"center"==i&&(i=Math.max((u.width()-a)/2,0)),t[0].call(c,{top:n,left:i},function(){l&&(e.type="onLoad",d.trigger(e))}),h&&r.closeOnClick&&f.mask.getMask().one("click",c.close),r.closeOnClick&&f(document).on("click."+p,function(e){f(e.target).parents(s).length||c.close(e)}),r.closeOnEsc&&f(document).on("keydown."+p,function(e){27==e.keyCode&&c.close(e)}),c},close:function(e){return c.isOpened()?((e=e||f.Event()).type="onBeforeClose",d.trigger(e),e.isDefaultPrevented()?void 0:(l=!1,g[r.effect][1].call(c,function(){e.type="onClose",d.trigger(e)}),f(document).off("click."+p+" keydown."+p),h&&f.mask.close(),c)):c},getOverlay:function(){return s},getTrigger:function(){return e},getClosers:function(){return t},isOpened:function(){return l},getConf:function(){return r}}),f.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(e,t){f.isFunction(r[t])&&f(c).on(t,r[t]),c[t]=function(e){return e&&f(c).on(t,e),c}}),(t=s.find(r.close||".close")).length||r.close||(t=f('<a class="close"></a>'),s.prepend(t)),t.click(function(e){c.close(e)}),r.load&&c.load()}f.tools.overlay.addEffect("default",function(e,t){var n=this.getConf(),i=f(window);n.fixed||(e.top+=i.scrollTop(),e.left+=i.scrollLeft()),e.position=n.fixed?"fixed":"absolute",this.getOverlay().css(e).fadeIn(n.speed,t)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,e)}),f.fn.overlay=function(e){var t=this.data("overlay");return t||(f.isFunction(e)&&(e={onBeforeLoad:e}),e=f.extend(!0,{},f.tools.overlay.conf,e),this.each(function(){t=new n(f(this),e),m.push(t),f(this).data("overlay",t)}),e.api?t:this)}}(jQuery),(f=jQuery).tools=f.tools||{version:"@VERSION"},f.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}},f.fn.scrollable=function(e){var t=this.data("scrollable");return t||(e=f.extend({},f.tools.scrollable.conf,e),this.each(function(){t=new n(f(this),e),f(this).data("scrollable",t)}),e.api?t:this)},function(h){h.tools=h.tools||{version:"@VERSION"},h.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialEffect:!1,initialIndex:0,event:"click",rotate:!1,slideUpSpeed:400,slideDownSpeed:400,history:!1},addEffect:function(e,t){p[e]=t}};var a,o,p={default:function(e,t){this.getPanes().hide().eq(e).show(),t.call()},fade:function(e,t){var n=this.getConf(),i=n.fadeOutSpeed,a=this.getPanes();i?a.fadeOut(i):a.hide(),a.eq(e).fadeIn(n.fadeInSpeed,t)},slide:function(e,t){var n=this.getConf();this.getPanes().slideUp(n.slideUpSpeed),this.getPanes().eq(e).slideDown(n.slideDownSpeed,t)},ajax:function(e,t){this.getPanes().eq(0).load(this.getTabs().eq(e).attr("href"),t)}};function i(r,e,s){var l,c=this,d=r.add(this),u=r.find(s.tabs),t=e.jquery?e:r.children(e);u.length||(u=r.children()),t.length||(t=r.parent().find(e)),t.length||(t=h(e)),h.extend(this,{click:function(e,t){var n=u.eq(e),i=!r.data("tabs");if("string"==typeof e&&e.replace("#","")&&(n=u.filter('[href*="'+e.replace("#","")+'"]'),e=Math.max(u.index(n),0)),s.rotate){var a=u.length-1;if(e<0)return c.click(a,t);if(a<e)return c.click(0,t)}if(!n.length){if(0<=l)return c;e=s.initialIndex,n=u.eq(e)}if(e===l)return c;if((t=t||h.Event()).type="onBeforeClick",d.trigger(t,[e]),!t.isDefaultPrevented()){var o=i?s.initialEffect&&s.effect||"default":s.effect;return p[o].call(c,e,function(){l=e,t.type="onClick",d.trigger(t,[e])}),u.removeClass(s.current),n.addClass(s.current),c}},getConf:function(){return s},getTabs:function(){return u},getPanes:function(){return t},getCurrentPane:function(){return t.eq(l)},getCurrentTab:function(){return u.eq(l)},getIndex:function(){return l},next:function(){return c.click(l+1)},prev:function(){return c.click(l-1)},destroy:function(){return u.off(s.event).removeClass(s.current),t.find('a[href^="#"]').off("click.T"),c}}),h.each("onBeforeClick,onClick".split(","),function(e,t){h.isFunction(s[t])&&h(c).on(t,s[t]),c[t]=function(e){return e&&h(c).on(t,e),c}}),s.history&&h.fn.history&&(h.tools.history.init(u),s.event="history"),u.each(function(t){h(this).on(s.event,function(e){return c.click(t,e),e.preventDefault()})}),t.find('a[href^="#"]').on("click.T",function(e){c.click(h(this).attr("href"),e)}),location.hash&&"a"==s.tabs&&r.find('[href="'+location.hash+'"]').length?c.click(location.hash):(0===s.initialIndex||0<s.initialIndex)&&c.click(s.initialIndex)}h.tools.tabs.addEffect("horizontal",function(e,t){if(!a){var n=this.getPanes().eq(e),i=this.getCurrentPane();o=o||this.getPanes().eq(0).width(),a=!0,n.show(),i.animate({width:0},{step:function(e){n.css("width",o-e)},complete:function(){h(this).hide(),t.call(),a=!1}}),i.length||(t.call(),a=!1)}}),h.fn.tabs=function(e,t){var n=this.data("tabs");return n&&(n.destroy(),this.removeData("tabs")),h.isFunction(t)&&(t={onBeforeClick:t}),t=h.extend({},h.tools.tabs.conf,t),this.each(function(){n=new i(h(this),e,t),h(this).data("tabs",n)}),t.api?n:this}}(jQuery),(i=jQuery).tools=i.tools||{version:"@VERSION"},i.tools.history={init:function(e){t||(i.browser.msie&&i.browser.version<"8"?o||(o=i("<iframe/>").attr("src","javascript:false;").hide().get(0),i("body").append(o),setInterval(function(){var e=o.contentWindow.document.location.hash;a!==e&&i(window).trigger("hash",e)},100),v(location.hash||"#")):setInterval(function(){var e=location.hash;e!==a&&i(window).trigger("hash",e)},100),r=r?r.add(e):e,e.click(function(e){var t=i(this).attr("href");if(o&&v(t),"#"!=t.slice(0,1))return location.href="#"+t,e.preventDefault()}),t=!0)}},i(window).on("hash",function(e,t){t?r.filter(function(){var e=i(this).attr("href");return e==t||e==t.replace("#","")}).trigger("history",[t]):r.eq(0).trigger("history",[t]),a=t}),i.fn.history=function(e){return i.tools.history.init(this),this.on("history",e)},(s=jQuery).tools=s.tools||{version:"@VERSION"},l=s.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}},s.mask={load:function(e,t){if(u)return this;"string"==typeof e&&(e={color:e}),e=e||h,h=e=s.extend(s.extend({},l.conf),e),(c=s("#"+e.maskId)).length||(c=s("<div/>").attr("id",e.maskId),s("body").append(c));var n=y();return c.css({position:"absolute",top:0,left:0,width:n[0],height:n[1],display:"none",opacity:e.startOpacity,zIndex:e.zIndex}),e.color&&c.css("backgroundColor",e.color),!1===b(e.onBeforeLoad)||(e.closeOnEsc&&s(document).on("keydown.mask",function(e){27==e.keyCode&&s.mask.close(e)}),e.closeOnClick&&c.on("click.mask",function(e){s.mask.close(e)}),s(window).on("resize.mask",function(){s.mask.fit()}),t&&t.length&&(g=t.eq(0).css("zIndex"),s.each(t,function(){var e=s(this);/relative|absolute|fixed/i.test(e.css("position"))||e.css("position","relative")}),d=t.css({zIndex:Math.max(e.zIndex+1,"auto"==g?0:g)})),c.css({display:"block"}).fadeTo(e.loadSpeed,e.opacity,function(){s.mask.fit(),b(e.onLoad),u="full"}),u=!0),this},close:function(){if(u){if(!1===b(h.onBeforeClose))return this;c.fadeOut(h.closeSpeed,function(){d&&d.css({zIndex:g}),u=!1,b(h.onClose)}),s(document).off("keydown.mask"),c.off("click.mask"),s(window).off("resize.mask")}return this},fit:function(){if(u){var e=y();c.css({width:e[0],height:e[1]})}},getMask:function(){return c},isLoaded:function(e){return e?"full"==u:u},getConf:function(){return h},getExposed:function(){return d}},s.fn.mask=function(e){return s.mask.load(e),this},s.fn.expose=function(e){return s.mask.load(e,this),this},function(m){m.tools=m.tools||{version:"@VERSION"},m.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(e,t,n){g[e]=[t,n]}};var g={toggle:[function(e){var t=this.getConf(),n=this.getTip(),i=t.opacity;i<1&&n.css({opacity:i}),n.show(),e.call()},function(e){this.getTip().hide(),e.call()}],fade:[function(e){var t=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||t.fadeIE?this.getTip().fadeTo(t.fadeInSpeed,t.opacity,e):(this.getTip().show(),e())},function(e){var t=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||t.fadeIE?this.getTip().fadeOut(t.fadeOutSpeed,e):(this.getTip().hide(),e())}]};function v(e,t,n){var i=n.relative?e.position().top:e.offset().top,a=n.relative?e.position().left:e.offset().left,o=n.position[0];i-=t.outerHeight()-n.offset[0],a+=e.outerWidth()+n.offset[1],/iPad/i.test(navigator.userAgent)&&(i-=m(window).scrollTop());var r=t.outerHeight()+e.outerHeight();"center"==o&&(i+=r/2),"bottom"==o&&(i+=r),o=n.position[1];var s=t.outerWidth()+e.outerWidth();return"center"==o&&(a-=s/2),"left"==o&&(a-=s),{top:i,left:a}}function n(i,a){var o,r,s=this,l=i.add(s),c=0,d=0,u=i.attr("title"),h=i.attr("data-tooltip"),p=g[a.effect],e=i.is(":input"),t=e&&i.is(":checkbox, :radio, select, :button, :submit"),n=i.attr("type"),f=a.events[n]||a.events[e?t?"widget":"input":"def"];if(!p)throw'Nonexistent effect "'+a.effect+'"';if(2!=(f=f.split(/,\s*/)).length)throw"Tooltip: bad events configuration for "+n;i.on(f[0],function(e){clearTimeout(c),a.predelay?d=setTimeout(function(){s.show(e)},a.predelay):s.show(e)}).on(f[1],function(e){clearTimeout(d),a.delay?c=setTimeout(function(){s.hide(e)},a.delay):s.hide(e)}),u&&a.cancelDefault&&(i.removeAttr("title"),i.data("title",u)),m.extend(s,{show:function(e){if(!o&&(h?o=m(h):a.tip?o=m(a.tip).eq(0):u?o=m(a.layout).addClass(a.tipClass).appendTo(document.body).hide().append(u):((o=i.find("."+a.tipClass)).length||(o=i.next()),o.length||(o=i.parent().next())),!o.length))throw"Cannot find tooltip for "+i;if(s.isShown())return s;o.stop(!0,!0);var t=v(i,o,a);if(a.tip&&o.html(i.data("title")),(e=m.Event()).type="onBeforeShow",l.trigger(e,[t]),e.isDefaultPrevented())return s;t=v(i,o,a),o.css({position:"absolute",top:t.top,left:t.left}),r=!0,p[0].call(s,function(){e.type="onShow",r="full",l.trigger(e)});var n=a.events.tooltip.split(/,\s*/);return o.data("__set")||(o.off(n[0]).on(n[0],function(){clearTimeout(c),clearTimeout(d)}),n[1]&&!i.is("input:not(:checkbox, :radio), textarea")&&o.off(n[1]).on(n[1],function(e){e.relatedTarget!=i[0]&&i.trigger(f[1].split(" ")[0])}),a.tip||o.data("__set",!0)),s},hide:function(e){return o&&s.isShown()?((e=m.Event()).type="onBeforeHide",l.trigger(e),e.isDefaultPrevented()?void 0:(r=!1,g[a.effect][1].call(s,function(){e.type="onHide",l.trigger(e)}),s)):s},isShown:function(e){return e?"full"==r:r},getConf:function(){return a},getTip:function(){return o},getTrigger:function(){return i}}),m.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(e,t){m.isFunction(a[t])&&m(s).on(t,a[t]),s[t]=function(e){return e&&m(s).on(t,e),s}})}m.fn.tooltip=function(e){var t=this.data("tooltip");return t||("string"==typeof(e=m.extend(!0,{},m.tools.tooltip.conf,e)).position&&(e.position=e.position.split(/,?\s/)),this.each(function(){t=new n(m(this),e),m(this).data("tooltip",t)}),e.api?t:this)}}(jQuery)}.apply(e,arguments)})}(this),function(e){define("resource-plone-app-jquerytools-dateinput-js",["jquery"],function(){return function(){!function(M,R){function P(e,t){return new Date(e,t+1,0).getDate()}function d(e,t){for(e=""+e,t=t||2;e.length<t;)e="0"+e;return e}function u(e,t,n,i){var a=t.getDate(),o=t.getDay(),r=t.getMonth(),s=t.getFullYear(),l={d:a,dd:d(a),ddd:U[i].shortDays[o],dddd:U[i].days[o],m:r+1,mm:d(r+1),mmm:U[i].shortMonths[r],mmmm:U[i].months[r],yy:String(s).slice(2),yyyy:s},c=p[e](n,t,l,i);return f.html(c).html()}function _(e){return parseInt(e,10)}function j(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()}function N(e){if(e!==R){if(e.constructor==Date)return e;if("string"==typeof e){var t=e.split("-");if(3==t.length)return new Date(_(t[0]),_(t[1])-1,_(t[2]));if(!/^-?\d+$/.test(e))return;e=_(e)}var n=new Date;return n.setDate(n.getDate()+e),n}}function a(o,p){function f(e,t,n){return o.attr("readonly")?void k.hide(n):(v=(E=e).getFullYear(),y=e.getMonth(),b=e.getDate(),"click"!=(n=n||M.Event("api")).type||/msie/.test(navigator.userAgent.toLowerCase())||o.focus(),n.type="beforeChange",l.trigger(n,[e]),void(n.isDefaultPrevented()||(o.val(u(t.formatter,e,t.format,t.lang)),n.type="change",n.target=o[0],l.trigger(n),o.data("date",e),k.hide(n))))}function n(e){e.type="onShow",l.trigger(e),M(document).on("keydown.d",function(e){if(e.ctrlKey)return!0;var t=e.keyCode;if(8==t||46==t)return o.val(""),k.hide(e);if(27==t||9==t)return k.hide(e);if(0<=M(F).index(t)){if(!w)return k.show(e),e.preventDefault();var n=M("#"+T.weeks+" a"),i=M("."+T.focus),a=n.index(i);return i.removeClass(T.focus),74==t||40==t?a+=7:75==t||38==t?a-=7:76==t||39==t?a+=1:72!=t&&37!=t||(a-=1),(i=41<a?(k.addMonth(),M("#"+T.weeks+" a:eq("+(a-42)+")")):a<0?(k.addMonth(-1),M("#"+T.weeks+" a:eq("+(a+42)+")")):n.eq(a)).addClass(T.focus),e.preventDefault()}return 34==t?k.addMonth():33==t?k.addMonth(-1):36==t?k.today():(13==t&&(M(e.target).is("select")||M("."+T.focus).click()),0<=M([16,17,18,9]).index(t))}),M(document).on("click.d",function(e){var t=e.target;t.id==T.root||M(t).parents("#"+T.root).length||t==o[0]||i&&t==i[0]||k.hide(e)})}var i,m,g,v,y,b,w,k=this,x=new Date,e=x.getFullYear(),T=p.css,S=U[p.lang],a=M("#"+T.root),C=a.find("#"+T.title),E=o.attr("data-value")||p.value||o.val(),D=o.attr("min")||p.min,$=o.attr("max")||p.max;if(0===D&&(D="0"),E=N(E)||x,D=N(D||new Date(e+p.yearRange[0],1,1)),$=N($||new Date(e+p.yearRange[1]+1,1,-1)),!S)throw"Dateinput: invalid language: "+p.lang;if("date"==o.attr("type")){var t,r=(t=o.clone()).wrap("<div/>").parent().html(),s=M(r.replace(/type/i,"type=text data-orig-type"));p.value&&s.val(p.value),o.replaceWith(s),o=s}o.addClass(T.input);var l=o.add(k);if(!a.length){if((a=M("<div><div><a/><div/><a/></div><div><div/><div/></div></div>").hide().css({position:"absolute"}).attr("id",T.root)).children().eq(0).attr("id",T.head).end().eq(1).attr("id",T.body).children().eq(0).attr("id",T.days).end().eq(1).attr("id",T.weeks).end().end().end().find("a").eq(0).attr("id",T.prev).end().eq(1).attr("id",T.next),C=a.find("#"+T.head).find("div").attr("id",T.title),p.selectors){var O=M("<select/>").attr("id",T.month),A=M("<select/>").attr("id",T.year);C.html(O.add(A))}for(var c=a.find("#"+T.days),d=0;d<7;d++)c.append(M("<span/>").text(S.shortDays[(d+p.firstDay)%7]));M("body").append(a)}p.trigger&&(i=M("<a/>").attr("href","#").addClass(T.trigger).click(function(e){return p.toggle?k.toggle():k.show(),e.preventDefault()}).insertAfter(o));var I=a.find("#"+T.weeks);A=a.find("#"+T.year),O=a.find("#"+T.month),M.extend(k,{show:function(e){if(!o.attr("disabled")&&!w&&((e=e||M.Event()).type="onBeforeShow",l.trigger(e),!e.isDefaultPrevented())){M.each(h,function(){this.hide()}),w=!0,O.off("change").change(function(){k.setValue(_(A.val()),_(M(this).val()))}),A.off("change").change(function(){k.setValue(_(M(this).val()),_(O.val()))}),m=a.find("#"+T.prev).off("click").click(function(){return m.hasClass(T.disabled)||k.addMonth(-1),!1}),g=a.find("#"+T.next).off("click").click(function(){return g.hasClass(T.disabled)||k.addMonth(),!1}),k.setValue(E);var t=o.offset();return/iPad/i.test(navigator.userAgent)&&(t.top-=M(window).scrollTop()),a.css({top:t.top+o.outerHeight(!0)+p.offset[0],left:t.left+p.offset[1]}),p.speed?a.show(p.speed,function(){n(e)}):(a.show(),n(e)),k}},setValue:function(n,e,t){var i=-1<=_(e)?new Date(_(n),_(e),_(t==R||isNaN(t)?1:t)):n||E;if(i<D?i=D:$<i&&(i=$),"string"==typeof n&&(i=N(n)),n=i.getFullYear(),e=i.getMonth(),t=i.getDate(),-1==e?(e=11,n--):12==e&&(e=0,n++),!w)return f(i,p),k;y=e,v=n,b=t;var a,o=new Date(n,e,1-p.firstDay).getDay(),r=P(n,e),s=P(n,e-1);if(p.selectors){O.empty(),M.each(S.months,function(e,t){D<new Date(n,e+1,1)&&$>new Date(n,e,0)&&O.append(M("<option/>").html(t).attr("value",e))}),A.empty();for(var l=x.getFullYear(),c=l+p.yearRange[0];c<l+p.yearRange[1];c++)D<new Date(c+1,0,1)&&$>new Date(c,0,0)&&A.append(M("<option/>").text(c));O.val(e),A.val(n)}else C.html(S.months[e]+" "+n);I.empty(),m.add(g).removeClass(T.disabled);for(var d,u,h=o?0:-7;h<(o?42:35);h++)d=M("<a/>"),h%7==0&&(a=M("<div/>").addClass(T.week),I.append(a)),h<o?(d.addClass(T.off),u=s-o+h+1,i=new Date(n,e-1,u)):o+r<=h?(d.addClass(T.off),u=h-r-o+1,i=new Date(n,e+1,u)):(u=h-o+1,i=new Date(n,e,u),j(E,i)?d.attr("id",T.current).addClass(T.focus):j(x,i)&&d.attr("id",T.today)),D&&i<D&&d.add(m).addClass(T.disabled),$&&$<i&&d.add(g).addClass(T.disabled),d.attr("href","#"+u).text(u).data("date",i),a.append(d);return I.find("a").click(function(e){var t=M(this);return t.hasClass(T.disabled)||(M("#"+T.current).removeAttr("id"),t.attr("id",T.current),f(t.data("date"),p,e)),!1}),T.sunday&&I.find("."+T.week).each(function(){var e=p.firstDay?7-p.firstDay:0;M(this).children().slice(e,1+e).addClass(T.sunday)}),k},setMin:function(e,t){return D=N(e),t&&E<D&&k.setValue(D),k},setMax:function(e,t){return $=N(e),t&&$<E&&k.setValue($),k},today:function(){return k.setValue(x)},addDay:function(e){return this.setValue(v,y,b+(e||1))},addMonth:function(e){var t=y+(e||1),n=P(v,t),i=b<=n?b:n;return this.setValue(v,t,i)},addYear:function(e){return this.setValue(v+(e||1),y,b)},destroy:function(){o.add(document).off("click.d keydown.d"),a.add(i).remove(),o.removeData("dateinput").removeClass(T.input),t&&o.replaceWith(t)},hide:function(e){if(w){if((e=M.Event()).type="onHide",l.trigger(e),e.isDefaultPrevented())return;M(document).off("click.d keydown.d"),a.hide(),w=!1}return k},toggle:function(){return k.isOpen()?k.hide():k.show()},getConf:function(){return p},getInput:function(){return o},getCalendar:function(){return a},getValue:function(e){return e?u(p.formatter,E,e,p.lang):E},isOpen:function(){return w}}),M.each(["onBeforeShow","onShow","change","onHide"],function(e,t){M.isFunction(p[t])&&M(k).on(t,p[t]),k[t]=function(e){return e&&M(k).on(t,e),k}}),p.editable||o.on("focus.d click.d",k.show).keydown(function(e){var t=e.keyCode;return!w&&0<=M(F).index(t)?(k.show(e),e.preventDefault()):(8!=t&&46!=t||o.val(""),!!(e.shiftKey||e.ctrlKey||e.altKey||9==t)||e.preventDefault())}),N(o.val())&&f(E,p)}M.tools=M.tools||{version:"@VERSION"};var e,h=[],p={},F=[75,76,38,39,74,72,40,37],U={};(e=M.tools.dateinput={conf:{format:"mm/dd/yy",formatter:"default",selectors:!1,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:R,max:R,trigger:0,toggle:0,editable:0,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},addFormatter:function(e,t){p[e]=t},localize:function(e,n){M.each(n,function(e,t){n[e]=t.split(",")}),U[e]=n}}).localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"Sun,Mon,Tue,Wed,Thu,Fri,Sat"});var f=M("<a/>");e.addFormatter("default",function(e,t,n){return e.replace(/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,function(e){return e in n?n[e]:e})}),e.addFormatter("prefixed",function(e,t,n){return e.replace(/%(d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*')/g,function(e,t){return t in n?n[t]:e})}),M.expr[":"].date=function(e){var t=e.getAttribute("type");return t&&"date"==t||!!M(e).data("dateinput")},M.fn.dateinput=function(n){return this.data("dateinput")?this:(n=M.extend(!0,{},e.conf,n),M.each(n.css,function(e,t){t||"prefix"==e||(n.css[e]=(n.css.prefix||"")+(t||e))}),this.each(function(){var e=new a(M(this),n);h.push(e);var t=e.getInput().data("dateinput",e);i=i?i.add(t):t}),i||this);var i}}(jQuery)}.apply(e,arguments)})}(this),function(e){define("jquery.tmpl",["jquery"],function(){return function(){function c(e,t,n,i){var a={data:i||(t?t.data:{}),_wrap:t?t._wrap:null,tmpl:null,parent:t||null,nodes:[],calls:d,nest:h,wrap:p,html:f,update:m};return e&&g.extend(a,e,{nodes:[],parent:t}),n&&(a.tmpl=n,a._ctnt=a._ctnt||a.tmpl(g,a),a.key=++T,(C.length?k:w)[T]=a),a}function r(t,e,n){var a,i=n?g.map(n,function(e){return"string"==typeof e?t.key?e.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+b+'="'+t.key+'" $2'):e:r(e,t,e._ctnt)}):t;return e?i:((i=i.join("")).replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(e,t,n,i){l(a=g(n).get()),t&&(a=o(t).concat(a)),i&&(a=a.concat(o(i)))}),a||o(i))}function o(e){var t=document.createElement("div");return t.innerHTML=e,g.makeArray(t.childNodes)}function n(e){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+g.trim(e).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(e,t,n,i,a,o,r){var s,l,c,d=g.tmpl.tag[n];if(!d)throw"Template command not found: "+n;return s=d._default||[],o&&!/\w$/.test(a)&&(a+=o,o=""),c=a?(a=u(a),r=r?","+u(r)+")":o?")":"",l=o?-1<a.indexOf(".")?a+o:"("+a+").call($item"+r:a,o?l:"(typeof("+a+")==='function'?("+a+").call($item):("+a+"))"):l=s.$1||"null",i=u(i),"');"+d[t?"close":"open"].split("$notnull_1").join(a?"typeof("+a+")!=='undefined' && ("+a+")!=null":"true").split("$1a").join(c).split("$1").join(l).split("$2").join(i?i.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(e,t,n,i){return(i=i?","+i+")":n?")":"")?"("+t+").call($item"+i:e}):s.$2||"")+"_.push('"})+"');}return _;")}function s(e,t){e._wrap=r(e,!0,g.isArray(t)?t:[i.test(t)?t:g(t).html()]).join("")}function u(e){return e?e.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function l(e){var t,n,i,a,o,s="_"+S,l={};for(i=0,a=e.length;i<a;i++)if(1===(t=e[i]).nodeType){for(o=(n=t.getElementsByTagName("*")).length-1;0<=o;o--)r(n[o]);r(t)}function r(e){var t,n,i,a,o=e;if(a=e.getAttribute(b)){for(;o.parentNode&&1===(o=o.parentNode).nodeType&&!(t=o.getAttribute(b)););t!==a&&(o=o.parentNode?11===o.nodeType?0:o.getAttribute(b)||0:0,(i=w[a])||((i=c(i=k[a],w[o]||k[o],null,!0)).key=++T,w[T]=i),S&&r(a)),e.removeAttribute(b)}else S&&(i=g.data(e,"tmplItem"))&&(r(i.key),w[i.key]=i,o=(o=g.data(e.parentNode,"tmplItem"))?o.key:0);if(i){for(n=i;n&&n.key!=o;)n.nodes.push(e),n=n.parent;delete i._ctnt,delete i._wrap,g.data(e,"tmplItem",i)}function r(e){i=l[e+=s]=l[e]||c(i,w[i.parent.key+s]||i.parent,null,!0)}}}function d(e,t,n,i){if(!e)return C.pop();C.push({_:e,tmpl:t,item:this,data:n,options:i})}function h(e,t,n){return g.tmpl(g.template(e),t,n,this)}function p(e,t){var n=e.options||{};return n.wrapped=t,g.tmpl(g.template(e.tmpl),e.data,n,e.item)}function f(e,t){var n=this._wrap;return g.map(g(g.isArray(n)?n.join(""):n).filter(e||"*"),function(e){return t?e.innerText||e.textContent:e.outerHTML||function(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}(e)})}function m(){var e=this.nodes;g.tmpl(null,null,null,this).insertBefore(e[0]),g(e).remove()}var g,v,y,b,i,w,k,x,T,S,C;g=jQuery,y=g.fn.domManip,b="_tmplitem",i=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,w={},k={},x={key:0,data:{}},S=T=0,C=[],g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(l,c){g.fn[l]=function(e){var t,n,i,a,o=[],r=g(e),s=1===this.length&&this[0].parentNode;if(v=w||{},s&&11===s.nodeType&&1===s.childNodes.length&&1===r.length)r[c](this[0]),o=this;else{for(n=0,i=r.length;n<i;n++)t=(0<(S=n)?this.clone(!0):this).get(),g.fn[c].apply(g(r[n]),t),o=o.concat(t);S=0,o=this.pushStack(o,l,r.selector)}return a=v,v=null,g.tmpl.complete(a),o}}),g.fn.extend({tmpl:function(e,t,n){return g.tmpl(this[0],e,t,n)},tmplItem:function(){return g.tmplItem(this[0])},template:function(e){return g.template(e,this[0])},domManip:function(e,t,n,i){if(e[0]&&e[0].nodeType){for(var a,o=g.makeArray(arguments),r=e.length,s=0;s<r&&!(a=g.data(e[s++],"tmplItem")););1<r&&(o[0]=[g.makeArray(e)]),a&&S&&(o[2]=function(e){g.tmpl.afterManip(this,e,n)}),y.apply(this,o)}else y.apply(this,arguments);return S=0,v||g.tmpl.complete(w),this}}),g.extend({tmpl:function(t,e,n,i){var a,o=!i;if(o)i=x,t=g.template[t]||g.template(null,t),k={};else if(!t)return t=i.tmpl,(w[i.key]=i).nodes=[],i.wrapped&&s(i,i.wrapped),g(r(i,null,i.tmpl(g,i)));return t?("function"==typeof e&&(e=e.call(i||{})),n&&n.wrapped&&s(n,n.wrapped),a=g.isArray(e)?g.map(e,function(e){return e?c(n,i,t,e):null}):[c(n,i,t,e)],o?g(r(i,null,a)):a):[]},tmplItem:function(e){var t;for(e instanceof g&&(e=e[0]);e&&1===e.nodeType&&!(t=g.data(e,"tmplItem"))&&(e=e.parentNode););return t||x},template:function(e,t){return t?("string"==typeof t?t=n(t):t instanceof g&&(t=t[0]||{}),t.nodeType&&(t=g.data(t,"tmpl")||g.data(t,"tmpl",n(t.innerHTML))),"string"==typeof e?g.template[e]=t:t):e?"string"!=typeof e?g.template(null,e):g.template[e]||g.template(null,i.test(e)?e:g(e)):null},encode:function(e){return(""+e).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),g.extend(g.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},if:{open:"if(($notnull_1) && $1a){",close:"}"},else:{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(e){w={}},afterManip:function(e,t,n){var i=11===t.nodeType?g.makeArray(t.childNodes):1===t.nodeType?[t]:[];n.call(e,t),l(i),S++}})}.apply(e,arguments)})}(this),function(e){define("jquery.recurrenceinput",["jquery","resource-plone-app-jquerytools-js","resource-plone-app-jquerytools-dateinput-js","jquery.tmpl"],function(){return function(){!function(A){var a;A.tools=A.tools||{version:"@VERSION"};var p={};(a=A.tools.recurrenceinput={conf:{lang:"en",readOnly:!1,firstDay:0,startField:null,startFieldYear:null,startFieldMonth:null,startFieldDay:null,ajaxURL:null,ajaxContentType:"application/json; charset=utf8",ributtonExtraClass:"",hasRepeatForeverButton:!0,formOverlay:{speed:"fast",fixed:!1},template:{form:"#jquery-recurrenceinput-form-tmpl",display:"#jquery-recurrenceinput-display-tmpl"},rtemplate:{daily:{rrule:"FREQ=DAILY",fields:["ridailyinterval","rirangeoptions"]},mondayfriday:{rrule:"FREQ=WEEKLY;BYDAY=MO,FR",fields:["rirangeoptions"]},weekdays:{rrule:"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR",fields:["rirangeoptions"]},weekly:{rrule:"FREQ=WEEKLY",fields:["riweeklyinterval","riweeklyweekdays","rirangeoptions"]},monthly:{rrule:"FREQ=MONTHLY",fields:["rimonthlyinterval","rimonthlyoptions","rirangeoptions"]},yearly:{rrule:"FREQ=YEARLY",fields:["riyearlyinterval","riyearlyoptions","rirangeoptions"]}}},localize:function(e,t){p[e]=t},setTemplates:function(e,t){var n,i;for(n in a.conf.rtemplate=e,t)if(t.hasOwnProperty(n))for(i in t[n])t[n].hasOwnProperty(i)&&(p[n].rtemplate[i]=t[n][i])}}).localize("en",{displayUnactivate:"Does not repeat",displayActivate:"Repeats every",add_rules:"Add",edit_rules:"Edit",delete_rules:"Delete",add:"Add",refresh:"Refresh",title:"Repeat",preview:"Selected dates",addDate:"Add date",recurrenceType:"Repeats:",dailyInterval1:"Repeat every:",dailyInterval2:"days",weeklyInterval1:"Repeat every:",weeklyInterval2:"week(s)",weeklyWeekdays:"Repeat on:",weeklyWeekdaysHuman:"on:",monthlyInterval1:"Repeat every:",monthlyInterval2:"month(s)",monthlyDayOfMonth1:"Day",monthlyDayOfMonth1Human:"on day",monthlyDayOfMonth2:"of the month",monthlyDayOfMonth3:"month(s)",monthlyWeekdayOfMonth1:"The",monthlyWeekdayOfMonth1Human:"on the",monthlyWeekdayOfMonth2:"",monthlyWeekdayOfMonth3:"of the month",monthlyRepeatOn:"Repeat on:",yearlyInterval1:"Repeat every:",yearlyInterval2:"year(s)",yearlyDayOfMonth1:"Every",yearlyDayOfMonth1Human:"on",yearlyDayOfMonth2:"",yearlyDayOfMonth3:"",yearlyWeekdayOfMonth1:"The",yearlyWeekdayOfMonth1Human:"on the",yearlyWeekdayOfMonth2:"",yearlyWeekdayOfMonth3:"of",yearlyWeekdayOfMonth4:"",yearlyRepeatOn:"Repeat on:",range:"End recurrence:",rangeNoEnd:"Never",rangeByOccurrences1:"After",rangeByOccurrences1Human:"ends after",rangeByOccurrences2:"occurrence(s)",rangeByEndDate:"On",rangeByEndDateHuman:"ends on",including:", and also",except:", except for",cancel:"Cancel",save:"Save",recurrenceStart:"Start of the recurrence",additionalDate:"Additional date",include:"Include",exclude:"Exclude",remove:"Remove",orderIndexes:["first","second","third","fourth","last"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortWeekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDateFormat:"mmmm dd, yyyy",shortDateFormat:"mm/dd/yyyy",unsupportedFeatures:"Warning: This event uses recurrence features not supported by this widget. Saving the recurrence may change the recurrence in unintended ways:",noTemplateMatch:"No matching recurrence template",multipleDayOfMonth:"This widget does not support multiple days in monthly or yearly recurrence",bysetpos:"BYSETPOS is not supported",noRule:"No RRULE in RRULE data",noRepeatEvery:'Error: The "Repeat every"-field must be between 1 and 1000',noEndDate:"Error: End date is not set. Please set a correct value",noRepeatOn:'Error: "Repeat on"-value must be selected',pastEndDate:"Error: End date cannot be before start date",noEndAfterNOccurrences:'Error: The "After N occurrences"-field must be between 1 and 1000',alreadyAdded:"This date was already added",rtemplate:{daily:"Daily",mondayfriday:"Monday and Friday",weekdays:"Weekday",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"}});var e=['<div class="rioccurrences">',"{{each occurrences}}",'<div class="occurrence ${occurrences[$index].type}">',"<span>","${occurrences[$index].formattedDate}",'{{if occurrences[$index].type === "start"}}','<span class="rlabel">${i18n.recurrenceStart}</span>',"{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<span class="rlabel">${i18n.additionalDate}</span>',"{{/if}}","</span>","{{if !readOnly}}",'<span class="action">','{{if occurrences[$index].type === "rrule"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.exclude}">',"${i18n.exclude}","</a>","{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.remove}" >',"${i18n.remove}","</a>","{{/if}}",'{{if occurrences[$index].type === "exdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.include}">',"${i18n.include}","</a>","{{/if}}","</span>","{{/if}}","</div>","{{/each}}",'<div class="batching">',"{{each batch.batches}}",'{{if $index === batch.currentBatch}}<span class="current">{{/if}}','<a href="#" start="${batch.batches[$index][0]}">[${batch.batches[$index][0]} - ${batch.batches[$index][1]}]</a>',"{{if $index === batch.currentBatch}}</span>{{/if}}","{{/each}}","</div></div>"].join("\n");A.template("occurrenceTmpl",e);var t=['<div class="ridisplay">','<div class="rimain">',"{{if !readOnly}}",'<button name="riedit">${i18n.add_rules}</button>','<button name="ridelete" style="display:none">${i18n.delete_rules}</button>',"{{/if}}",'<label class="ridisplay">${i18n.displayUnactivate}</label>',"</div>",'<div class="rioccurrences" style="display:none" /></div>'].join("\n");A.template("displayTmpl",t);var n=['<div class="riform">',"<form>","<h1>${i18n.title}</h1>",'<div id="messagearea" style="display: none;">',"</div>",'<div id="rirtemplate">','<label for="${name}rtemplate" class="label">',"${i18n.recurrenceType}","</label>",'<select id="rirtemplate" name="rirtemplate" class="field">',"{{each rtemplate}}",'<option value="${$index}">${i18n.rtemplate[$index]}</value>',"{{/each}}","</select>","<div>",'<div id="riformfields">','<div id="ridailyinterval" class="rifield">','<label for="${name}dailyinterval" class="label">',"${i18n.dailyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="ridailyinterval"','id="${name}dailyinterval" />',"${i18n.dailyInterval2}","</div>","</div>",'<div id="riweeklyinterval" class="rifield">','<label for="${name}weeklyinterval" class="label">',"${i18n.weeklyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="riweeklyinterval"','id="${name}weeklyinterval"/>',"${i18n.weeklyInterval2}","</div>","</div>",'<div id="riweeklyweekdays" class="rifield">','<label for="${name}weeklyinterval" class="label">${i18n.weeklyWeekdays}</label>','<div class="field">',"{{each orderedWeekdays}}",'<div class="riweeklyweekday">','<input type="checkbox"','name="riweeklyweekdays${weekdays[$value]}"','id="${name}weeklyWeekdays${weekdays[$value]}"','value="${weekdays[$value]}" />','<label for="${name}weeklyWeekdays${weekdays[$value]}">${i18n.shortWeekdays[$value]}</label>',"</div>","{{/each}}","</div>","</div>",'<div id="rimonthlyinterval" class="rifield">','<label for="rimonthlyinterval" class="label">${i18n.monthlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="rimonthlyinterval"/>',"${i18n.monthlyInterval2}","</div>","</div>",'<div id="rimonthlyoptions" class="rifield">','<label for="rimonthlytype" class="label">${i18n.monthlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:DAYOFMONTH" />','<label for="${name}monthlytype:DAYOFMONTH">',"${i18n.monthlyDayOfMonth1}","</label>",'<select name="rimonthlydayofmonthday"','id="${name}monthlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyDayOfMonth2}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:WEEKDAYOFMONTH" />','<label for="${name}monthlytype:WEEKDAYOFMONTH">',"${i18n.monthlyWeekdayOfMonth1}","</label>",'<select name="rimonthlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth2}",'<select name="rimonthlyweekdayofmonth">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth3}","</div>","</div>","</div>",'<div id="riyearlyinterval" class="rifield">','<label for="riyearlyinterval" class="label">${i18n.yearlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="riyearlyinterval"/>',"${i18n.yearlyInterval2}","</div>","</div>",'<div id="riyearlyoptions" class="rifield">','<label for="riyearlyType" class="label">${i18n.yearlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:DAYOFMONTH" />','<label for="${name}yearlytype:DAYOFMONTH">',"${i18n.yearlyDayOfMonth1}","</label>",'<select name="riyearlydayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth2}",'<select name="riyearlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth3}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:WEEKDAYOFMONTH"/>','<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth1}","</label>",'<select name="riyearlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>",'<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth2}","</label>",'<select name="riyearlyweekdayofmonthday">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth3}",'<select name="riyearlyweekdayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth4}","</div>","</div>","</div>",'<div id="rirangeoptions" class="rifield">','<label class="label">${i18n.range}</label>','<div class="field">',"{{if hasRepeatForeverButton}}","<div>","<input",'type="radio"','value="NOENDDATE"','name="rirangetype"','id="${name}rangetype:NOENDDATE"/>','<label for="${name}rangetype:NOENDDATE">',"${i18n.rangeNoEnd}","</label>","</div>","{{/if}}","<div>","<input",'type="radio"','checked="checked"','value="BYOCCURRENCES"','name="rirangetype"','id="${name}rangetype:BYOCCURRENCES"/>','<label for="${name}rangetype:BYOCCURRENCES">',"${i18n.rangeByOccurrences1}","</label>","<input",'type="text" size="3"','value="7"','name="rirangebyoccurrencesvalue" />',"${i18n.rangeByOccurrences2}","</div>","<div>","<input",'type="radio"','value="BYENDDATE"','name="rirangetype"','id="${name}rangetype:BYENDDATE"/>','<label for="${name}rangetype:BYENDDATE">',"${i18n.rangeByEndDate}","</label>","<input",'type="date"','name="rirangebyenddatecalendar" />',"</div>","</div>","</div>","</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.preview}</h2>",'<span class="refreshbutton action">','<a class="rirefreshbutton" href="#" title="${i18n.refresh}">',"${i18n.refresh}","</a>","</span>","</div>","</div>",'<div class="rioccurrences">',"</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.addDate}</h2>","</div>",'<div class="riaddoccurrence">','<div class="errorarea"></div>','<input type="date" name="adddate" id="adddate" />','<input type="button" name="addaction" id="addaction" value="${i18n.add}">',"</div>","</div>",'<div class="ributtons">',"<input",'type="submit"','class="ricancelbutton ${ributtonExtraClass}"','value="${i18n.cancel}" />',"<input",'type="submit"','class="risavebutton ${ributtonExtraClass}"','value="${i18n.save}" />',"</div>","</form></div>"].join("\n");A.template("formTmpl",n);var l=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g;function c(e,t){for(e=e.toString(),t=t||2;e.length<t;)e="0"+e;return e}function k(e,t,n){var i=e.getDate(),a=e.getDay(),o=e.getMonth(),r=e.getFullYear(),s={d:i,dd:c(i),ddd:n.i18n.shortWeekdays[a],dddd:n.i18n.weekdays[a],m:o+1,mm:c(o+1),mmm:n.i18n.shortMonths[o],mmmm:n.i18n.months[o],yy:String(r).slice(2),yyyy:r};return t.replace(l,function(e){return s.hasOwnProperty(e)?s[e]:e.slice(1,e.length-1)})}function x(e,t,n){var i,a,o,r,s,l,c,d,u,h,p,f,m=e.find("select[name=rirtemplate]").val(),g=t.rtemplate[m],v=g.rrule,y=t.i18n.rtemplate[m];for(r=0;r<g.fields.length;r++)switch((i=e.find("#"+g.fields[r])).attr("id")){case"ridailyinterval":"1"!==(p=i.find("input[name=ridailyinterval]").val())&&(v+=";INTERVAL="+p),y=p+" "+t.i18n.dailyInterval2;break;case"riweeklyinterval":"1"!==(p=i.find("input[name=riweeklyinterval]").val())&&(v+=";INTERVAL="+p),y=p+" "+t.i18n.weeklyInterval2;break;case"riweeklyweekdays":for(o=a="",s=0;s<t.weekdays.length;s++)i.find("input[name=riweeklyweekdays"+t.weekdays[s]+"]").is(":checked")&&(a&&(a+=",",o+=", "),a+=t.weekdays[s],o+=t.i18n.weekdays[s]);a&&(v+=";BYDAY="+a,y+=" "+t.i18n.weeklyWeekdaysHuman+" "+o);break;case"rimonthlyinterval":"1"!==(p=i.find("input[name=rimonthlyinterval]").val())&&(v+=";INTERVAL="+p),y=p+" "+t.i18n.monthlyInterval2;break;case"rimonthlyoptions":switch(A("input[name=rimonthlytype]:checked",e).val()){case"DAYOFMONTH":v+=";BYMONTHDAY="+(d=A("select[name=rimonthlydayofmonthday]",e).val()),y+=", "+t.i18n.monthlyDayOfMonth1Human+" "+d+" "+t.i18n.monthlyDayOfMonth2;break;case"WEEKDAYOFMONTH":l=A("select[name=rimonthlyweekdayofmonthindex]",e).val(),d=A("select[name=rimonthlyweekdayofmonth]",e).val(),-1<A.inArray(d,["MO","TU","WE","TH","FR","SA","SU"])&&(v+=";BYDAY="+l+d,y+=", "+t.i18n.monthlyWeekdayOfMonth1Human+" ",y+=" "+t.i18n.orderIndexes[A.inArray(l,t.orderIndexes)],y+=" "+t.i18n.monthlyWeekdayOfMonth2,y+=" "+t.i18n.weekdays[A.inArray(d,t.weekdays)],y+=" "+t.i18n.monthlyDayOfMonth2)}break;case"riyearlyinterval":"1"!==(p=i.find("input[name=riyearlyinterval]").val())&&(v+=";INTERVAL="+p),y=p+" "+t.i18n.yearlyInterval2;break;case"riyearlyoptions":switch(A("input[name=riyearlyType]:checked",e).val()){case"DAYOFMONTH":v+=";BYMONTH="+(u=A("select[name=riyearlydayofmonthmonth]",e).val()),v+=";BYMONTHDAY="+(d=A("select[name=riyearlydayofmonthday]",e).val()),y+=", "+t.i18n.yearlyDayOfMonth1Human+" "+t.i18n.months[u-1]+" "+d;break;case"WEEKDAYOFMONTH":l=A("select[name=riyearlyweekdayofmonthindex]",e).val(),d=A("select[name=riyearlyweekdayofmonthday]",e).val(),v+=";BYMONTH="+(u=A("select[name=riyearlyweekdayofmonthmonth]",e).val()),-1<A.inArray(d,["MO","TU","WE","TH","FR","SA","SU"])&&(v+=";BYDAY="+l+d,y+=", "+t.i18n.yearlyWeekdayOfMonth1Human,y+=" "+t.i18n.orderIndexes[A.inArray(l,t.orderIndexes)],y+=" "+t.i18n.yearlyWeekdayOfMonth2,y+=" "+t.i18n.weekdays[A.inArray(d,t.weekdays)],y+=" "+t.i18n.yearlyWeekdayOfMonth3,y+=" "+t.i18n.months[u-1],y+=" "+t.i18n.yearlyWeekdayOfMonth4)}break;case"rirangeoptions":switch(e.find("input[name=rirangetype]:checked").val()){case"BYOCCURRENCES":v+=";COUNT="+(f=e.find("input[name=rirangebyoccurrencesvalue]").val()),y+=", "+t.i18n.rangeByOccurrences1Human,y+=" "+f,y+=" "+t.i18n.rangeByOccurrences2;break;case"BYENDDATE":v+=";UNTIL="+(i=e.find("input[name=rirangebyenddatecalendar]")).data("dateinput").getValue("yyyymmdd")+"T000000",!0===n&&(v+="Z"),y+=", "+t.i18n.rangeByEndDateHuman,y+=" "+i.data("dateinput").getValue(t.i18n.longDateFormat)}}if(void 0!==e.ical.RDATE&&0<e.ical.RDATE.length){for(e.ical.RDATE.sort(),c=[],r=0;r<e.ical.RDATE.length;r++)""!==e.ical.RDATE[r]&&(h=parseInt(e.ical.RDATE[r].substring(0,4),10),u=parseInt(e.ical.RDATE[r].substring(4,6),10)-1,d=parseInt(e.ical.RDATE[r].substring(6,8),10),c.push(k(new Date(h,u,d),t.i18n.longDateFormat,t)));0!==c.length&&(y=y+t.i18n.including+" "+c.join("; "))}if(void 0!==e.ical.EXDATE&&0<e.ical.EXDATE.length){for(e.ical.EXDATE.sort(),c=[],r=0;r<e.ical.EXDATE.length;r++)""!==e.ical.EXDATE[r]&&(h=parseInt(e.ical.EXDATE[r].substring(0,4),10),u=parseInt(e.ical.EXDATE[r].substring(4,6),10)-1,d=parseInt(e.ical.EXDATE[r].substring(6,8),10),c.push(k(new Date(h,u,d),t.i18n.longDateFormat,t)));0!==c.length&&(y=y+t.i18n.except+" "+c.join("; "))}return v="RRULE:"+v,void 0!==e.ical.EXDATE&&""!==e.ical.EXDATE.join()&&(v=v+"\nEXDATE:"+(c=A.map(e.ical.EXDATE,function(e){return 8===e.length&&(e+="T000000"),!0===n&&(e+="Z"),e}))),void 0!==e.ical.RDATE&&""!==e.ical.RDATE.join()&&(v=v+"\nRDATE:"+(c=A.map(e.ical.RDATE,function(e){return 8===e.length&&(e+="T000000"),!0===n&&(e+="Z"),e}))),{result:v,description:y}}function I(e){var t,n=[],i=e.split(",");for(t in i)i.hasOwnProperty(t)&&(-1!==i[t].indexOf("Z")?n.push(i[t].substring(0,15)):n.push(i[t]));return n}function T(e,t,n,i){var a,o,r,s,l,c,d,u,h,p,f,m,g,v,y,b,w,k,x,T,S,C=[];if(e.ical=function(e){var t,n,i,a,o,r=[],s={},l=null;for((r=e.split("\n")).reverse();;){if(0<r.length){if(" "===(t=r.pop()).charAt(0)||"\t"===t.charAt(0)){l+=t;continue}}else t="";if(null!==l&&(o=a=i=void 0,i={},a=(n=l).indexOf(":"),o=n.substring(0,a),i.value=n.substring(a+1),-1!==o.indexOf(";")?(a=o.indexOf(";"),i.parameters=o.substring(a+1),i.property=o.substring(0,a)):(i.parameters=null,i.property=o),"RDATE"===(l=i).property||"EXDATE"===l.property?s[l.property]=I(l.value):s[l.property]=l.value),""===(l=t))break}return s}(n),void 0===e.ical.RRULE){if(C.push(t.i18n.noRule),!i)return-1}else{for(a in m=(o=/INTERVAL=([0-9]+);?/.exec(e.ical.RRULE))?o[1]:"1",g=(o=/BYDAY=([^;]+);?/.exec(e.ical.RRULE))?o[1]:"",y=(o=/BYMONTHDAY=([^;]+);?/.exec(e.ical.RRULE))?o[1].split(","):null,v=(o=/BYMONTH=([^;]+);?/.exec(e.ical.RRULE))?o[1].split(","):null,b=(o=/COUNT=([0-9]+);?/.exec(e.ical.RRULE))?o[1]:null,w=(o=/UNTIL=([0-9T]+);?/.exec(e.ical.RRULE))?o[1]:null,(o=/BYSETPOS=([^;]+);?/.exec(e.ical.RRULE))&&C.push(t.i18n.bysetpos),r="",s=null,t.rtemplate)t.rtemplate.hasOwnProperty(a)&&(l=t.rtemplate[a],0===e.ical.RRULE.indexOf(l.rrule)&&e.ical.RRULE.length>r.length&&(r=e.ical.RRULE,s=a));if(r)l=t.rtemplate[s],e.find("select[name=rirtemplate]").val(s);else{for(l in t.rtemplate)if(t.rtemplate.hasOwnProperty(l)){l=t.rtemplate[l];break}C.push(t.i18n.noTemplateMatch)}for(a=0;a<l.fields.length;a++)switch((p=e.find("#"+l.fields[a])).attr("id")){case"ridailyinterval":p.find("input[name=ridailyinterval]").val(m);break;case"riweeklyinterval":p.find("input[name=riweeklyinterval]").val(m);break;case"riweeklyweekdays":for(g=g.split(","),c=0;c<t.weekdays.length;c++)k=t.weekdays[c],(d=p.find("input[name=riweeklyweekdays"+k+"]")).attr("checked",-1!==A.inArray(k,g));break;case"rimonthlyinterval":p.find("input[name=rimonthlyinterval]").val(m);break;case"rimonthlyoptions":var E="DAYOFMONTH";for(y&&(E="DAYOFMONTH",1<y.length&&(C.push(t.i18n.multipleDayOfMonth),y=y[0]),p.find("select[name=rimonthlydayofmonthday]").val(y)),g&&(E="WEEKDAYOFMONTH",-1!==g.indexOf(",")&&(C.push(t.i18n.multipleDayOfMonth),g=g.split(",")[0]),"+"!==(u=g.slice(0,-2)).charAt(0)&&"-"!==u.charAt(0)&&(u="+"+u),S=g.slice(-2),p.find("select[name=rimonthlyweekdayofmonthindex]").val(u),p.find("select[name=rimonthlyweekdayofmonth]").val(S)),h=p.find("input[name=rimonthlytype]"),u=0;u<h.length;u++)f=h[u],A(f).attr("checked",f.value===E);break;case"riyearlyinterval":p.find("input[name=riyearlyinterval]").val(m);break;case"riyearlyoptions":var D="DAYOFMONTH";for(y&&(D="DAYOFMONTH",1<y.length&&(C.push(t.i18n.multipleDayOfMonth),y=y[0]),p.find("select[name=riyearlydayofmonthmonth]").val(v),p.find("select[name=riyearlydayofmonthday]").val(y)),g&&(D="WEEKDAYOFMONTH",-1!==g.indexOf(",")&&(C.push(t.i18n.multipleDayOfMonth),g=g.split(",")[0]),"+"!==(u=g.slice(0,-2)).charAt(0)&&"-"!==u.charAt(0)&&(u="+"+u),S=g.slice(-2),p.find("select[name=riyearlyweekdayofmonthindex]").val(u),p.find("select[name=riyearlyweekdayofmonthday]").val(S),p.find("select[name=riyearlyweekdayofmonthmonth]").val(v)),h=p.find("input[name=riyearlyType]"),u=0;u<h.length;u++)f=h[u],A(f).attr("checked",f.value===D);break;case"rirangeoptions":var $="NOENDDATE";for(b&&($="BYOCCURRENCES",p.find("input[name=rirangebyoccurrencesvalue]").val(b)),w&&($="BYENDDATE",d=p.find("input[name=rirangebyenddatecalendar]"),T=w.slice(0,4),x=w.slice(4,6),x=parseInt(x,10)-1,k=w.slice(6,8),d.data("dateinput").setValue(new Date(T,x,k))),h=p.find("input[name=rirangetype]"),u=0;u<h.length;u++)f=h[u],A(f).attr("checked",f.value===$)}}var O=e.find("#messagearea");return 0!==C.length?(O.text(t.i18n.unsupportedFeatures+" "+C.join("; ")),O.show(),1):(O.text(""),O.hide(),0)}function i(f,n){var m,g,e,t,i=[];for(t=0;t<7;t++)6<(e=t+f.firstDay)&&(e-=7),i.push(e);function a(e){var t;m.find(".rifield").hide();var n=e.val();if(n){var i=f.rtemplate[n];for(t=0;t<i.fields.length;t++)m.find("#"+i.fields[t]).show()}}function v(e){e.preventDefault(),void 0===m.ical.EXDATE&&(m.ical.EXDATE=[]),m.ical.EXDATE.push(this.attributes.date.value);var t=A(this);t.attr("class","exdate"),t.parent().parent().addClass("exdate"),t.unbind(e),t.click(y)}function y(e){e.preventDefault(),m.ical.EXDATE.splice(A.inArray(this.attributes.date.value,m.ical.EXDATE),1);var t=A(this);t.attr("class","rrule"),t.parent().parent().removeClass("exdate"),t.unbind(e),t.click(v)}function b(e){e.preventDefault(),m.ical.RDATE.splice(A.inArray(this.attributes.date.value,m.ical.RDATE),1),A(this).parent().parent().hide("slow",function(){A(this).remove()})}function w(u,h,e,p){(p?g:m).find(".rioccurrences").hide();var t={year:u.getFullYear(),month:u.getMonth()+1,day:u.getDate(),rrule:h,format:f.i18n.longDateFormat,start:e},n={url:f.ajaxURL,async:!1,type:"post",dataType:"json",contentType:f.ajaxContentType,cache:!1,data:t,success:function(e,t,n){var i,a,o,r,s,l,c,d;for(d in a=p?g:m,e.readOnly=p,e.i18n=f.i18n,e.occurrences)e.occurrences.hasOwnProperty(d)&&(r=(o=e.occurrences[d]).date,s=parseInt(r.substring(0,4),10),l=parseInt(r.substring(4,6),10)-1,c=parseInt(r.substring(6,8),10),o.formattedDate=k(new Date(s,l,c),f.i18n.longDateFormat,f));i=A.tmpl("occurrenceTmpl",e),a.find(".rioccurrences").replaceWith(i),a.find(".rioccurrences .batching a").click(function(e){e.preventDefault(),w(u,h,this.attributes.start.value,p)}),p||(a.find(".rioccurrences .action a.rrule").click(v),a.find(".rioccurrences .action a.exdate").click(y),a.find(".rioccurrences .action a.rdate").click(b)),a.find(".rioccurrences").show()},error:function(e,t,n){alert(t)}};A.ajax(n)}function o(e){var t=A(e);return t.length||(t=A("#"+e)),t.length||(t=A("input[name='"+e+"']")),t}function r(){var e,t,n,i,a=null;if(f.startField){if(!(e=o(f.startField)).length)return null;(a=e.data("dateinput"))?a=a.getValue():""===(a=e.val())&&(a=e.text()),"string"==typeof a&&(a=a.replace(" ","T")),a=new Date(a)}else if(f.startFieldYear&&f.startFieldMonth&&f.startFieldDay){if(t=o(f.startFieldYear),n=o(f.startFieldMonth),i=o(f.startFieldDay),!t.length&&!n.length&&!i.length)return null;a=new Date(t.val(),n.val()-1,i.val())}return null===a?null:isNaN(a)?null:a}function s(e,t){var n,i;return i=(n=t.find("input[name="+e+"]")).val(),isNaN(i)||-1!==i.toString().indexOf(".")||""===n.val()?null:i}function l(e){var t,n,i;e&&T(m,f,e,!0),null!==(t=r())?(m.find("select[name=rimonthlydayofmonthday]").val(t.getDate()),n=f.orderIndexes[Math.floor((t.getDate()-1)/7)],i=f.weekdays[t.getDay()],m.find("select[name=rimonthlyweekdayofmonthindex]").val(n),m.find("select[name=rimonthlyweekdayofmonth]").val(i),m.find("select[name=riyearlydayofmonthmonth]").val(t.getMonth()+1),m.find("select[name=riyearlydayofmonthday]").val(t.getDate()),m.find("select[name=riyearlyweekdayofmonthindex]").val(n),m.find("select[name=riyearlyweekdayofmonthday]").val(i),m.find("select[name=riyearlyweekdayofmonthmonth]").val(t.getMonth()+1),w(t,x(m,f,!1).result,0,!1),m.find("div.rioccurrencesactions").show()):m.find("div.rioccurrencesactions").hide(),a(m.find("select[name=rirtemplate]"))}function c(){var e=x(m,f,!1);g.find("label[class=ridisplay]").text(f.i18n.displayActivate+" "+e.description),n.val(e.result).change();var t=r();null!==t&&w(t,x(m,f,!1).result,0,!0),g.find('button[name="riedit"]').text(f.i18n.edit_rules),g.find('button[name="ridelete"]').show()}function d(e){var t,n,i,a;if(t=r(),(a=e.find("#messagearea")).text(""),a.hide(),e.find(".riaddoccurrence div.errorarea").text("").hide(),"block"===e.find("#ridailyinterval").css("display")&&(!(i=s("ridailyinterval",e))||i<1||1e3<i))return a.text(f.i18n.noRepeatEvery).show(),!1;if("block"===e.find("#riweeklyinterval").css("display")&&(!(i=s("riweeklyinterval",e))||i<1||1e3<i))return a.text(f.i18n.noRepeatEvery).show(),!1;if("block"===e.find("#rimonthlyinterval").css("display")){if(!(i=s("rimonthlyinterval",e))||i<1||1e3<i)return a.text(f.i18n.noRepeatEvery).show(),!1;if(0===e.find("#rimonthlyoptions input:checked").length)return a.text(f.i18n.noRepeatOn).show(),!1}if("block"===e.find("#riyearlyinterval").css("display")){if(!(i=s("riyearlyinterval",e))||i<1||1e3<i)return a.text(f.i18n.noRepeatEvery).show(),!1;if(0===e.find("#riyearlyoptions input:checked").length)return a.text(f.i18n.noRepeatOn).show(),!1}if(0<e.find('input[value="BYOCCURRENCES"]:visible:checked').length&&(!(i=s("rirangebyoccurrencesvalue",e))||i<1||1e3<i))return a.text(f.i18n.noEndAfterNOccurrences).show(),!1;if(0<e.find('input[value="BYENDDATE"]:visible:checked').length){if(!(n=function(e){var t,n;return n=(n=(t=e.find("input[name=rirangebyenddatecalendar]")).data("dateinput"))?n.getValue():t.val(),n=new Date(n),isNaN(n)||""===t.val()?null:n}(e)))return a.text(f.i18n.noEndDate).show(),!1;if(n<t)return a.text(f.i18n.pastEndDate).show(),!1}return!0}function u(e){e.preventDefault(),d(m)&&(m.overlay().close(),c())}function h(){var e;e=r(),d(m)&&w(e,x(m,f,!1).result,0,!1)}A.extend(f,{orderIndexes:["+1","+2","+3","+4","-1"],weekdays:["SU","MO","TU","WE","TH","FR","SA"],orderedWeekdays:i}),g=A.tmpl("displayTmpl",f),(m=A.tmpl("formTmpl",f)).overlay(f.formOverlay).hide(),m.ical={RDATE:[],EXDATE:[]},A.tools.dateinput.localize(f.lang,{months:p[f.lang].months.join(),shortMonths:p[f.lang].shortMonths.join(),days:p[f.lang].weekdays.join(),shortDays:p[f.lang].shortWeekdays.join()}),m.find("input[name=rirangebyenddatecalendar]").dateinput({selectors:!0,lang:f.lang,format:f.i18n.shortDateFormat,firstDay:f.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),n.val()&&(-1===T(m,f,n.val(),!1)?g.find("label[class=ridisplay]").text(f.i18n.noRule):c());g.find("button[name=ridelete]").click(function(e){e.preventDefault(),g.find("label[class=ridisplay]").text(f.i18n.displayUnactivate),n.val("").change(),g.find(".rioccurrences").hide(),g.find('button[name="riedit"]').text(f.i18n.add_rules),g.find('button[name="ridelete"]').hide()}),g.find("button[name=riedit]").click(function(e){l(n.val()),e.preventDefault(),m.overlay().load()}),m.find("div.riaddoccurrence input#adddate").dateinput({selectors:!0,lang:f.lang,format:f.i18n.shortDateFormat,firstDay:f.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),m.find("input#addaction").click(function(e){e.preventDefault();var t=m.find(".riaddoccurrence input#adddate").data("dateinput"),n=t.getValue("yyyymmddT000000");void 0===m.ical.RDATE&&(m.ical.RDATE=[]);var i=m.find(".riaddoccurrence div.errorarea");if(i.text(""),i.hide(),-1===A.inArray(n,m.ical.RDATE)){m.ical.RDATE.push(n);var a=['<div class="occurrence rdate" style="display: none;">','<span class="rdate">',t.getValue(f.i18n.longDateFormat),'<span class="rlabel">'+f.i18n.additionalDate+"</span>","</span>",'<span class="action">','<a date="'+n+'" href="#" class="rdate" >',"Include","</a>","</span>","</div>"].join("\n");m.find("div.rioccurrences").prepend(a),A(m.find("div.rioccurrences div")[0]).slideDown(),A(m.find("div.rioccurrences .action a.rdate")[0]).click(b)}else i.text(f.i18n.alreadyAdded).show()}),m.find("a.rirefreshbutton").click(function(e){e.preventDefault(),h()}),m.find("select[name=rirtemplate]").change(function(e){a(A(this))}),m.find("select").change(function(e){A(this).parent().find("> input").click().change()}),m.find("input[name=rirangebyoccurrencesvalue]").change(function(e){A(this).parent().find("input[name=rirangetype]").click().change()}),m.find("input[name=rirangebyenddatecalendar]").change(function(){A(this).parent().find("input[name=rirangetype]").click(),0!==m.find(".rioccurrencesactions:visible").length&&h()}),m.find("input:radio, .riweeklyweekday > input, input[name=ridailyinterval], input[name=riweeklyinterval], input[name=rimonthlyinterval], input[name=riyearlyinterval]").change(function(e){0!==m.find(".rioccurrencesactions:visible").length&&h()}),m.find(".ricancelbutton").click(function(e){e.preventDefault(),m.overlay().close()}),m.find(".risavebutton").click(u),A.extend(this,{display:g,form:m,loadData:l,save:u})}A.fn.recurrenceinput=function(e){if(this.data("recurrenceinput"))return this.data("recurrenceinput");var t=A.extend({},a.conf);A.extend(t,e),A.extend(t,{i18n:p[t.lang],name:this.attr("name")});var n=new i(t,this);return n.form.appendTo("body"),this.after(n.display),this.hide(),this.data("recurrenceinput",n),n}}(jQuery)}.apply(e,arguments)})}(this),define("mockup-patterns-recurrence",["jquery","pat-base","jquery.recurrenceinput"],function(e,t){"use strict";return t.extend({name:"recurrence",trigger:".pat-recurrence",parser:"mockup",defaults:{language:"en",localization:null,configuration:{}},init:function(){this.$el.addClass("recurrence-widget"),this.options.localization&&e.tools.recurrenceinput.localize(this.options.language,this.options.localization),this.$el.recurrenceinput(this.options.configuration)}})}),function(e){define("select2",[],function(){return function(){var a;void 0===(a=jQuery).fn.each2&&a.extend(a.fn,{each2:function(e){for(var t=a([0]),n=-1,i=this.length;++n<i&&(t.context=t[0]=this[n])&&!1!==e.call(t[0],n,t););return this}}),function(k,w){"use strict";if(window.Select2===w){var e,t,n,x,o,a,T,i,r={x:0,y:0},s={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case s.LEFT:case s.RIGHT:case s.UP:case s.DOWN:return!0}return!1},isControl:function(e){switch(e.which){case s.SHIFT:case s.CTRL:case s.ALT:return!0}return!!e.metaKey},isFunctionKey:function(e){return 112<=(e=e.which?e.which:e)&&e<=123}},l={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};a=k(document),i=1,x=function(){return i++},t=I(e=I(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(e){var o,t,n=".select2-results";this.opts=e=this.prepareOpts(e),this.id=e.id,e.element.data("select2")!==w&&null!==e.element.data("select2")&&e.element.data("select2").destroy(),this.container=this.createContainer(),this.liveRegion=k(".select2-hidden-accessible"),0==this.liveRegion.length&&(this.liveRegion=k("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body)),this.containerId="s2id_"+(e.element.attr("id")||"autogen"+x()),this.containerEventName=this.containerId.replace(/([.])/g,"_").replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.container.attr("title",e.element.attr("title")),this.body=k(document.body),y(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",e.element.attr("style")),this.container.css(O(e.containerCss,this.opts.element)),this.container.addClass(O(e.containerCssClass,this.opts.element)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",v),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(O(e.dropdownCssClass,this.opts.element)),this.dropdown.data("select2",this),this.dropdown.on("click",v),this.results=o=this.container.find(n),this.search=t=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",v),function(e){e.on("mousemove",function(e){var t=r;t!==w&&t.x===e.pageX&&t.y===e.pageY||k(e.target).trigger("mousemove-filtered",e)})}(this.results),this.dropdown.on("mousemove-filtered",n,this.bind(this.highlightUnderEvent)),this.dropdown.on("touchstart touchmove touchend",n,this.bind(function(e){this._touchEvent=!0,this.highlightUnderEvent(e)})),this.dropdown.on("touchmove",n,this.bind(this.touchMoved)),this.dropdown.on("touchstart touchend",n,this.bind(this.clearTouchMoved)),this.dropdown.on("click",this.bind(function(e){this._touchEvent&&(this._touchEvent=!1,this.selectHighlighted())})),function(e,t){var n=g(e,function(e){t.trigger("scroll-debounced",e)});t.on("scroll",function(e){0<=u(e.target,t.get())&&n(e)})}(80,this.results),this.dropdown.on("scroll-debounced",n,this.bind(this.loadMoreIfNeeded)),k(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),k(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),k.fn.mousewheel&&o.mousewheel(function(e,t,n,i){var a=o.scrollTop();0<i&&a-i<=0?(o.scrollTop(0),v(e)):i<0&&o.get(0).scrollHeight-o.scrollTop()+i<=o.height()&&(o.scrollTop(o.get(0).scrollHeight-o.height()),v(e))}),m(t),t.on("keyup-change input paste",this.bind(this.updateResults)),t.on("focus",function(){t.addClass("select2-focused")}),t.on("blur",function(){t.removeClass("select2-focused")}),this.dropdown.on("mouseup",n,this.bind(function(e){0<k(e.target).closest(".select2-result-selectable").length&&(this.highlightUnderEvent(e),this.selectHighlighted(e))})),this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(e){e.stopPropagation()}),this.lastSearchTerm=w,k.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==e.maximumInputLength&&this.search.attr("maxlength",e.maximumInputLength);var i=e.element.prop("disabled");i===w&&(i=!1),this.enable(!i);var a=e.element.prop("readonly");a===w&&(a=!1),this.readonly(a),T=T||function(){var e=k("<div class='select2-measure-scrollbar'></div>");e.appendTo(document.body);var t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight};return e.remove(),t}(),this.autofocus=e.element.prop("autofocus"),e.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.search.attr("placeholder",e.searchInputPlaceholder)},destroy:function(){var e=this.opts.element,t=e.data("select2"),n=this;this.close(),e.length&&e[0].detachEvent&&n._sync&&e.each(function(){n._sync&&this.detachEvent("onpropertychange",n._sync)}),this.propertyObserver&&(this.propertyObserver.disconnect(),this.propertyObserver=null),this._sync=null,t!==w&&(t.container.remove(),t.liveRegion.remove(),t.dropdown.remove(),e.removeData("select2").off(".select2"),e.is("input[type='hidden']")?e.css("display",""):(e.show().prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())),A.call(this,"container","liveRegion","dropdown","results","search")},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:p(e.attr("locked"),"locked")||p(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(y){var r,e,t,n,b=this;if("select"===(r=y.element).get(0).tagName.toLowerCase()&&(this.select=e=y.element),e&&k.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in y)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),y.debug=y.debug||k.fn.select2.defaults.debug,y.debug&&console&&console.warn&&(null!=y.id&&console.warn("Select2: The `id` option has been removed in Select2 4.0.0, consider renaming your `id` property or mapping the property before your data makes it to Select2. You can read more at https://select2.github.io/announcements-4.0.html#changed-id"),null!=y.text&&console.warn("Select2: The `text` option has been removed in Select2 4.0.0, consider renaming your `text` property or mapping the property before your data makes it to Select2. You can read more at https://select2.github.io/announcements-4.0.html#changed-id"),null!=y.sortResults&&console.warn("Select2: the `sortResults` option has been renamed to `sorter` in Select2 4.0.0. "),null!=y.selectOnBlur&&console.warn("Select2: The `selectOnBlur` option has been renamed to `selectOnClose` in Select2 4.0.0."),null!=y.ajax&&null!=y.ajax.results&&console.warn("Select2: The `ajax.results` option has been renamed to `ajax.processResults` in Select2 4.0.0."),null!=y.formatNoResults&&console.warn("Select2: The `formatNoResults` option has been renamed to `language.noResults` in Select2 4.0.0."),null!=y.formatSearching&&console.warn("Select2: The `formatSearching` option has been renamed to `language.searching` in Select2 4.0.0."),null!=y.formatInputTooShort&&console.warn("Select2: The `formatInputTooShort` option has been renamed to `language.inputTooShort` in Select2 4.0.0."),null!=y.formatInputTooLong&&console.warn("Select2: The `formatInputTooLong` option has been renamed to `language.inputTooLong` in Select2 4.0.0."),null!=y.formatLoading&&console.warn("Select2: The `formatLoading` option has been renamed to `language.loadingMore` in Select2 4.0.0."),null!=y.formatSelectionTooBig&&console.warn("Select2: The `formatSelectionTooBig` option has been renamed to `language.maximumSelected` in Select2 4.0.0."),y.element.data("select2Tags")&&console.warn("Select2: The `data-select2-tags` attribute has been renamed to `data-tags` in Select2 4.0.0.")),null!=y.element.data("tags")){var i=y.element.data("tags");k.isArray(i)||(i=[]),y.element.data("select2Tags",i)}if(null!=y.sorter&&(y.sortResults=y.sorter),null!=y.selectOnClose&&(y.selectOnBlur=y.selectOnClose),null!=y.ajax&&k.isFunction(y.ajax.processResults)&&(y.ajax.results=y.ajax.processResults),null!=y.language){var a=y.language;k.isFunction(a.noMatches)&&(y.formatNoMatches=a.noMatches),k.isFunction(a.searching)&&(y.formatSearching=a.searching),k.isFunction(a.inputTooShort)&&(y.formatInputTooShort=a.inputTooShort),k.isFunction(a.inputTooLong)&&(y.formatInputTooLong=a.inputTooLong),k.isFunction(a.loadingMore)&&(y.formatLoading=a.loadingMore),k.isFunction(a.maximumSelected)&&(y.formatSelectionTooBig=a.maximumSelected)}if("function"!=typeof(y=k.extend({},{populateResults:function(e,t,f){var m,g=this.opts.id,v=this.liveRegion;(m=function(e,t,n){var i,a,o,r,s,l,c,d,u,h,p=[];for(i=0,a=(e=y.sortResults(e,t,f)).length;i<a;i+=1)r=!(s=!0===(o=e[i]).disabled)&&g(o)!==w,l=o.children&&0<o.children.length,(c=k("<li></li>")).addClass("select2-results-dept-"+n),c.addClass("select2-result"),c.addClass(r?"select2-result-selectable":"select2-result-unselectable"),s&&c.addClass("select2-disabled"),l&&c.addClass("select2-result-with-children"),c.addClass(b.opts.formatResultCssClass(o)),c.attr("role","presentation"),(d=k(document.createElement("div"))).addClass("select2-result-label"),d.attr("id","select2-result-label-"+x()),d.attr("role","option"),(h=y.formatResult(o,d,f,b.opts.escapeMarkup))!==w&&(d.html(h),c.append(d)),l&&((u=k("<ul></ul>")).addClass("select2-result-sub"),m(o.children,u,n+1),c.append(u)),c.data("select2-data",o),p.push(c[0]);t.append(p),v.text(y.formatMatches(e.length))})(t,e,0)}},k.fn.select2.defaults,y)).id&&(t=y.id,y.id=function(e){return e[t]}),k.isArray(y.element.data("select2Tags"))){if("tags"in y)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+y.element.attr("id");y.tags=y.element.data("select2Tags")}if(e?(y.query=this.bind(function(i){var e,t,a,n={results:[],more:!1},o=i.term;a=function(e,t){var n;e.is("option")?i.matcher(o,e.text(),e)&&t.push(b.optionToData(e)):e.is("optgroup")&&(n=b.optionToData(e),e.children().each2(function(e,t){a(t,n.children)}),0<n.children.length&&t.push(n))},e=r.children(),this.getPlaceholder()!==w&&0<e.length&&(t=this.getPlaceholderOption())&&(e=e.not(t)),e.each2(function(e,t){a(t,n.results)}),i.callback(n)}),y.id=function(e){return e.id}):"query"in y||("ajax"in y?((n=y.element.data("ajax-url"))&&0<n.length&&(y.ajax.url=n),y.query=C.call(y.element,y.ajax)):"data"in y?y.query=E(y.data):"tags"in y&&(y.query=D(y.tags),y.createSearchChoice===w&&(y.createSearchChoice=function(e){return{id:k.trim(e),text:k.trim(e)}}),y.initSelection===w&&(y.initSelection=function(e,t){var n=[];k(h(e.val(),y.separator,y.transformVal)).each(function(){var e={id:this,text:this},t=y.tags;k.isFunction(t)&&(t=t()),k(t).each(function(){if(p(this.id,e.id))return e=this,!1}),n.push(e)}),t(n)}))),"function"!=typeof y.query)throw"query function not defined for Select2 "+y.element.attr("id");if("top"===y.createSearchChoicePosition)y.createSearchChoicePosition=function(e,t){e.unshift(t)};else if("bottom"===y.createSearchChoicePosition)y.createSearchChoicePosition=function(e,t){e.push(t)};else if("function"!=typeof y.createSearchChoicePosition)throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";return y},monitorSource:function(){var e,n=this.opts.element,t=this;n.on("change.select2",this.bind(function(e){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()})),this._sync=this.bind(function(){var e=n.prop("disabled");e===w&&(e=!1),this.enable(!e);var t=n.prop("readonly");t===w&&(t=!1),this.readonly(t),this.container&&(y(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(O(this.opts.containerCssClass,this.opts.element))),this.dropdown&&(y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(O(this.opts.dropdownCssClass,this.opts.element)))}),n.length&&n[0].attachEvent&&n.each(function(){this.attachEvent("onpropertychange",t._sync)}),(e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)!==w&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new e(function(e){k.each(e,t._sync)}),this.propertyObserver.observe(n.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(e){var t=k.Event("select2-selecting",{val:this.id(e),object:e,choice:e});return this.opts.element.trigger(t),!t.isDefaultPrevented()},triggerChange:function(e){e=e||{},e=k.extend({},e,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(e),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e!==this.enabledInterface&&(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){e===w&&(e=!0),this._enabled!==e&&(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(e){e===w&&(e=!1),this._readonly!==e&&(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface())},opened:function(){return!!this.container&&this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var e,t,n,i,a,o=this.dropdown,r=this.container,s=r.offset(),l=r.outerHeight(!1),c=r.outerWidth(!1),d=o.outerHeight(!1),u=k(window),h=u.width(),p=u.height(),f=u.scrollLeft()+h,m=u.scrollTop()+p,g=s.top+l,v=s.left,y=g+d<=m,b=s.top-d>=u.scrollTop(),w=o.outerWidth(!1);o.hasClass("select2-drop-above")?(t=!0,!b&&y&&(t=!(n=!0))):(t=!1,!y&&b&&(t=n=!0)),n&&(o.hide(),s=this.container.offset(),l=this.container.outerHeight(!1),c=this.container.outerWidth(!1),d=o.outerHeight(!1),f=u.scrollLeft()+h,m=u.scrollTop()+p,g=s.top+l,v=s.left,w=o.outerWidth(!1),o.show(),this.focusSearch()),this.opts.dropdownAutoWidth?(a=k(".select2-results",o)[0],o.addClass("select2-drop-auto-width"),o.css("width",""),c<(w=o.outerWidth(!1)+(a.scrollHeight===a.clientHeight?0:T.width))?c=w:w=c,d=o.outerHeight(!1)):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body.css("position")&&(g-=(e=this.body.offset()).top,v-=e.left),!(v+w<=f)&&s.left+f+r.outerWidth(!1)>w&&(v=s.left+this.container.outerWidth(!1)-w),i={left:v,width:c},t?(this.container.addClass("select2-drop-above"),o.addClass("select2-drop-above"),d=o.outerHeight(!1),i.top=s.top-d,i.bottom="auto"):(i.top=g,i.bottom="auto",this.container.removeClass("select2-drop-above"),o.removeClass("select2-drop-above")),i=k.extend(i,O(this.opts.dropdownCss,this.opts.element)),o.css(i)},shouldOpen:function(){var e;return!this.opened()&&(!1!==this._enabled&&!0!==this._readonly&&(e=k.Event("select2-opening"),this.opts.element.trigger(e),!e.isDefaultPrevented()))},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return!!this.shouldOpen()&&(this.opening(),a.on("mousemove.select2Event",function(e){r.x=e.pageX,r.y=e.pageY}),!0)},opening:function(){var i,e=this.containerEventName,t="scroll."+e,n="resize."+e,a="orientationchange."+e;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),0===(i=k("#select2-drop-mask")).length&&((i=k(document.createElement("div"))).attr("id","select2-drop-mask").attr("class","select2-drop-mask"),i.hide(),i.appendTo(this.body),i.on("mousedown touchstart click",function(e){c(i);var t,n=k("#select2-drop");0<n.length&&((t=n.data("select2")).opts.selectOnBlur&&t.selectHighlighted({noFocus:!0}),t.close(),e.preventDefault(),e.stopPropagation())})),this.dropdown.prev()[0]!==i[0]&&this.dropdown.before(i),k("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),i.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var o=this;this.container.parents().add(window).each(function(){k(this).on(n+" "+t+" "+a,function(e){o.opened()&&o.positionDropdown()})})},close:function(){if(this.opened()){var e=this.containerEventName,t="scroll."+e,n="resize."+e,i="orientationchange."+e;this.container.parents().add(window).each(function(){k(this).off(t).off(n).off(i)}),this.clearDropdownAlignmentPreference(),k("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),a.off("mousemove.select2Event"),this.clearSearch(),this.search.removeClass("select2-active"),this.search.removeAttr("aria-activedescendant"),this.opts.element.trigger(k.Event("select2-close"))}},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},prefillNextSearchTerm:function(){if(""!==this.search.val())return!1;var e=this.opts.nextSearchTerm(this.data(),this.lastSearchTerm);return e!==w&&(this.search.val(e),this.search.select(),!0)},getMaximumSelectionSize:function(){return O(this.opts.maximumSelectionSize,this.opts.element)},ensureHighlightVisible:function(){var e,t,n,i,a,o,r,s,l=this.results;(t=this.highlight())<0||(0!=t?(e=this.findHighlightableChoices().find(".select2-result-label"),i=(s=((n=k(e[t])).offset()||{}).top||0)+n.outerHeight(!0),t===e.length-1&&0<(r=l.find("li.select2-more-results")).length&&(i=r.offset().top+r.outerHeight(!0)),(a=l.offset().top+l.outerHeight(!1))<i&&l.scrollTop(l.scrollTop()+(i-a)),(o=s-l.offset().top)<0&&"none"!=n.css("display")&&l.scrollTop(l.scrollTop()+o)):l.scrollTop(0))},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)")},moveHighlight:function(e){for(var t=this.findHighlightableChoices(),n=this.highlight();-1<n&&n<t.length;){var i=k(t[n+=e]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")&&!i.hasClass("select2-selected")){this.highlight(n);break}}},highlight:function(e){var t,n,i=this.findHighlightableChoices();if(0===arguments.length)return u(i.filter(".select2-highlighted")[0],i.get());e>=i.length&&(e=i.length-1),e<0&&(e=0),this.removeHighlight(),(t=k(i[e])).addClass("select2-highlighted"),this.search.attr("aria-activedescendant",t.find(".select2-result-label").attr("id")),this.ensureHighlightVisible(),this.liveRegion.text(t.text()),(n=t.data("select2-data"))&&this.opts.element.trigger({type:"select2-highlight",val:this.id(n),choice:n})},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(e){var t=k(e.target).closest(".select2-result-selectable");if(0<t.length&&!t.is(".select2-highlighted")){var n=this.findHighlightableChoices();this.highlight(n.index(t))}else 0==t.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var t=this.results,n=t.find("li.select2-more-results"),i=this.resultsPage+1,a=this,o=this.search.val(),r=this.context;0!==n.length&&n.offset().top-t.offset().top-t.height()<=this.opts.loadMorePadding&&(n.addClass("select2-active"),this.opts.query({element:this.opts.element,term:o,page:i,context:r,matcher:this.opts.matcher,callback:this.bind(function(e){a.opened()&&(a.opts.populateResults.call(this,t,e.results,{term:o,page:i,context:r}),a.postprocessResults(e,!1,!1),!0===e.more?(n.detach().appendTo(t).html(a.opts.escapeMarkup(O(a.opts.formatLoadMore,a.opts.element,i+1))),window.setTimeout(function(){a.loadMoreIfNeeded()},10)):n.remove(),a.positionDropdown(),a.resultsPage=i,a.context=e.context,this.opts.element.trigger({type:"select2-loaded",items:e}))})}))},tokenize:function(){},updateResults:function(n){var e,t,i,a=this.search,o=this.results,r=this.opts,s=this,l=a.val(),c=k.data(this.container,"select2-last-term");if((!0===n||!c||!p(l,c))&&(k.data(this.container,"select2-last-term",l),!0===n||!1!==this.showSearchInput&&this.opened())){i=++this.queryCount;var d=this.getMaximumSelectionSize();if(!(1<=d&&(e=this.data(),k.isArray(e)&&e.length>=d&&$(r.formatSelectionTooBig,"formatSelectionTooBig"))))return a.val().length<r.minimumInputLength?($(r.formatInputTooShort,"formatInputTooShort")?h("<li class='select2-no-results'>"+O(r.formatInputTooShort,r.element,a.val(),r.minimumInputLength)+"</li>"):h(""),void(n&&this.showSearch&&this.showSearch(!0))):void(r.maximumInputLength&&a.val().length>r.maximumInputLength?$(r.formatInputTooLong,"formatInputTooLong")?h("<li class='select2-no-results'>"+O(r.formatInputTooLong,r.element,a.val(),r.maximumInputLength)+"</li>"):h(""):(r.formatSearching&&0===this.findHighlightableChoices().length&&h("<li class='select2-searching'>"+O(r.formatSearching,r.element)+"</li>"),a.addClass("select2-active"),this.removeHighlight(),(t=this.tokenize())!=w&&null!=t&&a.val(t),this.resultsPage=1,r.query({element:r.element,term:a.val(),page:this.resultsPage,context:null,matcher:r.matcher,callback:this.bind(function(e){var t;if(i==this.queryCount)if(this.opened())if(e.hasError!==w&&$(r.formatAjaxError,"formatAjaxError"))h("<li class='select2-ajax-error'>"+O(r.formatAjaxError,r.element,e.jqXHR,e.textStatus,e.errorThrown)+"</li>");else{if(this.context=e.context===w?null:e.context,this.opts.createSearchChoice&&""!==a.val()&&(t=this.opts.createSearchChoice.call(s,a.val(),e.results))!==w&&null!==t&&s.id(t)!==w&&null!==s.id(t)&&0===k(e.results).filter(function(){return p(s.id(this),s.id(t))}).length&&this.opts.createSearchChoicePosition(e.results,t),0===e.results.length&&$(r.formatNoMatches,"formatNoMatches"))return h("<li class='select2-no-results'>"+O(r.formatNoMatches,r.element,a.val())+"</li>"),void(this.showSearch&&this.showSearch(a.val()));o.empty(),s.opts.populateResults.call(this,o,e.results,{term:a.val(),page:this.resultsPage,context:null}),!0===e.more&&$(r.formatLoadMore,"formatLoadMore")&&(o.append("<li class='select2-more-results'>"+r.escapeMarkup(O(r.formatLoadMore,r.element,this.resultsPage))+"</li>"),window.setTimeout(function(){s.loadMoreIfNeeded()},10)),this.postprocessResults(e,n),u(),this.opts.element.trigger({type:"select2-loaded",items:e})}else this.search.removeClass("select2-active")})})));h("<li class='select2-selection-limit'>"+O(r.formatSelectionTooBig,r.element,d)+"</li>")}function u(){a.removeClass("select2-active"),s.positionDropdown(),o.find(".select2-no-results,.select2-selection-limit,.select2-searching").length?s.liveRegion.text(o.text()):s.liveRegion.text(s.opts.formatMatches(o.find('.select2-result-selectable:not(".select2-selected")').length))}function h(e){o.html(e),u()}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){!function(i){i[0]!==document.activeElement&&window.setTimeout(function(){var e,t=i[0],n=i.val().length;i.focus(),(0<t.offsetWidth||0<t.offsetHeight)&&t===document.activeElement&&(t.setSelectionRange?t.setSelectionRange(n,n):t.createTextRange&&((e=t.createTextRange()).collapse(!1),e.select()))},0)}(this.search)},selectHighlighted:function(e){if(this._touchMoved)this.clearTouchMoved();else{var t=this.highlight(),n=this.results.find(".select2-highlighted").closest(".select2-result").data("select2-data");n?(this.highlight(t),this.onSelect(n,e)):e&&e.noFocus&&this.close()}},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==w?e.text():w)},getPlaceholderOption:function(){if(this.select){var e=this.select.children("option").first();if(this.opts.placeholderOption!==w)return"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===k.trim(e.text())&&""===e.val())return e}},initContainerWidth:function(){var e=function(){var e,t,n,i,a;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"!==this.opts.width&&"resolve"!==this.opts.width)return k.isFunction(this.opts.width)?this.opts.width():this.opts.width;if("string"==typeof(e=this.opts.element.attr("style")))for(i=0,a=(t=e.split(";")).length;i<a;i+=1)if(null!==(n=t[i].replace(/\s/g,"").match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i))&&1<=n.length)return n[1];return"resolve"===this.opts.width?0<(e=this.opts.element.css("width")).indexOf("%")?e:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px":null}.call(this);null!==e&&this.container.css("width",e)}}),{createContainer:function(){return k(document.createElement("div")).attr({class:"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""))},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var e,t,n;0<=this.opts.minimumResultsForSearch&&this.showSearch(!0),this.parent.opening.apply(this,arguments),!1!==this.showSearchInput&&this.search.val(this.focusser.val()),this.opts.shouldFocusInput(this)&&(this.search.focus(),(e=this.search.get(0)).createTextRange?((t=e.createTextRange()).collapse(!1),t.select()):e.setSelectionRange&&(n=this.search.val().length,e.setSelectionRange(n,n))),this.prefillNextSearchTerm(),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(k.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){k("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),A.call(this,"selection","focusser")},initContainer:function(){var t,e,n=this.container,i=this.dropdown,a=x();this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=t=n.find(".select2-choice"),this.focusser=n.find(".select2-focusser"),t.find(".select2-chosen").attr("id","select2-chosen-"+a),this.focusser.attr("aria-labelledby","select2-chosen-"+a),this.results.attr("id","select2-results-"+a),this.search.attr("aria-owns","select2-results-"+a),this.focusser.attr("id","s2id_autogen"+a),e=k("label[for='"+this.opts.element.attr("id")+"']"),this.opts.element.on("focus.select2",this.bind(function(){this.focus()})),this.focusser.prev().text(e.text()).attr("for",this.focusser.attr("id"));var o=this.opts.element.attr("title");this.opts.element.attr("title",o||e.text()),this.focusser.attr("tabindex",this.elementTabIndex),this.search.attr("id",this.focusser.attr("id")+"_search"),this.search.prev().text(k("label[for='"+this.focusser.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&229!=e.keyCode)if(e.which!==s.PAGE_UP&&e.which!==s.PAGE_DOWN)switch(e.which){case s.UP:case s.DOWN:return this.moveHighlight(e.which===s.UP?-1:1),void v(e);case s.ENTER:return this.selectHighlighted(),void v(e);case s.TAB:return void this.selectHighlighted({noFocus:!0});case s.ESC:return this.cancel(e),void v(e)}else v(e)})),this.search.on("blur",this.bind(function(e){document.activeElement===this.body.get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.results&&1<this.results.length&&this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==s.TAB&&!s.isControl(e)&&!s.isFunctionKey(e)&&e.which!==s.ESC){if(!1!==this.opts.openOnEnter||e.which!==s.ENTER){if(e.which==s.DOWN||e.which==s.UP||e.which==s.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void v(e)}return e.which==s.DELETE||e.which==s.BACKSPACE?(this.opts.allowClear&&this.clear(),void v(e)):void 0}v(e)}})),m(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){if(0<=this.opts.minimumResultsForSearch){if(e.stopPropagation(),this.opened())return;this.open()}})),t.on("mousedown touchstart","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),function(e){e.preventDefault(),e.stopImmediatePropagation()}(e),this.close(),this.selection&&this.selection.focus())})),t.on("mousedown touchstart",this.bind(function(e){c(t),this.container.hasClass("select2-container-active")||this.opts.element.trigger(k.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),v(e)})),i.on("mousedown touchstart",this.bind(function(){this.opts.shouldFocusInput(this)&&this.search.focus()})),t.on("focus",this.bind(function(e){v(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(k.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(k.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(k.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.hide(),this.setPlaceholder()},clear:function(e){var t=this.selection.data("select2-data");if(t){var n=k.Event("select2-clearing");if(this.opts.element.trigger(n),n.isDefaultPrevented())return;var i=this.getPlaceholderOption();this.opts.element.val(i?i.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),!1!==e&&(this.opts.element.trigger({type:"select2-removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var t=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==w&&null!==e&&(t.updateSelection(e),t.close(),t.setPlaceholder(),t.lastSearchTerm=t.search.val())})}},isPlaceholderOptionSelected:function(){var e;return this.getPlaceholder()!==w&&((e=this.getPlaceholderOption())!==w&&e.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===w||null===this.opts.element.val())},prepareOpts:function(){var r=this.parent.prepareOpts.apply(this,arguments),i=this;return"select"===r.element.get(0).tagName.toLowerCase()?r.initSelection=function(e,t){var n=e.find("option").filter(function(){return this.selected&&!this.disabled});t(i.optionToData(n))}:"data"in r&&(r.initSelection=r.initSelection||function(e,t){var a=e.val(),o=null;r.query({matcher:function(e,t,n){var i=p(a,r.id(n));return i&&(o=n),i},callback:k.isFunction(t)?function(){t(o)}:k.noop})}),r},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===w?w:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&e!==w){if(this.select&&this.getPlaceholderOption()===w)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,n){var i=0,a=this;if(this.findHighlightableChoices().each2(function(e,t){if(p(a.id(t.data("select2-data")),a.opts.element.val()))return i=e,!1}),!1!==n&&(!0===t&&0<=i?this.highlight(i):this.highlight(0)),!0===t){var o=this.opts.minimumResultsForSearch;0<=o&&this.showSearch(function n(e){var i=0;return k.each(e,function(e,t){t.children?i+=n(t.children):i++}),i}(e.results)>=o)}},showSearch:function(e){this.showSearchInput!==e&&(this.showSearchInput=e,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!e),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!e),k(this.dropdown,this.container).toggleClass("select2-with-searchbox",e))},onSelect:function(e,t){if(this.triggerSelect(e)){var n=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.lastSearchTerm=this.search.val(),this.close(),t&&t.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),p(n,this.id(e))||this.triggerChange({added:e,removed:i})}},updateSelection:function(e){var t,n,i=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),i.empty(),null!==e&&(t=this.opts.formatSelection(e,i,this.opts.escapeMarkup)),t!==w&&i.append(t),(n=this.opts.formatSelectionCssClass(e,i))!==w&&i.addClass(n),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==w&&this.container.addClass("select2-allowclear")},val:function(){var e,t=!1,n=null,i=this,a=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],1<arguments.length&&(t=arguments[1],this.opts.debug&&console&&console.warn&&console.warn('Select2: The second option to `select2("val")` is not supported in Select2 4.0.0. The `change` event will always be triggered in 4.0.0.')),this.select)this.opts.debug&&console&&console.warn&&console.warn('Select2: Setting the value on a <select> using `select2("val")` is no longer supported in 4.0.0. You can use the `.val(newValue).trigger("change")` method provided by jQuery instead.'),this.select.val(e).find("option").filter(function(){return this.selected}).each2(function(e,t){return n=i.optionToData(t),!1}),this.updateSelection(n),this.setPlaceholder(),t&&this.triggerChange({added:n,removed:a});else{if(!e&&0!==e)return void this.clear(t);if(this.opts.initSelection===w)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){i.opts.element.val(e?i.id(e):""),i.updateSelection(e),i.setPlaceholder(),t&&i.triggerChange({added:e,removed:a})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e){var t,n=!1;if(0===arguments.length)return(t=this.selection.data("select2-data"))==w&&(t=null),t;this.opts.debug&&console&&console.warn&&console.warn('Select2: The `select2("data")` method can no longer set selected values in 4.0.0, consider using the `.val()` method instead.'),1<arguments.length&&(n=arguments[1]),e?(t=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),n&&this.triggerChange({added:e,removed:t})):this.clear(n)}}),n=I(e,{createContainer:function(){return k(document.createElement("div")).attr({class:"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var l=this.parent.prepareOpts.apply(this,arguments),i=this;return"select"===l.element.get(0).tagName.toLowerCase()?l.initSelection=function(e,t){var n=[];e.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(e,t){n.push(i.optionToData(t))}),t(n)}:"data"in l&&(l.initSelection=l.initSelection||function(e,o){var r=h(e.val(),l.separator,l.transformVal),s=[];l.query({matcher:function(e,t,n){var i=k.grep(r,function(e){return p(e,l.id(n))}).length;return i&&s.push(n),i},callback:k.isFunction(o)?function(){for(var e=[],t=0;t<r.length;t++)for(var n=r[t],i=0;i<s.length;i++){var a=s[i];if(p(n,l.id(a))){e.push(a),s.splice(i,1);break}}o(e)}:k.noop})}),l},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},destroy:function(){k("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),A.call(this,"searchContainer","selection")},initContainer:function(){var r,e=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=r=this.container.find(e);var t=this;this.selection.on("click",".select2-container:not(.select2-container-disabled) .select2-search-choice:not(.select2-locked)",function(e){t.search[0].focus(),t.selectChoice(k(this))}),this.search.attr("id","s2id_autogen"+x()),this.search.prev().text(k("label[for='"+this.opts.element.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.opts.element.on("focus.select2",this.bind(function(){this.focus()})),this.search.on("input paste",this.bind(function(){this.search.attr("placeholder")&&0==this.search.val().length||this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var t=r.find(".select2-search-choice-focus"),n=t.prev(".select2-search-choice:not(.select2-locked)"),i=t.next(".select2-search-choice:not(.select2-locked)"),a=function(e){var t=0,n=0;if("selectionStart"in(e=k(e)[0]))t=e.selectionStart,n=e.selectionEnd-t;else if("selection"in document){e.focus();var i=document.selection.createRange();n=document.selection.createRange().text.length,i.moveStart("character",-e.value.length),t=i.text.length-n}return{offset:t,length:n}}(this.search);if(t.length&&(e.which==s.LEFT||e.which==s.RIGHT||e.which==s.BACKSPACE||e.which==s.DELETE||e.which==s.ENTER)){var o=t;return e.which==s.LEFT&&n.length?o=n:e.which==s.RIGHT?o=i.length?i:null:e.which===s.BACKSPACE?this.unselect(t.first())&&(this.search.width(10),o=n.length?n:i):e.which==s.DELETE?this.unselect(t.first())&&(this.search.width(10),o=i.length?i:null):e.which==s.ENTER&&(o=null),this.selectChoice(o),v(e),void(o&&o.length||this.open())}if((e.which===s.BACKSPACE&&1==this.keydowns||e.which==s.LEFT)&&0==a.offset&&!a.length)return this.selectChoice(r.find(".select2-search-choice:not(.select2-locked)").last()),void v(e);if(this.selectChoice(null),this.opened())switch(e.which){case s.UP:case s.DOWN:return this.moveHighlight(e.which===s.UP?-1:1),void v(e);case s.ENTER:return this.selectHighlighted(),void v(e);case s.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case s.ESC:return this.cancel(e),void v(e)}if(e.which!==s.TAB&&!s.isControl(e)&&!s.isFunctionKey(e)&&e.which!==s.BACKSPACE&&e.which!==s.ESC){if(e.which===s.ENTER){if(!1===this.opts.openOnEnter)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),e.which!==s.PAGE_UP&&e.which!==s.PAGE_DOWN||v(e),e.which===s.ENTER&&v(e)}}})),this.search.on("keyup",this.bind(function(e){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),e.stopImmediatePropagation(),this.opts.element.trigger(k.Event("select2-blur"))})),this.container.on("click",e,this.bind(function(e){this.isInterfaceEnabled()&&(0<k(e.target).closest(".select2-search-choice").length||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(k.Event("select2-focus")),this.open(),this.focusSearch(),e.preventDefault()))})),this.container.on("focus",e,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(k.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.hide(),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var t=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==w&&null!==e&&(t.updateSelection(e),t.close(),t.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder(),t=this.getMaxSearchWidth();e!==w&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(e).addClass("select2-default"),this.search.width(0<t?t:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.prefillNextSearchTerm(),this.updateResults(!0),this.opts.shouldFocusInput(this)&&this.search.focus(),this.opts.element.trigger(k.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(e){var t={},n=[],i=this;k(e).each(function(){i.id(this)in t||(t[i.id(this)]=0,n.push(this))}),this.selection.find(".select2-search-choice").remove(),this.addSelectedChoice(n),i.postprocessResults()},tokenize:function(){var e=this.search.val();null!=(e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts))&&e!=w&&(this.search.val(e),0<e.length&&this.open())},onSelect:function(e,t){this.triggerSelect(e)&&""!==e.text&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),this.lastSearchTerm=this.search.val(),this.clearSearch(),this.updateResults(),!this.select&&this.opts.closeOnSelect||this.postprocessResults(e,!1,!0===this.opts.closeOnSelect),this.opts.closeOnSelect?(this.close(),this.search.width(10)):0<this.countSelectableResults()?(this.search.width(10),this.resizeSearch(),0<this.getMaximumSelectionSize()&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.prefillNextSearchTerm()&&this.updateResults(),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),t&&t.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(e){var t=this.getVal(),n=this;k(e).each(function(){t.push(n.createChoice(this))}),this.setVal(t)},createChoice:function(e){var t,n,i=!e.locked,a=k("<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>"),o=k("<li class='select2-search-choice select2-locked'><div></div></li>"),r=i?a:o,s=this.id(e);return(t=this.opts.formatSelection(e,r.find("div"),this.opts.escapeMarkup))!=w&&r.find("div").replaceWith(k("<div></div>").html(t)),(n=this.opts.formatSelectionCssClass(e,r.find("div")))!=w&&r.addClass(n),i&&r.find(".select2-search-choice-close").on("mousedown",v).on("click dblclick",this.bind(function(e){this.isInterfaceEnabled()&&(this.unselect(k(e.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),v(e),this.close(),this.focusSearch())})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),r.data("select2-data",e),r.insertBefore(this.searchContainer),s},unselect:function(e){var t,n,i=this.getVal();if(0===(e=e.closest(".select2-search-choice")).length)throw"Invalid argument: "+e+". Must be .select2-search-choice";if(t=e.data("select2-data")){var a=k.Event("select2-removing");if(a.val=this.id(t),a.choice=t,this.opts.element.trigger(a),a.isDefaultPrevented())return!1;for(;0<=(n=u(this.id(t),i));)i.splice(n,1),this.setVal(i),this.select&&this.postprocessResults();return e.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}),!0}},postprocessResults:function(e,t,n){var i=this.getVal(),a=this.results.find(".select2-result"),o=this.results.find(".select2-result-with-children"),r=this;a.each2(function(e,t){0<=u(r.id(t.data("select2-data")),i)&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),o.each2(function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")}),-1==this.highlight()&&!1!==n&&!0===this.opts.closeOnSelect&&r.highlight(0),!this.opts.createSearchChoice&&0<!a.filter(".select2-result:not(.select2-selected)").length&&(!e||e&&!e.more&&0===this.results.find(".select2-no-results").length)&&$(r.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+O(r.opts.formatNoMatches,r.opts.element,r.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-f(this.search)},resizeSearch:function(){var e,t,n,i,a=f(this.search);e=function(e){if(!o){var t=e[0].currentStyle||window.getComputedStyle(e[0],null);(o=k(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,letterSpacing:t.letterSpacing,textTransform:t.textTransform,whiteSpace:"nowrap"})).attr("class","select2-sizer"),k(document.body).append(o)}return o.text(e.val()),o.width()}(this.search)+10,t=this.search.offset().left,(i=(n=this.selection.width())-(t-this.selection.offset().left)-a)<e&&(i=n-a),i<40&&(i=n-a),i<=0&&(i=e),this.search.width(Math.floor(i))},getVal:function(){var e;return this.select?null===(e=this.select.val())?[]:e:h(e=this.opts.element.val(),this.opts.separator,this.opts.transformVal)},setVal:function(e){if(this.select)this.select.val(e);else{var t=[],n={};k(e).each(function(){this in n||(t.push(this),n[this]=0)}),this.opts.element.val(0===t.length?"":t.join(this.opts.separator))}},buildChangeDetails:function(e,t){t=t.slice(0),e=e.slice(0);for(var n=0;n<t.length;n++)for(var i=0;i<e.length;i++)if(p(this.opts.id(t[n]),this.opts.id(e[i]))){t.splice(n,1),n--,e.splice(i,1);break}return{added:t,removed:e}},val:function(e,n){var i,a=this;if(0===arguments.length)return this.getVal();if((i=this.data()).length||(i=[]),!e&&0!==e)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(n&&this.triggerChange({added:this.data(),removed:i}));if(this.setVal(e),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),n&&this.triggerChange(this.buildChangeDetails(i,this.data()));else{if(this.opts.initSelection===w)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(e){var t=k.map(e,a.id);a.setVal(t),a.updateSelection(e),a.clearSearch(),n&&a.triggerChange(a.buildChangeDetails(i,a.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var e=[],t=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){e.push(t.opts.id(k(this).data("select2-data")))}),this.setVal(e),this.triggerChange()},data:function(e,t){var n,i,a=this;if(0===arguments.length)return this.selection.children(".select2-search-choice").map(function(){return k(this).data("select2-data")}).get();i=this.data(),e=e||[],n=k.map(e,function(e){return a.opts.id(e)}),this.setVal(n),this.updateSelection(e),this.clearSearch(),t&&this.triggerChange(this.buildChangeDetails(i,this.data()))}}),k.fn.select2=function(){var e,t,n,i,a,o=Array.prototype.slice.call(arguments,0),r=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],s=["opened","isFocused","container","dropdown"],l=["val","data"],c={search:"externalSearch"};return this.each(function(){if(0===o.length||"object"==typeof o[0])(e=0===o.length?{}:k.extend({},o[0])).element=k(this),"select"===e.element.get(0).tagName.toLowerCase()?a=e.element.prop("multiple"):(a=e.multiple||!1,"tags"in e&&(e.multiple=a=!0)),(t=a?new window.Select2.class.multi:new window.Select2.class.single).init(e);else{if("string"!=typeof o[0])throw"Invalid arguments to select2 plugin: "+o;if(u(o[0],r)<0)throw"Unknown method: "+o[0];if(i=w,(t=k(this).data("select2"))===w)return;if(n=o[0],i="container"===n?t.container:"dropdown"===n?t.dropdown:(c[n]&&(n=c[n]),t[n].apply(t,o.slice(1))),0<=u(o[0],s)||0<=u(o[0],l)&&1==o.length)return!1}}),i===w?this:i},k.fn.select2.defaults={debug:!1,width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n,i){var a=[];return b(this.text(e),n.term,a,i),a.join("")},transformVal:function(e){return k.trim(e)},formatSelection:function(e,t,n){return e?n(this.text(e)):w},sortResults:function(e,t,n){return e},formatResultCssClass:function(e){return e.css},formatSelectionCssClass:function(e,t){return w},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==w?null:e.id},text:function(e){return e&&this.data&&this.data.text?k.isFunction(this.data.text)?this.data.text(e):e[this.data.text]:e.text},matcher:function(e,t){return 0<=d(""+t).toUpperCase().indexOf(d(""+e).toUpperCase())},separator:",",tokenSeparators:[],tokenizer:function(e,t,n,i){var a,o,r,s,l,c=e,d=!1;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return w;for(;;){for(o=-1,r=0,s=i.tokenSeparators.length;r<s&&(l=i.tokenSeparators[r],!(0<=(o=e.indexOf(l))));r++);if(o<0)break;if(a=e.substring(0,o),e=e.substring(o+l.length),0<a.length&&(a=i.createSearchChoice.call(this,a,t))!==w&&null!==a&&i.id(a)!==w&&null!==i.id(a)){for(d=!1,r=0,s=t.length;r<s;r++)if(p(i.id(a),i.id(t[r]))){d=!0;break}d||n(a)}}return c!==e?e:void 0},escapeMarkup:S,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(e){return null},nextSearchTerm:function(e,t){return w},searchInputPlaceholder:"",createSearchChoicePosition:"top",shouldFocusInput:function(e){return!("ontouchstart"in window||0<navigator.msMaxTouchPoints)||!(e.opts.minimumResultsForSearch<0)}},k.fn.select2.locales=[],k.fn.select2.locales.en={formatMatches:function(e){return 1===e?"One result is available, press enter to select it.":e+" results are available, use up and down arrow keys to navigate."},formatNoMatches:function(){return"No matches found"},formatAjaxError:function(e,t,n){return"Loading failed"},formatInputTooShort:function(e,t){var n=t-e.length;return"Please enter "+n+" or more character"+(1==n?"":"s")},formatInputTooLong:function(e,t){var n=e.length-t;return"Please delete "+n+" character"+(1==n?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(e){return"Loading more results"},formatSearching:function(){return"Searching"}},k.extend(k.fn.select2.defaults,k.fn.select2.locales.en),k.fn.select2.ajaxDefaults={transport:k.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:C,local:E,tags:D},util:{debounce:g,markMatch:b,escapeMarkup:S,stripDiacritics:d},class:{abstract:e,single:t,multi:n}}}function c(e){var t=k(document.createTextNode(""));e.before(t),t.before(e),t.remove()}function d(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return l[e]||e})}function u(e,t){for(var n=0,i=t.length;n<i;n+=1)if(p(e,t[n]))return n;return-1}function p(e,t){return e===t||e!==w&&t!==w&&(null!==e&&null!==t&&(e.constructor===String?e+""==t+"":t.constructor===String&&t+""==e+""))}function h(e,t,n){var i,a,o;if(null===e||e.length<1)return[];for(a=0,o=(i=e.split(t)).length;a<o;a+=1)i[a]=n(i[a]);return i}function f(e){return e.outerWidth(!1)-e.width()}function m(t){var n="keyup-change-value";t.on("keydown",function(){k.data(t,n)===w&&k.data(t,n,t.val())}),t.on("keyup",function(){var e=k.data(t,n);e!==w&&t.val()!==e&&(k.removeData(t,n),t.trigger("keyup-change"))})}function g(t,n,i){var a;return i=i||w,function(){var e=arguments;window.clearTimeout(a),a=window.setTimeout(function(){n.apply(i,e)},t)}}function v(e){e.preventDefault(),e.stopPropagation()}function y(e,t,n){var i,a,o=[];(i=k.trim(e.attr("class")))&&k((i=""+i).split(/\s+/)).each2(function(){0===this.indexOf("select2-")&&o.push(this)}),(i=k.trim(t.attr("class")))&&k((i=""+i).split(/\s+/)).each2(function(){0!==this.indexOf("select2-")&&(a=n(this))&&o.push(a)}),e.attr("class",o.join(" "))}function b(e,t,n,i){var a=d(e.toUpperCase()).indexOf(d(t.toUpperCase())),o=t.length;a<0?n.push(i(e)):(n.push(i(e.substring(0,a))),n.push("<span class='select2-match'>"),n.push(i(e.substring(a,a+o))),n.push("</span>"),n.push(i(e.substring(a+o,e.length))))}function S(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})}function C(r){var e,s=null,t=r.quietMillis||100,l=r.url,c=this;return function(o){window.clearTimeout(e),e=window.setTimeout(function(){var e=r.data,t=l,n=r.transport||k.fn.select2.ajaxDefaults.transport,i={type:r.type||"GET",cache:r.cache||!1,jsonpCallback:r.jsonpCallback||w,dataType:r.dataType||"json"},a=k.extend({},k.fn.select2.ajaxDefaults.params,i);e=e?e.call(c,o.term,o.page,o.context):null,t="function"==typeof t?t.call(c,o.term,o.page,o.context):t,s&&"function"==typeof s.abort&&s.abort(),r.params&&(k.isFunction(r.params)?k.extend(a,r.params.call(c)):k.extend(a,r.params)),k.extend(a,{url:t,dataType:r.dataType,data:e,success:function(e){var t=r.results(e,o.page,o);o.callback(t)},error:function(e,t,n){var i={hasError:!0,jqXHR:e,textStatus:t,errorThrown:n};o.callback(i)}}),s=n.call(c,a)},t)}}function E(e){var t,n,i=e,s=function(e){return""+e.text};k.isArray(i)&&(i={results:n=i}),!1===k.isFunction(i)&&(n=i,i=function(){return n});var a=i();return a.text&&(s=a.text,k.isFunction(s)||(t=a.text,s=function(e){return e[t]})),function(a){var o,r=a.term,n={results:[]};""!==r?(o=function(e,t){var n,i;if((e=e[0]).children){for(i in n={},e)e.hasOwnProperty(i)&&(n[i]=e[i]);n.children=[],k(e.children).each2(function(e,t){o(t,n.children)}),(n.children.length||a.matcher(r,s(n),e))&&t.push(n)}else a.matcher(r,s(e),e)&&t.push(e)},k(i().results).each2(function(e,t){o(t,n.results)}),a.callback(n)):a.callback(i())}}function D(t){var o=k.isFunction(t);return function(n){var i=n.term,a={results:[]},e=o?t(n):t;k.isArray(e)&&(k(e).each(function(){var e=this.text!==w,t=e?this.text:this;""!==i&&!n.matcher(i,t)||a.results.push(e?this:{id:this,text:this})}),n.callback(a))}}function $(e,t){if(k.isFunction(e))return!0;if(!e)return!1;if("string"==typeof e)return!0;throw new Error(t+" must be a string, function, or falsy value")}function O(e,t){if(k.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return e.apply(t,n)}return e}function A(){var n=this;k.each(arguments,function(e,t){n[t].remove(),n[t]=null})}function I(e,t){function n(){}return((n.prototype=new e).constructor=n).prototype.parent=e.prototype,n.prototype=k.extend(n.prototype,t),n}}(jQuery)}.apply(e,arguments)})}(this),function(e){define("jquery.event.drag",["jquery"],function(){return function(){!function(h){h.fn.drag=function(e,t,n){var i="string"==typeof e?e:"",a=h.isFunction(e)?e:h.isFunction(t)?t:null;return 0!==i.indexOf("drag")&&(i="drag"+i),n=(e==a?t:n)||{},a?this.bind(i,n,a):this.trigger(i)};var p=h.event,i=p.special,f=i.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var n=h.data(this,f.datakey),i=e.data||{};n.related+=1,h.each(f.defaults,function(e,t){void 0!==i[e]&&(n[e]=i[e])})},remove:function(){h.data(this,f.datakey).related-=1},setup:function(){if(!h.data(this,f.datakey)){var e=h.extend({related:0},f.defaults);h.data(this,f.datakey,e),p.add(this,"touchstart mousedown",f.init,e),this.attachEvent&&this.attachEvent("ondragstart",f.dontstart)}},teardown:function(){(h.data(this,f.datakey)||{}).related||(h.removeData(this,f.datakey),p.remove(this,"touchstart mousedown",f.init),f.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",f.dontstart))},init:function(e){if(!f.touched){var t,n=e.data;if(!(0!=e.which&&0<n.which&&e.which!=n.which)&&!h(e.target).is(n.not)&&(!n.handle||h(e.target).closest(n.handle,e.currentTarget).length)&&(f.touched="touchstart"==e.type?this:null,n.propagates=1,n.mousedown=this,n.interactions=[f.interaction(this,n)],n.target=e.target,n.pageX=e.pageX,n.pageY=e.pageY,n.dragging=null,t=f.hijack(e,"draginit",n),n.propagates))return(t=f.flatten(t))&&t.length&&(n.interactions=[],h.each(t,function(){n.interactions.push(f.interaction(this,n))})),n.propagates=n.interactions.length,!1!==n.drop&&i.drop&&i.drop.handler(e,n),f.textselect(!1),f.touched?p.add(f.touched,"touchmove touchend",f.handler,n):p.add(document,"mousemove mouseup",f.handler,n),!(!f.touched||n.live)&&void 0}},interaction:function(e,t){var n=h(e)[t.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new f.callback,droppable:[],offset:n}},handler:function(e){var t=e.data;switch(e.type){case!t.dragging&&"touchmove":e.preventDefault();case!t.dragging&&"mousemove":if(Math.pow(e.pageX-t.pageX,2)+Math.pow(e.pageY-t.pageY,2)<Math.pow(t.distance,2))break;e.target=t.target,f.hijack(e,"dragstart",t),t.propagates&&(t.dragging=!0);case"touchmove":e.preventDefault();case"mousemove":if(t.dragging){if(f.hijack(e,"drag",t),t.propagates){!1!==t.drop&&i.drop&&i.drop.handler(e,t);break}e.type="mouseup"}case"touchend":case"mouseup":default:f.touched?p.remove(f.touched,"touchmove touchend",f.handler):p.remove(document,"mousemove mouseup",f.handler),t.dragging&&(!1!==t.drop&&i.drop&&i.drop.handler(e,t),f.hijack(e,"dragend",t)),f.textselect(!0),!1===t.click&&t.dragging&&h.data(t.mousedown,"suppress.click",(new Date).getTime()+5),t.dragging=f.touched=!1}},hijack:function(n,i,a,e,t){if(a){var o,r,s,l={event:n.originalEvent,type:n.type},c=i.indexOf("drop")?"drag":"drop",d=e||0,u=isNaN(e)?a.interactions.length:e;n.type=i,n.originalEvent=null,a.results=[];do{if(r=a.interactions[d]){if("dragend"!==i&&r.cancelled)continue;s=f.properties(n,a,r),r.results=[],h(t||r[c]||a.droppable).each(function(e,t){if(s.target=t,!(n.isPropagationStopped=function(){return!1})===(o=t?p.dispatch.call(t,n,s):null)?("drag"==c&&(r.cancelled=!0,a.propagates-=1),"drop"==i&&(r[c][e]=null)):"dropinit"==i&&r.droppable.push(f.element(o)||t),"dragstart"==i&&(r.proxy=h(f.element(o)||r.drag)[0]),r.results.push(o),delete n.result,"dropinit"!==i)return o}),a.results[d]=f.flatten(r.results),"dropinit"==i&&(r.droppable=f.flatten(r.droppable)),"dragstart"!=i||r.cancelled||s.update()}}while(++d<u);return n.type=l.type,n.originalEvent=l.event,f.flatten(a.results)}},properties:function(e,t,n){var i=n.callback;return i.drag=n.drag,i.proxy=n.proxy||n.drag,i.startX=t.pageX,i.startY=t.pageY,i.deltaX=e.pageX-t.pageX,i.deltaY=e.pageY-t.pageY,i.originalX=n.offset.left,i.originalY=n.offset.top,i.offsetX=i.originalX+i.deltaX,i.offsetY=i.originalY+i.deltaY,i.drop=f.flatten((n.drop||[]).slice()),i.available=f.flatten((n.droppable||[]).slice()),i},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(e){return h.map(e,function(e){return e&&e.jquery?h.makeArray(e):e&&e.length?f.flatten(e):e})},textselect:function(e){h(document)[e?"unbind":"bind"]("selectstart",f.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}};f.callback.prototype={update:function(){i.drop&&this.available.length&&h.each(this.available,function(e){i.drop.locate(this,e)})}};var t=p.dispatch;p.dispatch=function(e){if(!(0<h.data(this,"suppress."+e.type)-(new Date).getTime()))return t.apply(this,arguments);h.removeData(this,"suppress."+e.type)};var a=p.fixHooks.touchstart=p.fixHooks.touchmove=p.fixHooks.touchend=p.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(n,e){if(e){var i=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0]||null;i&&h.each(a.props,function(e,t){n[t]=i[t]})}return n}}}(jQuery)}.apply(e,arguments)})}(this),function(e){define("jquery.event.drop",["jquery"],function(){return function(){return function(p){p.fn.drop=function(e,t,n){var i="string"==typeof e?e:"",a=p.isFunction(e)?e:p.isFunction(t)?t:null;return 0!==i.indexOf("drop")&&(i="drop"+i),n=(e==a?t:n)||{},a?this.bind(i,n,a):this.trigger(i)},p.drop=function(e){e=e||{},m.multi=!0===e.multi?1/0:!1===e.multi?1:isNaN(e.multi)?m.multi:e.multi,m.delay=e.delay||m.delay,m.tolerance=p.isFunction(e.tolerance)?e.tolerance:null===e.tolerance?null:m.tolerance,m.mode=e.mode||m.mode||"intersect"};var f=p.event.special,m=p.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(e){p.data(this,m.datakey).related+=1},remove:function(){p.data(this,m.datakey).related-=1},setup:function(){if(!p.data(this,m.datakey)){p.data(this,m.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}}),m.targets.push(this)}},teardown:function(){if(!(p.data(this,m.datakey)||{}).related){p.removeData(this,m.datakey);var t=this;m.targets=p.grep(m.targets,function(e){return e!==t})}},handler:function(e,t){var n;if(t)switch(e.type){case"mousedown":case"touchstart":n=p(m.targets),"string"==typeof t.drop&&(n=n.filter(t.drop)),n.each(function(){var e=p.data(this,m.datakey);e.active=[],e.anyactive=0,e.winner=0}),t.droppable=n,f.drag.hijack(e,"dropinit",t);break;case"mousemove":case"touchmove":m.event=e,m.timer||m.tolerate(t);break;case"mouseup":case"touchend":m.timer=clearTimeout(m.timer),t.propagates&&(f.drag.hijack(e,"drop",t),f.drag.hijack(e,"dropend",t))}},locate:function(e,t){var n=p.data(e,m.datakey),i=p(e),a=i.offset()||{},o=i.outerHeight(),r=i.outerWidth(),s={elem:e,width:r,height:o,top:a.top,left:a.left,right:a.left+r,bottom:a.top+o};return n&&(n.location=s,n.index=t,n.elem=e),s},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,n){return this.contains(n,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,n){return Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top))*Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))},fit:function(e,t,n){return this.contains(n,t)?1:0},middle:function(e,t,n){return this.contains(n,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(e){var t,n,i,a,o,r,s,l,c=0,d=e.interactions.length,u=[m.event.pageX,m.event.pageY],h=m.tolerance||m.modes[m.mode];do{if(l=e.interactions[c]){if(!l)return;l.drop=[],o=[],r=l.droppable.length,h&&(i=m.locate(l.proxy)),t=0;do{if(s=l.droppable[t]){if(!(n=(a=p.data(s,m.datakey)).location))continue;a.winner=h?h.call(m,m.event,i,n):m.contains(n,u)?1:0,o.push(a)}}while(++t<r);for(o.sort(m.sort),t=0;(a=o[t])&&(a.winner&&l.drop.length<m.multi?(a.active[c]||a.anyactive||(!1!==f.drag.hijack(m.event,"dropstart",e,c,a.elem)[0]?(a.active[c]=1,a.anyactive+=1):a.winner=0),a.winner&&l.drop.push(a.elem)):a.active[c]&&1==a.anyactive&&(f.drag.hijack(m.event,"dropend",e,c,a.elem),a.active[c]=0,a.anyactive-=1)),++t<r;);}}while(++c<d);m.last&&u[0]==m.last.pageX&&u[1]==m.last.pageY?delete m.timer:m.timer=setTimeout(function(){m.tolerate(e)},m.delay),m.last=m.event}};f.dropinit=f.dropstart=f.dropend=m}(jQuery),$.drop}.apply(e,arguments)})}(this),define("mockup-patterns-select2",["jquery","pat-base","mockup-utils","select2","jquery.event.drag","jquery.event.drop"],function(s,e,l){"use strict";return e.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:","},initializeValues:function(){var o=this;o.options.initialValues&&(o.options.id=function(e){return e.id},o.options.initSelection=function(e,t){var n=[],i=e.val(),a=o.options.initialValues;"string"==typeof o.options.initialValues&&""!==o.options.initialValues&&("{"===o.options.initialValues[0]?a=JSON.parse(o.options.initialValues):(a={},s(o.options.initialValues.split(o.options.separator)).each(function(){var e=this.split(":"),t=s.trim(e[0]),n=s.trim(e[1]);a[t]=n}))),s(i.split(o.options.separator)).each(function(){var e=this;a[this]&&(e=a[this]),n.push({id:l.removeHTML(this),text:l.removeHTML(e)})}),t(n)})},initializeTags:function(){var e=this;e.options.tags&&"string"==typeof e.options.tags&&("["===e.options.tags.substr(0,1)?e.options.tags=JSON.parse(e.options.tags):e.options.tags=e.options.tags.split(e.options.separator)),e.options.tags&&!e.options.allowNewItems&&(e.options.data=s.map(e.options.tags,function(e,t){return{id:e,text:e}}),e.options.multiple=!0,delete e.options.tags)},initializeOrdering:function(){var n=this;if(n.options.orderable){var i=function(e,t){return e?e.text:void 0};n.options.formatSelection&&(i=n.options.formatSelection),n.options.formatSelection=function(e,t){return t.parents("li").drag("start",function(e,t){return s(this).addClass("select2-choice-dragging"),n.$el.select2("onSortStart"),s.drop({tolerance:function(e,t,n){var i=e.pageY>n.top+n.height/2;return s.data(n.elem,"drop+reorder",i?"insertAfter":"insertBefore"),this.contains(n,[e.pageX,e.pageY])}}),s(this).clone().addClass("dragging").css({opacity:.75,position:"absolute"}).appendTo(document.body)}).drag(function(e,t){s(t.proxy).css({top:t.offsetY,left:t.offsetX});var n=t.drop[0],i=s.data(n||{},"drop+reorder");!n||n==t.current&&i==t.method||(s(this)[i](n),t.current=n,t.method=i,t.update())}).drag("end",function(e,t){s(this).removeClass("select2-choice-dragging"),n.$el.select2("onSortEnd"),s(t.proxy).remove()}).drop("init",function(e,t){return this!=t.drag}),i(e,t)}}},initializeSelect2:function(){var n=this;function t(e,t){return e?(n.options.debug&&console.debug("callback",e,t),"string"==typeof e&&(e=window[e]),e(t)):e}n.options.formatResultCssClass=function(e){if(e.id)return"select2-option-"+e.id.toLowerCase().replace(/[ \:\)\(\[\]\{\}\_\+\=\&\*\%\#]/g,"-")},n.$el.select2(n.options),n.$el.on("select2-selected",function(e){t(n.options.onSelected,e)}),n.$el.on("select2-selecting",function(e){t(n.options.onSelecting,e)}),n.$el.on("select2-deselecting",function(e){t(n.options.onDeselecting,e)}),n.$el.on("select2-deselected",function(e){t(n.options.onDeselected,e)}),n.$select2=n.$el.parent().find(".select2-container"),n.$el.parent().off("close.plone-modal.patterns"),n.options.orderable&&n.$select2.addClass("select2-orderable")},opened:function(){return 1===s(".select2-dropdown-open",this.$el.parent()).length},init:function(){var o=this;if(o.options.allowNewItems=!o.options.hasOwnProperty("allowNewItems")||JSON.parse(o.options.allowNewItems),o.options.ajax||o.options.vocabularyUrl){o.options.vocabularyUrl&&(o.options.multiple=void 0===o.options.multiple||o.options.multiple,o.options.ajax=o.options.ajax||{},o.options.ajax.url=o.options.vocabularyUrl,o.options.initSelection=function(e,t){var n=[],i=e.val();s(i.split(o.options.separator)).each(function(){var e=l.removeHTML(this);n.push({id:e,text:e})}),t(n)});var r="";o.options.ajax=s.extend({quietMillis:300,data:function(e,t){return{query:r=e,page_limit:10,page:t}},results:function(e,t){var n=e.results;if(o.options.vocabularyUrl){var i=[];s.each(e.results,function(e,t){i.push(t.id)}),n=[];var a=""===r||0<=s.inArray(r,i);o.options.allowNewItems&&!a&&(r=l.removeHTML(r),n.push({id:r,text:r})),s.each(e.results,function(e,t){n.push(t)})}return{results:n}}},o.options.ajax)}else if(o.options.multiple&&o.$el.is("select")){var e=o.$el.val()||[],t=s.map(o.$el.find("option"),function(e){return{text:s(e).html(),id:e.value}}),n=s('<input type="hidden" />');n.val(e.join(o.options.separator)),n.attr("class",o.$el.attr("class")),n.attr("name",o.$el.attr("name")),n.attr("id",o.$el.attr("id")),o.$orig=o.$el,o.$el.replaceWith(n),o.$el=n,o.options.data=t}o.initializeValues(),o.initializeTags(),o.initializeOrdering(),o.initializeSelect2()}})}),define("mockup-ui-url/views/base",["jquery","underscore","backbone","translate"],function(n,i,a,o){"use strict";return a.View.extend({isUIView:!0,eventPrefix:"ui",template:null,idPrefix:"base-",appendInContainer:!0,initialize:function(e){for(var t in this.options=e,this.options)this[t]=this.options[t];this.options._t=o},render:function(){return this.applyTemplate(),this.trigger("render",this),this.afterRender(),this.options.id&&this.$el.attr("id",this.idPrefix+this.options.id),this},afterRender:function(){},serializedModel:function(){return this.options},applyTemplate:function(){if(null!==this.template){var e=n.extend({_t:o},this.options,this.serializedModel()),t=this.template;"string"==typeof t&&(t=i.template(t)),this.$el.html(t(e))}},propagateEvent:function(e){if(0<e.indexOf(":")){var t=e.split(":")[0];if(""!==this.eventPrefix&&(t===this.eventPrefix||t===this.eventPrefix+"."+this.id))return!0}return!1},uiEventTrigger:function(e){var t=[].slice.call(arguments,0);""!==this.eventPrefix&&(t[0]=this.eventPrefix+":"+e,a.View.prototype.trigger.apply(this,t),this.id&&(t[0]=this.eventPrefix+"."+this.id+":"+e,a.View.prototype.trigger.apply(this,t)))}})}),define("mockup-patterns-tooltip",["jquery","pat-base"],function(f,e,t){"use strict";function n(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)}return n.VERSION="3.2.0",n.DEFAULTS={animation:!0,placement:"auto",selector:!1,template:'<div class="tooltip mockup-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!0,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(e,t,n){this.enabled=!0,this.type=e,this.$element=f(t),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&f(this.options.viewport.selector||this.options.viewport);for(var i=this.options.trigger.split(" "),a=i.length;a--;){var o=i[a];if("click"==o)this.$element.on("click."+this.type,this.options.selector,f.proxy(this.toggle,this));else if("manual"!=o){var r="hover"==o?"mouseenter":"focusin",s="hover"==o?"mouseleave":"focusout";this.$element.on(r+"."+this.type,this.options.selector,f.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,f.proxy(this.leave,this))}}this.options.selector?this._options=f.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(e){return(e=f.extend({},this.getDefaults(),this.$element.data(),e)).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},n.prototype.getDelegateOptions=function(){var n={},i=this.getDefaults();return this._options&&f.each(this._options,function(e,t){i[e]!=t&&(n[e]=t)}),n},n.prototype.enter=function(e){var t=e instanceof this.constructor?e:f(e.currentTarget).data("bs."+this.type);if(t||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),f(e.currentTarget).data("bs."+this.type,t)),t.leaving=!1,clearTimeout(t.timeout),t.hoverState="in",!t.options.delay||!t.options.delay.show)return t.show();t.timeout=setTimeout(function(){"in"==t.hoverState&&t.show()},t.options.delay.show)},n.prototype.leave=function(e){var t=e instanceof this.constructor?e:f(e.currentTarget).data("bs."+this.type);if(t.leaving=!0,t||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),f(e.currentTarget).data("bs."+this.type,t)),clearTimeout(t.timeout),t.hoverState="out",!t.options.delay||!t.options.delay.hide)return t.hide();t.timeout=setTimeout(function(){"out"==t.hoverState&&t.hide()},t.options.delay.hide)},n.prototype.show=function(){var e=f.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var t=f.contains(document.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!t)return;var u=this.tip(),h=this.getUID(this.type),p=this;this.setContent().then(function(){u.attr("id",h),p.$element.attr("aria-describedby",h),p.options.animation&&u.addClass("fade");var e="function"==typeof p.options.placement?p.options.placement.call(p,u[0],p.$element[0]):p.options.placement,t=/\s?auto?\s?/i,n=t.test(e);n&&(e=e.replace(t,"")||"top"),u.detach().css({top:0,left:0,display:"block"}).addClass(e).data("bs."+p.type,p),p.options.container?u.appendTo(p.options.container):u.insertAfter(p.$element);var i=p.getPosition(),a=u[0].offsetWidth,o=u[0].offsetHeight;if(n){var r=e,s=p.$element.parent(),l=p.getPosition(s);e="bottom"==e&&i.top+i.height+o-l.scroll>l.height?"top":"top"==e&&i.top-l.scroll-o<0?"bottom":"right"==e&&i.right+a>l.width?"left":"left"==e&&i.left-a<l.left?"right":e,u.removeClass(r).addClass(e)}var c=p.getCalculatedOffset(e,i,a,o);p.applyPlacement(c,e);function d(){p.$element.trigger("shown.bs."+p.type),p.hoverState=null,p.leaving&&p.leave(p)}f.support.transition&&p.$tip.hasClass("fade")?u.one("bsTransitionEnd",d).emulateTransitionEnd(150):d()})}},n.prototype.applyPlacement=function(e,t){var n=this.tip(),i=n[0].offsetWidth,a=n[0].offsetHeight,o=parseInt(n.css("margin-top"),10),r=parseInt(n.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(r)&&(r=0),e.top=e.top+o,e.left=e.left+r,f.offset.setOffset(n[0],f.extend({using:function(e){n.css({top:Math.round(e.top),left:Math.round(e.left)})}},e),0),n.addClass("in");var s=n[0].offsetWidth,l=n[0].offsetHeight;"top"==t&&l!=a&&(e.top=e.top+a-l);var c=this.getViewportAdjustedDelta(t,e,s,l);c.left?e.left+=c.left:e.top+=c.top;var d=c.left?2*c.left-i+s:2*c.top-a+l,u=c.left?"left":"top",h=c.left?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(d,n[0][h],u)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},n.prototype.setContent=function(){var t=this.tip(),n=this.options.html?"html":"text",i=this.options.patTooltip?this.options.patTooltip.contentSelector:null;function a(e){"html"===n&&i&&(e=f(e).find(i).html()),t.find(".tooltip-inner")[n](e)}function e(){t.removeClass("fade in top bottom left right")}var o=this.getTitle(),r=this.getUrl();return r?(e(),f.get(r).then(function(e){a(e)})):(e(),a(o),new Promise(function(e,t){e(o)}))},n.prototype.getUrl=function(){return this.options.patTooltip?this.options.patTooltip.ajaxUrl:null},n.prototype.hide=function(){var e=this,t=this.tip(),n=f.Event("hide.bs."+this.type);function i(){"in"!=e.hoverState&&t.detach(),e.$element.trigger("hidden.bs."+e.type)}if(this.$element.removeAttr("aria-describedby"),this.$element.trigger(n),!n.isDefaultPrevented())return t.removeClass("in"),f.support.transition&&this.$tip.hasClass("fade")?t.one("bsTransitionEnd",i).emulateTransitionEnd(150):i(),this.hoverState=null,this},n.prototype.fixTitle=function(){var e=this.$element;!e.attr("title")&&"string"==typeof e.attr("data-original-title")||e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()||this.getUrl()},n.prototype.getPosition=function(e){var t=(e=e||this.$element)[0],n="BODY"==t.tagName;return f.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():null,{scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop(),width:n?f(window).width():e.outerWidth(),height:n?f(window).height():e.outerHeight()},n?{top:0,left:0}:e.offset())},n.prototype.getCalculatedOffset=function(e,t,n,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-n}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,i){var a={top:0,left:0};if(!this.$viewport)return a;var o=this.options.viewport&&this.options.viewport.padding||0,r=this.getPosition(this.$viewport);if(/right|left/.test(e)){var s=t.top-o-r.scroll,l=t.top+o-r.scroll+i;s<r.top?a.top=r.top-s:l>r.top+r.height&&(a.top=r.top+r.height-l)}else{var c=t.left-o,d=t.left+o+n;c<r.left?a.left=r.left-c:d>r.width&&(a.left=r.left+r.width-d)}return a},n.prototype.getTitle=function(){var e=this.$element,t=this.options;return e.attr("data-original-title")||("function"==typeof t.title?t.title.call(e[0]):t.title)},n.prototype.getUID=function(e){for(;e+=~~(1e6*Math.random()),document.getElementById(e););return e},n.prototype.tip=function(){if(this.$tip)return this.$tip;var e=this.$tip||f(this.options.template);return this.options.patTooltip&&(this.options.patTooltip.style&&e.css(this.options.patTooltip.style),this.options.patTooltip.class&&e.addClass(this.options.patTooltip.class),this.options.patTooltip.innerStyle&&e.find(".tooltip-inner").css(this.options.patTooltip.innerStyle)),this.$tip=e},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(e){var t=this;e&&((t=f(e.currentTarget).data("bs."+this.type))||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),f(e.currentTarget).data("bs."+this.type,t))),t.tip().hasClass("in")?t.leave(t):t.enter(t)},n.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)},e.extend({name:"tooltip",trigger:".pat-tooltip",parser:"mockup",defaults:{html:!1,placement:"top"},init:function(){"true"===this.options.html||!0===this.options.html?this.options.html=!0:this.options.html=!1,this.data=new n(this.$el[0],this.options)}})}),define("mockup-ui-url/views/button",["underscore","mockup-ui-url/views/base","mockup-patterns-tooltip"],function(n,i,a){"use strict";return i.extend({tagName:"a",className:"btn",eventPrefix:"button",context:"default",idPrefix:"btn-",attributes:{href:"#"},extraClasses:[],tooltip:null,template:'<% if (icon) { %><span class="glyphicon glyphicon-<%= icon %>"></span><% } %> <%= title %>',events:{click:"handleClick"},initialize:function(e){if(!e.id){var t=e.title||"";e.id=""!==t?t.toLowerCase().replace(" ","-"):this.cid}i.prototype.initialize.apply(this,[e]),this.on("render",function(){if(this.$el.attr("title",this.options.title||""),this.$el.attr("aria-label",this.options.title||this.options.tooltip||""),null!==this.context&&this.$el.addClass("btn-"+this.context),n.each(this.extraClasses,function(e){this.$el.addClass(e)}.bind(this)),null!==this.tooltip){this.$el.attr("title",this.tooltip);new a(this.$el);this.$el.on("hidden",function(e){"hidden"===e.type&&e.stopPropagation()})}},this)},handleClick:function(e){e.preventDefault(),this.$el.is(".disabled")||this.uiEventTrigger("click",this,e)},serializedModel:function(){return n.extend({icon:"",title:""},this.options)},disable:function(){this.$el.addClass("disabled")},enable:function(){this.$el.removeClass("disabled")}})}),define("text",["module"],function(e){"use strict";var c,a,r,s,l,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,u=d&&location.protocol&&location.protocol.replace(/\:/,""),h=d&&location.hostname,p=d&&(location.port||void 0),f={},m=e.config&&e.config()||{};function g(e,t){return void 0===e||""===e?t:e}return c={version:"2.0.15",strip:function(e){if(e){var t=(e=e.replace(n,"")).match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(e){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,i,a=!1,o=e.lastIndexOf("."),r=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!r||1<o)?(t=e.substring(0,o),n=e.substring(o+1)):t=e,-1!==(o=(i=n||t).indexOf("!"))&&(a="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,i){var a,o,r,s=c.xdRegExp.exec(e);return!s||(a=s[2],r=(o=(o=s[3]).split(":"))[1],o=o[0],(!a||a===t)&&(!o||o.toLowerCase()===n.toLowerCase())&&(!r&&!o||function(e,t,n,i){if(t===i)return!0;if(e===n){if("http"===e)return g(t,"80")===g(i,"80");if("https"===e)return g(t,"443")===g(i,"443")}return!1}(a,r,t,i)))},finishLoad:function(e,t,n,i){n=t?c.strip(n):n,m.isBuild&&(f[e]=n),i(n)},load:function(t,e,n,i){if(i&&i.isBuild&&!i.inlineText)n();else{m.isBuild=i&&i.isBuild;var a=c.parseName(t),o=a.moduleName+(a.ext?"."+a.ext:""),r=e.toUrl(o),s=m.useXhr||c.useXhr;0!==r.indexOf("empty:")?!d||s(r,u,h,p)?c.get(r,function(e){c.finishLoad(t,a.strip,e,n)},function(e){n.error&&n.error(e)}):e([o],function(e){c.finishLoad(a.moduleName+"."+a.ext,a.strip,e,n)}):n()}},write:function(e,t,n,i){if(f.hasOwnProperty(t)){var a=c.jsEscape(f[t]);n.asModule(e+"!"+t,"define(function () { return '"+a+"';});\n")}},writeFile:function(n,e,t,i,a){var o=c.parseName(e),r=o.ext?"."+o.ext:"",s=o.moduleName+r,l=t.toUrl(o.moduleName+r)+".js";c.load(s,t,function(e){function t(e){return i(l,e)}t.asModule=function(e,t){return i.asModule(e,l,t)},c.write(n,s,t,a)},a)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(a=require.nodeRequire("fs"),c.get=function(e,t,n){try{var i=a.readFileSync(e,"utf8");"\ufeff"===i[0]&&(i=i.substring(1)),t(i)}catch(e){n&&n(e)}}):"xhr"===m.env||!m.env&&c.createXhr()?c.get=function(i,a,o,e){var t,r=c.createXhr();if(r.open("GET",i,!0),e)for(t in e)e.hasOwnProperty(t)&&r.setRequestHeader(t.toLowerCase(),e[t]);m.onXhr&&m.onXhr(r,i),r.onreadystatechange=function(e){var t,n;4===r.readyState&&(399<(t=r.status||0)&&t<600?((n=new Error(i+" HTTP status: "+t)).xhr=r,o&&o(n)):a(r.responseText),m.onXhrComplete&&m.onXhrComplete(r,i))},r.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?c.get=function(e,t){var n,i,a=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),"utf-8")),s="";try{for(n=new java.lang.StringBuffer,(i=r.readLine())&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=r.readLine());)n.append(o),n.append(i);s=String(n.toString())}finally{r.close()}t(s)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,s=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),l="@mozilla.org/windows-registry-key;1"in r,c.get=function(e,t){var n,i,a,o={};l&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{(n=r["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream)).init(a,1,0,!1),(i=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream)).init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),o),i.close(),n.close(),t(o.value)}catch(e){throw new Error((a&&a.path||"")+": "+e)}}),c}),define("text!mockup-patterns-relateditems-url/templates/breadcrumb.xml",[],function(){return'<span class="separator">/<span>\n<a href="<%- path %>" class="crumb"><%- text %></a>\n'}),define("text!mockup-patterns-relateditems-url/templates/favorite.xml",[],function(){return'<li><a href="<%- path %>" class="fav" aria-labelledby="blip"><%- title %></a></li>\n'}),define("text!mockup-patterns-relateditems-url/templates/recentlyused.xml",[],function(){return'<li class="pattern-relateditems-recentlyused">\n  <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n    <div class="pattern-relateditems-recentlyused-info">\n      <span\n        class="pattern-relateditems-recentlyused-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n        title="<%- portal_type %>">\n        <%- Title %>\n      </span>\n      <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n    </div>\n    <% if (getURL && (getIcon || portal_type === "Image")) { %>\n      <div class="pattern-relateditems-recentlyused-image">\n        <img src="<%- getURL %>/@@images/image/tile" />\n      </div>\n    <% } %>\n  </a>\n</li>\n'}),define("text!mockup-patterns-relateditems-url/templates/result.xml",[],function(){return'<div class="pattern-relateditems-result <%- oneLevelUp ? \'one-level-up\' : \'\' %>">\n  <div class="pattern-relateditems-result-browse-wrapper">\n  <% if (!oneLevelUp) { %>\n    <a\n      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n      data-path="<%- path %>">\n  <% } %>\n      <div class="pattern-relateditems-result-info">\n        <span\n          class="pattern-relateditems-result-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n          title="<%- portal_type %>">\n          <%- Title %>\n        </span>\n        <span class="pattern-relateditems-result-path"><%- oneLevelUp ? currentPath : path %></span>\n      </div>\n      <% if (is_folderish) { %>\n        <a\n          class="pattern-relateditems-result-browse"\n          data-path="<%- path %>"\n          title="<%- oneLevelUp ? one_level_up : open_folder %>">\n          <span class="<%- oneLevelUp ? \'icon-left-circle\' : \'icon-right-circle\' %>"></span>\n        </a>\n      <% } %>\n  <% if (!oneLevelUp) { %>\n    </a>\n  <% } %>\n  </div>\n  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n    <% if (!oneLevelUp) { %>\n    <a\n      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n      data-path="<%- path %>">\n    <% } %>\n    <div class="pattern-relateditems-result-image">\n      <img src="<%- getURL %>/@@images/image/thumb" />\n    </div>\n    <% if (!oneLevelUp) { %>\n    </a>\n    <% } %>\n  <% } %>\n</div>\n'}),define("text!mockup-patterns-relateditems-url/templates/selection.xml",[],function(){return'<div class="pattern-relateditems-item">\n  <div class="pattern-relateditems-result-info">\n    <span\n      class="pattern-relateditems-item-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n      title="<%- portal_type %>">\n      <%- Title %>\n    </span>\n    <span class="pattern-relateditems-item-path"><%- path %></span>\n  </div>\n  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n    <div class="pattern-relateditems-item-image">\n      <img src="<%- getURL %>/@@images/image/thumb" />\n    </div>\n  <% } %>\n</div>\n'}),define("text!mockup-patterns-relateditems-url/templates/toolbar.xml",[],function(){return'<% if (mode!==\'auto\') { %>\n<div class="btn-group mode-selector" role="group">\n  <button type="button" class="mode search btn <% if (mode==\'search\') { %>btn-primary<% } else {%>btn-default<% } %>"><%- searchModeText %></button>\n  <button type="button" class="mode browse btn <% if (mode==\'browse\') { %>btn-primary<% } else {%>btn-default<% } %>"><%- browseModeText %></button>\n</div>\n<% } %>\n<div class="path-wrapper">\n  <span class="pattern-relateditems-path-label"><%- searchText %></span>\n  <a class="crumb" href="/"><span class="glyphicon glyphicon-home"/></a>\n  <%= items %>\n</div>\n<div class="controls pull-right">\n\n  <% if (recentlyUsedItems) { %>\n  <div class="recentlyUsed dropdown pull-right">\n    <button type="button" class="recentlyUsed dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n      <span class="glyphicon glyphicon-time"/>\n      <%- recentlyUsedText %>\n      <span class="caret"/>\n    </button>\n    <ul class="dropdown-menu">\n      <%= recentlyUsedItems %>\n    </ul>\n  </div>\n  <% } %>\n\n  <% if (favorites.length > 0) { %>\n  <div class="favorites dropdown pull-right">\n    <button type="button" class="favorites dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n      <span class="glyphicon glyphicon-star"/>\n      <%- favText %>\n      <span class="caret"/>\n    </button>\n    <ul class="dropdown-menu">\n      <%= favItems %>\n    </ul>\n  </div>\n  <% } %>\n</div>\n'}),define("mockup-patterns-relateditems",["jquery","underscore","pat-base","mockup-patterns-select2","mockup-ui-url/views/button","mockup-utils","pat-registry","translate","text!mockup-patterns-relateditems-url/templates/breadcrumb.xml","text!mockup-patterns-relateditems-url/templates/favorite.xml","text!mockup-patterns-relateditems-url/templates/recentlyused.xml","text!mockup-patterns-relateditems-url/templates/result.xml","text!mockup-patterns-relateditems-url/templates/selection.xml","text!mockup-patterns-relateditems-url/templates/toolbar.xml","bootstrap-dropdown"],function(c,d,e,o,u,h,r,p,t,n,i,a,s,l){"use strict";var f=37,m=39;return e.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",currentPath:void 0,selectedUIDs:[],openAfterInit:void 0,defaults:{vocabularyUrl:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],basePath:"",pageSize:10,browsing:void 0,closeOnSelect:!0,contextPath:void 0,dropdownCssClass:"pattern-relateditems-dropdown",favorites:[],recentlyUsed:!1,recentlyUsedMaxItems:20,recentlyUsedKey:"relateditems_recentlyused",maximumSelectionSize:-1,minimumInputLength:0,mode:"auto",orderable:!0,pathOperator:"plone.app.querystring.operation.string.path",rootPath:"/",rootUrl:"",scanSelection:!1,selectableTypes:null,separator:",",sortOn:null,sortOrder:"ascending",tokenSeparators:[","," "],upload:!1,uploadAllowView:void 0,width:"100%",breadcrumbTemplate:t,breadcrumbTemplateSelector:null,favoriteTemplate:n,favoriteTemplateSelector:null,recentlyusedTemplate:i,recentlyusedTemplateSelector:null,resultTemplate:a,resultTemplateSelector:null,selectionTemplate:s,selectionTemplateSelector:null,toolbarTemplate:l,toolbarTemplateSelector:null,multiple:!0},recentlyUsed:function(e){var t=h.storage.get(this.options.recentlyUsedKey)||[];t=t.slice(t.length-1e3,t.length),e&&t.filter(this.isSelectable.bind(this));var n=parseInt(this.options.recentlyUsedMaxItems,10);return n&&(t=t.slice(t.length-n,t.length)),t},applyTemplate:function(e,t){var n,i=this;n=i.options[e+"TemplateSelector"]&&(n=c(i.options[e+"TemplateSelector"]).html())||i.options[e+"Template"];var a=c.extend(!0,{},i.options,t,{browsing:i.browsing,open_folder:p("Open folder"),current_directory:p("current directory:"),one_level_up:p("Go one level up")});return a._item=t,d.template(n)(a)},setAjax:function(){var e={url:this.options.vocabularyUrl,dataType:"JSON",quietMillis:500,data:function(e,t){var n=[];e&&(e="*"+e+"*",n.push({i:"SearchableText",o:"plone.app.querystring.operation.string.contains",v:e})),!this.browsing&&this.options.selectableTypes&&n.push({i:"portal_type",o:"plone.app.querystring.operation.selection.any",v:this.options.selectableTypes}),n.push({i:"path",o:this.options.pathOperator,v:this.options.rootPath+this.currentPath+(this.browsing?"::1":"")});var i=this.options.sortOn,a=i?this.options.sortOrder:null;return this.browsing&&null===i&&(i="getObjPositionInParent",a="ascending"),{query:JSON.stringify({criteria:n,sort_on:i,sort_order:a}),attributes:JSON.stringify(this.options.attributes),batch:JSON.stringify({page:t||1,size:this.options.pageSize})}}.bind(this),results:function(e,t){var n=t*this.options.pageSize<e.total,i=e.results;this.selectedUIDs=(this.$el.select2("data")||[]).map(function(e){return e.UID}),i=i.filter(function(e){return!!(this.browsing&&e.is_folderish||this.isSelectable(e)&&-1===this.selectedUIDs.indexOf(e.UID))}.bind(this));var a=this.currentPath.split("/");return 1===t&&this.browsing&&1<a.length&&"/"!==this.currentPath&&(i=[{oneLevelUp:!0,Title:p("One level up"),path:a.slice(0,a.length-1).join("/")||"/",currentPath:this.currentPath,is_folderish:!0,selectable:!1}].concat(i)),{results:i,more:n}}.bind(this)};this.options.ajax=e},renderToolbar:function(){var e,a=this,t=a.currentPath.split("/"),n="",i="";d.each(t,function(e){if(""!==e){var t={};t.path=n=n+"/"+e,t.text=e,i+=a.applyTemplate("breadcrumb",t)}});var o="";d.each(a.options.favorites,function(e){var t=d.clone(e);t.path=t.path.substr(a.options.rootPath.length)||"/",o+=a.applyTemplate("favorite",t)});var r="";if(a.options.recentlyUsed){var s=a.recentlyUsed(!0);d.each(s.reverse(),function(e){r+=a.applyTemplate("recentlyused",e)})}function l(e,t){var n="upload-"+h.generateId(),i=new u({id:n,title:p("Upload"),tooltip:p("Upload files"),icon:"upload"});t&&i.disable(),c(".controls",a.$toolbar).prepend(i.render().el),a.uploadView=new e({triggerView:i,app:a}),c("#btn-"+n,a.$toolbar).append(a.uploadView.render().el)}e=a.applyTemplate("toolbar",{items:i,favItems:o,favText:p("Favorites"),searchText:p("Current path:"),searchModeText:p("Search"),browseModeText:p("Browse"),recentlyUsedItems:r,recentlyUsedText:p("Recently Used")}),a.$toolbar.html(e),c(".dropdown-toggle",a.$toolbar).dropdown(),c(".pattern-relateditems-dropdown").unbind("mouseup"),c(".pattern-relateditems-dropdown").bind("mouseup",function(e){e.stopPropagation()}),c("button.mode.search",a.$toolbar).on("click",function(e){e.preventDefault(),a.browsing?(c("button.mode.search",a.$toolbar).toggleClass("btn-primary btn-default"),c("button.mode.browse",a.$toolbar).toggleClass("btn-primary btn-default"),a.browsing=!1,0<a.$el.select2("data").length&&(a.openAfterInit=!0),a.openAfterInit||(a.$el.select2("close"),a.$el.select2("open"))):(a.$el.select2("close"),a.$el.select2("open"))}),c("button.mode.browse",a.$toolbar).on("click",function(e){e.preventDefault(),a.browsing?(a.$el.select2("close"),a.$el.select2("open")):(c("button.mode.search",a.$toolbar).toggleClass("btn-primary btn-default"),c("button.mode.browse",a.$toolbar).toggleClass("btn-primary btn-default"),a.browsing=!0,0<a.$el.select2("data").length&&(a.openAfterInit=!0),a.openAfterInit||(a.$el.select2("close"),a.$el.select2("open")))}),c("a.crumb",a.$toolbar).on("click",function(e){e.preventDefault(),a.browseTo(c(this).attr("href"))}),c("a.fav",a.$toolbar).on("click",function(e){e.preventDefault(),a.browseTo(c(this).attr("href"))}),a.options.recentlyUsed&&c(".pattern-relateditems-recentlyused-select",a.$toolbar).on("click",function(e){e.preventDefault();var t=c(this).data("uid"),n=a.recentlyUsed().filter(function(e){return e.UID===t});if(0<n.length&&(n=n[0],a.selectItem(n),0<a.options.maximumSelectionSize&&a.$el.select2("data").length>=a.options.maximumSelectionSize))return}),a.options.upload&&h.featureSupport.dragAndDrop()&&h.featureSupport.fileApi()&&require(["mockup-patterns-relateditems-upload"],function(t){a.options.uploadAllowView?c.ajax({url:a.options.uploadAllowView,dataType:"JSON",data:{path:a.options.rootPath+a.currentPath},type:"GET",success:function(e){l(t,!e.allowUpload)}}):l(t)})},browseTo:function(e){var t=this;t.emit("before-browse"),t.currentPath=e,t.$el.select2("close"),t.renderToolbar(),t.$el.select2("open"),t.emit("after-browse")},selectItem:function(t){var e=this;e.emit("selecting");var n=e.$el.select2("data");if(n.push(t),e.$el.select2("data",n,!0),e.options.recentlyUsed){var i=e.recentlyUsed(),a=i.filter(function(e){return e.UID===t.UID});0<a.length&&i.splice(i.indexOf(a[0]),1),i.push(t),h.storage.set(e.options.recentlyUsedKey,i)}e.emit("selected")},deselectItem:function(n){this.emit("deselecting");var i=this.$el.select2("data");d.each(i,function(e,t){e.UID===n.UID&&i.splice(t,1)}),this.$el.select2("data",i,!0),this.emit("deselected")},isSelectable:function(e){return!1!==e.selectable&&(null===this.options.selectableTypes||-1!==this.options.selectableTypes.indexOf(e.portal_type))},init:function(){var a=this;a.browsing="search"!==a.options.mode,a.options.rootPath=a.options.rootPath.replace(/\/$/,""),a.currentPath=a.options.basePath.substr(a.options.rootPath.length)||"/",a.setAjax(),a.$el.wrap('<div class="pattern-relateditems-container" />'),a.$container=a.$el.parents(".pattern-relateditems-container"),a.$container.width(a.options.width),o.prototype.initializeValues.call(a),o.prototype.initializeTags.call(a),a.options.formatSelection=function(e){e=c.extend(!0,{Title:"",getIcon:"",getURL:"",path:"",portal_type:"",review_state:""},e);var t=c(a.applyTemplate("selection",e));if(a.options.scanSelection&&r.scan(t),1==a.options.maximumSelectionSize){var n=e.path,i=n.split("/");n=(i=i.slice(0,-1)).join("/"),a.currentPath=n,a.renderToolbar()}return t},o.prototype.initializeOrdering.call(a),a.options.formatResult=function(n){n.selectable=a.isSelectable(n),n=c.extend(!0,{Title:"",getIcon:"",getURL:"",is_folderish:!1,oneLevelUp:!1,path:"",portal_type:"",review_state:"",selectable:!1},n),-1!==a.selectedUIDs.indexOf(n.UID)&&(n.selectable=!1);var e=c(a.applyTemplate("result",n));return c(".pattern-relateditems-result-select",e).on("click",function(e){if(e.preventDefault(),c(this).is(".selectable")){var t=c(this).parents(".pattern-relateditems-result");if(t.is(".pattern-relateditems-active"))t.removeClass("pattern-relateditems-active"),a.deselectItem(n);else{if(0<a.options.maximumSelectionSize)a.$el.select2("data").length>=a.options.maximumSelectionSize&&a.$el.select2("close");a.selectItem(n),t.addClass("pattern-relateditems-active"),a.options.closeOnSelect&&a.$el.select2("close")}}}),c(".pattern-relateditems-result-browse",e).on("click",function(e){e.preventDefault(),e.stopPropagation();var t=c(this).data("path");a.browseTo(t)}),c(e)},a.options.initSelection=function(e,n){var t=c(e).val();if(""!==t){var i=t.split(a.options.separator);new h.QueryHelper(c.extend(!0,{},a.options,{pattern:a})).search("UID","plone.app.querystring.operation.list.contains",i,function(e){var t=e.results.reduce(function(e,t){return e[t.UID]=t,e},{});try{n(i.map(function(e){return t[e]}).filter(function(e){return void 0!==e}))}catch(e){}a.openAfterInit&&(a.$el.select2("open"),a.openAfterInit=void 0)},!1)}},a.options.tokenizer=function(e){"auto"===this.options.mode&&(this.browsing=!e)}.bind(this),a.options.id=function(e){return e.UID},o.prototype.initializeSelect2.call(a),a.$toolbar=c('<div class="toolbar ui-offset-parent" />'),a.$container.prepend(a.$toolbar),a.$el.on("select2-selecting",function(e){a.isSelectable(e.choice)||e.preventDefault()}),a.renderToolbar(),c(document).on("keyup",a.$el,function(e){if(o.prototype.opened.call(a)&&(e.which===f||e.which===m)){e.stopPropagation();var t=e.which===f?".pattern-relateditems-result.one-level-up":".select2-highlighted",n=c(".pattern-relateditems-result-browse",t);if(1!==n.length)return;var i=n.data("path");a.browseTo(i)}})}})}),function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):"object"==typeof window?window.Picker=e(jQuery):this.Picker=e(jQuery)}(function(m){var i=m(window),g=m(document),a=m(document.documentElement),v=null!=document.documentElement.style.transition;function y(a,e,t,n){if(!a)return y;function i(){return this.start()}var o=!1,s={id:a.id||"P"+Math.abs(~~(Math.random()*new Date)),handlingOpen:!1},l=t?m.extend(!0,{},t.defaults,n):n||{},r=m.extend({},y.klasses(),l.klass),c=m(a),d=i.prototype={constructor:i,$node:c,start:function(){return s&&s.start?d:(s.methods={},s.start=!0,s.open=!1,s.type=a.type,a.autofocus=a==x(),a.readOnly=!l.editable,a.id=a.id||s.id,"text"!=a.type&&(a.type="text"),d.component=new t(d,l),d.$root=m('<div class="'+r.picker+'" id="'+a.id+'_root" />'),k(d.$root[0],"hidden",!0),d.$holder=m(u()).appendTo(d.$root),h(),l.formatSubmit&&function(){var e;!0===l.hiddenName?(e=a.name,a.name=""):e=(e=["string"==typeof l.hiddenPrefix?l.hiddenPrefix:"","string"==typeof l.hiddenSuffix?l.hiddenSuffix:"_submit"])[0]+a.name+e[1];d._hidden=m('<input type=hidden name="'+e+'"'+(c.data("value")||a.value?' value="'+d.get("select",l.formatSubmit)+'"':"")+">")[0],c.on("change."+s.id,function(){d._hidden.value=a.value?d.get("select",l.formatSubmit):""})}(),function(){c.data(e,d).addClass(r.input).val(c.data("value")?d.get("select",l.format):a.value).on("focus."+s.id+" click."+s.id,function(e){e.preventDefault(),d.open()}).on("mousedown",function(){s.handlingOpen=!0;var e=function(){setTimeout(function(){m(document).off("mouseup",e),s.handlingOpen=!1},0)};m(document).on("mouseup",e)}),l.editable||c.on("keydown."+s.id,f);k(a,{haspopup:!0,expanded:!1,readonly:!1,owns:a.id+"_root"})}(),l.containerHidden?m(l.containerHidden).append(d._hidden):c.after(d._hidden),l.container?m(l.container).append(d.$root):c.after(d.$root),d.on({start:d.component.onStart,render:d.component.onRender,stop:d.component.onStop,open:d.component.onOpen,close:d.component.onClose,set:d.component.onSet}).on({start:l.onStart,render:l.onRender,stop:l.onStop,open:l.onOpen,close:l.onClose,set:l.onSet}),o=function(e){var t,n="position";e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]);return"fixed"==t}(d.$holder[0]),a.autofocus&&d.open(),d.trigger("start").trigger("render"))},render:function(e){return e?(d.$holder=m(u()),h(),d.$root.html(d.$holder)):d.$root.find("."+r.box).html(d.component.nodes(s.open)),d.trigger("render")},stop:function(){return s.start&&(d.close(),d._hidden&&d._hidden.parentNode.removeChild(d._hidden),d.$root.remove(),c.removeClass(r.input).removeData(e),setTimeout(function(){c.off("."+s.id)},0),a.type=s.type,a.readOnly=!1,d.trigger("stop"),s.methods={},s.start=!1),d},open:function(e){return s.open?d:(c.addClass(r.active),k(a,"expanded",!0),setTimeout(function(){d.$root.addClass(r.opened),k(d.$root[0],"hidden",!1)},0),!1!==e&&(s.open=!0,o&&m("body").css("overflow","hidden").css("padding-right","+="+b()),o&&v?d.$holder.find("."+r.frame).one("transitionend",function(){d.$holder.eq(0).focus()}):setTimeout(function(){d.$holder.eq(0).focus()},0),g.on("click."+s.id+" focusin."+s.id,function(e){if(!s.handlingOpen){var t=w(e,a);e.isSimulated||t==a||t==document||3==e.which||d.close(t===d.$holder[0])}}).on("keydown."+s.id,function(e){var t=e.keyCode,n=d.component.key[t],i=w(e,a);27==t?d.close(!0):i!=d.$holder[0]||!n&&13!=t?m.contains(d.$root[0],i)&&13==t&&(e.preventDefault(),i.click()):(e.preventDefault(),n?y._.trigger(d.component.key.go,d,[y._.trigger(n)]):d.$root.find("."+r.highlighted).hasClass(r.disabled)||(d.set("select",d.component.item.highlight),l.closeOnSelect&&d.close(!0)))})),d.trigger("open"))},close:function(e){return e&&(l.editable?a.focus():(d.$holder.off("focus.toOpen").focus(),setTimeout(function(){d.$holder.on("focus.toOpen",p)},0))),c.removeClass(r.active),k(a,"expanded",!1),setTimeout(function(){d.$root.removeClass(r.opened+" "+r.focused),k(d.$root[0],"hidden",!0)},0),s.open?(s.open=!1,o&&m("body").css("overflow","").css("padding-right","-="+b()),g.off("."+s.id),d.trigger("close")):d},clear:function(e){return d.set("clear",null,e)},set:function(e,t,n){var i,a,o=m.isPlainObject(e),r=o?e:{};if(n=o&&m.isPlainObject(t)?t:n||{},e){for(i in o||(r[e]=t),r)a=r[i],i in d.component.item&&(void 0===a&&(a=null),d.component.set(i,a,n)),"select"!=i&&"clear"!=i||!l.updateInput||c.val("clear"==i?"":d.get(i,l.format)).trigger("change");d.render()}return n.muted?d:d.trigger("set",r)},get:function(e,t){if(null!=s[e=e||"value"])return s[e];if("valueSubmit"==e){if(d._hidden)return d._hidden.value;e="value"}if("value"==e)return a.value;if(e in d.component.item){if("string"!=typeof t)return d.component.get(e);var n=d.component.get(e);return n?y._.trigger(d.component.formats.toString,d.component,[t,n]):""}},on:function(e,t,n){var i,a,o=m.isPlainObject(e),r=o?e:{};if(e)for(i in o||(r[e]=t),r)a=r[i],n&&(i="_"+i),s.methods[i]=s.methods[i]||[],s.methods[i].push(a);return d},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)(t=n[e])in s.methods&&delete s.methods[t];return d},trigger:function(e,n){function t(e){var t=s.methods[e];t&&t.map(function(e){y._.trigger(e,d,[n])})}return t("_"+e),t(e),d}};function u(){return y._.node("div",y._.node("div",y._.node("div",y._.node("div",d.component.nodes(s.open),r.box),r.wrap),r.frame),r.holder,'tabindex="-1"')}function h(){d.$holder.on({keydown:f,"focus.toOpen":p,blur:function(){c.removeClass(r.target)},focusin:function(e){d.$root.removeClass(r.focused),e.stopPropagation()},"mousedown click":function(e){var t=w(e,a);t!=d.$holder[0]&&(e.stopPropagation(),"mousedown"!=e.type||m(t).is("input, select, textarea, button, option")||(e.preventDefault(),d.$holder.eq(0).focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var e=m(this),t=e.data(),n=e.hasClass(r.navDisabled)||e.hasClass(r.disabled),i=x();i=i&&(i.type||i.href?i:null),(n||i&&!m.contains(d.$root[0],i))&&d.$holder.eq(0).focus(),!n&&t.nav?d.set("highlight",d.component.item.highlight,{nav:t.nav}):!n&&"pick"in t?(d.set("select",t.pick),l.closeOnSelect&&d.close(!0)):t.clear?(d.clear(),l.closeOnClear&&d.close(!0)):t.close&&d.close(!0)})}function p(e){e.stopPropagation(),c.addClass(r.target),d.$root.addClass(r.focused),d.open()}function f(e){var t=e.keyCode,n=/^(8|46)$/.test(t);if(27==t)return d.close(!0),!1;(32==t||n||!s.open&&d.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?d.clear().close():d.open())}return new i}function b(){if(a.height()<=i.height())return 0;var e=m('<div style="visibility:hidden;width:100px" />').appendTo("body"),t=e[0].offsetWidth;e.css("overflow","scroll");var n=m('<div style="width:100%" />').appendTo(e)[0].offsetWidth;return e.remove(),t-n}function w(e,t){var n=[];return e.path&&(n=e.path),e.originalEvent&&e.originalEvent.path&&(n=e.originalEvent.path),n&&0<n.length?t&&0<=n.indexOf(t)?t:n[0]:e.target}function k(e,t,n){if(m.isPlainObject(t))for(var i in t)o(e,i,t[i]);else o(e,t,n)}function o(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function x(){try{return document.activeElement}catch(e){}}return y.klasses=function(e){return{picker:e=e||"picker",opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},y._={group:function(e){for(var t,n="",i=y._.trigger(e.min,e);i<=y._.trigger(e.max,e,[i]);i+=e.i)t=y._.trigger(e.item,e,[i]),n+=y._.node(e.node,t[0],t[1],t[2]);return n},node:function(e,t,n,i){return t?"<"+e+(n=n?' class="'+n+'"':"")+(i=i?" "+i:"")+">"+(t=m.isArray(t)?t.join(""):t)+"</"+e+">":""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return-1<{}.toString.call(e).indexOf("Date")&&this.isInteger(e.getDate())},isInteger:function(e){return-1<{}.toString.call(e).indexOf("Number")&&e%1==0},ariaAttr:function(e,t){m.isPlainObject(e)||(e={attribute:t});for(var n in t="",e){var i=("role"==n?"":"aria-")+n,a=e[n];t+=null==a?"":i+'="'+e[n]+'"'}return t}},y.extend=function(i,a){m.fn[i]=function(e,t){var n=this.data(i);return"picker"==e?n:n&&"string"==typeof e?y._.trigger(n[e],n,[t]):this.each(function(){m(this).data(i)||new y(this,i,a,e)})},m.fn[i].defaults=a.defaults},y}),function(e){"function"==typeof define&&define.amd?define("picker.date",["./picker","jquery"],e):"object"==typeof exports?module.exports=e(require("./picker.js"),require("jquery")):e(Picker,jQuery)}(function(e,f){var t,v=e._;function n(t,n){function e(){return o.currentStyle?"rtl"==o.currentStyle.direction:"rtl"==getComputedStyle(t.$root[0]).direction}var i,a=this,o=t.$node[0],r=o.value,s=t.$node.data("value"),l=s||r,c=s?n.formatSubmit:n.format;a.settings=n,a.$node=t.$node,a.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},a.item={},a.item.clear=null,a.item.disable=(n.disable||[]).slice(0),a.item.enable=-(!0===(i=a.item.disable)[0]?i.shift():-1),a.set("min",n.min).set("max",n.max).set("now"),l?a.set("select",l,{format:c,defaultValue:!0}):a.set("select",null).set("highlight",a.item.now),a.key={40:7,38:-7,39:function(){return e()?-1:1},37:function(){return e()?1:-1},go:function(e){var t=a.item.highlight,n=new Date(t.year,t.month,t.date+e);a.set("highlight",n,{interval:e}),this.render()}},t.on("render",function(){t.$root.find("."+n.klass.selectMonth).on("change",function(){var e=this.value;e&&(t.set("highlight",[t.get("view").year,e,t.get("highlight").date]),t.$root.find("."+n.klass.selectMonth).trigger("focus"))}),t.$root.find("."+n.klass.selectYear).on("change",function(){var e=this.value;e&&(t.set("highlight",[e,t.get("view").month,t.get("highlight").date]),t.$root.find("."+n.klass.selectYear).trigger("focus"))})},1).on("open",function(){var e="";a.disabled(a.get("now"))&&(e=":not(."+n.klass.buttonToday+")"),t.$root.find("button"+e+", select").attr("disabled",!1)},1).on("close",function(){t.$root.find("button, select").attr("disabled",!0)},1)}function i(e,t,n){var i=e.match(/[^\x00-\x7F]+|\w+/)[0];return n.mm||n.m||(n.m=t.indexOf(i)+1),i.length}function a(e){return e.match(/\w+/)[0].length}n.prototype.set=function(t,n,i){var a=this,e=a.item;return null===n?("clear"==t&&(t="select"),e[t]=n):(e["enable"==t?"disable":"flip"==t?"enable":t]=a.queue[t].split(" ").map(function(e){return n=a[e](t,n,i)}).pop(),"select"==t?a.set("highlight",e.select,i):"highlight"==t?a.set("view",e.highlight,i):t.match(/^(flip|min|max|disable|enable)$/)&&(e.select&&a.disabled(e.select)&&a.set("select",e.select,i),e.highlight&&a.disabled(e.highlight)&&a.set("highlight",e.highlight,i))),a},n.prototype.get=function(e){return this.item[e]},n.prototype.create=function(e,t,n){var i;return(t=void 0===t?e:t)==-1/0||t==1/0?i=t:t=f.isPlainObject(t)&&v.isInteger(t.pick)?t.obj:f.isArray(t)?(t=new Date(t[0],t[1],t[2]),v.isDate(t)?t:this.create().obj):v.isInteger(t)||v.isDate(t)?this.normalize(new Date(t),n):this.now(e,t,n),{year:i||t.getFullYear(),month:i||t.getMonth(),date:i||t.getDate(),day:i||t.getDay(),obj:i||t,pick:i||t.getTime()}},n.prototype.createRange=function(e,t){function n(e){return!0===e||f.isArray(e)||v.isDate(e)?i.create(e):e}var i=this;return v.isInteger(e)||(e=n(e)),v.isInteger(t)||(t=n(t)),v.isInteger(e)&&f.isPlainObject(t)?e=[t.year,t.month,t.date+e]:v.isInteger(t)&&f.isPlainObject(e)&&(t=[e.year,e.month,e.date+t]),{from:n(e),to:n(t)}},n.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},n.prototype.overlapRanges=function(e,t){var n=this;return e=n.createRange(e.from,e.to),t=n.createRange(t.from,t.to),n.withinRange(e,t.from)||n.withinRange(e,t.to)||n.withinRange(t,e.from)||n.withinRange(t,e.to)},n.prototype.now=function(e,t,n){return t=new Date,n&&n.rel&&t.setDate(t.getDate()+n.rel),this.normalize(t,n)},n.prototype.navigate=function(e,t,n){var i,a,o,r,s=f.isArray(t),l=f.isPlainObject(t),c=this.item.view;if(s||l){for(r=l?(a=t.year,o=t.month,t.date):(a=+t[0],o=+t[1],+t[2]),n&&n.nav&&c&&c.month!==o&&(a=c.year,o=c.month),a=(i=new Date(a,o+(n&&n.nav?n.nav:0),1)).getFullYear(),o=i.getMonth();new Date(a,o,r).getMonth()!==o;)r-=1;t=[a,o,r]}return t},n.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},n.prototype.measure=function(e,t){return v.isInteger(t)?t=this.now(e,t,{rel:t}):t?"string"==typeof t&&(t=this.parse(e,t)):t="min"==e?-1/0:1/0,t},n.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},n.prototype.validate=function(e,n,t){var i,a,o,r,s=this,l=n,c=t&&t.interval?t.interval:1,d=-1===s.item.enable,u=s.item.min,h=s.item.max,p=d&&s.item.disable.filter(function(e){if(f.isArray(e)){var t=s.create(e).pick;t<n.pick?i=!0:t>n.pick&&(a=!0)}return v.isInteger(e)}).length;if((!t||!t.nav&&!t.defaultValue)&&(!d&&s.disabled(n)||d&&s.disabled(n)&&(p||i||a)||!d&&(n.pick<=u.pick||n.pick>=h.pick)))for(d&&!p&&(!a&&0<c||!i&&c<0)&&(c*=-1);s.disabled(n)&&(1<Math.abs(c)&&(n.month<l.month||n.month>l.month)&&(n=l,c=0<c?1:-1),n.pick<=u.pick?(o=!0,c=1,n=s.create([u.year,u.month,u.date+(n.pick===u.pick?0:-1)])):n.pick>=h.pick&&(r=!0,c=-1,n=s.create([h.year,h.month,h.date+(n.pick===h.pick?0:1)])),!o||!r);)n=s.create([n.year,n.month,n.date+c]);return n},n.prototype.disabled=function(t){var n=this,e=n.item.disable.filter(function(e){return v.isInteger(e)?t.day===(n.settings.firstDay?e:e-1)%7:f.isArray(e)||v.isDate(e)?t.pick===n.create(e).pick:f.isPlainObject(e)?n.withinRange(e,t):void 0});return e=e.length&&!e.filter(function(e){return f.isArray(e)&&"inverted"==e[3]||f.isPlainObject(e)&&e.inverted}).length,-1===n.item.enable?!e:e||t.pick<n.item.min.pick||t.pick>n.item.max.pick},n.prototype.parse=function(e,i,t){var a=this,o={};return i&&"string"==typeof i?(t&&t.format||((t=t||{}).format=a.settings.format),a.formats.toArray(t.format).map(function(e){var t=a.formats[e],n=t?v.trigger(t,a,[i,o]):e.replace(/^!/,"").length;t&&(o[e]=i.substr(0,n)),i=i.substr(n)}),[o.yyyy||o.yy,+(o.mm||o.m)-1,o.dd||o.d]):i},n.prototype.formats={d:function(e,t){return e?v.digits(e):t.date},dd:function(e,t){return e?2:v.lead(t.date)},ddd:function(e,t){return e?a(e):this.settings.weekdaysShort[t.day]},dddd:function(e,t){return e?a(e):this.settings.weekdaysFull[t.day]},m:function(e,t){return e?v.digits(e):t.month+1},mm:function(e,t){return e?2:v.lead(t.month+1)},mmm:function(e,t){var n=this.settings.monthsShort;return e?i(e,n,t):n[t.month]},mmmm:function(e,t){var n=this.settings.monthsFull;return e?i(e,n,t):n[t.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return v.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}},n.prototype.isDateExact=function(e,t){return v.isInteger(e)&&v.isInteger(t)||"boolean"==typeof e&&"boolean"==typeof t?e===t:(v.isDate(e)||f.isArray(e))&&(v.isDate(t)||f.isArray(t))?this.create(e).pick===this.create(t).pick:!(!f.isPlainObject(e)||!f.isPlainObject(t))&&(this.isDateExact(e.from,t.from)&&this.isDateExact(e.to,t.to))},n.prototype.isDateOverlap=function(e,t){var n=this.settings.firstDay?1:0;return v.isInteger(e)&&(v.isDate(t)||f.isArray(t))?(e=e%7+n)===this.create(t).day+1:v.isInteger(t)&&(v.isDate(e)||f.isArray(e))?(t=t%7+n)===this.create(e).day+1:!(!f.isPlainObject(e)||!f.isPlainObject(t))&&this.overlapRanges(e,t)},n.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},n.prototype.deactivate=function(e,t){var i=this,a=i.item.disable.slice(0);return"flip"==t?i.flipEnable():!1===t?(i.flipEnable(1),a=[]):!0===t?(i.flipEnable(-1),a=[]):t.map(function(e){for(var t,n=0;n<a.length;n+=1)if(i.isDateExact(e,a[n])){t=!0;break}t||(v.isInteger(e)||v.isDate(e)||f.isArray(e)||f.isPlainObject(e)&&e.from&&e.to)&&a.push(e)}),a},n.prototype.activate=function(e,t){var o=this,r=o.item.disable,s=r.length;return"flip"==t?o.flipEnable():!0===t?(o.flipEnable(1),r=[]):!1===t?(o.flipEnable(-1),r=[]):t.map(function(e){var t,n,i,a;for(i=0;i<s;i+=1){if(n=r[i],o.isDateExact(n,e)){t=r[i]=null,a=!0;break}if(o.isDateOverlap(n,e)){f.isPlainObject(e)?(e.inverted=!0,t=e):f.isArray(e)?(t=e)[3]||t.push("inverted"):v.isDate(e)&&(t=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}}if(t)for(i=0;i<s;i+=1)if(o.isDateExact(r[i],e)){r[i]=null;break}if(a)for(i=0;i<s;i+=1)if(o.isDateOverlap(r[i],e)){r[i]=null;break}t&&r.push(t)}),r.filter(function(e){return null!=e})},n.prototype.nodes=function(l){function e(e){return v.node("div"," ",d.klass["nav"+(e?"Next":"Prev")]+(e&&h.year>=m.year&&h.month>=m.month||!e&&h.year<=f.year&&h.month<=f.month?" "+d.klass.navDisabled:""),"data-nav="+(e||-1)+" "+v.ariaAttr({role:"button",controls:c.$node[0].id+"_table"})+' title="'+(e?d.labelMonthNext:d.labelMonthPrev)+'"')}function t(){var t=d.showMonthsShort?d.monthsShort:d.monthsFull;return d.selectMonths?v.node("select",v.group({min:0,max:11,i:1,node:"option",item:function(e){return[t[e],0,"value="+e+(h.month==e?" selected":"")+(h.year==f.year&&e<f.month||h.year==m.year&&e>m.month?" disabled":"")]}}),d.klass.selectMonth,(l?"":"disabled")+" "+v.ariaAttr({controls:c.$node[0].id+"_table"})+' title="'+d.labelMonthSelect+'"'):v.node("div",t[h.month],d.klass.month)}function n(){var t=h.year,e=!0===d.selectYears?5:~~(d.selectYears/2);if(e){var n=f.year,i=m.year,a=t-e,o=t+e;if(a<n&&(o+=n-a,a=n),i<o){var r=a-n,s=o-i;a-=s<r?s:r,o=i}return v.node("select",v.group({min:a,max:o,i:1,node:"option",item:function(e){return[e,0,"value="+e+(t==e?" selected":"")]}}),d.klass.selectYear,(l?"":"disabled")+" "+v.ariaAttr({controls:c.$node[0].id+"_table"})+' title="'+d.labelYearSelect+'"')}return v.node("div",t,d.klass.year)}var i,a,c=this,d=c.settings,o=c.item,r=o.now,s=o.select,u=o.highlight,h=o.view,p=o.disable,f=o.min,m=o.max,g=(i=(d.showWeekdaysFull?d.weekdaysFull:d.weekdaysShort).slice(0),a=d.weekdaysFull.slice(0),d.firstDay&&(i.push(i.shift()),a.push(a.shift())),v.node("thead",v.node("tr",v.group({min:0,max:6,i:1,node:"th",item:function(e){return[i[e],d.klass.weekdays,'scope=col title="'+a[e]+'"']}}))));return v.node("div",(d.selectYears?n()+t():t()+n())+e()+e(1),d.klass.header)+v.node("table",g+v.node("tbody",v.group({min:0,max:5,i:1,node:"tr",item:function(e){var t=d.firstDay&&0===c.create([h.year,h.month,1]).day?-7:0;return[v.group({min:7*e-h.day+t+1,max:function(){return this.min+7-1},i:1,node:"td",item:function(e){e=c.create([h.year,h.month,e+(d.firstDay?1:0)]);var t,n=s&&s.pick==e.pick,i=u&&u.pick==e.pick,a=p&&c.disabled(e)||e.pick<f.pick||e.pick>m.pick,o=v.trigger(c.formats.toString,c,[d.format,e]);return[v.node("div",e.date,(t=[d.klass.day],t.push(h.month==e.month?d.klass.infocus:d.klass.outfocus),r.pick==e.pick&&t.push(d.klass.now),n&&t.push(d.klass.selected),i&&t.push(d.klass.highlighted),a&&t.push(d.klass.disabled),t.join(" ")),"data-pick="+e.pick+" "+v.ariaAttr({role:"gridcell",label:o,selected:!(!n||c.$node.val()!==o)||null,activedescendant:!!i||null,disabled:!!a||null})),"",v.ariaAttr({role:"presentation"})]}})]}})),d.klass.table,'id="'+c.$node[0].id+'_table" '+v.ariaAttr({role:"grid",controls:c.$node[0].id,readonly:!0}))+v.node("div",v.node("button",d.today,d.klass.buttonToday,"type=button data-pick="+r.pick+(l&&!c.disabled(r)?"":" disabled")+" "+v.ariaAttr({controls:c.$node[0].id}))+v.node("button",d.clear,d.klass.buttonClear,"type=button data-clear=1"+(l?"":" disabled")+" "+v.ariaAttr({controls:c.$node[0].id}))+v.node("button",d.close,d.klass.buttonClose,"type=button data-close=true "+(l?"":" disabled")+" "+v.ariaAttr({controls:c.$node[0].id})),d.klass.footer)},n.defaults={labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",close:"Close",closeOnSelect:!0,closeOnClear:!0,updateInput:!0,format:"d mmmm, yyyy",klass:{table:(t=e.klasses().picker+"__")+"table",header:t+"header",navPrev:t+"nav--prev",navNext:t+"nav--next",navDisabled:t+"nav--disabled",month:t+"month",year:t+"year",selectMonth:t+"select--month",selectYear:t+"select--year",weekdays:t+"weekday",day:t+"day",disabled:t+"day--disabled",selected:t+"day--selected",highlighted:t+"day--highlighted",now:t+"day--today",infocus:t+"day--infocus",outfocus:t+"day--outfocus",footer:t+"footer",buttonClear:t+"button--clear",buttonToday:t+"button--today",buttonClose:t+"button--close"}},e.extend("pickadate",n)}),function(e){"function"==typeof define&&define.amd?define("picker.time",["./picker","jquery"],e):"object"==typeof exports?module.exports=e(require("./picker.js"),require("jquery")):e(Picker,jQuery)}(function(e,l){var t,a=1440,p=e._;function n(a,o){var e,t=this,n=a.$node[0].value,i=a.$node.data("value"),r=i||n,s=i?o.formatSubmit:o.format;t.settings=o,t.$node=a.$node,t.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse create validate",view:"parse create validate",disable:"deactivate",enable:"activate"},t.item={},t.item.clear=null,t.item.interval=o.interval||30,t.item.disable=(o.disable||[]).slice(0),t.item.enable=-(!0===(e=t.item.disable)[0]?e.shift():-1),t.set("min",o.min).set("max",o.max).set("now"),r?t.set("select",r,{format:s}):t.set("select",null).set("highlight",t.item.now),t.key={40:1,38:-1,39:1,37:-1,go:function(e){t.set("highlight",t.item.highlight.pick+e*t.item.interval,{interval:e*t.item.interval}),this.render()}},a.on("render",function(){function e(t){return["webkit","moz","ms","o",""].map(function(e){return(e?"-"+e+"-":"")+t})}function t(t,n){e("transform").map(function(e){t.css(e,n)}),e("transition").map(function(e){t.css(e,n)})}var n=a.$root.children(),i=n.find("."+o.klass.viewset);i.length&&(t(n,"none"),n[0].scrollTop=~~i.position().top-2*i[0].clientHeight,t(n,""))},1).on("open",function(){a.$root.find("button").attr("disabled",!1)},1).on("close",function(){a.$root.find("button").attr("disabled",!0)},1)}n.prototype.set=function(t,n,i){var a=this,e=a.item;return null===n?("clear"==t&&(t="select"),e[t]=n):(e["enable"==t?"disable":"flip"==t?"enable":t]=a.queue[t].split(" ").map(function(e){return n=a[e](t,n,i)}).pop(),"select"==t?a.set("highlight",e.select,i):"highlight"==t?a.set("view",e.highlight,i):"interval"==t?a.set("min",e.min,i).set("max",e.max,i):t.match(/^(flip|min|max|disable|enable)$/)&&(e.select&&a.disabled(e.select)&&a.set("select",n,i),e.highlight&&a.disabled(e.highlight)&&a.set("highlight",n,i),"min"==t&&a.set("max",e.max,i))),a},n.prototype.get=function(e){return this.item[e]},n.prototype.create=function(e,t,n){var i=this;return t=void 0===t?e:t,p.isDate(t)&&(t=[t.getHours(),t.getMinutes()]),l.isPlainObject(t)&&p.isInteger(t.pick)?t=t.pick:l.isArray(t)?t=60*+t[0]+ +t[1]:p.isInteger(t)||(t=i.now(e,t,n)),"max"==e&&t<i.item.min.pick&&(t+=a),"min"!=e&&"max"!=e&&(t-i.item.min.pick)%i.item.interval!=0&&(t+=i.item.interval),{hour:~~(24+(t=i.normalize(e,t,n))/60)%24,mins:(60+t%60)%60,time:(a+t)%a,pick:t%a}},n.prototype.createRange=function(e,t){function n(e){return!0===e||l.isArray(e)||p.isDate(e)?i.create(e):e}var i=this;return p.isInteger(e)||(e=n(e)),p.isInteger(t)||(t=n(t)),p.isInteger(e)&&l.isPlainObject(t)?e=[t.hour,t.mins+e*i.settings.interval]:p.isInteger(t)&&l.isPlainObject(e)&&(t=[e.hour,e.mins+t*i.settings.interval]),{from:n(e),to:n(t)}},n.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},n.prototype.overlapRanges=function(e,t){var n=this;return e=n.createRange(e.from,e.to),t=n.createRange(t.from,t.to),n.withinRange(e,t.from)||n.withinRange(e,t.to)||n.withinRange(t,e.from)||n.withinRange(t,e.to)},n.prototype.now=function(e,t){var n,i=this.item.interval,a=new Date,o=60*a.getHours()+a.getMinutes();return o-=o%i,n=t<0&&i*t+o<=-i,o+="min"==e&&n?0:i,p.isInteger(t)&&(o+=i*(n&&"max"!=e?t+1:t)),o},n.prototype.normalize=function(e,t){var n=this.item.interval,i=this.item.min&&this.item.min.pick||0;return t-="min"==e?0:(t-i)%n},n.prototype.measure=function(e,t,n){return"string"==typeof(t=t||("min"==e?[0,0]:[23,59]))?t=this.parse(e,t):!0===t||p.isInteger(t)?t=this.now(e,t,n):l.isPlainObject(t)&&p.isInteger(t.pick)&&(t=this.normalize(e,t.pick,n)),t},n.prototype.validate=function(e,t,n){var i=this,a=n&&n.interval?n.interval:i.item.interval;return i.disabled(t)&&(t=i.shift(t,a)),t=i.scope(t),i.disabled(t)&&(t=i.shift(t,-1*a)),t},n.prototype.disabled=function(t){var n=this,e=n.item.disable.filter(function(e){return p.isInteger(e)?t.hour==e:l.isArray(e)||p.isDate(e)?t.pick==n.create(e).pick:l.isPlainObject(e)?n.withinRange(e,t):void 0});return e=e.length&&!e.filter(function(e){return l.isArray(e)&&"inverted"==e[2]||l.isPlainObject(e)&&e.inverted}).length,-1===n.item.enable?!e:e||t.pick<n.item.min.pick||t.pick>n.item.max.pick},n.prototype.shift=function(e,t){var n=this,i=n.item.min.pick,a=n.item.max.pick;for(t=t||n.item.interval;n.disabled(e)&&!((e=n.create(e.pick+=t)).pick<=i||e.pick>=a););return e},n.prototype.scope=function(e){var t=this.item.min.pick,n=this.item.max.pick;return this.create(e.pick>n?n:e.pick<t?t:e)},n.prototype.parse=function(e,a,t){var n,i,o,r,s,l=this,c={};if(!a||"string"!=typeof a)return a;for(r in t&&t.format||((t=t||{}).format=l.settings.format),l.formats.toArray(t.format).map(function(e){var t,n=l.formats[e],i=n?p.trigger(n,l,[a,c]):e.replace(/^!/,"").length;n&&(t=a.substr(0,i),c[e]=t.match(/^\d+$/)?+t:t),a=a.substr(i)}),c)s=c[r],p.isInteger(s)?r.match(/^(h|hh)$/i)?(n=s,"h"!=r&&"hh"!=r||(n%=12)):"i"==r&&(i=s):r.match(/^a$/i)&&s.match(/^p/i)&&("h"in c||"hh"in c)&&(o=!0);return 60*(o?n+12:n)+i},n.prototype.formats={h:function(e,t){return e?p.digits(e):t.hour%12||12},hh:function(e,t){return e?2:p.lead(t.hour%12||12)},H:function(e,t){return e?p.digits(e):""+t.hour%24},HH:function(e,t){return e?p.digits(e):p.lead(t.hour%24)},i:function(e,t){return e?2:p.lead(t.mins)},a:function(e,t){return e?4:t.time%a<720?"a.m.":"p.m."},A:function(e,t){return e?2:t.time%a<720?"AM":"PM"},toArray:function(e){return e.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return p.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}},n.prototype.isTimeExact=function(e,t){return p.isInteger(e)&&p.isInteger(t)||"boolean"==typeof e&&"boolean"==typeof t?e===t:(p.isDate(e)||l.isArray(e))&&(p.isDate(t)||l.isArray(t))?this.create(e).pick===this.create(t).pick:!(!l.isPlainObject(e)||!l.isPlainObject(t))&&(this.isTimeExact(e.from,t.from)&&this.isTimeExact(e.to,t.to))},n.prototype.isTimeOverlap=function(e,t){return p.isInteger(e)&&(p.isDate(t)||l.isArray(t))?e===this.create(t).hour:p.isInteger(t)&&(p.isDate(e)||l.isArray(e))?t===this.create(e).hour:!(!l.isPlainObject(e)||!l.isPlainObject(t))&&this.overlapRanges(e,t)},n.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},n.prototype.deactivate=function(e,t){var i=this,a=i.item.disable.slice(0);return"flip"==t?i.flipEnable():!1===t?(i.flipEnable(1),a=[]):!0===t?(i.flipEnable(-1),a=[]):t.map(function(e){for(var t,n=0;n<a.length;n+=1)if(i.isTimeExact(e,a[n])){t=!0;break}t||(p.isInteger(e)||p.isDate(e)||l.isArray(e)||l.isPlainObject(e)&&e.from&&e.to)&&a.push(e)}),a},n.prototype.activate=function(e,t){var o=this,r=o.item.disable,s=r.length;return"flip"==t?o.flipEnable():!0===t?(o.flipEnable(1),r=[]):!1===t?(o.flipEnable(-1),r=[]):t.map(function(e){var t,n,i,a;for(i=0;i<s;i+=1){if(n=r[i],o.isTimeExact(n,e)){t=r[i]=null,a=!0;break}if(o.isTimeOverlap(n,e)){l.isPlainObject(e)?(e.inverted=!0,t=e):l.isArray(e)?(t=e)[2]||t.push("inverted"):p.isDate(e)&&(t=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}}if(t)for(i=0;i<s;i+=1)if(o.isTimeExact(r[i],e)){r[i]=null;break}if(a)for(i=0;i<s;i+=1)if(o.isTimeOverlap(r[i],e)){r[i]=null;break}t&&r.push(t)}),r.filter(function(e){return null!=e})},n.prototype.i=function(e,t){return p.isInteger(t)&&0<t?t:this.item.interval},n.prototype.nodes=function(e){var s=this,l=s.settings,c=s.item.select,d=s.item.highlight,u=s.item.view,h=s.item.disable;return p.node("ul",p.group({min:s.item.min.pick,max:s.item.max.pick,i:s.item.interval,node:"li",item:function(e){var t,n=(e=s.create(e)).pick,i=c&&c.pick==n,a=d&&d.pick==n,o=h&&s.disabled(e),r=p.trigger(s.formats.toString,s,[l.format,e]);return[p.trigger(s.formats.toString,s,[p.trigger(l.formatLabel,s,[e])||l.format,e]),(t=[l.klass.listItem],i&&t.push(l.klass.selected),a&&t.push(l.klass.highlighted),u&&u.pick==n&&t.push(l.klass.viewset),o&&t.push(l.klass.disabled),t.join(" ")),"data-pick="+e.pick+" "+p.ariaAttr({role:"option",label:r,selected:!(!i||s.$node.val()!==r)||null,activedescendant:!!a||null,disabled:!!o||null})]}})+p.node("li",p.node("button",l.clear,l.klass.buttonClear,"type=button data-clear=1"+(e?"":" disabled")+" "+p.ariaAttr({controls:s.$node[0].id})),"",p.ariaAttr({role:"presentation"})),l.klass.list,p.ariaAttr({role:"listbox",controls:s.$node[0].id}))},n.defaults={clear:"Clear",format:"h:i A",interval:30,closeOnSelect:!0,closeOnClear:!0,updateInput:!0,klass:{picker:(t=e.klasses().picker)+" "+t+"--time",holder:t+"__holder",list:t+"__list",listItem:t+"__list-item",disabled:t+"__list-item--disabled",selected:t+"__list-item--selected",highlighted:t+"__list-item--highlighted",viewset:t+"__list-item--viewset",now:t+"__list-item--now",buttonClear:t+"__button--clear"}},e.extend("pickatime",n)}),define("mockup-patterns-pickadate",["jquery","pat-base","mockup-utils","translate","picker","picker.date","picker.time","mockup-patterns-select2"],function(r,e,s,t){"use strict";return e.extend({name:"pickadate",trigger:".pat-pickadate",parser:"mockup",defaults:{separator:" ",date:{selectYears:!0,selectMonths:!0,formatSubmit:"yyyy-mm-dd",format:"yyyy-mm-dd",labelMonthNext:t("Next month"),labelMonthPrev:t("Previous month"),labelMonthSelect:t("Select a month"),labelYearSelect:t("Select a year"),clear:!1,close:!1,today:!1},time:{clear:!1},today:t("Today"),clear:t("Clear"),timezone:null,autoSetTimeOnDateChange:"+[0,0]",classWrapperName:"pattern-pickadate-wrapper",classSeparatorName:"pattern-pickadate-separator",classDateName:"pattern-pickadate-date",classDateWrapperName:"pattern-pickadate-date-wrapper",classTimeName:"pattern-pickadate-time",classTimeWrapperName:"pattern-pickadate-time-wrapper",classTimezoneName:"pattern-pickadate-timezone",classTimezoneWrapperName:"pattern-pickadate-timezone-wrapper",classClearName:"pattern-pickadate-clear",classNowName:"pattern-pickadate-now",placeholderDate:t("Enter date..."),placeholderTime:t("Enter time..."),placeholderTimezone:t("Enter timezone...")},parseTimeOffset:function(t){var e=void 0;0===t.indexOf("+")?(e="+",t=t.split("+")[1]):0===t.indexOf("-")&&(e="-",t=t.split("-")[1]);try{t=JSON.parse(t)}catch(e){t=void 0}if(!1===t)return!1;if(!0===t||!0!==Array.isArray(t))return[0,0];var n=parseInt(t[0],10)||0,i=parseInt(t[1],10)||0;if("+"===e||"-"===e){var a=new Date,o=a.getHours(),r=a.getMinutes();"+"===e?(23<(n=o+n)&&(n=23),59<(i=r+i)&&(i=59)):"-"===e&&((n=o-n)<0&&(n=0),(i=r-i)<0&&(i=0))}return[n,i]},init:function(){var n=this,e=n.$el.val().split(" "),t=e[0]||"",i=e[1]||"";if(!1===s.bool(n.options.date)&&(n.options.date=!1),!1===s.bool(n.options.time)&&(n.options.time=!1),n.options.autoSetTimeOnDateChange=n.parseTimeOffset(n.options.autoSetTimeOnDateChange),!1===n.options.date&&(i=e[0]),n.$el.hide(),n.$wrapper=r("<div/>").addClass(n.options.classWrapperName).insertAfter(n.$el),!1!==n.options.date&&(n.$date=r('<input type="text"/>').attr("placeholder",n.options.placeholderDate).attr("data-value",t).addClass(n.options.classDateName).appendTo(r("<div/>").addClass(n.options.classDateWrapperName).appendTo(n.$wrapper)).pickadate(r.extend(!0,{},n.options.date,{onSet:function(e){void 0!==e.select&&(n.$date.attr("data-value",e.select),!1!==n.options.autoSetTimeOnDateChange&&n.$time&&(n.$time.pickatime("picker").get("select")||n.$time.pickatime("picker").set("select",n.options.autoSetTimeOnDateChange)),!1!==n.options.time&&""===n.$time.attr("data-value")||n.updateValue.call(n)),e.hasOwnProperty("clear")&&(n.$el.val(""),n.$date.attr("data-value",""))}}))),!1!==n.options.time&&(n.options.time.formatSubmit="HH:i",n.$time=r('<input type="text"/>').attr("placeholder",n.options.placeholderTime).attr("data-value",i).addClass(n.options.classTimeName).appendTo(r("<div/>").addClass(n.options.classTimeWrapperName).appendTo(n.$wrapper)).pickatime(r.extend(!0,{},n.options.time,{onSet:function(e){void 0!==e.select&&(n.$time.attr("data-value",e.select),!1!==n.options.date&&""===n.$date.attr("data-value")||n.updateValue.call(n)),e.hasOwnProperty("clear")&&(n.$el.val(""),n.$time.attr("data-value",""))}})),"string"==typeof i&&"00"===i.substring(0,2)&&(n.$time.pickatime("picker").set("select",i.split(":")),n.$time.attr("data-value",i))),!1!==n.options.date&&!1!==n.options.time&&n.options.timezone&&(n.$separator=r("<span/>").addClass(n.options.classSeparatorName).html(" "===n.options.separator?"&nbsp;":n.options.separator).appendTo(n.$wrapper)),null!==n.options.timezone){n.$timezone=r('<input type="text"/>').addClass(n.options.classTimezoneName).appendTo(r("<div/>").addClass(n.options.classTimezoneWrapperName).appendTo(n.$wrapper)).patternSelect2(r.extend(!0,{placeholder:n.options.placeholderTimezone,width:"10em"},n.options.timezone,{multiple:!1})).on("change",function(e){void 0!==e.val&&(n.$timezone.attr("data-value",e.val),!1!==n.options.date&&""===n.$date.attr("data-value")||!1!==n.options.time&&""===n.$time.attr("data-value")||n.updateValue.call(n))});var a,o=n.options.timezone.default;if(o)n.options.timezone.data.some(function(e){return a=e.text===n.options.timezone.default}),a&&(n.$timezone.attr("data-value",o),n.$timezone.parent().find(".select2-chosen").text(o));1===n.options.timezone.data.length&&(n.$timezone.attr("data-value",n.options.timezone.data[0].text),n.$timezone.parent().find(".select2-chosen").text(n.options.timezone.data[0].text),n.$timezone.select2("enable",!1))}s.bool(n.options.today)&&(n.$now=r('<button type="button" class="btn btn-xs btn-info" title="'+n.options.today+'"><span class="glyphicon glyphicon-time"></span></button>').addClass(n.options.classNowName).on("click",function(e){e.preventDefault();var t=new Date;n.$date&&n.$date.data("pickadate").set("select",t),n.$time&&n.$time.data("pickatime").set("select",t),n.emit("updated")}).appendTo(n.$wrapper)),s.bool(n.options.clear)&&(n.$clear=r('<button type="button" class="btn btn-xs btn-danger" title="'+n.options.clear+'"><span class="glyphicon glyphicon-trash"></span></button>').addClass(n.options.classClearName).on("click",function(e){e.preventDefault(),n.$date&&n.$date.data("pickadate").clear(),n.$time&&n.$time.data("pickatime").clear(),n.emit("updated")}).appendTo(n.$wrapper))},updateValue:function(){var e=this,t="";if(!1!==e.options.date){var n=e.$date.data("pickadate").component,i=e.$date.data("pickadate").get("select"),a=n.formats.toString;i&&(t+=a.apply(n,[e.options.date.formatSubmit,i]))}if(!1!==e.options.date&&!1!==e.options.time&&(t+=" "),!1!==e.options.time){var o=e.$time.data("pickatime").component,r=e.$time.data("pickatime").get("select"),s=o.formats.toString;r&&(t+=s.apply(o,["HH:i",r]))}if(null!==e.options.timezone){var l=" "+e.$timezone.attr("data-value");l&&(t+=l)}e.$el.val(t),e.emit("updated")}})}),require(["mockup-patterns-inlinevalidation","mockup-patterns-recurrence","mockup-patterns-relateditems","mockup-patterns-pickadate","mockup-patterns-select2"],function(){}),define("/home/_thet/data/dev/plone/buildout.coredev/src/plone.staticresources/src/plone/staticresources/static/plone-logged-in.js",function(){});
//# sourceMappingURL=plone-logged-in-compiled.min.js.map